# ナレッジデータ管理画面の操作ガイド

## 📊 表示の更新方法

### 総ファイル数・総容量・重複データ・最終整理の表示を更新するには

**「状況更新」ボタンをクリック**することで、すべての統計情報が最新の状態に更新されます。

#### 更新される情報

1. **総ファイル数** (`storageStats.totalFiles`)
   - ナレッジベース内のすべてのファイル数
   - エクスポートファイル数とドキュメントファイル数の内訳

2. **総容量** (`storageStats.totalSize`)
   - ナレッジベース全体の容量（MB単位）
   - アーカイブファイル数の表示

3. **重複データ** (`storageStats.duplicates`)
   - 重複しているファイル・データの数

4. **最終整理** (`storageStats.lastMaintenance`)
   - 最後にメンテナンスが実行された日時
   - 次回整理予定日

#### 内部的な動作

- **API**: `/api/knowledge-base/stats` を呼び出し
- **関数**: `fetchStorageStats()` を実行
- **自動更新**: ページ読み込み時（`useEffect`）にも自動実行

---

## 🔧 管理操作の4つの処理

### 1. **自動整理** (🔄 リフレッシュアイコン)

**処理内容**:
- ナレッジベースのメンテナンス処理を実行
- データの整理・最適化を自動で行う

**API**: `POST /api/knowledge/maintenance/run`

**動作**:
```typescript
const runMaintenance = async () => {
  // /api/knowledge/maintenance/run を呼び出し
  // 実行後、統計情報を自動更新
  await fetchStorageStats();
}
```

**実行後**: 統計情報が自動的に更新されます

---

### 2. **重複解決** (🎯 ターゲットアイコン)

**処理内容**:
- システム内の重複しているナレッジデータを検出
- 重複データの解決（削除・統合など）を実行

**API**: `POST /api/knowledge/deduplication/resolve`

**動作**:
```typescript
const resolveDuplicates = async () => {
  // /api/knowledge/deduplication/resolve を呼び出し
  // 重複データを解決
  // 実行後、統計情報を自動更新
  await fetchStorageStats();
}
```

**実行後**: 重複データ数が減り、統計情報が自動更新されます

---

### 3. **状況更新** (⚡ アクティビティアイコン)

**処理内容**:
- ナレッジデータの現在の状態を再集計
- 画面表示を最新の情報に更新

**API**: `GET /api/knowledge-base/stats`

**動作**:
```typescript
const fetchStorageStats = async () => {
  // /api/knowledge-base/stats を呼び出し
  // 統計情報を取得して画面表示を更新
  setStorageStats({
    totalFiles: data.total,
    totalSize: data.totalSize,
    duplicates: data.duplicates,
    lastMaintenance: data.lastMaintenance,
    ...
  });
}
```

**更新される情報**:
- 総ファイル数
- 総容量
- 重複データ数
- 最終整理日時
- エクスポートファイル数
- ドキュメントファイル数
- アーカイブファイル数

**使用タイミング**:
- データを追加・削除した後
- 手動で最新情報を確認したい時
- 他の操作実行後（自動で実行される場合もあり）

---

### 4. **アーカイブ** (📦 データベースアイコン)

**処理内容**:
- **現在は準備中**の機能
- クリックすると「アーカイブ表示機能は準備中です」というアラートが表示される

**予定される機能**:
- ナレッジデータの一部または全体をアーカイブ状態に移行
- 頻繁に使用しないデータを分離して管理
- アーカイブされたファイルの一覧表示

**注意**: 
- 下部の「エクスポートオプション」セクションにある「アーカイブ一覧表示」ボタンは動作します
- このボタンは `/api/knowledge-base/archives` を呼び出してアーカイブファイルの一覧を表示します

---

## 📝 その他の操作

### 整理ポリシー

画面左側で整理ポリシーを選択できます：

1. **手動整理のみ**
   - 自動的な整理は行わない
   - 手動で操作を実行する必要がある

2. **積極的整理（6ヶ月以上の古いデータ）**
   - 6ヶ月以上経過したデータを自動的に整理
   - 「自動整理」ボタン実行時に適用

3. **保守的整理（1年以上の古いデータ）**
   - 1年以上経過したデータを保守的に整理
   - 「自動整理」ボタン実行時に適用

### 削除操作

画面下部の「ナレッジデータ削除」セクションで：

1. **1年以上経過データを削除**
   - API: `POST /api/knowledge-base/cleanup/auto`
   - 1年以上古いファイルを自動削除

2. **全ナレッジデータを削除**
   - API: `POST /api/knowledge-base/cleanup/manual` (deleteAll: true)
   - すべてのナレッジデータを削除（確認ダイアログあり）

### エクスポート操作

1. **全データエクスポート**
   - API: `POST /api/knowledge-base/export`
   - ZIPファイルとしてダウンロード

2. **アーカイブ一覧表示**
   - API: `GET /api/knowledge-base/archives`
   - アーカイブされたファイルの一覧を表示

---

## ⚠️ 重要な注意事項

- **削除したデータは復元できません**
- 重要なデータは事前にエクスポートを推奨
- 「状況更新」ボタンで最新の状態を確認できます
- 各操作実行後は自動的に統計情報が更新されます

