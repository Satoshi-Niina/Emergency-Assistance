const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D4_QFRUw.js","assets/ui-BaYWhfWe.js","assets/vendor-C0Yfakdp.js","assets/index-D8OdIOAq.css"])))=>i.map(i=>d[i]);
import{d as e,u as s,f as a,a as t,_ as i,W as r,L as n,B as l,S as c}from"./index-D4_QFRUw.js";import{j as o}from"./ui-BaYWhfWe.js";import{r as d}from"./vendor-C0Yfakdp.js";import{C as h,c as m,a as x,b as j}from"./card-Cwo0jHfR.js";import{I as p}from"./input-FnMOQTl6.js";import{L as u}from"./label-CmO-ANr9.js";import{T as g,a as y,b as f,c as b,d as w,e as v}from"./table-Dkpwn9-C.js";import{D as N,f as _,a as A,c as S,b as k,d as E,e as C}from"./dialog-CDOEvz8g.js";import{S as T,b as U,c as I,d as P,e as L}from"./select-pqHZxxVK.js";import{A as O}from"./arrow-left-KSc1dkfP.js";import{P as $}from"./plus-DxKd94XR.js";import{S as J}from"./square-pen-E1CytUDv.js";import{T as z}from"./trash-2-Dv20Tsaj.js";import{S as D}from"./search-CeFhu50c.js";import"./index-jVOyRz7F.js";import"./index-CttfQz0H.js";import"./check-C-i65cFq.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=e("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function R(){const{user:e,isLoading:R}=s(),{toast:B}=a(),F=t(),[q,H]=d.useState(!0),[Q,W]=d.useState(null),[G,K]=d.useState([]),[M,X]=d.useState([]),[Y,Z]=d.useState([]),[ee,se]=d.useState(""),[ae,te]=d.useState("all"),[ie,re]=d.useState(!1),[ne,le]=d.useState(!1),[ce,oe]=d.useState(null),[de,he]=d.useState(null),[me,xe]=d.useState(""),[je,pe]=d.useState(""),[ue,ge]=d.useState("");d.useEffect(()=>{R||e||F("/chat")},[e,R,F]),d.useEffect(()=>{ye()},[]),d.useEffect(()=>{let e=M;ee.trim()&&(e=e.filter(e=>e.machine_number.toLowerCase().includes(ee.toLowerCase())||e.machine_type_name&&e.machine_type_name.toLowerCase().includes(ee.toLowerCase()))),"all"!==ae&&(e=e.filter(e=>e.machine_type_id===ae)),Z(e)},[M,ee,ae]);const ye=async()=>{try{H(!0),W(null);const{buildApiUrl:e}=await i(async()=>{const{buildApiUrl:e}=await import("./index-D4_QFRUw.js").then(e=>e.J);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),s=await fetch(e("/machines/machine-types")),a=s.headers.get("content-type")||"";if(!s.ok||!a.includes("application/json")){const e=await s.text();throw console.error("APIレスポンス非JSON:",s.status,a,e.slice(0,200)),new Error("API非JSON: "+s.status+" "+a)}const t=await s.json();if(console.log("機種タイプAPIレスポンス:",t),t.success){const e=t.machineTypes||t.data||[];console.log("機種タイプデータ:",e);const s=e.map(e=>({id:e.id,machine_type_name:e.name||e.machine_type_name||e.category}));K(s)}const r=await fetch(e("/machines")),n=r.headers.get("content-type")||"";if(!r.ok||!n.includes("application/json")){const e=await r.text();throw console.error("APIレスポンス非JSON:",r.status,n,e.slice(0,200)),new Error("API非JSON: "+r.status+" "+n)}const l=await r.json();if(console.log("機械APIレスポンス:",l),l.success){const e=l.machines||l.data||[];console.log("機械データ:",e);const s=e.map(e=>({id:e.id,machine_number:e.machine_number,machine_type_id:e.machine_type_id,machine_type_name:e.type||e.machine_type_name}));X(s)}}catch(e){console.error("データ取得エラー:",e),W(e instanceof Error?e:new Error("Unknown error")),B({title:"エラー",description:"データの取得に失敗しました",variant:"destructive"})}finally{H(!1)}},fe=()=>{oe(null),xe(""),re(!1)},be=()=>{he(null),pe(""),ge(""),le(!1)};return R||q?o.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 max-w-7xl mx-auto w-full bg-gradient-to-br from-blue-50 to-indigo-50",children:o.jsx("div",{className:"flex justify-center items-center h-64",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),o.jsx("p",{className:"text-blue-600",children:"読み込み中..."})]})})}):o.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 max-w-7xl mx-auto w-full bg-gradient-to-br from-blue-50 to-indigo-50",children:[o.jsx("div",{className:"mb-6",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsxs("h1",{className:"text-2xl font-bold flex items-center bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[o.jsx(r,{className:"mr-2 h-6 w-6 text-indigo-500"}),"機種・機械番号管理"]}),o.jsx("p",{className:"text-blue-400",children:"機種と機械番号の一覧表示、追加、編集、削除ができます"})]}),o.jsx(n,{to:"/settings",children:o.jsxs(l,{variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-50",children:[o.jsx(O,{className:"mr-2 h-4 w-4"}),"設定に戻る"]})})]})}),Q&&o.jsx(h,{className:"mb-6 border-red-200 bg-red-50",children:o.jsx(m,{className:"pt-6",children:o.jsxs("div",{className:"text-red-600",children:[o.jsx("p",{className:"font-medium",children:"エラーが発生しました"}),o.jsx("p",{className:"text-sm",children:Q.message})]})})}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[o.jsxs(h,{className:"lg:col-span-1",children:[o.jsx(x,{className:"pb-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:o.jsxs(j,{className:"text-lg flex items-center justify-between",children:[o.jsxs("span",{className:"flex items-center",children:[o.jsx(c,{className:"mr-2 h-5 w-5"}),"機種管理"]}),o.jsxs(N,{open:ie,onOpenChange:re,children:[o.jsx(_,{asChild:!0,children:o.jsxs(l,{size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-white/30",onClick:fe,children:[o.jsx($,{className:"mr-1 h-3 w-3"}),"追加"]})}),o.jsxs(A,{children:[o.jsxs(S,{children:[o.jsx(k,{children:ce?"機種を編集":"新規機種追加"}),o.jsx(E,{children:ce?"機種名を編集してください":"新しい機種名を入力してください"})]}),o.jsx("div",{className:"space-y-4",children:o.jsxs("div",{children:[o.jsx(u,{htmlFor:"type-name",children:"機種名"}),o.jsx(p,{id:"type-name",value:me,onChange:e=>xe(e.target.value),placeholder:"機種名を入力"})]})}),o.jsxs(C,{children:[o.jsx(l,{variant:"outline",onClick:fe,children:"キャンセル"}),o.jsx(l,{onClick:async()=>{if(me.trim())try{const{buildApiUrl:e}=await i(async()=>{const{buildApiUrl:e}=await import("./index-D4_QFRUw.js").then(e=>e.J);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),s=e(ce?`/machines/machine-types/${ce.id}`:"/machines/machine-types"),a=ce?"PUT":"POST",t=localStorage.getItem("authToken"),r={"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}},n=await fetch(s,{method:a,headers:r,body:JSON.stringify({name:me.trim(),category:me.trim(),machine_type_name:me.trim()})});if(!n.ok){const e=await n.text();throw console.error("機種保存失敗:",n.status,e),new Error("機種の保存に失敗しました")}{const e=await n.json();console.log("機種保存成功:",e),B({title:ce?"機種を更新しました":"機種を追加しました",description:`${me} が正常に処理されました`}),xe(""),oe(null),re(!1),console.log("データ再取得を開始..."),await ye(),console.log("データ再取得完了")}}catch(e){console.error("機種保存エラー:",e),B({title:"エラー",description:"機種の保存に失敗しました",variant:"destructive"})}},children:ce?"更新":"追加"})]})]})]})]})}),o.jsx(m,{className:"p-0",children:o.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===G.length?o.jsx("div",{className:"p-4 text-center text-gray-500",children:"機種が登録されていません"}):o.jsx("div",{className:"divide-y",children:G.map(e=>o.jsx("div",{className:"p-4 hover:bg-gray-50",children:o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-gray-900",children:e.machine_type_name}),o.jsxs("p",{className:"text-sm text-gray-500",children:[M.filter(s=>s.machine_type_id===e.id).length,"台の機械"]})]}),o.jsxs("div",{className:"flex gap-1",children:[o.jsx(l,{variant:"ghost",size:"sm",onClick:()=>(e=>{oe(e),xe(e.machine_type_name),re(!0)})(e),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:o.jsx(J,{className:"h-3 w-3"})}),o.jsx(l,{variant:"ghost",size:"sm",onClick:()=>(async(e,s)=>{if(confirm(`機種「${s}」を削除してもよろしいですか？\n関連する機械番号も削除されます。`))try{const a=localStorage.getItem("authToken"),t={...a&&{Authorization:`Bearer ${a}`}},{buildApiUrl:r}=await i(async()=>{const{buildApiUrl:e}=await import("./index-D4_QFRUw.js").then(e=>e.J);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3]));if(!(await fetch(r(`/machines/machine-types/${e}`),{method:"DELETE",headers:t})).ok)throw new Error("機種の削除に失敗しました");B({title:"機種を削除しました",description:`${s} と関連する機械番号が削除されました`}),ye()}catch(a){console.error("機種削除エラー:",a),B({title:"エラー",description:"機種の削除に失敗しました",variant:"destructive"})}})(e.id,e.machine_type_name),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:o.jsx(z,{className:"h-3 w-3"})})]})]})},e.id))})})})]}),o.jsxs(h,{className:"lg:col-span-2",children:[o.jsx(x,{className:"pb-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white",children:o.jsxs(j,{className:"text-lg flex items-center justify-between",children:[o.jsxs("span",{className:"flex items-center",children:[o.jsx(V,{className:"mr-2 h-5 w-5"}),"機械番号管理"]}),o.jsxs(N,{open:ne,onOpenChange:le,children:[o.jsx(_,{asChild:!0,children:o.jsxs(l,{size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-white/30",onClick:be,children:[o.jsx($,{className:"mr-1 h-3 w-3"}),"追加"]})}),o.jsxs(A,{children:[o.jsxs(S,{children:[o.jsx(k,{children:de?"機械番号を編集":"新規機械番号追加"}),o.jsx(E,{children:de?"機械番号を編集してください":"新しい機械番号を入力してください"})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{children:[o.jsx(u,{htmlFor:"machine-type",children:"機種"}),o.jsxs(T,{value:ue,onValueChange:ge,children:[o.jsx(U,{children:o.jsx(I,{placeholder:"機種を選択"})}),o.jsx(P,{children:G.map(e=>o.jsx(L,{value:e.id,children:e.machine_type_name},e.id))})]})]}),o.jsxs("div",{children:[o.jsx(u,{htmlFor:"machine-number",children:"機械番号"}),o.jsx(p,{id:"machine-number",value:je,onChange:e=>pe(e.target.value),placeholder:"機械番号を入力"})]})]}),o.jsxs(C,{children:[o.jsx(l,{variant:"outline",onClick:be,children:"キャンセル"}),o.jsx(l,{onClick:async()=>{if(je.trim()&&ue)try{const{buildApiUrl:e}=await i(async()=>{const{buildApiUrl:e}=await import("./index-D4_QFRUw.js").then(e=>e.J);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),s=e(de?`/machines/${de.id}`:"/machines"),a=de?"PUT":"POST",t=localStorage.getItem("authToken"),r={"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}};if(!(await fetch(s,{method:a,headers:r,body:JSON.stringify({machine_number:je.trim(),machine_type_id:ue})})).ok)throw new Error("機械番号の保存に失敗しました");B({title:de?"機械番号を更新しました":"機械番号を追加しました",description:`${je} が正常に処理されました`}),pe(""),ge(""),he(null),le(!1),ye()}catch(e){console.error("機械番号保存エラー:",e),B({title:"エラー",description:"機械番号の保存に失敗しました",variant:"destructive"})}},children:de?"更新":"追加"})]})]})]})]})}),o.jsxs(m,{children:[o.jsx("div",{className:"mb-4 space-y-4",children:o.jsxs("div",{className:"flex gap-4",children:[o.jsx("div",{className:"flex-1",children:o.jsxs("div",{className:"relative",children:[o.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),o.jsx(p,{placeholder:"機械番号または機種名で検索...",value:ee,onChange:e=>se(e.target.value),className:"pl-10"})]})}),o.jsx("div",{className:"w-48",children:o.jsxs(T,{value:ae,onValueChange:te,children:[o.jsx(U,{children:o.jsx(I,{placeholder:"機種でフィルター"})}),o.jsxs(P,{children:[o.jsx(L,{value:"all",children:"すべての機種"}),G.map(e=>o.jsx(L,{value:e.id,children:e.machine_type_name},e.id))]})]})})]})}),o.jsx("div",{className:"border rounded-lg",children:o.jsxs(g,{children:[o.jsx(y,{children:o.jsxs(f,{children:[o.jsx(b,{children:"機械番号"}),o.jsx(b,{children:"機種"}),o.jsx(b,{className:"text-right",children:"操作"})]})}),o.jsx(w,{children:0===Y.length?o.jsx(f,{children:o.jsx(v,{colSpan:3,className:"text-center py-8 text-gray-500",children:ee||"all"!==ae?"検索条件に一致する機械番号が見つかりません":"機械番号が登録されていません"})}):Y.map(e=>o.jsxs(f,{children:[o.jsx(v,{className:"font-medium",children:e.machine_number}),o.jsx(v,{children:e.machine_type_name}),o.jsx(v,{className:"text-right",children:o.jsxs("div",{className:"flex justify-end gap-1",children:[o.jsx(l,{variant:"ghost",size:"sm",onClick:()=>(e=>{he(e),pe(e.machine_number),ge(e.machine_type_id),le(!0)})(e),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:o.jsx(J,{className:"h-3 w-3"})}),o.jsx(l,{variant:"ghost",size:"sm",onClick:()=>(async(e,s)=>{if(confirm(`機械番号「${s}」を削除してもよろしいですか？`))try{const a=localStorage.getItem("authToken"),t={...a&&{Authorization:`Bearer ${a}`}},{buildApiUrl:r}=await i(async()=>{const{buildApiUrl:e}=await import("./index-D4_QFRUw.js").then(e=>e.J);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3]));if(!(await fetch(r(`/machines/${e}`),{method:"DELETE",headers:t})).ok)throw new Error("機械番号の削除に失敗しました");B({title:"機械番号を削除しました",description:`${s} が削除されました`}),ye()}catch(a){console.error("機械番号削除エラー:",a),B({title:"エラー",description:"機械番号の削除に失敗しました",variant:"destructive"})}})(e.id,e.machine_number),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:o.jsx(z,{className:"h-3 w-3"})})]})})]},e.id))})]})})]})]})]})]})}export{R as default};
