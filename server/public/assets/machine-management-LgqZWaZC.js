import{j as e}from"./ui-BaYWhfWe.js";import{r as s}from"./vendor-C0Yfakdp.js";import{d as a,u as t,f as i,a as r,W as n,L as l,B as c,S as o}from"./index-Bi0_jrGv.js";import{C as h,c as d,a as m,b as x}from"./card-BB112kUH.js";import{I as j}from"./input-DqBO3U1S.js";import{L as p}from"./label-dv4x1FJC.js";import{T as u,a as g,b as f,c as y,d as v,e as b}from"./table-D3DKZgjn.js";import{D as w,f as N,a as _,c as S,b as k,d as C,e as E}from"./dialog-HugNRQS3.js";import{S as $,a as T,b as A,c as I,d as O}from"./select-CGKBBxlh.js";import{A as P}from"./arrow-left--aqnZ3iS.js";import{P as z}from"./plus-Ot00y2Fk.js";import{S as L}from"./square-pen-kv3tigZZ.js";import{T as J}from"./trash-2-C6P-e9bS.js";import{S as B}from"./search-DbbGlS3J.js";import"./index-jVOyRz7F.js";import"./index-CttfQz0H.js";import"./check-CRHhj4fp.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=a("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function D(){const{user:a,isLoading:D}=t(),{toast:F}=i(),V=r(),[q,H]=s.useState(!0),[Q,W]=s.useState(null),[G,K]=s.useState([]),[M,R]=s.useState([]),[X,Y]=s.useState([]),[Z,ee]=s.useState(""),[se,ae]=s.useState("all"),[te,ie]=s.useState(!1),[re,ne]=s.useState(!1),[le,ce]=s.useState(null),[oe,he]=s.useState(null),[de,me]=s.useState(""),[xe,je]=s.useState(""),[pe,ue]=s.useState("");s.useEffect(()=>{D||a||V("/chat")},[a,D,V]),s.useEffect(()=>{ge()},[]),s.useEffect(()=>{let e=M;Z.trim()&&(e=e.filter(e=>e.machine_number.toLowerCase().includes(Z.toLowerCase())||e.machine_type_name&&e.machine_type_name.toLowerCase().includes(Z.toLowerCase()))),"all"!==se&&(e=e.filter(e=>e.machine_type_id===se)),Y(e)},[M,Z,se]);const ge=async()=>{try{const e="http://localhost:8081/api";H(!0),W(null);const s=await fetch(`${e}/machines/machine-types`),a=s.headers.get("content-type")||"";if(!s.ok||!a.includes("application/json")){const e=await s.text();throw console.error("APIレスポンス非JSON:",s.status,a,e.slice(0,200)),new Error("API非JSON: "+s.status+" "+a)}const t=await s.json();if(console.log("機種タイプAPIレスポンス:",t),t.success){const e=t.machineTypes||t.data||[];console.log("機種タイプデータ:",e);const s=e.map(e=>({id:e.id,machine_type_name:e.name||e.machine_type_name||e.category}));K(s)}const i=await fetch(`${e}/machines`),r=i.headers.get("content-type")||"";if(!i.ok||!r.includes("application/json")){const e=await i.text();throw console.error("APIレスポンス非JSON:",i.status,r,e.slice(0,200)),new Error("API非JSON: "+i.status+" "+r)}const n=await i.json();if(console.log("機械APIレスポンス:",n),n.success){const e=n.machines||n.data||[];console.log("機械データ:",e);const s=e.map(e=>({id:e.id,machine_number:e.machine_number,machine_type_id:e.machine_type_id,machine_type_name:e.type||e.machine_type_name}));R(s)}}catch(e){console.error("データ取得エラー:",e),W(e instanceof Error?e:new Error("Unknown error")),F({title:"エラー",description:"データの取得に失敗しました",variant:"destructive"})}finally{H(!1)}},fe=()=>{ce(null),me(""),ie(!1)},ye=()=>{he(null),je(""),ue(""),ne(!1)};return D||q?e.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 max-w-7xl mx-auto w-full bg-gradient-to-br from-blue-50 to-indigo-50",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600",children:"読み込み中..."})]})})}):e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 max-w-7xl mx-auto w-full bg-gradient-to-br from-blue-50 to-indigo-50",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[e.jsx(n,{className:"mr-2 h-6 w-6 text-indigo-500"}),"機種・機械番号管理"]}),e.jsx("p",{className:"text-blue-400",children:"機種と機械番号の一覧表示、追加、編集、削除ができます"})]}),e.jsx(l,{to:"/settings",children:e.jsxs(c,{variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-50",children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"設定に戻る"]})})]})}),Q&&e.jsx(h,{className:"mb-6 border-red-200 bg-red-50",children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"text-red-600",children:[e.jsx("p",{className:"font-medium",children:"エラーが発生しました"}),e.jsx("p",{className:"text-sm",children:Q.message})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(h,{className:"lg:col-span-1",children:[e.jsx(m,{className:"pb-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:e.jsxs(x,{className:"text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(o,{className:"mr-2 h-5 w-5"}),"機種管理"]}),e.jsxs(w,{open:te,onOpenChange:ie,children:[e.jsx(N,{asChild:!0,children:e.jsxs(c,{size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-white/30",onClick:fe,children:[e.jsx(z,{className:"mr-1 h-3 w-3"}),"追加"]})}),e.jsxs(_,{children:[e.jsxs(S,{children:[e.jsx(k,{children:le?"機種を編集":"新規機種追加"}),e.jsx(C,{children:le?"機種名を編集してください":"新しい機種名を入力してください"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(p,{htmlFor:"type-name",children:"機種名"}),e.jsx(j,{id:"type-name",value:de,onChange:e=>me(e.target.value),placeholder:"機種名を入力"})]})}),e.jsxs(E,{children:[e.jsx(c,{variant:"outline",onClick:fe,children:"キャンセル"}),e.jsx(c,{onClick:async()=>{if(de.trim())try{const e=le?`http://localhost:8081/api/machines/machine-types/${le.id}`:"http://localhost:8081/api/machines/machine-types",s=le?"PUT":"POST",a=localStorage.getItem("authToken"),t={"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}},i=await fetch(e,{method:s,headers:t,body:JSON.stringify({name:de.trim(),category:de.trim(),machine_type_name:de.trim()})});if(!i.ok){const e=await i.text();throw console.error("機種保存失敗:",i.status,e),new Error("機種の保存に失敗しました")}{const e=await i.json();console.log("機種保存成功:",e),F({title:le?"機種を更新しました":"機種を追加しました",description:`${de} が正常に処理されました`}),me(""),ce(null),ie(!1),console.log("データ再取得を開始..."),await ge(),console.log("データ再取得完了")}}catch(e){console.error("機種保存エラー:",e),F({title:"エラー",description:"機種の保存に失敗しました",variant:"destructive"})}},children:le?"更新":"追加"})]})]})]})]})}),e.jsx(d,{className:"p-0",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===G.length?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"機種が登録されていません"}):e.jsx("div",{className:"divide-y",children:G.map(s=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.machine_type_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[M.filter(e=>e.machine_type_id===s.id).length,"台の機械"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>(e=>{ce(e),me(e.machine_type_name),ie(!0)})(s),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>(async(e,s)=>{if(confirm(`機種「${s}」を削除してもよろしいですか？\n関連する機械番号も削除されます。`))try{const a=localStorage.getItem("authToken"),t={...a&&{Authorization:`Bearer ${a}`}};if(!(await fetch(`http://localhost:8081/api/machines/machine-types/${e}`,{method:"DELETE",headers:t})).ok)throw new Error("機種の削除に失敗しました");F({title:"機種を削除しました",description:`${s} と関連する機械番号が削除されました`}),ge()}catch(a){console.error("機種削除エラー:",a),F({title:"エラー",description:"機種の削除に失敗しました",variant:"destructive"})}})(s.id,s.machine_type_name),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(J,{className:"h-3 w-3"})})]})]})},s.id))})})})]}),e.jsxs(h,{className:"lg:col-span-2",children:[e.jsx(m,{className:"pb-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white",children:e.jsxs(x,{className:"text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(U,{className:"mr-2 h-5 w-5"}),"機械番号管理"]}),e.jsxs(w,{open:re,onOpenChange:ne,children:[e.jsx(N,{asChild:!0,children:e.jsxs(c,{size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-white/30",onClick:ye,children:[e.jsx(z,{className:"mr-1 h-3 w-3"}),"追加"]})}),e.jsxs(_,{children:[e.jsxs(S,{children:[e.jsx(k,{children:oe?"機械番号を編集":"新規機械番号追加"}),e.jsx(C,{children:oe?"機械番号を編集してください":"新しい機械番号を入力してください"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"machine-type",children:"機種"}),e.jsxs($,{value:pe,onValueChange:ue,children:[e.jsx(T,{children:e.jsx(A,{placeholder:"機種を選択"})}),e.jsx(I,{children:G.map(s=>e.jsx(O,{value:s.id,children:s.machine_type_name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"machine-number",children:"機械番号"}),e.jsx(j,{id:"machine-number",value:xe,onChange:e=>je(e.target.value),placeholder:"機械番号を入力"})]})]}),e.jsxs(E,{children:[e.jsx(c,{variant:"outline",onClick:ye,children:"キャンセル"}),e.jsx(c,{onClick:async()=>{if(xe.trim()&&pe)try{const e=oe?`http://localhost:8081/api/machines/${oe.id}`:"http://localhost:8081/api/machines",s=oe?"PUT":"POST",a=localStorage.getItem("authToken"),t={"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}};if(!(await fetch(e,{method:s,headers:t,body:JSON.stringify({machine_number:xe.trim(),machine_type_id:pe})})).ok)throw new Error("機械番号の保存に失敗しました");F({title:oe?"機械番号を更新しました":"機械番号を追加しました",description:`${xe} が正常に処理されました`}),je(""),ue(""),he(null),ne(!1),ge()}catch(e){console.error("機械番号保存エラー:",e),F({title:"エラー",description:"機械番号の保存に失敗しました",variant:"destructive"})}},children:oe?"更新":"追加"})]})]})]})]})}),e.jsxs(d,{children:[e.jsx("div",{className:"mb-4 space-y-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(j,{placeholder:"機械番号または機種名で検索...",value:Z,onChange:e=>ee(e.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-48",children:e.jsxs($,{value:se,onValueChange:ae,children:[e.jsx(T,{children:e.jsx(A,{placeholder:"機種でフィルター"})}),e.jsxs(I,{children:[e.jsx(O,{value:"all",children:"すべての機種"}),G.map(s=>e.jsx(O,{value:s.id,children:s.machine_type_name},s.id))]})]})})]})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(f,{children:[e.jsx(y,{children:"機械番号"}),e.jsx(y,{children:"機種"}),e.jsx(y,{className:"text-right",children:"操作"})]})}),e.jsx(v,{children:0===X.length?e.jsx(f,{children:e.jsx(b,{colSpan:3,className:"text-center py-8 text-gray-500",children:Z||"all"!==se?"検索条件に一致する機械番号が見つかりません":"機械番号が登録されていません"})}):X.map(s=>e.jsxs(f,{children:[e.jsx(b,{className:"font-medium",children:s.machine_number}),e.jsx(b,{children:s.machine_type_name}),e.jsx(b,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>(e=>{he(e),je(e.machine_number),ue(e.machine_type_id),ne(!0)})(s),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>(async(e,s)=>{if(confirm(`機械番号「${s}」を削除してもよろしいですか？`))try{const a=localStorage.getItem("authToken"),t={...a&&{Authorization:`Bearer ${a}`}};if(!(await fetch(`http://localhost:8081/api/machines/${e}`,{method:"DELETE",headers:t})).ok)throw new Error("機械番号の削除に失敗しました");F({title:"機械番号を削除しました",description:`${s} が削除されました`}),ge()}catch(a){console.error("機械番号削除エラー:",a),F({title:"エラー",description:"機械番号の削除に失敗しました",variant:"destructive"})}})(s.id,s.machine_number),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(J,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})]})]})]})}export{D as default};
