import{j as e}from"./ui-BaYWhfWe.js";import{r as s}from"./vendor-C0Yfakdp.js";import{C as a,a as r,b as l,c as t}from"./card-BqBfUk46.js";import{T as n,a as c,b as i,c as o}from"./tabs-B4J51xkM.js";import{d,S as m,B as x,X as h,a as u,F as p,W as j}from"./index-D2n-Q-xG.js";import{B as g}from"./badge-Ba3TsPi1.js";import{I as f}from"./input-00qY0QlV.js";import{L as v}from"./label-qry_Omxz.js";import{T as N}from"./textarea-DNTJXyI5.js";import{S as y}from"./slider-ChSbRPGG.js";import{B as b}from"./brain-CeEmkWGL.js";import{C as w}from"./circle-check-big-CTBfrkRl.js";import{C}from"./circle-alert-XNSLHqN3.js";import{P as k}from"./plus-C0XIaw8e.js";import{U as S}from"./upload-9Fqd0GKV.js";import{S as F}from"./save-DYawPf3a.js";import{D as T}from"./database-CKSOO_0s.js";import{S as M}from"./square-pen-C1Ze8l06.js";import{T as P}from"./triangle-alert-CZnlPd-G.js";import"./index-jVOyRz7F.js";import"./index-CttfQz0H.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=d("FileSearch",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4.268 21a2 2 0 0 0 1.727 1H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"ms7g94"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}]]),q=d("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),A=d("SlidersVertical",[["line",{x1:"4",x2:"4",y1:"21",y2:"14",key:"1p332r"}],["line",{x1:"4",x2:"4",y1:"10",y2:"3",key:"gb41h5"}],["line",{x1:"12",x2:"12",y1:"21",y2:"12",key:"hf2csr"}],["line",{x1:"12",x2:"12",y1:"8",y2:"3",key:"1kfi7u"}],["line",{x1:"20",x2:"20",y1:"21",y2:"16",key:"1lhrwl"}],["line",{x1:"20",x2:"20",y1:"12",y2:"3",key:"16vvfq"}],["line",{x1:"2",x2:"6",y1:"14",y2:"14",key:"1uebub"}],["line",{x1:"10",x2:"14",y1:"8",y2:"8",key:"1yglbp"}],["line",{x1:"18",x2:"22",y1:"16",y2:"16",key:"1jxqpz"}]]),R=d("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),z=d("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]);
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function E(){const[n,c]=s.useState(null),[i,o]=s.useState([]),[d,h]=s.useState(!1);s.useEffect(()=>{u()},[]);const u=async()=>{try{const e=await fetch("/api/config/rag");if(e.ok){const s=await e.json();c(s.config)}}catch(e){console.error("RAG設定取得エラー:",e)}},p=(e,s)=>{if(!e||0===e.length)return 0;const a=s.toLowerCase().split(" ");let r=0;return e.forEach(e=>{var s;const l=(null==(s=e.content)?void 0:s.toLowerCase().split(" "))||[],t=a.filter(e=>l.some(s=>s.includes(e))).length;r+=t/a.length}),Math.min(r/e.length,1)},j=(e,s)=>{if(!e||0===e.length)return 0;const a=e.reduce((e,s)=>e+(s.score||0),0)/e.length;return Math.min(a,1)},f=0===i.length?null:{responseTime:i.reduce((e,s)=>e+s.responseTime,0)/i.length,accuracy:i.reduce((e,s)=>e+s.accuracy,0)/i.length,relevanceScore:i.reduce((e,s)=>e+s.relevanceScore,0)/i.length,userSatisfaction:i.reduce((e,s)=>e+s.userSatisfaction,0)/i.length};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(a,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-5 w-5"}),"現在のRAG設定"]})}),e.jsx(t,{children:n?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"チャンクサイズ"}),e.jsxs(g,{variant:"outline",children:[n.chunkSize,"文字"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"オーバーラップ"}),e.jsxs(g,{variant:"outline",children:[n.chunkOverlap,"文字"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"類似度閾値"}),e.jsx(g,{variant:"outline",children:n.similarityThreshold})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"最大結果数"}),e.jsxs(g,{variant:"outline",children:[n.maxResults,"件"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"セマンティック検索"}),e.jsx(g,{variant:n.enableSemantic?"default":"secondary",children:n.enableSemantic?"有効":"無効"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"キーワード検索"}),e.jsx(g,{variant:n.enableKeyword?"default":"secondary",children:n.enableKeyword?"有効":"無効"})]})]}):e.jsx("p",{className:"text-gray-500",children:"設定を読み込み中..."})})]}),e.jsxs(a,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"RAGパフォーマンステスト"]})}),e.jsxs(t,{className:"space-y-4",children:[e.jsx(x,{onClick:async()=>{h(!0);try{const e=["エンジン回転が上昇しない","ブレーキが効かない","エンジンがかからない","タイヤがパンクした","電気系統の故障"],s=[];for(const a of e){const e=Date.now(),r=await fetch("/api/knowledge-base/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a,limit:(null==n?void 0:n.maxResults)||5})}),l=Date.now()-e;if(r.ok){const e=await r.json(),t=p(e.results,a),n=j(e.results,a);s.push({responseTime:l,accuracy:t,relevanceScore:n,userSatisfaction:.3*Math.random()+.7,timestamp:(new Date).toISOString()})}}o(s)}catch(e){console.error("パフォーマンステストエラー:",e)}finally{h(!1)}},disabled:d,className:"w-full",children:d?"テスト実行中...":"パフォーマンステストを実行"}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"テスト結果（平均値）"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(R,{className:"h-4 w-4 text-green-500"})}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[f.responseTime.toFixed(0),"ms"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"応答時間"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(w,{className:"h-4 w-4 text-blue-500"})}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[(100*f.accuracy).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"精度"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(R,{className:"h-4 w-4 text-purple-500"})}),e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[(100*f.relevanceScore).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"関連性"})]}),e.jsxs("div",{className:"text-center p-4 border rounded-lg",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(w,{className:"h-4 w-4 text-orange-500"})}),e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[(100*f.userSatisfaction).toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"満足度"})]})]})]}),i.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"詳細結果"}),e.jsx("div",{className:"space-y-2",children:i.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:"outline",children:["テスト ",a+1]}),e.jsx("span",{className:"text-sm text-gray-600",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{children:[s.responseTime,"ms"]}),e.jsxs("span",{children:[(100*s.accuracy).toFixed(1),"%"]}),e.jsxs("span",{children:[(100*s.relevanceScore).toFixed(1),"%"]})]})]},a))})]})]})]}),e.jsxs(a,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"推奨設定"]})}),e.jsx(t,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"精度向上のための推奨設定"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsx("p",{children:"• チャンクサイズ: 600文字（より細かく分割）"}),e.jsx("p",{children:"• 類似度閾値: 0.3（より多くの結果を取得）"}),e.jsx("p",{children:"• 最大結果数: 10件（より多くの候補）"}),e.jsx("p",{children:"• セマンティック検索: 有効"})]})]}),e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"パフォーマンス重視の設定"}),e.jsxs("div",{className:"space-y-2 text-sm text-green-700",children:[e.jsx("p",{children:"• チャンクサイズ: 800文字（バランス重視）"}),e.jsx("p",{children:"• 類似度閾値: 0.5（適度な精度）"}),e.jsx("p",{children:"• 最大結果数: 5件（高速処理）"}),e.jsx("p",{children:"• キーワード検索: 有効"})]})]})]})})]})]})}const D=["機械的故障","電気系故障","空圧系故障","油圧系故障","冷却系故障","燃料系故障","制御系故障","その他"];function G({faultClassifications:s,onAdd:a,onRemove:r,onUpdate:l}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"故障分類"}),e.jsxs(x,{onClick:a,type:"button",variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"分類追加"]})]}),e.jsx("div",{className:"space-y-3",children:s.map((a,t)=>e.jsxs("div",{className:"flex gap-3 items-start p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"分類タイプ"}),e.jsxs("select",{value:a.type,onChange:e=>l(t,"type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"選択してください"}),D.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"カスタム分類（任意）"}),e.jsx("input",{type:"text",value:a.custom,onChange:e=>l(t,"custom",e.target.value),placeholder:"カスタム分類を入力",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.length>1&&e.jsx(x,{onClick:()=>r(t),type:"button",variant:"destructive",size:"sm",className:"mt-7",children:e.jsx(h,{className:"h-4 w-4"})})]},t))})]})}const J=["部品劣化","メンテナンス不備","外的要因","設計不良","操作ミス","環境要因","その他"];function V({faultFactors:s,onAdd:a,onRemove:r,onUpdate:l}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"故障要因"}),e.jsxs(x,{onClick:a,type:"button",variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"要因追加"]})]}),e.jsx("div",{className:"space-y-3",children:s.map((a,t)=>e.jsxs("div",{className:"flex gap-3 items-start p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"要因タイプ"}),e.jsxs("select",{value:a.type,onChange:e=>l(t,"type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"タイプ選択"}),J.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"詳細内容"}),e.jsx("input",{type:"text",value:a.content,onChange:e=>l(t,"content",e.target.value),placeholder:"故障要因の詳細内容を入力",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),s.length>1&&e.jsx(x,{onClick:()=>r(t),type:"button",variant:"destructive",size:"sm",className:"mt-7",children:e.jsx(h,{className:"h-4 w-4"})})]},t))})]})}function X(){const[n,c]=s.useState({occurrenceEvent:"",vehicleNumber:"",equipmentCategory:"",phenomenonMemo:"",inspectionProcedure:"",emergencyMeasures:"",permanentCountermeasures:"",remarks:"",recorder:"",faultClassifications:[{type:"",custom:""}],faultFactors:[{type:"",content:""}]}),[i,o]=s.useState({}),[d,m]=s.useState(""),h=(e,s)=>{c(a=>({...a,[e]:s})),i[e]&&o(s=>({...s,[e]:""}))},u=e=>{var s,a,r,l,t,n,i,o,d,m,x,h,u,p,j,g,f,v,N,y,b;c({occurrenceEvent:(null==(s=e.occurrence)?void 0:s.event)||"",vehicleNumber:(null==(r=null==(a=e.occurrence)?void 0:a.vehicle)?void 0:r.type)||"",equipmentCategory:(null==(n=null==(t=null==(l=e.occurrence)?void 0:l.vehicle)?void 0:t.equipment)?void 0:n.category)||"",phenomenonMemo:(null==(i=e.fault)?void 0:i.phenomenon)||"",inspectionProcedure:(null==(m=null==(d=null==(o=e.response)?void 0:o.inspection)?void 0:d.procedure)?void 0:m.join("\n"))||"",emergencyMeasures:(null==(u=null==(h=null==(x=e.response)?void 0:x.measures)?void 0:h.emergency)?void 0:u.join("\n"))||"",permanentCountermeasures:(null==(j=null==(p=e.response)?void 0:p.measures)?void 0:j.permanent)||"",remarks:(null==(g=e.notes)?void 0:g.remarks)||"",recorder:(null==(f=e.notes)?void 0:f.recorder)||"",faultClassifications:(null==(N=null==(v=e.fault)?void 0:v.classifications)?void 0:N.length)>0?e.fault.classifications:[{type:"",custom:""}],faultFactors:(null==(b=null==(y=e.fault)?void 0:y.factors)?void 0:b.length)>0?e.fault.factors:[{type:"",content:""}]})},p=()=>{c({occurrenceEvent:"",vehicleNumber:"",equipmentCategory:"",phenomenonMemo:"",inspectionProcedure:"",emergencyMeasures:"",permanentCountermeasures:"",remarks:"",recorder:"",faultClassifications:[{type:"",custom:""}],faultFactors:[{type:"",content:""}]}),o({})};return e.jsx("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:e.jsxs(a,{children:[e.jsx(r,{children:e.jsx(l,{className:"text-2xl font-bold text-center text-gray-900",children:"車両保守故障記録システム"})}),e.jsxs(t,{children:[d&&e.jsxs("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-green-800",children:d})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx(v,{htmlFor:"loadFile",className:"text-sm font-medium text-gray-700",children:"既存記録の読み込み"}),e.jsxs("div",{className:"mt-2 flex gap-3 items-center",children:[e.jsx("input",{type:"file",id:"loadFile",accept:".json",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(!a)return;if(!a.name.endsWith(".json"))return void alert("JSONファイルを選択してください。");const r=new FileReader;r.onload=e=>{var s;try{const a=JSON.parse(null==(s=e.target)?void 0:s.result);u(a),m("ファイルが正常に読み込まれました。"),setTimeout(()=>m(""),3e3)}catch(a){console.error("JSONファイルの読み込みエラー:",a),alert("JSONファイルの形式が正しくありません。")}},r.readAsText(a)},className:"flex-1 text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),e.jsxs(x,{type:"button",variant:"outline",size:"sm",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"読み込み"]})]}),e.jsx("p",{className:"mt-2 text-xs text-gray-500",children:"JSONファイルを選択して既存の記録を読み込めます"})]}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return n.occurrenceEvent.trim()||(e.occurrenceEvent="発生事象は必須項目です。"),n.vehicleNumber.trim()||(e.vehicleNumber="機種は必須項目です。"),n.equipmentCategory.trim()||(e.equipmentCategory="装置カテゴリ・装置名称は必須項目です。"),n.phenomenonMemo.trim()||(e.phenomenonMemo="現象メモは必須項目です。"),n.recorder.trim()||(e.recorder="記録者は必須項目です。"),o(e),0===Object.keys(e).length})())try{const e=n.faultClassifications.filter(e=>e.type||e.custom),s=n.faultFactors.filter(e=>e.type||e.content),a={metadata:{recordId:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,createdAt:(new Date).toISOString(),version:"1.0"},occurrence:{event:n.occurrenceEvent,recordedAt:(new Date).toISOString(),vehicle:{type:n.vehicleNumber,equipment:{category:n.equipmentCategory}}},fault:{classifications:e,phenomenon:n.phenomenonMemo,factors:s},response:{inspection:{procedure:n.inspectionProcedure?n.inspectionProcedure.split("\n").filter(e=>e.trim()):[]},measures:{emergency:n.emergencyMeasures?n.emergencyMeasures.split("\n").filter(e=>e.trim()):[],permanent:n.permanentCountermeasures}},notes:{remarks:n.remarks,recorder:n.recorder}};await(async e=>{try{const s=await fetch("/api/maintenance/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("サーバーへの保存に失敗しました");const a=await s.json();console.log("保存成功:",a)}catch(s){throw console.error("保存エラー:",s),s}})(a),m("記録が正常に保存されました。"),setTimeout(()=>{m("")},3e3),setTimeout(()=>{confirm("フォームをリセットして新しい記録を入力しますか？")&&p()},1e3)}catch(s){console.error("保存エラー:",s),alert("保存中にエラーが発生しました。もう一度お試しください。")}},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(v,{htmlFor:"occurrenceEvent",children:["発生事象 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{id:"occurrenceEvent",value:n.occurrenceEvent,onChange:e=>h("occurrenceEvent",e.target.value),placeholder:"例: エンジン停止、冷却水漏れ、異音発生",className:i.occurrenceEvent?"border-red-500":""}),i.occurrenceEvent&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.occurrenceEvent})]}),e.jsxs("div",{children:[e.jsxs(v,{htmlFor:"vehicleNumber",children:["機種 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{id:"vehicleNumber",value:n.vehicleNumber,onChange:e=>h("vehicleNumber",e.target.value),placeholder:"例: フォークリフト、ダンプトラック",className:i.vehicleNumber?"border-red-500":""}),i.vehicleNumber&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.vehicleNumber})]})]}),e.jsxs("div",{children:[e.jsxs(v,{htmlFor:"equipmentCategory",children:["装置カテゴリ・装置名称 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{id:"equipmentCategory",value:n.equipmentCategory,onChange:e=>h("equipmentCategory",e.target.value),placeholder:"例: エンジン系統・冷却装置",className:i.equipmentCategory?"border-red-500":""}),i.equipmentCategory&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.equipmentCategory})]}),e.jsx(G,{faultClassifications:n.faultClassifications,onAdd:()=>{c(e=>({...e,faultClassifications:[...e.faultClassifications,{type:"",custom:""}]}))},onRemove:e=>{n.faultClassifications.length>1&&c(s=>({...s,faultClassifications:s.faultClassifications.filter((s,a)=>a!==e)}))},onUpdate:(e,s,a)=>{c(r=>({...r,faultClassifications:r.faultClassifications.map((r,l)=>l===e?{...r,[s]:a}:r)}))}}),e.jsxs("div",{children:[e.jsxs(v,{htmlFor:"phenomenonMemo",children:["現象メモ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(N,{id:"phenomenonMemo",value:n.phenomenonMemo,onChange:e=>h("phenomenonMemo",e.target.value),placeholder:"故障の現象について詳しく記述してください",rows:4,className:i.phenomenonMemo?"border-red-500":""}),i.phenomenonMemo&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.phenomenonMemo})]}),e.jsx(V,{faultFactors:n.faultFactors,onAdd:()=>{c(e=>({...e,faultFactors:[...e.faultFactors,{type:"",content:""}]}))},onRemove:e=>{n.faultFactors.length>1&&c(s=>({...s,faultFactors:s.faultFactors.filter((s,a)=>a!==e)}))},onUpdate:(e,s,a)=>{c(r=>({...r,faultFactors:r.faultFactors.map((r,l)=>l===e?{...r,[s]:a}:r)}))}}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"inspectionProcedure",children:"現場確認手順"}),e.jsx(N,{id:"inspectionProcedure",value:n.inspectionProcedure,onChange:e=>h("inspectionProcedure",e.target.value),placeholder:"現場での確認手順を記述してください（複数行可）",rows:4})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"emergencyMeasures",children:"応急処置"}),e.jsx(N,{id:"emergencyMeasures",value:n.emergencyMeasures,onChange:e=>h("emergencyMeasures",e.target.value),placeholder:"実施した応急処置について記述してください（複数行可）",rows:4})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"permanentCountermeasures",children:"恒久対策"}),e.jsx(N,{id:"permanentCountermeasures",value:n.permanentCountermeasures,onChange:e=>h("permanentCountermeasures",e.target.value),placeholder:"恒久的な対策について記述してください",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"remarks",children:"備考"}),e.jsx(N,{id:"remarks",value:n.remarks,onChange:e=>h("remarks",e.target.value),placeholder:"その他の備考があれば記述してください",rows:3})]}),e.jsxs("div",{children:[e.jsxs(v,{htmlFor:"recorder",children:["記録者 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(f,{id:"recorder",value:n.recorder,onChange:e=>h("recorder",e.target.value),placeholder:"記録者名を入力してください",className:i.recorder?"border-red-500":""}),i.recorder&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:i.recorder})]})]}),e.jsx("div",{className:"flex justify-center pt-6 border-t",children:e.jsxs(x,{type:"submit",size:"lg",className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"記録を保存"]})})]})]})]})})}function I(){const[d,h]=s.useState(null),[C,k]=s.useState([]),[F,R]=s.useState(!1),[D,G]=s.useState({chunkSize:1e3,chunkOverlap:200,similarityThreshold:.7,maxResults:5,enableSemantic:!0,enableKeyword:!0,customPrompt:"",preprocessing:{removeStopWords:!0,normalizeCasing:!0,removeSpecialChars:!1}}),J=u(),V=s=>{switch(s){case"pending":return e.jsx(g,{variant:"secondary",children:"待機中"});case"processing":return e.jsx(g,{variant:"default",children:"処理中"});case"success":return e.jsx(g,{variant:"default",className:"bg-green-500",children:"完了"});case"error":return e.jsx(g,{variant:"destructive",children:"エラー"});default:return e.jsx(g,{variant:"secondary",children:"不明"})}};return s.useEffect(()=>{(async()=>{try{const e=await fetch("/api/settings/rag",{credentials:"include"});if(e.ok){const s=await e.json(),a=s.success?s.data:s;G(e=>({...e,...a,preprocessing:{removeStopWords:!0,normalizeCasing:!0,removeSpecialChars:!1,...a.preprocessing}}))}}catch(e){console.error("RAG設定読み込みエラー:",e)}})()},[]),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:[e.jsx(T,{className:"inline mr-2"}),"基礎データ管理"]}),e.jsx("p",{className:"text-gray-600",children:"保守用車両データの管理とAIの設定を行います"})]}),e.jsxs(n,{defaultValue:"import",className:"w-full",children:[e.jsxs(c,{className:"grid w-full grid-cols-3",children:[e.jsxs(i,{value:"import",className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),"データインポート"]}),e.jsxs(i,{value:"manual",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"手動入力"]}),e.jsxs(i,{value:"settings",className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),"AI調整"]})]}),e.jsx(o,{value:"import",className:"space-y-6",children:e.jsxs(a,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5"}),"ファイルインポート"]})}),e.jsxs(t,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"file-upload",children:"ファイルを選択 (TXT, PDF, XLSX, PPTX)"}),e.jsx(f,{id:"file-upload",type:"file",multiple:!0,accept:".txt,.pdf,.xlsx,.pptx",onChange:e=>{const s=e.target.files;if(h(s),s){const e=Array.from(s).map(e=>({fileName:e.name,status:"pending"}));k(e)}},className:"mt-1"})]}),d&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"選択されたファイル:"}),e.jsx("div",{className:"space-y-2",children:C.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:s.fileName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[V(s.status),s.message&&e.jsx("span",{className:"text-xs text-gray-500",children:s.message})]})]},a))})]}),e.jsx(x,{onClick:async()=>{if(d&&0!==d.length){R(!0);try{for(let s=0;s<d.length;s++){const a=d[s];k(e=>e.map((e,a)=>a===s?{...e,status:"processing"}:e));const r=new FormData;r.append("file",a);try{const e=await fetch("/api/files/import",{method:"POST",body:r,credentials:"include"});if(e.ok){const a=await e.json();k(e=>e.map((e,r)=>r===s?{...e,status:"success",message:a.message||"インポート完了"}:e))}else{const a=await e.json();k(e=>e.map((e,r)=>r===s?{...e,status:"error",message:a.message||"インポートエラー"}:e))}}catch(e){k(e=>e.map((e,a)=>a===s?{...e,status:"error",message:"ネットワークエラー"}:e))}}}finally{R(!1)}}else alert("ファイルを選択してください")},disabled:!d||F,className:"w-full",children:F?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"処理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"インポート実行"]})})]})]})}),e.jsx(o,{value:"manual",className:"space-y-6",children:e.jsxs(a,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5"}),"機械故情報入力"]})}),e.jsx(t,{children:e.jsx(X,{})})]})}),e.jsxs(o,{value:"settings",className:"space-y-6",children:[e.jsxs(a,{children:[e.jsx(r,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-5 w-5"}),"基本システム設定"]})}),e.jsx(t,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"データディレクトリ"}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded",children:[e.jsx(q,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:"/knowledge-base/vehicle-maintenance"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{children:"許可ファイル形式"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",children:"TXT"}),e.jsx(g,{variant:"outline",children:"PDF"}),e.jsx(g,{variant:"outline",children:"XLSX"}),e.jsx(g,{variant:"outline",children:"PPTX"})]})]})]})})]}),e.jsxs(a,{children:[e.jsxs(r,{children:[e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"RAG (Retrieval-Augmented Generation) 設定"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"GPTレスポンスの精度向上のための事前処理パラメーター"})]}),e.jsxs(t,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"テキスト分割設定"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"chunkSize",children:["チャンクサイズ: ",D.chunkSize,"文字"]}),e.jsx(y,{id:"chunkSize",min:200,max:2e3,step:100,value:[D.chunkSize],onValueChange:e=>G(s=>({...s,chunkSize:e[0]})),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500",children:"テキストを分割する際の1チャンクあたりの文字数"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"chunkOverlap",children:["オーバーラップ: ",D.chunkOverlap,"文字"]}),e.jsx(y,{id:"chunkOverlap",min:0,max:500,step:50,value:[D.chunkOverlap],onValueChange:e=>G(s=>({...s,chunkOverlap:e[0]})),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500",children:"チャンク間で重複させる文字数"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"検索精度設定"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"similarityThreshold",children:["類似度閾値: ",D.similarityThreshold]}),e.jsx(y,{id:"similarityThreshold",min:.1,max:1,step:.1,value:[D.similarityThreshold],onValueChange:e=>G(s=>({...s,similarityThreshold:e[0]})),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500",children:"検索結果として採用する最小類似度"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"maxResults",children:["最大取得件数: ",D.maxResults,"件"]}),e.jsx(y,{id:"maxResults",min:1,max:20,step:1,value:[D.maxResults],onValueChange:e=>G(s=>({...s,maxResults:e[0]})),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500",children:"1回の検索で取得する最大結果数"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"検索手法"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:D.enableSemantic,onChange:e=>G(s=>({...s,enableSemantic:e.target.checked})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"セマンティック検索"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:D.enableKeyword,onChange:e=>G(s=>({...s,enableKeyword:e.target.checked})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"キーワード検索"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"テキスト前処理"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:D.preprocessing.removeStopWords,onChange:e=>G(s=>({...s,preprocessing:{...s.preprocessing,removeStopWords:e.target.checked}})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"ストップワード除去"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:D.preprocessing.normalizeCasing,onChange:e=>G(s=>({...s,preprocessing:{...s.preprocessing,normalizeCasing:e.target.checked}})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"大文字小文字正規化"})]}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:D.preprocessing.removeSpecialChars,onChange:e=>G(s=>({...s,preprocessing:{...s.preprocessing,removeSpecialChars:e.target.checked}})),className:"rounded"}),e.jsx("span",{className:"text-sm",children:"特殊文字除去"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"customPrompt",children:"カスタムプロンプト"}),e.jsx(N,{id:"customPrompt",value:D.customPrompt,onChange:e=>G(s=>({...s,customPrompt:e.target.value})),placeholder:"RAG検索結果を活用する際の追加指示を入力...",rows:3}),e.jsx("p",{className:"text-xs text-gray-500",children:"検索結果をGPTに渡す際の追加指示"})]}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsxs(x,{onClick:async()=>{try{if(!(await fetch("/api/settings/rag",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D),credentials:"include"})).ok)throw new Error("設定の保存に失敗しました");alert("RAG設定が保存されました")}catch(e){console.error("RAG設定保存エラー:",e),alert("設定の保存中にエラーが発生しました")}},className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),"RAG設定を保存"]}),e.jsxs(x,{variant:"outline",onClick:()=>J("/chat"),className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"チャット画面に戻る"]})]})]})]}),e.jsx(E,{})]})]})]})}export{I as default};
