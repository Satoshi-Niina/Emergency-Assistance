const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BRa72JSc.js","assets/ui-BaYWhfWe.js","assets/vendor-C0Yfakdp.js","assets/index-D8OdIOAq.css","assets/db-history-loader-DM2lRx14.js"])))=>i.map(i=>d[i]);
import{d as e,M as n,_ as t,B as a,F as s,S as o}from"./index-BRa72JSc.js";import{j as i}from"./ui-BaYWhfWe.js";import{r as l}from"./vendor-C0Yfakdp.js";import{C as r,a as c,b as d,c as m}from"./card-WTho8eQW.js";import{I as p}from"./input-Dtpc0C9c.js";import{S as g,a as h,b as u,c as x,d as v}from"./select-CcEo8Jy_.js";import{e as y,a as f,d as b}from"./history-api-D89YV-GN.js";import{T as j}from"./textarea-CWN81IYO.js";import{B as D}from"./badge-ldcpDxir.js";import{I as N}from"./image-DJ0qYU1h.js";import{S as w}from"./search-D1xBoKh8.js";import{T}from"./trash-2-BPrYEG1B.js";import{D as I}from"./download-D0t2ATNk.js";import"./index-jVOyRz7F.js";import"./index-CttfQz0H.js";import"./check-DJXMWc9X.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=e("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),S=e("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),k=e("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),$=({data:e,fileName:n,onClose:t,onSave:a,onPrint:s})=>{var o,r,c,d,m,p,g,h,u,x,v,y,f,b;const[j,w]=l.useState(!1),[T,I]=l.useState(!1),[E,S]=l.useState({reportId:`R${e.chatId.slice(-5).toUpperCase()}`,machineId:e.machineNumber||(null==(r=null==(o=e.chatData)?void 0:o.machineInfo)?void 0:r.machineNumber)||"M98765",machineType:e.machineType||(null==(d=null==(c=e.chatData)?void 0:c.machineInfo)?void 0:d.machineTypeName)||"",machineNumber:e.machineNumber||(null==(p=null==(m=e.chatData)?void 0:m.machineInfo)?void 0:p.machineNumber)||"",date:new Date(e.exportTimestamp).toISOString().split("T")[0],location:"â—‹â—‹ç·š",failureCode:"FC01",description:e.problemDescription||"ãƒãƒ£ãƒƒãƒˆã«ã‚ˆã‚‹æ•…éšœç›¸è«‡ãƒ»å¿œæ€¥å‡¦ç½®",status:"å¿œæ€¥å‡¦ç½®å®Œäº†",engineer:e.userId||"æ‹…å½“è€…",notes:`ãƒãƒ£ãƒƒãƒˆID: ${e.chatId}\nãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°: ${(null==(g=e.metadata)?void 0:g.total_messages)||(null==(u=null==(h=e.chatData)?void 0:h.messages)?void 0:u.length)||0}ä»¶\nã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç¨®åˆ¥: ${e.exportType}`,repairSchedule:"2025å¹´9æœˆ",repairLocation:"å·¥å ´å†…ä¿®ç†ã‚¹ãƒšãƒ¼ã‚¹",incidentTitle:e.title||"ã‚¿ã‚¤ãƒˆãƒ«ãªã—",problemDescription:e.problemDescription||"èª¬æ˜ãªã—",extractedComponents:e.extractedComponents||[],extractedSymptoms:e.extractedSymptoms||[],possibleModels:e.possibleModels||[]}),[k,$]=l.useState(E);l.useEffect(()=>{$(E)},[E]);const C=e=>new Date(e).toLocaleString("ja-JP"),B=k,A=e=>{var n,t,a;const s=[],o=new Set;Array.isArray(null==e?void 0:e.images)&&e.images.forEach(e=>{const n=(null==e?void 0:e.url)||(null==e?void 0:e.path);n&&!o.has(n)&&(s.push(n),o.add(n))}),Array.isArray(null==e?void 0:e.savedImages)&&e.savedImages.forEach(e=>{const n=(null==e?void 0:e.url)||(null==e?void 0:e.path);n&&!o.has(n)&&(s.push(n),o.add(n))}),Array.isArray(null==e?void 0:e.imagePath)?e.imagePath.forEach(e=>{e&&!o.has(e)&&(s.push(e),o.add(e))}):"string"!=typeof(null==e?void 0:e.imagePath)||o.has(e.imagePath)||(s.push(e.imagePath),o.add(e.imagePath));const i=e=>{e.forEach(e=>{(null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")&&(o.has(e.content)||(s.push(e.content),o.add(e.content)))})};return Array.isArray(null==(n=null==e?void 0:e.chatData)?void 0:n.messages)&&i(e.chatData.messages),Array.isArray(null==e?void 0:e.conversationHistory)&&i(e.conversationHistory),Array.isArray(null==(t=null==e?void 0:e.originalChatData)?void 0:t.messages)&&i(e.originalChatData.messages),Array.isArray(null==e?void 0:e.messages)&&i(e.messages),Array.isArray(null==(a=null==e?void 0:e.jsonData)?void 0:a.images)&&e.jsonData.images.forEach(e=>{const n=(null==e?void 0:e.url)||(null==e?void 0:e.path);n&&!o.has(n)&&(s.push(n),o.add(n))}),Object.values(e||{}).forEach(e=>{if(e&&"object"==typeof e&&!Array.isArray(e))try{s.push(...A(e))}catch{}}),s.map(e=>"string"==typeof e&&e.startsWith("data:image/")?e:(e=>e?/^data:image\//.test(e)||/^https?:\/\//i.test(e)?e:e.startsWith("/api/")?"http://localhost:8080"+e:new URL(e,window.location.origin).toString():null)(e)).filter(Boolean)};A(e);const M=(()=>{const e=[],n={reportId:"å ±å‘Šæ›¸ID",machineId:"æ©Ÿæ¢°ID",machineType:"æ©Ÿç¨®",machineNumber:"æ©Ÿæ¢°ç•ªå·",date:"æ—¥ä»˜",location:"å ´æ‰€",failureCode:"æ•…éšœã‚³ãƒ¼ãƒ‰",status:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",engineer:"æ‹…å½“ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",notes:"å‚™è€ƒ",repairSchedule:"ä¿®ç¹•äºˆå®š",repairLocation:"ä¿®ç¹•å ´æ‰€",incidentTitle:"äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«",problemDescription:"äº‹è±¡èª¬æ˜",extractedComponents:"å½±éŸ¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ",extractedSymptoms:"ç—‡çŠ¶",possibleModels:"å¯èƒ½æ€§ã®ã‚ã‚‹æ©Ÿç¨®"};return Object.keys(E).forEach(t=>{const a=E[t],s=k[t];a!==s&&e.push({field:n[t]||t,oldValue:String(a||"æœªè¨­å®š"),newValue:String(s||"æœªè¨­å®š")})}),e})();T&&M.length>0&&(M.length,M.map((e,n)=>i.jsxs("div",{className:"flex items-center gap-4 p-3 bg-white rounded-lg border",children:[i.jsx("div",{className:"flex-1",children:i.jsxs("span",{className:"font-medium text-gray-700",children:[e.field,":"]})}),i.jsxs("div",{className:"flex-1 text-right",children:[i.jsx("div",{className:"text-sm text-red-600 line-through",children:e.oldValue}),i.jsx("div",{className:"text-sm text-green-600 font-medium",children:e.newValue})]})]},n))),B.incidentTitle,B.reportId,B.machineId,B.machineType,B.machineNumber,B.date,B.location,B.problemDescription,B.status,B.engineer,B.notes,B.extractedComponents.join(", "),B.extractedSymptoms.join(", "),B.possibleModels.join(", "),B.repairSchedule,B.repairLocation,C(e.exportTimestamp),(null==(x=e.metadata)?void 0:x.total_messages)||null==(y=null==(v=e.chatData)?void 0:v.messages)||y.length,null==(f=e.savedImages)||f.length,(e.machineType||e.machineNumber)&&(e.machineType&&e.machineType,e.machineNumber&&e.machineNumber),(e.conversationHistory||(null==(b=e.chatData)?void 0:b.messages)||[]).map((e,n)=>{return i.jsxs("div",{className:"mb-4 p-3 rounded-lg "+(e.isAiResponse?"bg-blue-50 ml-4":"bg-gray-100 mr-4"),children:[i.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[i.jsx(D,{variant:e.isAiResponse?"default":"secondary",className:"text-xs",children:e.isAiResponse?"AI":"ãƒ¦ãƒ¼ã‚¶ãƒ¼"}),i.jsx("span",{className:"text-xs text-gray-500",children:C(e.timestamp||e.createdAt)})]}),i.jsx("div",{className:"mt-1",children:(t=e.content,t&&t.startsWith("data:image/")?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(N,{className:"h-4 w-4 text-gray-500"}),i.jsx("span",{className:"text-sm text-gray-600",children:"ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"})]}):i.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:e.content}))})]},e.id||n);var t})},C=()=>{var e,n,j,D,C,B,A,M,z,L,_,P,H,O;const[U,R]=l.useState([]),[F,J]=l.useState([]),[q,W]=l.useState(""),[V,K]=l.useState({machineType:"",machineNumber:"",searchText:"",searchDate:""}),[Y,G]=l.useState(!0),[X,Q]=l.useState(null),[Z,ee]=l.useState(new Set),[ne,te]=l.useState(1),[ae,se]=l.useState(1),[oe,ie]=l.useState(!1),[le,re]=l.useState(!1),[ce,de]=l.useState(!1),[me,pe]=l.useState(null),[ge,he]=l.useState(null),[ue,xe]=l.useState(!1),[ve,ye]=l.useState(!1),[fe,be]=l.useState({show:!1,id:"",title:""}),[je,De]=l.useState(!1),[Ne,we]=l.useState("table"),[Te,Ie]=l.useState(!1),[Ee,Se]=l.useState(null),[ke,$e]=l.useState(""),[Ce,Be]=l.useState(!1),[Ae,Me]=l.useState(null),[ze,Le]=l.useState({machineTypes:[],machines:[]}),[_e,Pe]=l.useState({machineTypes:[],machineNumbers:[]}),[He,Oe]=l.useState(!1),Ue=l.useRef(0),Re=l.useRef(!1),Fe=e=>{var n,t,a,s,o,i;if(console.log("æ­£è¦åŒ–å‰ã®ã‚¢ã‚¤ãƒ†ãƒ :",e),!e.jsonData)return console.log("jsonDataãŒå­˜åœ¨ã—ã¾ã›ã‚“"),e;if(e.machineType&&e.machineNumber)return console.log("æ—¢ã«æ­£è¦åŒ–æ¸ˆã¿:",{machineType:e.machineType,machineNumber:e.machineNumber}),e;const l=e.machineType||e.jsonData.machineType||(null==(t=null==(n=e.jsonData.chatData)?void 0:n.machineInfo)?void 0:t.machineTypeName)||"",r=e.machineNumber||e.jsonData.machineNumber||(null==(s=null==(a=e.jsonData.chatData)?void 0:a.machineInfo)?void 0:s.machineNumber)||"";console.log("ğŸ” æŠ½å‡ºã—ãŸæ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·:",{machineType:l,machineNumber:r});const c={...e,machineType:l,machineNumber:r,jsonData:{...e.jsonData,title:e.jsonData.title||e.title||"",problemDescription:e.jsonData.problemDescription||"",machineType:l,machineNumber:r,extractedComponents:e.jsonData.extractedComponents||e.extractedComponents||[],extractedSymptoms:e.jsonData.extractedSymptoms||e.extractedSymptoms||[],possibleModels:e.jsonData.possibleModels||e.possibleModels||[],conversationHistory:e.jsonData.conversationHistory||[],savedImages:e.jsonData.savedImages||[]}};if(e.jsonData.chatData){console.log("chatDataå½¢å¼ã‚’æ¤œå‡º");const n=e.jsonData.chatData,t=(null==(o=n.machineInfo)?void 0:o.machineTypeName)||"",a=(null==(i=n.machineInfo)?void 0:i.machineNumber)||"";console.log("chatDataã‹ã‚‰æŠ½å‡º:",{machineTypeName:t,machineNumber:a}),c.machineType=t||c.machineType,c.machineNumber=a||c.machineNumber,c.jsonData.machineType=t||c.jsonData.machineType,c.jsonData.machineNumber=a||c.jsonData.machineNumber}return console.log("æ­£è¦åŒ–å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ :",c),c};l.useEffect(()=>{const e=e=>{if(e.data&&"UPDATE_HISTORY_ITEM"===e.data.type){const n=e.data.data;console.log("å±¥æ­´ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡:",n),R(e=>e.map(e=>e.id===n.id||e.chatId===n.chatId?{...e,...n}:e)),J(e=>e.map(e=>e.id===n.id||e.chatId===n.chatId?{...e,...n}:e)),!X||X.id!==n.id&&X.chatId!==n.chatId||Q(e=>e?{...e,...n}:null)}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[X]);const[Je,qe]=l.useState(!1);l.useEffect(()=>{console.log("ğŸ” machineDataçŠ¶æ…‹å¤‰åŒ–:",ze)},[ze]);const We=l.useCallback(async(e=1)=>{var n,a;try{G(!0);const s=Date.now();if(Ue.current&&s-Ue.current<1e3)return void console.log("ğŸ” APIãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™ä¸­...");Ue.current=s;const o={machineType:V.machineType,machineNumber:V.machineNumber,searchText:V.searchText,searchDate:V.searchDate},i=new URLSearchParams;o.machineType&&i.append("machineType",o.machineType),o.machineNumber&&i.append("machineNumber",o.machineNumber),o.searchText&&i.append("searchText",o.searchText),o.searchDate&&i.append("searchDate",o.searchDate),i.append("limit","20"),i.append("offset",(20*(e-1)).toString());const{buildApiUrl:l}=await t(async()=>{const{buildApiUrl:e}=await import("./index-BRa72JSc.js").then(e=>e.J);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),r=l("/history");console.log("ğŸ” APIãƒªã‚¯ã‚¨ã‚¹ãƒˆURL:",r);const c=await fetch(r);console.log("ğŸ” ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:",c.status,c.statusText);const d=await c.json();if(console.log("ğŸ” å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:",d),console.log("ğŸ” ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ :",{success:d.success,hasItems:!!d.items,hasData:!!d.data,itemsLength:null==(n=d.items)?void 0:n.length,dataLength:null==(a=d.data)?void 0:a.length,total:d.total}),localStorage.setItem("debug_api_response",JSON.stringify(d,null,2)),Array.isArray(d)){console.log("ğŸ” å–å¾—ä»¶æ•°:",d.length),d.forEach((e,n)=>{console.log(`ğŸ” ã‚¢ã‚¤ãƒ†ãƒ  ${n+1}:`,{fileName:e.fileName,title:e.title,chatId:e.chatId})});const n=d.map(e=>{const n=e.title||"ã‚¿ã‚¤ãƒˆãƒ«ãªã—",t=e.content||{},a=t.machineType||e.machineType||"",s=t.machineNumber||e.machineNumber||"",o=t.problemDescription||t.answer||"",i={id:e.chatId||e.fileName,chatId:e.chatId||e.fileName,fileName:e.fileName,machineType:a,machineNumber:s,title:n,createdAt:e.createdAt,lastModified:e.lastModified,extractedComponents:t.extractedComponents||[],extractedSymptoms:t.extractedSymptoms||[],possibleModels:t.possibleModels||[],machineInfo:{machineTypeName:a,machineNumber:s},jsonData:{title:n,problemDescription:o,machineType:a,machineNumber:s,extractedComponents:t.extractedComponents||[],extractedSymptoms:t.extractedSymptoms||[],possibleModels:t.possibleModels||[],conversationHistory:t.conversationHistory||[],savedImages:t.savedImages||[],fileName:e.fileName}};return console.log("å¤‰æ›ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ :",{fileName:i.fileName,machineType:i.machineType,machineNumber:i.machineNumber,jsonData:i.jsonData}),i});console.log("ğŸ” è¨­å®šå‰ã®çŠ¶æ…‹:",{historyItemsLength:U.length,filteredItemsLength:F.length,updatedItemsLength:n.length});const{loadHistoryFromDB:a}=await t(async()=>{const{loadHistoryFromDB:e}=await import("./db-history-loader-DM2lRx14.js");return{loadHistoryFromDB:e}},__vite__mapDeps([4,0,1,2,3])),s=await a(),o=s;R(o),J(o),se(Math.ceil(o.length/20)),te(e),console.log("ğŸ” DBå°‚ç”¨å±¥æ­´è¨­å®šå®Œäº†:",{dbItemsLength:s.length,totalPages:Math.ceil(o.length/20)})}else{console.log("ğŸ” ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸã›ãš:",d);const{loadHistoryFromDB:e}=await t(async()=>{const{loadHistoryFromDB:e}=await import("./db-history-loader-DM2lRx14.js");return{loadHistoryFromDB:e}},__vite__mapDeps([4,0,1,2,3])),n=await e();n.length>0?(R(n),J(n),se(Math.ceil(n.length/20)),console.log(`ğŸ” DBå°‚ç”¨å±¥æ­´å–å¾—å®Œäº†: ${n.length}ä»¶`)):(R([]),J([]),se(1))}}catch(s){console.error("å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:",s),console.error("ã‚¨ãƒ©ãƒ¼è©³ç´°:",{message:s instanceof Error?s.message:"Unknown error",stack:s instanceof Error?s.stack:void 0});try{const{loadHistoryFromDB:e}=await t(async()=>{const{loadHistoryFromDB:e}=await import("./db-history-loader-DM2lRx14.js");return{loadHistoryFromDB:e}},__vite__mapDeps([4,0,1,2,3])),n=await e();n.length>0?(R(n),J(n),se(Math.ceil(n.length/20)),console.log(`ğŸ” ã‚¨ãƒ©ãƒ¼æ™‚DBå±¥æ­´å–å¾—å®Œäº†: ${n.length}ä»¶`)):(R([]),J([]),se(1))}catch(o){console.error("DBå±¥æ­´å–å¾—ã‚‚ã‚¨ãƒ©ãƒ¼:",o),R([]),J([]),se(1)}}finally{G(!1)}},[]);l.useEffect(()=>{Re.current||(Re.current=!0,We(1))},[]),l.useEffect(()=>{U.length>0&&(async()=>{try{Oe(!0),console.log("ğŸ” å±¥æ­´æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–‹å§‹");const e=[...U],n=[...new Set(e.map(e=>e.machineType).filter(Boolean))],t=[...new Set(e.map(e=>e.machineNumber).filter(Boolean))];Pe({machineTypes:n,machineNumbers:t}),console.log("ğŸ” å±¥æ­´æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†:",{machineTypes:n.length,machineNumbers:t.length})}catch(e){console.error("å±¥æ­´æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",e)}finally{Oe(!1)}})()},[U]),l.useEffect(()=>{U.length>0&&We(1)},[V]);const Ve=(e,n)=>{K(t=>({...t,[e]:n}));try{me&&("machineType"!==e&&"machineNumber"!==e||(pe(t=>t?{...t,[e]:n}:t),console.log(`filters -> editingItem sync: ${e} = ${n}`)))}catch(t){console.warn("ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‹ã‚‰ç·¨é›†ã‚¢ã‚¤ãƒ†ãƒ ã¸ã®åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ:",t)}},Ke=()=>{We(1)},Ye=e=>{We(e)},Ge=async(e="json")=>{if(0!==Z.size)try{ie(!0);const n=F.filter(e=>Z.has(e.id)),t=await y(n,e);Xe(t,`selected_history.${e}`)}catch(n){console.error("é¸æŠå±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:",n)}finally{ie(!1)}else alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹å±¥æ­´ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚")},Xe=(e,n)=>{const t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=n,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a)},Qe=async(e="json")=>{try{ie(!0);const n=await f(V,e);Xe(n,`all_history.${e}`)}catch(n){console.error("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:",n)}finally{ie(!1)}},Ze=e=>new Date(e).toLocaleString("ja-JP"),en=async e=>{var n;try{console.log("ç·¨é›†ã•ã‚ŒãŸå±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä¿å­˜:",e),console.log("ç·¨é›†ã•ã‚ŒãŸå±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®ID:",e.id),console.log("ç·¨é›†ã•ã‚ŒãŸå±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®JSONãƒ‡ãƒ¼ã‚¿:",e.jsonData);let a=e.id||e.chatId;if(!a)return void alert("ã‚¢ã‚¤ãƒ†ãƒ IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ä¿å­˜ã§ãã¾ã›ã‚“ã€‚");if(a.startsWith("export_")){a=a.replace("export_",""),a.endsWith(".json")&&(a=a.replace(".json",""));const e=a.split("_");e.length>=2&&e[1].match(/^[a-f0-9-]+$/)&&(a=e[1])}console.log("ä½¿ç”¨ã™ã‚‹ID:",a,"å…ƒã®ID:",e.id||e.chatId);const s={updatedData:{...e.jsonData,machineType:e.machineType,machineNumber:e.machineNumber,title:(null==(n=e.jsonData)?void 0:n.title)||e.title,lastModified:(new Date).toISOString()},updatedBy:"user"};console.log("é€ä¿¡ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰:",s);const o=await fetch(`/api/history/update-item/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:",o.status,o.statusText),!o.ok){const e=await o.text();console.error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼è©³ç´°:",e);let n=`å±¥æ­´ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ (${o.status})`;try{n=JSON.parse(e).error||n}catch(t){n+=": "+e}return void alert(n)}const i=await o.json();if(console.log("å±¥æ­´æ›´æ–°å®Œäº†:",i),a){const n="savedMachineFailureReport_"+a;localStorage.setItem(n,JSON.stringify(e.jsonData)),console.log("ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ›´æ–°:",n)}R(n=>n.map(n=>{var t,s,o,i;return n.id===a||n.chatId===a?{...n,jsonData:e.jsonData,lastModified:(new Date).toISOString(),machineType:(null==(t=e.jsonData)?void 0:t.machineType)||n.machineType,machineNumber:(null==(s=e.jsonData)?void 0:s.machineNumber)||n.machineNumber,title:(null==(o=e.jsonData)?void 0:o.title)||n.title,incidentTitle:(null==(i=e.jsonData)?void 0:i.title)||n.incidentTitle}:n})),J(n=>n.map(n=>{var t,s,o,i;return n.id===a||n.chatId===a?{...n,jsonData:e.jsonData,lastModified:(new Date).toISOString(),machineType:(null==(t=e.jsonData)?void 0:t.machineType)||n.machineType,machineNumber:(null==(s=e.jsonData)?void 0:s.machineNumber)||n.machineNumber,title:(null==(o=e.jsonData)?void 0:o.title)||n.title,incidentTitle:(null==(i=e.jsonData)?void 0:i.title)||n.incidentTitle}:n})),alert("å±¥æ­´ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã€å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šæ›¸ãä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚"),xe(!1),pe(null),console.log("å±¥æ­´æ›´æ–°å®Œäº† - ãƒªã‚¹ãƒˆå†èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—")}catch(a){console.error("å±¥æ­´ä¿å­˜ã‚¨ãƒ©ãƒ¼:",a);const e=a instanceof Error?a.message:"Unknown error";alert("å±¥æ­´ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+e)}};function nn(e){var n,t;if(console.log("ğŸ–¼ï¸ pickFirstImage - ãƒ‡ãƒ¼ã‚¿åˆ†æ:",{hasImages:!!(null==e?void 0:e.images),imagesLength:(null==(n=null==e?void 0:e.images)?void 0:n.length)||0,hasSavedImages:!!(null==e?void 0:e.savedImages),savedImagesLength:(null==(t=null==e?void 0:e.savedImages)?void 0:t.length)||0,hasConversationHistory:!!(null==e?void 0:e.conversationHistory),hasImagePath:!!(null==e?void 0:e.imagePath),hasImageUrl:!!(null==e?void 0:e.imageUrl),dataKeys:Object.keys(e||{})}),"string"==typeof(null==e?void 0:e.imageUrl)&&e.imageUrl.trim()){console.log("ğŸ–¼ï¸ pickFirstImage - imageUrl:",e.imageUrl);let n=e.imageUrl;return n.startsWith("http")||(n=n.replace(/\/api\/api\//g,"/api/"),n=`http://localhost:8080${n}`),n}if("string"==typeof(null==e?void 0:e.imagePath)&&e.imagePath.trim()){console.log("ğŸ–¼ï¸ pickFirstImage - imagePath:",e.imagePath);let n=e.imagePath;return n.startsWith("http")||(n=n.replace(/\/api\/api\//g,"/api/"),n=`http://localhost:8080${n}`),n}if(Array.isArray(null==e?void 0:e.savedImages)&&e.savedImages.length>0){const n=e.savedImages[0];if(console.log("ğŸ–¼ï¸ pickFirstImage - savedImages[0]:",n),"string"==typeof n&&!n.startsWith("data:image/")){let e=n;return e.startsWith("http")||(e=e.replace(/\/api\/api\//g,"/api/"),e=`http://localhost:8080${e}`),e}if(n&&"object"==typeof n){const e=n.url||n.path||n.fileName;if(e&&!e.startsWith("data:image/")){let n=e;return n.startsWith("http")||(n=n.replace(/\/api\/api\//g,"/api/"),n=`http://localhost:8080${n}`),n}}}if(Array.isArray(null==e?void 0:e.images)&&e.images.length>0){const n=e.images[0];if(console.log("ğŸ–¼ï¸ pickFirstImage - images[0]:",n),n&&"object"==typeof n&&n.url){let e=n.url;return e.startsWith("http")||(e=e.replace(/\/api\/api\//g,"/api/"),e.startsWith("http")||(e=`http://localhost:8080${e}`)),console.log("ğŸ–¼ï¸ pickFirstImage - imagesé…åˆ—ã‹ã‚‰å–å¾—:",e),e}if(n&&"object"==typeof n&&n.fileName){const e=`http://localhost:8080${`/api/images/chat-exports/${n.fileName}`}`;return console.log("ğŸ–¼ï¸ pickFirstImage - DBç”»åƒãƒ¬ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å–å¾—:",e),e}}if(Array.isArray(null==e?void 0:e.conversationHistory))for(const a of e.conversationHistory)if(a.content&&"string"==typeof a.content&&a.content.startsWith("data:image/"))return console.log("ğŸ–¼ï¸ pickFirstImage - conversationHistoryã‹ã‚‰Base64ç”»åƒã‚’ç™ºè¦‹"),a.content;if("string"==typeof(null==e?void 0:e.id)||"string"==typeof(null==e?void 0:e.chatId)){const n=e.id||e.chatId;console.log("ğŸ–¼ï¸ pickFirstImage - å±¥æ­´IDã‹ã‚‰ç”»åƒã‚’æ¨æ¸¬:",n);const t=`/api/images/chat-exports/${[`${n}_3_0.jpeg`,`${n}_2_0.jpeg`,`${n}_1_0.jpeg`,`${n}_0_0.jpeg`,`${n}.jpg`,`${n}.jpeg`,`chat_image_${n}_*.jpg`][0]}`;return console.log("ğŸ–¼ï¸ pickFirstImage - æ¨æ¸¬ã•ã‚ŒãŸç”»åƒãƒ‘ã‚¹:",t),`http://localhost:8080${t}`}if("string"==typeof(null==e?void 0:e.fileName)){const n=e.fileName.replace(/^export_/,"");if(/\.(png|jpg|jpeg)$/i.test(n)){const e=`/api/images/chat-exports/${n}`;return console.log("ğŸ–¼ï¸ pickFirstImage - fileNameç”»åƒç›´ãƒªãƒ³ã‚¯:",e),`http://localhost:8080${e}`}{const e=`/api/images/chat-exports/${n.replace(/\.json$/,"")}_3_0.jpeg`;return console.log("ğŸ–¼ï¸ pickFirstImage - fileNameã‹ã‚‰æ¨æ¸¬:",e),`http://localhost:8080${e}`}}return console.log("ğŸ–¼ï¸ pickFirstImage - ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"),null}return Y?i.jsx("div",{className:"p-6",children:i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),i.jsx("p",{className:"text-gray-600",children:"å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­..."})]})})}):i.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-2xl font-bold mb-2",children:"å±¥æ­´ç®¡ç†"}),i.jsx("p",{className:"text-gray-600",children:"é€ä¿¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¨é–¢é€£ç”»åƒã®å±¥æ­´ã‚’ç®¡ç†ãƒ»æ¤œç´¢ã§ãã¾ã™"})]}),i.jsxs(r,{className:"mb-6",children:[i.jsx(c,{children:i.jsxs(d,{className:"flex items-center gap-2",children:[i.jsx(w,{className:"h-5 w-5"}),"æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼"]})}),i.jsxs(m,{children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[i.jsx("div",{className:"lg:col-span-2",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx(p,{placeholder:"ã‚¿ã‚¤ãƒˆãƒ«ã€æ©Ÿç¨®ã€äº‹æ¥­æ‰€ã€å¿œæ€¥å‡¦ç½®å†…å®¹ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãªã©ã§æ¤œç´¢...",value:V.searchText,onChange:e=>Ve("searchText",e.target.value),onKeyDown:e=>{"Enter"===e.key&&Ke()},className:"w-full"}),i.jsx("p",{className:"text-xs text-gray-500",children:"â€» è¤‡æ•°ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§å…¥åŠ›ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€å±¥æ­´ã‚’æ¤œç´¢ã—ã¾ã™"})]})}),i.jsx("div",{children:i.jsxs("div",{className:"space-y-2",children:[i.jsx(p,{type:"date",value:V.searchDate,onChange:e=>Ve("searchDate",e.target.value),className:"w-full"}),i.jsx("p",{className:"text-xs text-gray-500",children:"â€» æŒ‡å®šã—ãŸæ—¥ä»˜ã®å±¥æ­´ã‚’æ¤œç´¢ã—ã¾ã™"})]})}),i.jsx("div",{children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs(g,{value:V.machineType||"all",onValueChange:e=>Ve("machineType","all"===e?"":e),children:[i.jsx(h,{children:i.jsx(u,{placeholder:"æ©Ÿç¨®ã‚’é¸æŠ"})}),i.jsxs(x,{children:[i.jsx(v,{value:"all",children:"ã™ã¹ã¦ã®æ©Ÿç¨®"}),He?i.jsx(v,{value:"loading",disabled:!0,children:"èª­ã¿è¾¼ã¿ä¸­..."}):_e.machineTypes&&_e.machineTypes.length>0?_e.machineTypes.map((e,n)=>i.jsx(v,{value:e,children:e},`type-${n}`)):i.jsx(v,{value:"no-data",disabled:!0,children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),i.jsxs("p",{className:"text-xs text-gray-500",children:["â€» JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ©Ÿç¨®ã‚’å–å¾—ã—ã¦ã„ã¾ã™",_e.machineTypes&&` (${_e.machineTypes.length}ä»¶)`]})]})}),i.jsx("div",{children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs(g,{value:V.machineNumber||"all",onValueChange:e=>Ve("machineNumber","all"===e?"":e),children:[i.jsx(h,{children:i.jsx(u,{placeholder:"æ©Ÿæ¢°ç•ªå·ã‚’é¸æŠ"})}),i.jsxs(x,{children:[i.jsx(v,{value:"all",children:"ã™ã¹ã¦ã®æ©Ÿæ¢°ç•ªå·"}),He?i.jsx(v,{value:"loading",disabled:!0,children:"èª­ã¿è¾¼ã¿ä¸­..."}):_e.machineNumbers&&_e.machineNumbers.length>0?_e.machineNumbers.map((e,n)=>i.jsx(v,{value:e,children:e},`number-${n}`)):i.jsx(v,{value:"no-data",disabled:!0,children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),i.jsxs("p",{className:"text-xs text-gray-500",children:["â€» JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ©Ÿæ¢°ç•ªå·ã‚’å–å¾—ã—ã¦ã„ã¾ã™",_e.machineNumbers&&` (${_e.machineNumbers.length}ä»¶)`]})]})})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(a,{onClick:Ke,className:"flex items-center gap-2",children:[i.jsx(w,{className:"h-4 w-4"}),"æ¤œç´¢"]}),i.jsx(a,{variant:"outline",onClick:()=>{K({machineType:"",machineNumber:"",searchText:"",searchDate:""})},children:"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢"})]})]})]}),i.jsxs(r,{className:"mb-6",children:[i.jsx(c,{children:i.jsxs(d,{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(s,{className:"h-5 w-5"}),"æ•…éšœå±¥æ­´ä¸€è¦§ (",F.length,"ä»¶)"]}),i.jsx("div",{className:"flex items-center gap-2",children:ce&&i.jsx("span",{className:"text-sm text-gray-500",children:"ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•èª­ã¿è¾¼ã¿ä¸­..."})})]})}),i.jsx(m,{children:0===F.length?i.jsxs("div",{className:"text-center py-8",children:[i.jsx(s,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),i.jsx("p",{className:"text-gray-600",children:"å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]}):i.jsx("div",{className:"space-y-4",children:i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-gray-50",children:[i.jsxs("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-medium",children:[i.jsx("input",{type:"checkbox",checked:Z.size===F.length&&F.length>0,onChange:()=>{Z.size===F.length?ee(new Set):ee(new Set(F.map(e=>e.id)))},className:"mr-2 w-6 h-6"}),"é¸æŠ"]}),i.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"æ©Ÿç¨®"}),i.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"æ©Ÿæ¢°ç•ªå·"}),i.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"äº‹è±¡å†…å®¹"}),i.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"ä½œæˆæ—¥æ™‚"}),i.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"ç”»åƒ"}),i.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"})]})}),i.jsx("tbody",{children:F.map(e=>{var n,t,s,l,r,c,d;const m=e.jsonData;let p=(null==m?void 0:m.title)||"";if(!p&&e.fileName){const n=e.fileName.split("_");n.length>1&&(p=n[0])}if(!p&&(p=(null==m?void 0:m.question)||"äº‹è±¡ãªã—","äº‹è±¡ãªã—"===p&&(null==(n=null==m?void 0:m.chatData)?void 0:n.messages))){const e=m.chatData.messages.filter(e=>!e.isAiResponse);e.length>0&&(p=e[0].content||"äº‹è±¡ãªã—")}p||(p="äº‹è±¡ãªã—");const g=(null==m?void 0:m.machineType)||(null==(s=null==(t=null==m?void 0:m.chatData)?void 0:t.machineInfo)?void 0:s.machineTypeName)||(null==(l=e.machineInfo)?void 0:l.machineTypeName)||e.machineType||"",h=(null==m?void 0:m.machineNumber)||(null==(c=null==(r=null==m?void 0:m.chatData)?void 0:r.machineInfo)?void 0:c.machineNumber)||(null==(d=e.machineInfo)?void 0:d.machineNumber)||e.machineNumber||"";return i.jsxs("tr",{className:"hover:bg-gray-50 bg-blue-50",children:[i.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center text-sm",children:i.jsx("input",{type:"checkbox",checked:Z.has(e.id),onChange:()=>{return n=e.id,void ee(e=>{const t=new Set(e);return t.has(n)?t.delete(n):t.add(n),t});var n},className:"w-6 h-6"})}),i.jsx("td",{className:"border border-gray-300 px-3 py-2 text-sm",children:g||"-"}),i.jsx("td",{className:"border border-gray-300 px-3 py-2 text-sm",children:h||"-"}),i.jsx("td",{className:"border border-gray-300 px-3 py-2 text-sm max-w-xs truncate",title:p,children:p}),i.jsx("td",{className:"border border-gray-300 px-3 py-2 text-sm",children:Ze(e.createdAt)}),i.jsx("td",{className:"border border-gray-300 px-3 py-2",children:(()=>{var n;const t=e.images||(null==(n=e.jsonData)?void 0:n.images)||[];let a="";return t.length>0?(a=t[0].url||t[0].path||"",a=a.replace(/\/api\/api\//g,"/api/")):(a=nn(e),a&&(a=a.replace(/\/api\/api\//g,"/api/"))),a?i.jsx("img",{src:a,alt:"ç”»åƒ",className:"w-8 h-8 object-cover rounded border",title:"æ•…éšœç”»åƒ",onError:e=>{e.target.style.display="none"}}):i.jsx("span",{className:"text-gray-500",children:"-"})})()}),i.jsx("td",{className:"border border-gray-300 px-3 py-2",children:i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(a,{variant:"outline",size:"sm",onClick:()=>{console.log("ğŸ” ç·¨é›†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ - å…ƒã®ã‚¢ã‚¤ãƒ†ãƒ :",e),console.log("ğŸ” item.machineType:",e.machineType),console.log("ğŸ” item.machineNumber:",e.machineNumber),console.log("ğŸ” item.jsonData:",e.jsonData);const n=Fe(e);console.log("ğŸ” æ­£è¦åŒ–å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ :",n),console.log("ğŸ” æ­£è¦åŒ–å¾Œ machineType:",n.machineType),console.log("ğŸ” æ­£è¦åŒ–å¾Œ machineNumber:",n.machineNumber),pe(n),xe(!0)},className:"flex items-center gap-1 text-xs",title:"ç·¨é›†ç”»é¢ã‚’é–‹ã",children:[i.jsx(o,{className:"h-3 w-3"}),"ç·¨é›†"]}),i.jsxs(a,{variant:"outline",size:"sm",onClick:()=>{be({show:!0,id:e.id,title:p})},className:"flex items-center gap-1 text-xs text-red-600 hover:text-red-700 hover:bg-red-50",title:"å±¥æ­´ã‚’å‰Šé™¤",children:[i.jsx(T,{className:"h-3 w-3"}),"å‰Šé™¤"]})]})})]},e.id)})})]})})})})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[i.jsx("div",{className:"flex items-center justify-between mb-4",children:i.jsx("h2",{className:"text-xl font-bold",children:"ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡¦ç†"})}),i.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(a,{onClick:()=>Ge("json"),disabled:oe||0===Z.size,variant:"default",className:"flex items-center gap-2",children:[i.jsx(I,{className:"h-4 w-4"}),"é¸æŠå±¥æ­´ã‚’JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (",Z.size,")"]}),i.jsxs(a,{onClick:()=>Ge("csv"),disabled:oe||0===Z.size,variant:"default",className:"flex items-center gap-2",children:[i.jsx(I,{className:"h-4 w-4"}),"é¸æŠå±¥æ­´ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (",Z.size,")"]}),i.jsxs(a,{onClick:()=>{const e=window.open("","_blank");if(!e)return;const n=Z.size>0?F.filter(e=>Z.has(e.id)):F,t=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>å±¥æ­´ä¸€è¦§ - å°åˆ·</title>\n        <style>\n          @page { size: A4 portrait; margin: 10mm; }\n          @media print {\n            html, body { margin: 0; padding: 0; }\n            .no-print { display: none !important; }\n            img, .image-cell { break-inside: avoid; page-break-inside: avoid; }\n            table { width: 100%; border-collapse: collapse; table-layout: fixed; }\n            th, td { border: 1px solid #ccc; padding: 4px; vertical-align: top; }\n          }\n          body { font-family: Arial, sans-serif; margin: 20px; }\n          .header { text-align: center; margin-bottom: 20px; }\n          .header h1 { margin: 0; color: #333; }\n          .header p { margin: 5px 0; color: #666; }\n          table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; vertical-align: top; }\n          th { background-color: #f5f5f5; font-weight: bold; }\n          .summary { margin-bottom: 20px; padding: 10px; background-color: #f9f9f9; border-radius: 5px; }\n          .image-cell img { max-width: 100px; max-height: 100px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px; display: block; margin: 0 auto; }\n          .image-cell { text-align: center; vertical-align: middle; }\n          img.thumb { width: 32px; height: 32px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px; }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>æ•…éšœå±¥æ­´ä¸€è¦§</h1>\n          <p>å°åˆ·æ—¥æ™‚: ${(new Date).toLocaleString("ja-JP")}</p>\n          <p>å¯¾è±¡ä»¶æ•°: ${n.length}ä»¶${Z.size>0?" (é¸æŠã•ã‚ŒãŸå±¥æ­´)":""}</p>\n        </div>\n        \n        <div class="summary">\n          <strong>å°åˆ·å¯¾è±¡:</strong> ${Z.size>0?"é¸æŠã•ã‚ŒãŸå±¥æ­´":"æ•…éšœå±¥æ­´ä¸€è¦§"}<br>\n          <strong>å°åˆ·æ—¥æ™‚:</strong> ${(new Date).toLocaleString("ja-JP")}<br>\n          <strong>å¯¾è±¡ä»¶æ•°:</strong> ${n.length}ä»¶\n        </div>\n        \n        <table>\n          <thead>\n            <tr>\n              <th>æ©Ÿç¨®</th>\n              <th>æ©Ÿæ¢°ç•ªå·</th>\n              <th>äº‹è±¡</th>\n              <th>èª¬æ˜</th>\n              <th>ä½œæˆæ—¥æ™‚</th>\n              <th>ç”»åƒ</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${n.map(e=>{var n,t,a,s,o,i,l,r;const c=e.jsonData,d=(null==c?void 0:c.machineType)||(null==(t=null==(n=null==c?void 0:c.originalChatData)?void 0:n.machineInfo)?void 0:t.machineTypeName)||(null==(s=null==(a=null==c?void 0:c.chatData)?void 0:a.machineInfo)?void 0:s.machineTypeName)||e.machineType||"",m=(null==c?void 0:c.machineNumber)||(null==(i=null==(o=null==c?void 0:c.originalChatData)?void 0:o.machineInfo)?void 0:i.machineNumber)||(null==(r=null==(l=null==c?void 0:c.chatData)?void 0:l.machineInfo)?void 0:r.machineNumber)||e.machineNumber||"",p=(null==c?void 0:c.title)||(null==c?void 0:c.question)||"äº‹è±¡ãªã—",g=(null==c?void 0:c.problemDescription)||(null==c?void 0:c.answer)||"èª¬æ˜ãªã—",h=nn(e);return`\n                <tr>\n                  <td>${d}</td>\n                  <td>${m}</td>\n                  <td>${p}</td>\n                  <td>${g}</td>\n                  <td>${Ze(e.createdAt)}</td>\n                  <td class="image-cell">${h?`<img class="thumb" src="${h}" alt="æ•…éšœç”»åƒ" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span style="display:none; color: #999; font-size: 10px;">ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</span>`:"ãªã—"}</td>\n                </tr>\n              `}).join("")}\n          </tbody>\n        </table>\n        \n        <div class="no-print" style="margin-top: 20px; text-align: center;">\n          <button onclick="window.close()">é–‰ã˜ã‚‹</button>\n        </div>\n      </body>\n      </html>\n    `;e.document.write(t),e.document.close(),setTimeout(()=>{e.print()},100)},disabled:oe||0===Z.size,variant:"outline",className:"flex items-center gap-2",children:[i.jsx(s,{className:"h-4 w-4"}),"é¸æŠã®ä¸€è¦§ã‚’å°åˆ· (",Z.size,")"]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(a,{onClick:()=>Qe("json"),disabled:oe,variant:"secondary",className:"flex items-center gap-2",children:[i.jsx(I,{className:"h-4 w-4"}),"å…¨å±¥æ­´ã‚’JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"]}),i.jsxs(a,{onClick:()=>Qe("csv"),disabled:oe,variant:"secondary",className:"flex items-center gap-2",children:[i.jsx(I,{className:"h-4 w-4"}),"å…¨å±¥æ­´ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"]})]})]}),oe&&i.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),"ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡¦ç†ä¸­..."]})]}),ae>1&&i.jsx("div",{className:"flex justify-center mt-6",children:i.jsxs("div",{className:"flex gap-2",children:[i.jsx(a,{variant:"outline",onClick:()=>Ye(ne-1),disabled:1===ne,children:"å‰ã¸"}),Array.from({length:Math.min(5,ae)},(e,n)=>{const t=Math.max(1,Math.min(ae-4,ne-2))+n;return i.jsx(a,{variant:ne===t?"default":"outline",onClick:()=>Ye(t),children:t},t)}),i.jsx(a,{variant:"outline",onClick:()=>Ye(ne+1),disabled:ne===ae,children:"æ¬¡ã¸"})]})}),ve&&ge&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:i.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-auto",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h2",{className:"text-xl font-bold",children:"å±¥æ­´ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(a,{onClick:()=>(e=>{var n,t,a,s,o,i,l,r,c,d,m,p,g,h,u;const x=e.images||(null==(n=e.jsonData)?void 0:n.images)||[];let v="";v=x.length>0?`\n        <div class="section">\n          <h2>é–¢é€£ç”»åƒï¼ˆ${x.length}æšï¼‰</h2>\n          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;">\n            ${x.map((e,n)=>{const t=(e.url||e.path||"").replace(/\/api\/api\//g,"/api/"),a=e.fileName||`å±¥æ­´ç”»åƒ${n+1}`;return`<div style='text-align:center;'><img src='${t}' alt='${a}' style='max-width:100%;max-height:180px;display:block;margin:0 auto;border:1px solid #ccc;border-radius:6px;'/><div style='font-size:12px;color:#888;margin-top:4px;'>${a}</div></div>`}).join("")}\n          </div>\n        </div>\n      `:"<div class='section' style='color:#888;'>ç”»åƒã¯ã‚ã‚Šã¾ã›ã‚“</div>",console.log("ğŸ–¨ï¸ å°åˆ·ãƒ¬ãƒãƒ¼ãƒˆé–‹å§‹:",e);const y=window.open("","_blank");if(!y)return console.error("âŒ å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸ"),void alert("å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç„¡åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚");console.log("âœ… å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãã¾ã—ãŸ");const f=e.jsonData;let b="äº‹è±¡ãªã—";if(e.fileName){const n=e.fileName.split("_");n.length>1&&(b=n[0])}if("äº‹è±¡ãªã—"===b&&(b=(null==f?void 0:f.title)||(null==f?void 0:f.question)||"äº‹è±¡ãªã—","äº‹è±¡ãªã—"===b&&(null==(t=null==f?void 0:f.chatData)?void 0:t.messages))){const e=f.chatData.messages.filter(e=>!e.isAiResponse);e.length>0&&(b=e[0].content||"äº‹è±¡ãªã—")}const j=(null==f?void 0:f.problemDescription)||(null==f?void 0:f.answer)||"èª¬æ˜ãªã—",D=(null==(a=e.machineInfo)?void 0:a.machineTypeName)||(null==f?void 0:f.machineType)||(null==(o=null==(s=null==f?void 0:f.chatData)?void 0:s.machineInfo)?void 0:o.machineTypeName)||e.machineType||"",N=(null==(i=e.machineInfo)?void 0:i.machineNumber)||(null==f?void 0:f.machineNumber)||(null==(r=null==(l=null==f?void 0:f.chatData)?void 0:l.machineInfo)?void 0:r.machineNumber)||e.machineNumber||"";null==f||f.extractedComponents,null==f||f.extractedSymptoms,null==f||f.possibleModels;let w="",T="";if(console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨ç”»åƒèª­ã¿è¾¼ã¿å‡¦ç†:",{itemId:e.id,hasJsonData:!!f,jsonDataKeys:f?Object.keys(f):[],savedImages:null==f?void 0:f.savedImages,conversationHistory:null==f?void 0:f.conversationHistory,originalChatData:null==f?void 0:f.originalChatData,chatData:null==f?void 0:f.chatData,imagePath:e.imagePath}),(null==f?void 0:f.conversationHistory)&&f.conversationHistory.length>0){const n=f.conversationHistory.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(w=n.content,T=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: conversationHistoryã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆæœ€å„ªå…ˆï¼‰"))}if(!w&&(null==(c=null==f?void 0:f.originalChatData)?void 0:c.messages)){const n=f.originalChatData.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(w=n.content,T=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: originalChatDataã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½2ï¼‰"))}if(!w&&(null==(d=null==f?void 0:f.chatData)?void 0:d.messages)){const n=f.chatData.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(w=n.content,T=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: chatDataã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½3ï¼‰"))}if(!w&&(null==f?void 0:f.messages)&&Array.isArray(f.messages)){const n=f.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(w=n.content,T=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: messagesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½4ï¼‰"))}if(!w&&(null==f?void 0:f.savedImages)&&f.savedImages.length>0){const n=f.savedImages[0];w=n.url||"",T=n.fileName||`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: savedImagesã‹ã‚‰ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½5ï¼‰")}if(!w&&(null==(m=null==f?void 0:f.originalChatData)?void 0:m.messages)){const n=f.originalChatData.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(w=n.content,T=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: originalChatDataã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½3ï¼‰"))}if(!w&&(null==(p=null==f?void 0:f.chatData)?void 0:p.messages)){const n=f.chatData.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(w=n.content,T=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: chatDataã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½4ï¼‰"))}if(!w){const n=(e,t="")=>{const a=[];if(e&&"object"==typeof e)for(const[s,o]of Object.entries(e)){const e=t?`${t}.${s}`:s;"string"==typeof o&&o.startsWith("data:image/")?a.push({path:e,content:o}):Array.isArray(o)?o.forEach((t,s)=>{a.push(...n(t,`${e}[${s}]`))}):"object"==typeof o&&null!==o&&a.push(...n(o,e))}return a},t=n(f);t.length>0&&(w=t[0].content,T=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: å†å¸°çš„æ¤œç´¢ã§ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½6ï¼‰"))}!w&&e.imagePath&&(w=e.imagePath.startsWith("http")?e.imagePath:e.imagePath.startsWith("/")?`${window.location.origin}${e.imagePath}`:`${window.location.origin}/api/images/chat-exports/${e.imagePath}`,T=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: imagePathã‹ã‚‰ç”»åƒã‚’å–å¾—ï¼ˆæœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰")),console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: æœ€çµ‚çš„ãªç”»åƒæƒ…å ±:",{hasImage:!!w,imageUrl:w?w.substring(0,100)+"...":"ãªã—",imageFileName:T,isBase64:!!w&&w.startsWith("data:image/")});const I=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸ - å°åˆ·</title>\n        <style>\n          body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }\n          .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }\n          .header h1 { margin: 0; color: #333; font-size: 24px; }\n          .header p { margin: 5px 0; color: #666; }\n          .section { margin-bottom: 25px; }\n          .section h2 { color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }\n          .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }\n          .info-item { padding: 10px; background-color: #f9f9f9; border-radius: 5px; }\n          .info-item strong { display: block; margin-bottom: 5px; color: #333; }\n          .content-box { background-color: #f9f9f9; padding: 15px; border-radius: 5px; margin-top: 10px; }\n          .image-section { text-align: center; margin: 20px 0; }\n          .image-section img { max-width: 100%; max-height: 300px; border: 1px solid #ddd; border-radius: 5px; }\n          @media print {\n            .no-print { display: none; }\n            body { \n              margin: 0; \n              font-size: 10px;\n              line-height: 1.2;\n            }\n            .header h1 { \n              font-size: 16px; \n              margin: 5px 0; \n            }\n            .header p { \n              font-size: 8px; \n              margin: 2px 0; \n            }\n            .section { \n              margin: 8px 0; \n              page-break-inside: avoid;\n            }\n            .section h2 { \n              font-size: 12px; \n              margin: 5px 0; \n            }\n            .info-grid { \n              gap: 4px; \n            }\n            .info-item { \n              font-size: 9px; \n              padding: 2px; \n            }\n            .content { \n              font-size: 9px; \n              line-height: 1.1;\n            }\n            .image-section { \n              margin: 8px 0; \n            }\n            .image-section img { \n              max-height: 150px; \n            }\n            @page {\n              size: A4;\n              margin: 10mm;\n            }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸</h1>\n          <p>å°åˆ·æ—¥æ™‚: ${(new Date).toLocaleString("ja-JP")}</p>\n        </div>\n        <div class="section">\n          <h2>å ±å‘Šæ¦‚è¦</h2>\n          <div class="info-grid">\n            <div class="info-item">\n              <strong>å ±å‘Šæ›¸ID</strong>\n              R${e.id.slice(-5).toUpperCase()}\n            </div>\n            <div class="info-item">\n              <strong>æ©Ÿæ¢°ID</strong>\n              ${e.machineNumber}\n            </div>\n            <div class="info-item">\n              <strong>æ—¥ä»˜</strong>\n              ${e.createdAt?new Date(e.createdAt).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]}\n            </div>\n            <div class="info-item">\n              <strong>å ´æ‰€</strong>\n              â—‹â—‹ç·š\n            </div>\n            <div class="info-item">\n              <strong>æ•…éšœã‚³ãƒ¼ãƒ‰</strong>\n              FC01\n            </div>\n          </div>\n        </div>\n        <div class="section">\n          <h2>äº‹è±¡è©³ç´°</h2>\n          <div class="content-box">\n            <p><strong>äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${b}</p>\n            <p><strong>äº‹è±¡èª¬æ˜:</strong> ${j}</p>\n            <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> å¿œæ€¥å‡¦ç½®å®Œäº†<br><span style="font-size:12px;color:#888;">${e.fileName||""}</span></p>\n            <p><strong>æ‹…å½“ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢:</strong> æ‹…å½“è€…</p>\n            <p><strong>æ©Ÿç¨®:</strong> ${D}</p>\n            <p><strong>æ©Ÿæ¢°ç•ªå·:</strong> ${N}</p>\n          </div>\n        </div>\n        ${v}\n        <div class="section">\n          <h2>ä¿®ç¹•è¨ˆç”»</h2>\n          <div class="info-grid">\n            <div class="info-item">\n              <strong>äºˆå®šæœˆæ—¥</strong>\n              ${(null==(g=e.jsonData)?void 0:g.repairSchedule)||"-"}\n            </div>\n            <div class="info-item">\n              <strong>å ´æ‰€</strong>\n              ${(null==(h=e.jsonData)?void 0:h.location)||"-"}\n            </div>\n          </div>\n        </div>\n        \n        <div class="section">\n          <h2>è¨˜äº‹æ¬„</h2>\n          <div class="content-box">\n            <p>${(null==(u=e.jsonData)?void 0:u.remarks)||"è¨˜è¼‰ãªã—"}</p>\n          </div>\n        </div>\n        \n        <div class="section">\n          <p style="text-align: center; color: #666; font-size: 12px;">\n            Â© 2025 æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸. All rights reserved.\n          </p>\n        </div>\n        \n        <div class="no-print" style="margin-top: 30px; text-align: center;">\n          <button onclick="window.print()">å°åˆ·</button>\n          <button onclick="window.close()">é–‰ã˜ã‚‹</button>\n        </div>\n      </body>\n      </html>\n    `;console.log("ğŸ–¨ï¸ HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é•·ã•:",I.length),console.log("ğŸ–¨ï¸ HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å…ˆé ­100æ–‡å­—:",I.substring(0,100));try{y.document.write(I),y.document.close(),console.log("âœ… document.write()ã§HTMLã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸ")}catch(E){console.error("âŒ document.write()ã§ã‚¨ãƒ©ãƒ¼:",E);try{y.document.documentElement.innerHTML=I,console.log("âœ… innerHTMLã§HTMLã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸ")}catch(S){console.error("âŒ innerHTMLã§ã‚‚ã‚¨ãƒ©ãƒ¼:",S),y.document.open(),y.document.write(I),y.document.close(),console.log("âœ… æ–°ã—ã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§HTMLã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸ")}}setTimeout(()=>{console.log("ğŸ–¨ï¸ æ›¸ãè¾¼ã¾ã‚ŒãŸHTMLã®é•·ã•:",y.document.documentElement.innerHTML.length),console.log("ğŸ–¨ï¸ æ›¸ãè¾¼ã¾ã‚ŒãŸHTMLã®å…ˆé ­100æ–‡å­—:",y.document.documentElement.innerHTML.substring(0,100))},100),console.log("âœ… å°åˆ·ãƒ¬ãƒãƒ¼ãƒˆHTMLã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸ"),y.onload=()=>{console.log("âœ… å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"),y.focus(),setTimeout(()=>{y.print(),console.log("âœ… å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ")},1e3)},setTimeout(()=>{y.closed||(y.focus(),y.print(),console.log("âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ"))},2e3)})(ge),className:"flex items-center gap-2",children:[i.jsx(s,{className:"h-4 w-4"}),"å°åˆ·"]}),i.jsxs(a,{onClick:()=>{const e=Fe(ge);pe(e),ye(!1),xe(!0)},className:"flex items-center gap-2",children:[i.jsx(o,{className:"h-4 w-4"}),"ç·¨é›†ã«ç§»å‹•"]}),i.jsx(a,{variant:"ghost",onClick:()=>ye(!1),children:"Ã—"})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"text-center border-b pb-4",children:[i.jsx("h1",{className:"text-2xl font-bold mb-2",children:"å¿œæ€¥å‡¦ç½®ã‚µãƒãƒ¼ãƒˆå±¥æ­´"}),i.jsxs("p",{className:"text-sm text-gray-500",children:["ä½œæˆæ—¥æ™‚: ",Ze(ge.createdAt)]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"åŸºæœ¬æƒ…å ±"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(o,{className:"h-4 w-4 text-gray-500"}),i.jsxs("span",{children:[i.jsx("strong",{children:"æ©Ÿç¨®:"})," ",ge.machineType]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(S,{className:"h-4 w-4 text-gray-500"}),i.jsxs("span",{children:[i.jsx("strong",{children:"æ©Ÿæ¢°ç•ªå·:"})," ",ge.machineNumber]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(E,{className:"h-4 w-4 text-gray-500"}),i.jsxs("span",{children:[i.jsx("strong",{children:"ä½œæˆæ—¥æ™‚:"})," ",Ze(ge.createdAt)]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(N,{className:"h-4 w-4 text-gray-500"}),i.jsxs("span",{children:[i.jsx("strong",{children:"ç”»åƒ:"})," ",ge.imagePath?"ã‚ã‚Š":"ãªã—"]})]})]})]}),(()=>{var e;const n=ge.images||(null==(e=ge.jsonData)?void 0:e.images)||[];return n.length>0?i.jsxs("div",{children:[i.jsxs("h3",{className:"text-lg font-semibold mb-3",children:["é–¢é€£ç”»åƒï¼ˆ",n.length,"æšï¼‰"]}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:n.map((e,n)=>i.jsxs("div",{className:"text-center",children:[i.jsx("img",{src:(e.url||e.path||"").replace(/\/api\/api\//g,"/api/"),alt:e.fileName||`å±¥æ­´ç”»åƒ${n+1}`,className:"w-full h-48 object-cover rounded-md",onError:e=>{e.currentTarget.style.opacity="0.3",e.currentTarget.alt="ç”»åƒãŒè¡¨ç¤ºã§ãã¾ã›ã‚“"}}),i.jsx("div",{style:{fontSize:"12px",color:"#888",marginTop:"4px"},children:e.fileName||""})]},e.url||e.fileName||n))})]}):null})()]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"è©³ç´°æƒ…å ±"}),i.jsx("div",{className:"bg-gray-50 p-4 rounded-md",children:i.jsx("pre",{className:"text-sm overflow-auto max-h-64",children:JSON.stringify(ge.jsonData,null,2)})})]})]})]})})}),ue&&me&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:i.jsx("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[95vh] overflow-auto",children:i.jsxs("div",{className:"p-6",children:[(0!==ze.machineTypes.length||Je||(async()=>{try{qe(!0),console.log("ğŸ” æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹");const{buildApiUrl:e}=await t(async()=>{const{buildApiUrl:e}=await import("./index-BRa72JSc.js").then(e=>e.J);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),n=await fetch(e("/machines/machine-types"));console.log("ğŸ” APIãƒ¬ã‚¹ãƒãƒ³ã‚¹:",n.status,n.statusText);const a=await n.json();if(console.log("ğŸ” APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿:",a),a.success&&a.data){const e=new Set,n=[];console.log("ğŸ” æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿ã¯å°‚ç”¨APIã‹ã‚‰å–å¾—ã•ã‚Œã¾ã™"),a.data.forEach(t=>{t.machine_type_name&&!e.has(t.machine_type_name)&&(e.add(t.machine_type_name),n.push({id:t.id,machineTypeName:t.machine_type_name}))});const t={machineTypes:n,machines:[]};console.log("ğŸ” æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿å–å¾—çµæœ:",t),console.log("ğŸ” æ©Ÿç¨®æ•°:",t.machineTypes.length),console.log("ğŸ” æ©Ÿæ¢°ç•ªå·æ•°:",t.machines.length),console.log("ğŸ” æ©Ÿç¨®ä¸€è¦§:",t.machineTypes.map(e=>e.machineTypeName)),console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ä¸€è¦§:",t.machines.map(e=>`${e.machineNumber} (${e.machineTypeName})`)),console.log("ğŸ” setMachineDataå‘¼ã³å‡ºã—å‰:",t),Le(t),console.log("ğŸ” setMachineDataå‘¼ã³å‡ºã—å®Œäº†")}else console.log("âš ï¸ æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ:",a),console.log("âš ï¸ data.success:",a.success),console.log("âš ï¸ data.machineTypes:",a.machineTypes),console.log("âš ï¸ data.machines:",a.machines),Le({machineTypes:[],machines:[]})}catch(e){console.error("æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:",e),Le({machineTypes:[],machines:[]})}finally{qe(!1)}})(),console.log("ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºæ™‚ã®editingItem:",{machineType:me.machineType,machineNumber:me.machineNumber,fileName:me.fileName,title:null==(tn=me.jsonData)?void 0:tn.title,question:null==(an=me.jsonData)?void 0:an.question,jsonData:me.jsonData}),null),i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h2",{className:"text-xl font-bold",children:"æ©Ÿæ¢°æ•…éšœæƒ…å ±ç·¨é›†"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(a,{onClick:()=>{console.log("ç·¨é›†ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã™:",me),en(me)},className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[i.jsx(I,{className:"h-4 w-4"}),"ä¿å­˜"]}),i.jsxs(a,{onClick:()=>{console.log("ğŸ–¨ï¸ ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‹ã‚‰å°åˆ·ã‚’å®Ÿè¡Œ:",me),console.log("ğŸ–¨ï¸ editingItem.jsonData:",me.jsonData),console.log("ğŸ–¨ï¸ editingItem.id:",me.id),console.log("ğŸ–¨ï¸ editingItem.fileName:",me.fileName);const e=(e=>{const n=(e=>{var n,t,a,s;console.log("ğŸ–¼ï¸ ç”»åƒåé›†é–‹å§‹ - reportData:",e),console.log("ğŸ–¼ï¸ reportData keys:",Object.keys(e||{}));const o=[],i=new Set;return console.log("ğŸ–¼ï¸ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª:"),console.log("ğŸ–¼ï¸ - chatData:",(null==e?void 0:e.chatData)?"ã‚ã‚Š":"ãªã—"),console.log("ğŸ–¼ï¸ - chatData.messages:",(null==(n=null==e?void 0:e.chatData)?void 0:n.messages)?"ã‚ã‚Š("+e.chatData.messages.length+"ä»¶)":"ãªã—"),console.log("ğŸ–¼ï¸ - conversationHistory:",(null==e?void 0:e.conversationHistory)?"ã‚ã‚Š("+(Array.isArray(e.conversationHistory)?e.conversationHistory.length:"non-array")+")":"ãªã—"),console.log("ğŸ–¼ï¸ - originalChatData.messages:",(null==(t=null==e?void 0:e.originalChatData)?void 0:t.messages)?"ã‚ã‚Š("+e.originalChatData.messages.length+")":"ãªã—"),console.log("ğŸ–¼ï¸ - messages:",(null==e?void 0:e.messages)?"ã‚ã‚Š("+(Array.isArray(e.messages)?e.messages.length:"non-array")+")":"ãªã—"),(null==(a=null==e?void 0:e.chatData)?void 0:a.messages)&&Array.isArray(e.chatData.messages)&&(console.log("ğŸ–¼ï¸ chatData.messagesã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­..."),e.chatData.messages.forEach((e,n)=>{var t;if(console.log("ğŸ–¼ï¸ message["+n+"]:",{id:null==e?void 0:e.id,content:(null==e?void 0:e.content)?e.content.substring(0,50)+"...":"ãªã—",isBase64:null==(t=null==e?void 0:e.content)?void 0:t.startsWith("data:image/")}),(null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")){const t=e.content.replace(/\r?\n/g,"").replace(/[""]/g,'"').trim();i.has(t)||(i.add(t),o.push({id:`chatdata-${n}`,url:t,fileName:`æ•…éšœç”»åƒ${o.length+1}`,description:"æ•…éšœç®‡æ‰€ç”»åƒï¼ˆchatData.messagesï¼‰"}),console.log("ğŸ–¼ï¸ Base64ç”»åƒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆchatData.messagesï¼‰:",o.length))}})),(null==e?void 0:e.conversationHistory)&&Array.isArray(e.conversationHistory)&&(console.log("ğŸ–¼ï¸ conversationHistoryã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­..."),e.conversationHistory.forEach((e,n)=>{if((null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")){const t=e.content.replace(/\r?\n/g,"").replace(/[""]/g,'"').trim();i.has(t)||(i.add(t),o.push({id:`conversation-${n}`,url:t,fileName:`æ•…éšœç”»åƒ${o.length+1}`,description:"æ•…éšœç®‡æ‰€ç”»åƒï¼ˆconversationHistoryï¼‰"}),console.log("ğŸ–¼ï¸ Base64ç”»åƒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆconversationHistoryï¼‰:",o.length))}})),(null==(s=null==e?void 0:e.originalChatData)?void 0:s.messages)&&Array.isArray(e.originalChatData.messages)&&(console.log("ğŸ–¼ï¸ originalChatData.messagesã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­..."),e.originalChatData.messages.forEach((e,n)=>{if((null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")){const t=e.content.replace(/\r?\n/g,"").replace(/[""]/g,'"').trim();i.has(t)||(i.add(t),o.push({id:`original-${n}`,url:t,fileName:`æ•…éšœç”»åƒ${o.length+1}`,description:"æ•…éšœç®‡æ‰€ç”»åƒï¼ˆoriginalChatDataï¼‰"}),console.log("ğŸ–¼ï¸ Base64ç”»åƒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆoriginalChatDataï¼‰:",o.length))}})),(null==e?void 0:e.messages)&&Array.isArray(e.messages)&&(console.log("ğŸ–¼ï¸ messagesã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­..."),e.messages.forEach((e,n)=>{if((null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")){const t=e.content.replace(/\r?\n/g,"").replace(/[""]/g,'"').trim();i.has(t)||(i.add(t),o.push({id:`messages-${n}`,url:t,fileName:`æ•…éšœç”»åƒ${o.length+1}`,description:"æ•…éšœç®‡æ‰€ç”»åƒï¼ˆmessagesï¼‰"}),console.log("ğŸ–¼ï¸ Base64ç”»åƒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆmessagesï¼‰:",o.length))}})),console.log("ğŸ–¼ï¸ ç”»åƒåé›†çµæœï¼ˆBase64ã®ã¿ï¼‰:",o.length+"ä»¶ã®ç”»åƒ"),o.forEach((e,n)=>{console.log("ğŸ–¼ï¸ ç”»åƒ["+n+"]:",e.description,"-",e.url.substring(0,50)+"...")}),o})(e),t=`\n      <div class="image-section">\n        <h3>æ•…éšœç®‡æ‰€ç”»åƒ</h3>\n        <div class="image-grid">\n          ${n&&n.length>0?n.map((e,n)=>`\n                  <div class="image-item">\n                    <img class="report-img" \n                         src="${e.url}" \n                         alt="æ•…éšœç”»åƒ${n+1}" />\n                  </div>\n                `).join(""):'<div class="image-item" style="color:#888;text-align:center;">ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“</div>'}\n        </div>\n      </div>\n    `;return`\n      <!doctype html>\n      <html>\n      <head>\n        <meta charset="utf-8">\n        <title>æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸</title>\n        <style>\n          @page {\n            size: A4 portrait;\n            margin: 10mm;\n          }\n          \n          * {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n          }\n          \n          body {\n            font-family: 'Yu Mincho', 'YuMincho', 'Hiragino Mincho ProN', 'Hiragino Mincho Pro', 'HGSæ˜æœ', 'MS Mincho', serif;\n            font-size: 12pt;\n            line-height: 1.4;\n            color: #000;\n            background: white;\n            max-width: 100%;\n            overflow-x: hidden;\n          }\n          \n          /* å°åˆ·æ™‚ã®ã¿æ–‡å­—ã‚µã‚¤ã‚ºã‚’ã•ã‚‰ã«ç¸®å°ã—ã¦A4ä¸€æšã«åã‚ã‚‹ */\n          @media print {\n            body {\n              font-size: 10pt;\n              line-height: 1.2;\n            }\n            \n            .header h1 {\n              font-size: 16pt;\n              margin-bottom: 5px;\n            }\n            \n            .section h2 {\n              font-size: 12pt;\n              margin-bottom: 5px;\n            }\n            \n            .info-item strong,\n            .info-item span,\n            .info-item input,\n            .info-item textarea,\n            .content-box strong,\n            .content-box p {\n              font-size: 10pt;\n            }\n            \n            .header p {\n              font-size: 10pt;\n            }\n            \n            input, textarea, .editable {\n              font-size: 10pt;\n            }\n            \n            /* å°åˆ·æ™‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæœ€é©åŒ– */\n            .section {\n              margin-bottom: 8px;\n              page-break-inside: avoid;\n            }\n            \n            .info-grid {\n              gap: 4px;\n              margin-bottom: 8px;\n            }\n            \n            .info-item {\n              padding: 4px;\n            }\n            \n            .content-box {\n              padding: 4px;\n              margin-top: 4px;\n            }\n            \n            .image-grid {\n              gap: 4px;\n              margin: 4px 0;\n              grid-template-columns: repeat(2, 1fr);\n              max-width: 300px;\n            }\n            \n            .report-img {\n              max-width: 120px;\n              max-height: 80px;\n            }\n            \n            /* A4ä¸€æšã«åã‚ã‚‹ãŸã‚ã®èª¿æ•´ */\n            @page {\n              size: A4 portrait;\n              margin: 10mm;\n            }\n            \n            .container {\n              max-height: 260mm;\n              overflow: hidden;\n            }\n            \n            .action-buttons { \n              display: none !important; \n            }\n            \n            body { \n              margin: 0; \n              padding: 0;\n            }\n          }\n          \n          .container {\n            max-width: 100%;\n            padding: 0;\n          }\n          \n          .header {\n            text-align: center;\n            margin-bottom: 10px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #333;\n          }\n          \n          .header h1 {\n            font-size: 27pt;\n            font-weight: bold;\n            margin-bottom: 8px;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼çµ±ä¸€ */\n          .edit-mode .header h1 {\n            font-size: 27pt;\n            font-weight: bold;\n          }\n          \n          .section h2 {\n            font-size: 20pt;\n            font-weight: bold;\n            color: #000;\n            border-bottom: 1px solid #ccc;\n            padding-bottom: 4px;\n            margin-bottom: 8px;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã—çµ±ä¸€ */\n          .edit-mode .section h2 {\n            font-size: 20pt;\n            font-weight: bold;\n            color: #000;\n          }\n          \n          .info-item strong {\n            font-size: 18pt;\n            font-weight: bold;\n            color: #000;\n          }\n          \n          .info-item span,\n          .info-item input,\n          .info-item textarea {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          .header p {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼æ—¥ä»˜çµ±ä¸€ */\n          .edit-mode .header p {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          .section {\n            margin-bottom: 10px;\n            page-break-inside: avoid;\n          }\n          \n\n          \n          .info-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 6px;\n            margin-bottom: 8px;\n          }\n          \n          .info-item {\n            padding: 8px;\n            background-color: #f8f8f8;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n          }\n          \n\n          \n          .content-box {\n            background-color: #f8f8f8;\n            padding: 6px;\n            border: 1px solid #ddd;\n            border-radius: 3px;\n            margin-top: 4px;\n          }\n          \n          .content-box p {\n            font-size: 8pt;\n            line-height: 1.3;\n            margin: 0;\n          }\n          \n          .image-section {\n            margin: 12px 0;\n            padding-left: 20px;\n            page-break-inside: avoid;\n          }\n          \n          .image-section h3 {\n            font-size: 10pt;\n            margin-bottom: 8px;\n            text-align: left;\n          }\n          \n          .image-grid {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 12px;\n            margin: 8px 0;\n            max-width: 600px;\n          }\n          \n          .image-item {\n            text-align: center;\n            page-break-inside: avoid;\n          }\n          \n          .report-img {\n            max-width: 120px;\n            max-height: 80px;\n            width: auto;\n            height: auto;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            object-fit: cover;\n            transition: all 0.2s ease;\n          }\n          \n          .resizable-image {\n            position: relative;\n            cursor: move;\n            user-select: none;\n          }\n          \n          .resizable-image:hover {\n            border: 2px solid #007bff;\n            transform: scale(1.02);\n          }\n          \n          .resizable-image.dragging {\n            opacity: 0.7;\n            transform: scale(1.1);\n            z-index: 1000;\n          }\n          \n          .image-caption {\n            text-align: center;\n            margin-top: 5px;\n            font-size: 8pt;\n            color: #666;\n          }\n          \n          .footer {\n            text-align: center;\n            margin-top: 8px;\n            padding-top: 6px;\n            border-top: 1px solid #ccc;\n            font-size: 7pt;\n            color: #666;\n          }\n          \n          .action-buttons {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            z-index: 1000;\n            display: flex;\n            gap: 10px;\n          }\n          \n          .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: bold;\n          }\n          \n          .btn-print {\n            background: #28a745;\n            color: white;\n            padding: 20px 40px; /* 2å€ã‚µã‚¤ã‚º */\n            font-size: 28px; /* 2å€ã‚µã‚¤ã‚º */\n          }\n          \n          .btn-save {\n            background: #ffc107;\n            color: #000;\n          }\n          \n          .btn-cancel {\n            background: #6c757d;\n            color: white;\n            padding: 20px 40px; /* 2å€ã‚µã‚¤ã‚º */\n            font-size: 28px; /* 2å€ã‚µã‚¤ã‚º */\n          }\n          \n          .btn-close {\n            background: #6c757d;\n            color: white;\n          }\n          \n          .readonly {\n            display: block;\n          }\n          \n          .editable {\n            display: none;\n            background-color: #f0f0f0;\n            color: #000;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            padding: 8px;\n            font-size: 18pt;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸UIã«åˆã‚ã›ã‚‹ */\n          .edit-mode .editable {\n            font-size: 18pt;\n          }\n          \n          .edit-mode .info-item strong {\n            font-size: 18pt;\n          }\n          \n          .edit-mode .info-item span {\n            font-size: 18pt;\n          }\n          \n          .edit-mode .content-box strong {\n            font-size: 18pt;\n          }\n          \n          .edit-mode .content-box p {\n            font-size: 18pt;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ - ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚ˆã†ã«å¼·åŒ– */\n          .edit-mode .readonly {\n            display: none !important;\n            visibility: hidden !important;\n          }\n          \n          .edit-mode .editable {\n            display: block !important;\n            visibility: visible !important;\n            width: 100% !important;\n            padding: 8px !important;\n            border: 2px solid #007bff !important;\n            border-radius: 3px !important;\n            font-size: 14pt !important;\n            color: #000 !important;\n            background-color: #fff !important;\n            font-family: inherit !important;\n          }\n          \n          /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç·¨é›†è¦ç´ ã‚’ç¢ºå®Ÿã«éè¡¨ç¤º */\n          .editable {\n            display: none !important;\n            visibility: hidden !important;\n          }\n          \n          /* èª­ã¿å–ã‚Šå°‚ç”¨è¦ç´ ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤º */\n          .readonly {\n            display: inline !important;\n            visibility: visible !important;\n          }\n          \n          input, textarea {\n            width: 100%;\n            padding: 8px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€ */\n          .edit-mode input,\n          .edit-mode textarea {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          .content-box strong {\n            font-size: 18pt;\n            font-weight: bold;\n            color: #000;\n          }\n          \n          .content-box p {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          @media print {\n            .action-buttons { display: none !important; }\n            body { margin: 0; }\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */\n          .readonly {\n            display: inline;\n          }\n          \n          .editable {\n            display: none !important;\n            padding: 4px 8px;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            width: 100%;\n            box-sizing: border-box;\n          }\n          \n          .edit-mode .readonly {\n            display: none !important;\n          }\n          \n          .edit-mode .editable {\n            display: block !important;\n            background-color: #ffffcc;\n            border: 2px solid #007bff;\n          }\n          \n          .btn {\n            padding: 8px 16px;\n            margin: 0 4px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n          }\n          \n          .btn-save {\n            background-color: #28a745;\n            color: white;\n          }\n          \n          .btn-cancel {\n            background-color: #6c757d;\n            color: white;\n            padding: 20px 40px; /* 2å€ã‚µã‚¤ã‚º */\n            font-size: 28px; /* 2å€ã‚µã‚¤ã‚º */\n          }\n          \n          .btn-print {\n            background-color: #17a2b8;\n            color: white;\n            padding: 20px 40px; /* 2å€ã‚µã‚¤ã‚º */\n            font-size: 28px; /* 2å€ã‚µã‚¤ã‚º */\n          }\n          \n          .btn-close {\n            background-color: #dc3545;\n            color: white;\n          }\n        </style>\n      </head>\n      <body>\n        <script>\n          // ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿãªè¨­å®š\n          window.reportData = {};\n          console.log('Script starting...');\n        <\/script>\n        <div class="action-buttons">\n          <button class="btn btn-save" id="save-btn" style="display: none;">ä¿å­˜</button>\n          <button class="btn btn-print" onclick="window.print()">å°åˆ·</button>\n          <button class="btn btn-cancel" id="cancel-btn" style="display: none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n          <button class="btn btn-close" onclick="window.close()">é–‰ã˜ã‚‹</button>\n        </div>\n        \n        <div class="container">\n          <div class="header">\n            <h1>æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸</h1>\n            <p>å°åˆ·æ—¥æ™‚: ${(new Date).toLocaleString("ja-JP")}</p>\n          </div>\n          \n          <div class="section">\n            <h2>å ±å‘Šæ¦‚è¦</h2>\n            <div class="info-grid">\n              <div class="info-item">\n                <strong>å ±å‘Šæ›¸ID</strong>\n                <span class="readonly">${(e.reportId||e.id||"").substring(0,8)}...</span>\n                <input class="editable" value="${e.reportId||e.id||""}" />\n              </div>\n              <div class="info-item">\n                <strong>æ©Ÿç¨®</strong>\n                <span class="readonly">${e.machineType||e.machineTypeName||"-"}</span>\n                <input class="editable" value="${e.machineType||e.machineTypeName||""}" />\n              </div>\n              <div class="info-item">\n                <strong>æ©Ÿæ¢°ç•ªå·</strong>\n                <span class="readonly">${e.machineNumber||"-"}</span>\n                <input class="editable" value="${e.machineNumber||""}" />\n              </div>\n              <div class="info-item">\n                <strong>æ—¥ä»˜</strong>\n                <span class="readonly">${e.date?new Date(e.date).toLocaleDateString("ja-JP"):e.timestamp?new Date(e.timestamp).toLocaleDateString("ja-JP"):e.createdAt?new Date(e.createdAt).toLocaleDateString("ja-JP"):"-"}</span>\n                <input class="editable" type="date" value="${e.date||e.timestamp||e.createdAt||""}" />\n              </div>\n              <div class="info-item">\n                <strong>å ´æ‰€</strong>\n                <span class="readonly">${e.location||"-"}</span>\n                <input class="editable" value="${e.location||""}" />\n              </div>\n            </div>\n          </div>\n          \n          <div class="section">\n            <h2>æ•…éšœè©³ç´°</h2>\n            <div class="info-grid">\n              <div class="info-item">\n                <strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</strong>\n                <span class="readonly">${e.status||"-"}</span>\n                <input class="editable" value="${e.status||""}" />\n              </div>\n              <div class="info-item">\n                <strong>è²¬ä»»è€…</strong>\n                <span class="readonly">${e.engineer||"-"}</span>\n                <input class="editable" value="${e.engineer||""}" />\n              </div>\n            </div>\n            \n            <div class="content-box">\n              <strong>èª¬æ˜</strong>\n              <p class="readonly">${e.problemDescription||e.description||e.incidentTitle||e.title||"èª¬æ˜ãªã—"}</p>\n              <textarea class="editable" rows="4">${e.problemDescription||e.description||e.incidentTitle||e.title||""}</textarea>\n            </div>\n            \n            <div class="content-box">\n              <strong>å‚™è€ƒ</strong>\n              <p class="readonly">${e.notes||"-"}</p>\n              <textarea class="editable" rows="4">${e.notes||""}</textarea>\n            </div>\n          </div>\n          \n          ${t}\n          \n          <div class="section">\n            <h2>ä¿®ç¹•è¨ˆç”»</h2>\n            <div class="info-grid">\n              <div class="info-item">\n                <strong>ä¾é ¼æœˆæ—¥</strong>\n                <span class="readonly">${e.requestDate||"-"}</span>\n                <input class="editable" type="date" value="${e.requestDate||""}" />\n              </div>\n              <div class="info-item">\n                <strong>äºˆå®šæœˆæ—¥</strong>\n                <span class="readonly">${e.repairSchedule||"-"}</span>\n                <input class="editable" type="date" value="${e.repairSchedule||""}" />\n              </div>\n              <div class="info-item">\n                <strong>å ´æ‰€</strong>\n                <span class="readonly">${e.repairLocation||"-"}</span>\n                <input class="editable" value="${e.repairLocation||""}" />\n              </div>\n            </div>\n          </div>\n          \n          <div class="section">\n            <h2>è¨˜äº‹æ¬„</h2>\n            <div class="info-item">\n              <strong>å‚™è€ƒãƒ»è¨˜äº‹</strong>\n              <p class="readonly">${e.remarks||"-"}</p>\n              <textarea class="editable" rows="4" maxlength="200">${e.remarks||""}</textarea>\n            </div>\n          </div>\n          \n          <div class="footer">\n            <p>Â© 2025 æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸. All rights reserved.</p>\n          </div>\n        </div>\n        \n        <script>\n          let isEditMode = false;\n          let originalData = {};\n          \n          // ãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã«è¨­å®šã™ã‚‹é–¢æ•°\n          function setOriginalData(data) {\n            try {\n              originalData = data;\n              console.log('ğŸ”§ originalData set:', originalData);\n            } catch (e) {\n              console.error('originalDataã®è¨­å®šã«å¤±æ•—:', e);\n              originalData = {};\n            }\n          }\n          \n          // ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰èª­ã¿å–ã‚Šï¼‰\n          try {\n            if (window.reportData) {\n              setOriginalData(window.reportData);\n              console.log('ğŸ”§ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ');\n            } else {\n              console.error('ğŸ”§ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°window.reportDataãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n              setOriginalData({});\n            }\n          } catch (e) {\n            console.error('ğŸ”§ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—:', e);\n            setOriginalData({});\n          }\n          \n          // ç”»åƒè¡¨ç¤ºã®åˆæœŸåŒ–ã¨ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š\n          document.addEventListener('DOMContentLoaded', function() {\n            console.log('ğŸ”§ DOMContentLoaded - Document ready');\n            console.log('ğŸ”§ Available edit elements:');\n            console.log('ğŸ”§ - Readonly elements:', document.querySelectorAll('.readonly').length);\n            console.log('ğŸ”§ - Editable elements:', document.querySelectorAll('.editable').length);\n            console.log('ğŸ”§ - Edit button:', !!document.querySelector('.btn-edit'));\n            console.log('ğŸ”§ Initial CSS classes:', document.body.classList.toString());\n            console.log('ğŸ”§ originalData:', originalData);\n            \n            // åˆæœŸçŠ¶æ…‹ã§ã¯ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚ªãƒ•ã«ã™ã‚‹\n            isEditMode = false;\n            document.body.classList.remove('edit-mode');\n            \n            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š\n            setupButtonEvents();\n            \n            // è¤‡æ•°å›å®Ÿè¡Œã—ã¦ç¢ºå®Ÿã«è¨­å®š\n            setTimeout(() => {\n              setupButtonEvents();\n            }, 100);\n            \n            setTimeout(() => {\n              setupButtonEvents();\n            }, 500);\n          });\n          \n          // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹é–¢æ•°\n          function setupButtonEvents() {\n            console.log('ğŸ”§ setupButtonEvents called');\n            \n            // DOMè¦ç´ ã®ç¢ºå®Ÿãªå–å¾—ã®ãŸã‚å°‘ã—å¾…æ©Ÿ\n            setTimeout(() => {\n              const editBtn = document.getElementById('edit-btn');\n              const saveBtn = document.getElementById('save-btn');\n              const cancelBtn = document.getElementById('cancel-btn');\n              \n              console.log('ğŸ”§ ãƒœã‚¿ãƒ³ã®å–å¾—çŠ¶æ³:', {\n                editBtn: !!editBtn,\n                saveBtn: !!saveBtn,\n                cancelBtn: !!cancelBtn\n              });\n              \n              if (editBtn) {\n                console.log('ğŸ”§ Edit button found, setting up event listener');\n                \n                // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¯ãƒªã‚¢\n                const newEditBtn = editBtn.cloneNode(true);\n                editBtn.parentNode?.replaceChild(newEditBtn, editBtn);\n                \n                // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ \n                newEditBtn.addEventListener('click', function(e) {\n                  console.log('ğŸ”§ Edit button click event triggered');\n                  e.preventDefault();\n                  e.stopPropagation();\n                  try {\n                    console.log('ğŸ”§ Calling toggleEditMode()...');\n                    toggleEditMode();\n                  } catch (error) {\n                    console.error('ğŸ”§ Error in toggleEditMode:', error);\n                    alert('ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);\n                  }\n                });\n                \n                // ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š\n                newEditBtn.style.pointerEvents = 'auto';\n                newEditBtn.style.cursor = 'pointer';\n                newEditBtn.style.backgroundColor = '#007bff';\n                newEditBtn.style.color = 'white';\n                newEditBtn.style.border = '1px solid #007bff';\n                newEditBtn.style.borderRadius = '4px';\n                newEditBtn.style.padding = '8px 16px';\n                newEditBtn.style.fontSize = '14px';\n                \n                console.log('ğŸ”§ Edit button event listener added successfully');\n              } else {\n              console.error('ğŸ”§ Edit button not found!');\n              }\n              \n              if (saveBtn) {\n                const newSaveBtn = saveBtn.cloneNode(true);\n                saveBtn.parentNode?.replaceChild(newSaveBtn, saveBtn);\n                \n                newSaveBtn.addEventListener('click', function(e) {\n                  console.log('ğŸ”§ Save button click event triggered');\n                  e.preventDefault();\n                  e.stopPropagation();\n                  try {\n                    saveReport();\n                  } catch (error) {\n                    console.error('ğŸ”§ Error in saveReport:', error);\n                    alert('ä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);\n                  }\n                });\n              }\n              \n              if (cancelBtn) {\n                const newCancelBtn = cancelBtn.cloneNode(true);\n                cancelBtn.parentNode?.replaceChild(newCancelBtn, cancelBtn);\n                \n                newCancelBtn.addEventListener('click', function(e) {\n                  console.log('ğŸ”§ Cancel button click event triggered');\n                  e.preventDefault();\n                  e.stopPropagation();\n                  try {\n                    toggleEditMode();\n                  } catch (error) {\n                    console.error('ğŸ”§ Error in toggleEditMode (cancel):', error);\n                  }\n                });\n              }\n              \n              console.log('ğŸ”§ Button event setup complete');\n            }, 200); // DOMè¦ç´ ãŒç¢ºå®Ÿã«å­˜åœ¨ã™ã‚‹ã¾ã§å¾…æ©Ÿ\n          }          function toggleEditMode() {\n            console.log('ğŸ”§ toggleEditMode called, current isEditMode:', isEditMode);\n            console.log('ğŸ”§ Current document body classList before toggle:', document.body.classList.toString());\n            \n            isEditMode = !isEditMode;\n            console.log('ğŸ”§ toggled isEditMode to:', isEditMode);\n            \n            const editBtn = document.getElementById('edit-btn');\n            const cancelBtn = document.getElementById('cancel-btn');\n            const saveBtn = document.getElementById('save-btn');\n            \n            console.log('ğŸ”§ Found buttons:', { editBtn: !!editBtn, cancelBtn: !!cancelBtn, saveBtn: !!saveBtn });\n            \n            if (isEditMode) {\n              console.log('ğŸ”§ Entering edit mode...');\n              \n              // ãƒœã‚¿ãƒ³è¡¨ç¤ºã®å¤‰æ›´\n              if (editBtn) {\n                editBtn.style.display = 'none';\n                console.log('ğŸ”§ Edit button hidden');\n              }\n              if (cancelBtn) {\n                cancelBtn.style.display = 'inline-block';\n                cancelBtn.style.backgroundColor = '#6c757d';\n                cancelBtn.style.color = 'white';\n                cancelBtn.style.border = '1px solid #6c757d';\n                cancelBtn.style.borderRadius = '4px';\n                cancelBtn.style.padding = '8px 16px';\n                cancelBtn.style.fontSize = '14px';\n                cancelBtn.style.cursor = 'pointer';\n                console.log('ğŸ”§ Cancel button shown');\n              }\n              if (saveBtn) {\n                saveBtn.style.display = 'inline-block';\n                saveBtn.style.backgroundColor = '#28a745';\n                saveBtn.style.color = 'white';\n                saveBtn.style.border = '1px solid #28a745';\n                saveBtn.style.borderRadius = '4px';\n                saveBtn.style.padding = '8px 16px';\n                saveBtn.style.fontSize = '14px';\n                saveBtn.style.cursor = 'pointer';\n                console.log('ğŸ”§ Save button shown');\n              }\n              \n              // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ \n              document.body.classList.add('edit-mode');\n              console.log('ğŸ”§ Added edit-mode class, classList:', document.body.classList.toString());\n              \n              // è¦ç´ ã®è¡¨ç¤ºã‚’ç¢ºå®Ÿã«åˆ‡ã‚Šæ›¿ãˆ\n              const readonlyElements = document.querySelectorAll('.readonly');\n              const editableElements = document.querySelectorAll('.editable');\n              \n              console.log('ğŸ”§ Found elements for toggle:', { \n                readonly: readonlyElements.length, \n                editable: editableElements.length \n              });\n              \n              readonlyElements.forEach((el, index) => {\n                el.style.display = 'none !important';\n                el.style.visibility = 'hidden';\n                console.log('ğŸ”§ Hidden readonly element', index);\n              });\n              \n              editableElements.forEach((el, index) => {\n                el.style.display = 'block !important';\n                el.style.visibility = 'visible';\n                // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èƒŒæ™¯è‰²ã‚’å¤‰æ›´ã—ã¦ç·¨é›†ä¸­ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«ã™ã‚‹\n                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {\n                  el.style.backgroundColor = '#ffffcc';\n                  el.style.border = '2px solid #007bff';\n                  el.removeAttribute('readonly');\n                  el.removeAttribute('disabled');\n                }\n                console.log('ğŸ”§ Shown editable element', index, 'tag:', el.tagName);\n              });\n              \n              // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã«å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¨­å®š\n              setupEditFields();\n              \n              console.log('ğŸ”§ Edit mode setup complete');\n            } else {\n              console.log('ğŸ”§ Exiting edit mode...');\n              \n              // ãƒœã‚¿ãƒ³è¡¨ç¤ºã®å¤‰æ›´\n              if (editBtn) {\n                editBtn.style.display = 'inline-block';\n                console.log('ğŸ”§ Edit button shown');\n              }\n              if (cancelBtn) {\n                cancelBtn.style.display = 'none';\n                console.log('ğŸ”§ Cancel button hidden');\n              }\n              if (saveBtn) {\n                saveBtn.style.display = 'none';\n                console.log('ğŸ”§ Save button hidden');\n              }\n              \n              // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤\n              document.body.classList.remove('edit-mode');\n              console.log('ğŸ”§ Removed edit-mode class, classList:', document.body.classList.toString());\n              \n              // è¦ç´ ã®è¡¨ç¤ºã‚’ç¢ºå®Ÿã«åˆ‡ã‚Šæ›¿ãˆ\n              const readonlyElements = document.querySelectorAll('.readonly');\n              const editableElements = document.querySelectorAll('.editable');\n              \n              readonlyElements.forEach((el, index) => {\n                el.style.display = 'inline';\n                el.style.visibility = 'visible';\n                console.log('ğŸ”§ Shown readonly element', index);\n              });\n              \n              editableElements.forEach((el, index) => {\n                el.style.display = 'none !important';\n                el.style.visibility = 'hidden';\n                console.log('ğŸ”§ Hidden editable element', index);\n              });\n              \n              // ç·¨é›†å†…å®¹ã‚’å…ƒã«æˆ»ã™\n              resetToOriginal();\n              \n              console.log('ğŸ”§ Read-only mode setup complete');\n            }\n          }\n                console.log('ğŸ”§ Save button hidden');\n              }\n              \n              // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤\n              document.body.classList.remove('edit-mode');\n              console.log('ğŸ”§ Removed edit-mode class, classList:', document.body.classList.toString());\n              \n              // è¦ç´ ã®è¡¨ç¤ºã‚’å¼·åˆ¶çš„ã«åˆ‡ã‚Šæ›¿ãˆ\n              readonlyElements.forEach((el, index) => {\n                el.style.display = 'inline';\n                el.style.visibility = 'visible';\n                console.log('ğŸ”§ Shown readonly element', index);\n              });\n              \n              editableElements.forEach((el, index) => {\n                el.style.display = 'none';\n                el.style.visibility = 'hidden';\n                console.log('ğŸ”§ Hidden editable element', index);\n              });\n              \n              // ç·¨é›†å†…å®¹ã‚’å…ƒã«æˆ»ã™\n              resetToOriginal();\n              \n              console.log('ğŸ”§ Read-only mode setup complete');\n            }\n          }\n          \n          // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§ã‚‚åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹\n          window.toggleEditMode = toggleEditMode;\n          \n          // ãƒšãƒ¼ã‚¸ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ã‚‚ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’å†è¨­å®š\n          window.addEventListener('load', function() {\n            console.log('ğŸ”§ Window load event - page fully loaded');\n            setTimeout(() => {\n              setupButtonEvents();\n            }, 500);\n          });\n          \n          function setupEditFields() {\n            console.log('ğŸ”§ setupEditFields called');\n            // å„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«é©åˆ‡ãªå€¤ã‚’è¨­å®š\n            const inputs = document.querySelectorAll('input.editable');\n            const textareas = document.querySelectorAll('textarea.editable');\n            \n            console.log('ğŸ”§ Found inputs:', inputs.length, 'textareas:', textareas.length);\n            \n            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¨­å®š\n            inputs.forEach((input, index) => {\n              console.log('ğŸ”§ Setting up input', index, input);\n              if (index === 0) input.value = originalData.reportId || originalData.id || '';\n              if (index === 1) input.value = originalData.machineType || originalData.machineTypeName || '';\n              if (index === 2) input.value = originalData.machineNumber || '';\n              if (index === 3) {\n                const dateValue = originalData.date || originalData.timestamp || originalData.createdAt;\n                if (dateValue) {\n                  const date = new Date(dateValue);\n                  input.value = date.toISOString().split('T')[0];\n                }\n              }\n              if (index === 4) input.value = originalData.location || '';\n              if (index === 5) input.value = originalData.status || '';\n              if (index === 6) input.value = originalData.engineer || '';\n              if (index === 7) input.value = originalData.requestDate || '';\n              if (index === 8) input.value = originalData.repairSchedule || '';\n              if (index === 9) input.value = originalData.repairLocation || '';\n            });\n            \n            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å€¤ã‚’è¨­å®š\n            textareas.forEach((textarea, index) => {\n              if (index === 0) {\n                textarea.value = originalData.problemDescription || originalData.description || originalData.incidentTitle || originalData.title || '';\n              }\n              if (index === 1) {\n                textarea.value = originalData.notes || '';\n              }\n            });\n          }\n          \n          function resetToOriginal() {\n            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…ƒã®å€¤ã«æˆ»ã™\n            setupEditFields();\n          }\n          \n          async function saveReport() {\n            console.log('ä¿å­˜å‡¦ç†é–‹å§‹');\n            console.log('originalData:', originalData);\n            console.log('originalData.id:', originalData.id);\n            console.log('originalData.chatId:', originalData.chatId);\n            console.log('originalData.reportId:', originalData.reportId);\n            console.log('originalData.fileName:', originalData.fileName);\n            \n            // ç·¨é›†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’åé›†\n            const updatedData = { ...originalData };\n            \n            // å„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰å€¤ã‚’å–å¾—\n            const inputs = document.querySelectorAll('input.editable');\n            const textareas = document.querySelectorAll('textarea.editable');\n            \n            console.log('å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•°:', inputs.length);\n            console.log('ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢æ•°:', textareas.length);\n            \n            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’å–å¾—\n            inputs.forEach((input, index) => {\n              if (index === 0) updatedData.reportId = input.value;\n              if (index === 1) updatedData.machineType = input.value;\n              if (index === 2) updatedData.machineNumber = input.value;\n              if (index === 3) updatedData.date = input.value;\n              if (index === 4) updatedData.location = input.value;\n              if (index === 5) updatedData.status = input.value;\n              if (index === 6) updatedData.engineer = input.value;\n              if (index === 7) updatedData.requestDate = input.value;\n              if (index === 8) updatedData.repairSchedule = input.value;\n              if (index === 9) updatedData.repairLocation = input.value;\n            });\n            \n            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å€¤ã‚’å–å¾—\n            textareas.forEach((textarea, index) => {\n              if (index === 0) {\n                updatedData.problemDescription = textarea.value;\n              }\n              if (index === 1) {\n                updatedData.notes = textarea.value;\n              }\n            });\n            \n            console.log('æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿:', updatedData);\n            console.log('ä½¿ç”¨ã™ã‚‹chatId:', updatedData.chatId || updatedData.id);\n            \n            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜\n            localStorage.setItem('savedMachineFailureReport_' + updatedData.id, JSON.stringify(updatedData));\n            \n            // å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ï¼ˆè¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å±¥æ­´ä¸€è¦§è¡¨ã‚’æ›´æ–°ï¼‰\n            try {\n              if (window.opener && !window.opener.closed) {\n                // è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n                window.opener.postMessage({\n                  type: 'UPDATE_HISTORY_ITEM',\n                  data: updatedData\n                }, '*');\n                \n                // è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚‚æ›´æ–°\n                try {\n                  const parentStorage = window.opener.localStorage;\n                  const historyKey = 'savedMachineFailureReport_' + updatedData.id;\n                  parentStorage.setItem(historyKey, JSON.stringify(updatedData));\n                } catch (storageError) {\n                  console.warn('è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ›´æ–°ã«å¤±æ•—:', storageError);\n                }\n              }\n            } catch (error) {\n              console.warn('è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸ã®é€šçŸ¥ã«å¤±æ•—:', error);\n            }\n            \n            // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n            originalData = updatedData;\n            \n            // UIã‚’æ›´æ–°\n            updateUIAfterSave(updatedData);\n            \n            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†\n            toggleEditMode();\n            \n            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\n            alert('ãƒ¬ãƒãƒ¼ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚‚æ›´æ–°ã•ã‚Œã¾ã™ã€‚');\n            \n            // ã‚µãƒ¼ãƒãƒ¼ã¸ã®ä¿å­˜ã‚‚è©¦è¡Œ\n            try {\n              await saveToJsonFile(updatedData);\n            } catch (error) {\n              console.warn('ã‚µãƒ¼ãƒãƒ¼ã¸ã®ä¿å­˜ã¯å¤±æ•—ã—ã¾ã—ãŸãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ã¯ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™:', error);\n            }\n          }\n          \n          async function saveToJsonFile(updatedData) {\n            try {\n              console.log('ã‚µãƒ¼ãƒãƒ¼ã¸ã®ä¿å­˜é–‹å§‹:', updatedData);\n              \n              // æ­£ã—ã„IDã‚’å–å¾—\n              let targetId = originalData.id || originalData.chatId || originalData.reportId;\n              \n              // IDãŒå–å¾—ã§ããªã„å ´åˆã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰UUIDã‚’æŠ½å‡º\n              if (!targetId && originalData.fileName) {\n                console.log('ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰UUIDæŠ½å‡ºã‚’è©¦è¡Œ:', originalData.fileName);\n                \n                // UUIDãƒ‘ã‚¿ãƒ¼ãƒ³1: æ¨™æº–çš„ãªUUIDå½¢å¼\n                let fileNameMatch = originalData.fileName.match(/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})/);\n                \n                if (fileNameMatch) {\n                  targetId = fileNameMatch[1];\n                  console.log('æ¨™æº–UUIDã‹ã‚‰æŠ½å‡ºã—ãŸID:', targetId);\n                } else {\n                  // UUIDãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢åŒºåˆ‡ã‚Šã®UUID\n                  fileNameMatch = originalData.fileName.match(/_([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})/);\n                  if (fileNameMatch) {\n                    targetId = fileNameMatch[1];\n                    console.log('ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢åŒºåˆ‡ã‚ŠUUIDã‹ã‚‰æŠ½å‡ºã—ãŸID:', targetId);\n                  }\n                }\n              }\n              \n              if (!targetId) {\n                console.error('å¯¾è±¡IDãŒç‰¹å®šã§ãã¾ã›ã‚“:', originalData);\n                throw new Error('å¯¾è±¡IDãŒç‰¹å®šã§ãã¾ã›ã‚“');\n              }\n              \n              console.log('ä¿å­˜å¯¾è±¡ID:', targetId);\n              \n              // æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™\n              const updatePayload = {\n                updatedData: updatedData,\n                updatedBy: 'user'\n              };\n              \n              console.log('é€ä¿¡ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰:', updatePayload);\n              \n              // ã‚µãƒ¼ãƒãƒ¼APIã‚’å‘¼ã³å‡ºã—ã¦å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°\n              const response = await fetch('/api/history/update-item/' + targetId, {\n                method: 'PUT',\n                headers: {\n                  'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(updatePayload)\n              });\n              \n              console.log('ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response.status, response.statusText);\n              console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼:', Object.fromEntries(response.headers.entries()));\n              \n              if (response.ok) {\n                const result = await response.json();\n                console.log('å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ:', result);\n                \n                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\n                alert('ãƒ¬ãƒãƒ¼ãƒˆãŒå…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã«æ­£å¸¸ã«ä¸Šæ›¸ãä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚');\n                \n                return result;\n              } else {\n                const errorData = await response.json();\n                console.error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼:', errorData);\n                throw new Error(errorData.error || 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ' + response.status);\n              }\n              \n            } catch (error) {\n              console.error('JSONãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);\n              throw error;\n            }\n          }\n                    engineer: updatedData.engineer,\n                    location: updatedData.location,\n                    requestDate: updatedData.requestDate,\n                    repairSchedule: updatedData.repairSchedule,\n                    repairLocation: updatedData.repairLocation,\n                    lastModified: new Date().toISOString()\n                  },\n                  updatedBy: 'user'\n                })\n              });\n              \n              console.log('ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response.status, response.statusText);\n              console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼:', Object.fromEntries(response.headers.entries()));\n              \n              if (response.ok) {\n                try {\n                  const result = await response.json();\n                  console.log('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ:', result);\n                  \n                  // ä¿å­˜æˆåŠŸå¾Œã®å‡¦ç†\n                  updateUIAfterSave(updatedData);\n                  \n                  // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\n                  alert('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚');\n                } catch (parseError) {\n                  console.warn('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸãŒã€ä¿å­˜ã¯æˆåŠŸã—ã¦ã„ã¾ã™:', parseError);\n                  updateUIAfterSave(updatedData);\n                  alert('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚');\n                }\n              } else {\n                let errorMessage = 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼';\n                try {\n                  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®Content-Typeã‚’ç¢ºèª\n                  const contentType = response.headers.get('content-type');\n                  if (contentType && contentType.includes('application/json')) {\n                    const errorData = await response.json();\n                    console.error('ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹è©³ç´°:', errorData);\n                    if (errorData.error) {\n                      errorMessage = errorData.error;\n                    } else if (errorData.message) {\n                      errorMessage = errorData.message;\n                    } else {\n                      errorMessage = 'HTTP ' + response.status + ': ' + response.statusText;\n                    }\n                  } else {\n                    // HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆ\n                    const textResponse = await response.text();\n                    console.error('HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹:', textResponse.substring(0, 200));\n                    errorMessage = 'HTTP ' + response.status + ': ' + response.statusText + ' (HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹)';\n                  }\n                } catch (parseError) {\n                  console.error('ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æã«å¤±æ•—:', parseError);\n                  errorMessage = 'HTTP ' + response.status + ': ' + response.statusText;\n                }\n                \n                console.error('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', errorMessage);\n                alert('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + errorMessage);\n              }\n            } catch (error) {\n              console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);\n              console.error('ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯:', error.stack);\n              alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);\n            }\n          }\n          \n          function updateUIAfterSave(updatedData) {\n            // ä¿å­˜å¾Œã«UIã‚’æ›´æ–°\n            const readonlyElements = document.querySelectorAll('.readonly');\n            \n            // å ±å‘Šæ›¸ID\n            if (readonlyElements[0]) {\n              readonlyElements[0].textContent = (updatedData.reportId || updatedData.id || '').substring(0, 8) + '...';\n            }\n            \n            // æ©Ÿç¨®\n            if (readonlyElements[1]) {\n              readonlyElements[1].textContent = updatedData.machineType || updatedData.machineTypeName || '-';\n            }\n            \n            // æ©Ÿæ¢°ç•ªå·\n            if (readonlyElements[2]) {\n              readonlyElements[2].textContent = updatedData.machineNumber || '-';\n            }\n            \n            // æ—¥ä»˜\n            if (readonlyElements[3]) {\n              const dateValue = updatedData.date || updatedData.timestamp || updatedData.createdAt;\n              if (dateValue) {\n                const date = new Date(dateValue);\n                readonlyElements[3].textContent = date.toLocaleDateString('ja-JP');\n              } else {\n                readonlyElements[3].textContent = '-';\n              }\n            }\n            \n            // å ´æ‰€\n            if (readonlyElements[4]) {\n              readonlyElements[4].textContent = updatedData.location || '-';\n            }\n            \n            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹\n            if (readonlyElements[5]) {\n              readonlyElements[5].textContent = updatedData.status || '-';\n            }\n            \n            // è²¬ä»»è€…\n            if (readonlyElements[6]) {\n              readonlyElements[6].textContent = updatedData.engineer || '-';\n            }\n            \n            // èª¬æ˜\n            if (readonlyElements[7]) {\n              readonlyElements[7].textContent = updatedData.problemDescription || updatedData.description || updatedData.incidentTitle || updatedData.title || 'èª¬æ˜ãªã—';\n            }\n            \n            // å‚™è€ƒ\n            if (readonlyElements[8]) {\n              readonlyElements[8].textContent = updatedData.notes || '-';\n            }\n            \n            // ä¾é ¼æœˆæ—¥\n            if (readonlyElements[9]) {\n              readonlyElements[9].textContent = updatedData.requestDate || '-';\n            }\n            \n            // äºˆå®šæœˆæ—¥\n            if (readonlyElements[10]) {\n              readonlyElements[10].textContent = updatedData.repairSchedule || '-';\n            }\n            \n            // ä¿®ç¹•å ´æ‰€\n            if (readonlyElements[11]) {\n              readonlyElements[11].textContent = updatedData.repairLocation || '-';\n            }\n          }\n        <\/script>\n      </body>\n      </html>\n    `})(me.jsonData);console.log("ğŸ–¨ï¸ ç”Ÿæˆã•ã‚ŒãŸHTMLã®é•·ã•:",e.length);const n=window.open("","_blank","width=1200,height=800");n?(n.document.write(e),n.document.close(),n.onload=()=>{console.log("âœ… ç·¨é›†ç”»é¢ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"),n.focus(),setTimeout(()=>{n.print(),console.log("âœ… å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ")},1e3)}):alert("å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç„¡åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚")},className:"flex items-center gap-2",children:[i.jsx(k,{className:"h-4 w-4"}),"å°åˆ·"]}),i.jsx(a,{variant:"outline",onClick:()=>{console.log("ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™"),xe(!1),pe(null)},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[i.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[i.jsx(o,{className:"h-5 w-5"}),"åŸºæœ¬æƒ…å ±"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"æ©Ÿç¨®"}),i.jsxs(g,{value:me.machineType||"",onValueChange:e=>{console.log("æ©Ÿç¨®ã‚’å¤‰æ›´:",e),pe({...me,machineType:e,jsonData:{...me.jsonData,machineType:e}})},children:[i.jsx(h,{children:i.jsx(u,{placeholder:me.machineType?me.machineType:"æ©Ÿç¨®ã‚’é¸æŠ"})}),i.jsxs(x,{children:[me.machineType&&i.jsxs(v,{value:me.machineType,children:[me.machineType," (ç¾åœ¨ã®å€¤)"]}),Je?i.jsx(v,{value:"loading",disabled:!0,children:"ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­..."}):(null==(n=null==(e=ze.machineTypes)?void 0:e.filter(e=>(null==e?void 0:e.machineTypeName)&&e.machineTypeName!==me.machineType))?void 0:n.map(e=>i.jsx(v,{value:e.machineTypeName||"",children:e.machineTypeName||"ä¸æ˜"},e.id||`machine-type-${Date.now()}-${Math.random()}`)))||[]]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"æ©Ÿæ¢°ç•ªå·"}),i.jsxs(g,{value:me.machineNumber||"",onValueChange:e=>{console.log("æ©Ÿæ¢°ç•ªå·ã‚’å¤‰æ›´:",e),pe({...me,machineNumber:e,jsonData:{...me.jsonData,machineNumber:e}})},children:[i.jsx(h,{children:i.jsx(u,{placeholder:me.machineNumber?me.machineNumber:"æ©Ÿæ¢°ç•ªå·ã‚’é¸æŠ"})}),i.jsxs(x,{children:[me.machineNumber&&i.jsxs(v,{value:me.machineNumber,children:[me.machineNumber," (ç¾åœ¨ã®å€¤)"]}),Je?i.jsx(v,{value:"loading",disabled:!0,children:"ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­..."}):(null==(D=null==(j=ze.machines)?void 0:j.filter(e=>(null==e?void 0:e.machineNumber)&&(null==e?void 0:e.machineTypeName)&&(!me.machineType||e.machineTypeName===me.machineType)&&e.machineNumber!==me.machineNumber))?void 0:D.map(e=>i.jsxs(v,{value:e.machineNumber||"",children:[e.machineNumber||"ä¸æ˜"," (",e.machineTypeName||"ä¸æ˜",")"]},e.id||`machine-${Date.now()}-${Math.random()}`)))||[]]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"ãƒ•ã‚¡ã‚¤ãƒ«å"}),i.jsx(p,{value:me.fileName||"",onChange:e=>{console.log("ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰æ›´:",e.target.value),pe({...me,fileName:e.target.value})},placeholder:"ãƒ•ã‚¡ã‚¤ãƒ«å",disabled:!0})]})]})]}),i.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[i.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[i.jsx(s,{className:"h-5 w-5"}),"äº‹è±¡ãƒ»èª¬æ˜"]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«"}),i.jsx(p,{value:(null==(C=me.jsonData)?void 0:C.title)||(me.fileName?me.fileName.split("_")[0]:"")||(null==(B=me.jsonData)?void 0:B.question)||"",onChange:e=>{console.log("äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´:",e.target.value),pe({...me,jsonData:{...me.jsonData,title:e.target.value,question:e.target.value}})},placeholder:"äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›"}),(()=>{var e,n,t,a;const s=(null==(e=me.jsonData)?void 0:e.title)||(null==(n=me.jsonData)?void 0:n.question)||"";return console.log("ğŸ” äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ« - è¡¨ç¤ºå€¤:",s),console.log("ğŸ” äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ« - jsonData.title:",null==(t=me.jsonData)?void 0:t.title),console.log("ğŸ” äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ« - jsonData.question:",null==(a=me.jsonData)?void 0:a.question),null})()]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"äº‹è±¡èª¬æ˜"}),i.jsx("textarea",{value:(null==(A=me.jsonData)?void 0:A.problemDescription)||(null==(M=me.jsonData)?void 0:M.answer)||"",onChange:e=>{console.log("äº‹è±¡èª¬æ˜ã‚’å¤‰æ›´:",e.target.value),pe({...me,jsonData:{...me.jsonData,problemDescription:e.target.value,answer:e.target.value}})},className:"w-full h-24 p-3 border border-gray-300 rounded-md",placeholder:"äº‹è±¡ã®è©³ç´°èª¬æ˜ã‚’å…¥åŠ›"})]})]})]}),(()=>{var e;const n=me.images||(null==(e=me.jsonData)?void 0:e.images)||[];return n.length>0?i.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[i.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[i.jsx(N,{className:"h-5 w-5"}),"æ•…éšœå€‹æ‰€ã®ç”»åƒï¼ˆ",n.length,"æšï¼‰"]}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:n.map((e,n)=>i.jsxs("div",{className:"text-center",children:[i.jsx("img",{src:e.url||e.path||"",alt:e.fileName||`æ•…éšœç”»åƒ${n+1}`,className:"max-w-full max-h-64 mx-auto border border-gray-300 rounded-md shadow-sm",onError:e=>{e.currentTarget.style.opacity="0.3",e.currentTarget.alt="ç”»åƒãŒè¡¨ç¤ºã§ãã¾ã›ã‚“"}}),i.jsx("div",{className:"text-xs text-gray-500 mt-1",children:e.fileName||""})]},e.url||e.fileName||n))})]}):null})(),i.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[i.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[i.jsx(S,{className:"h-5 w-5"}),"ä¿®ç¹•è¨ˆç”»"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"ä¿®ç¹•äºˆå®šæœˆæ—¥"}),i.jsx(p,{type:"date",value:(null==(z=me.jsonData)?void 0:z.repairSchedule)||"",onChange:e=>{pe({...me,jsonData:{...me.jsonData,repairSchedule:e.target.value}})},placeholder:"ä¿®ç¹•äºˆå®šæœˆæ—¥"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"å ´æ‰€"}),i.jsx(p,{value:(null==(L=me.jsonData)?void 0:L.location)||"",onChange:e=>{pe({...me,jsonData:{...me.jsonData,location:e.target.value}})},placeholder:"è¨­ç½®å ´æ‰€"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"}),i.jsxs(g,{value:(null==(_=me.jsonData)?void 0:_.status)||"",onValueChange:e=>{pe({...me,jsonData:{...me.jsonData,status:e}})},children:[i.jsx(h,{children:i.jsx(u,{placeholder:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é¸æŠ"})}),i.jsxs(x,{children:[i.jsx(v,{value:"å ±å‘Šæ¸ˆã¿",children:"å ±å‘Šæ¸ˆã¿"}),i.jsx(v,{value:"å¯¾å¿œä¸­",children:"å¯¾å¿œä¸­"}),i.jsx(v,{value:"å®Œäº†",children:"å®Œäº†"}),i.jsx(v,{value:"ä¿ç•™",children:"ä¿ç•™"})]})]})]})]})]}),i.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[i.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[i.jsx(s,{className:"h-5 w-5"}),"è¨˜äº‹æ¬„"]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-2",children:"å‚™è€ƒãƒ»è¨˜äº‹ (200æ–‡å­—ä»¥å†…)"}),i.jsx("textarea",{value:(null==(P=me.jsonData)?void 0:P.remarks)||"",onChange:e=>{e.target.value.length<=200&&pe({...me,jsonData:{...me.jsonData,remarks:e.target.value}})},className:"w-full h-24 p-3 border border-gray-300 rounded-md",placeholder:"ä¿®ç¹•ã«é–¢ã™ã‚‹å‚™è€ƒã‚„è¿½åŠ æƒ…å ±ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ï¼ˆ200æ–‡å­—ä»¥å†…ï¼‰",maxLength:200}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(null==(O=null==(H=me.jsonData)?void 0:H.remarks)?void 0:O.length)||0,"/200æ–‡å­—"]})]})]}),i.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[i.jsx(a,{variant:"outline",onClick:()=>{console.log("ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™"),xe(!1),pe(null)},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),i.jsx(a,{onClick:()=>{console.log("ç·¨é›†ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã™:",me),en(me)},className:"bg-green-600 hover:bg-green-700 text-white",children:"ä¿å­˜ã—ã¦é©ç”¨"})]})]})]})})}),fe.show&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4 text-red-600",children:"å±¥æ­´å‰Šé™¤ã®ç¢ºèª"}),i.jsx("p",{className:"text-gray-700 mb-6",children:"ä»¥ä¸‹ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"}),i.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-6",children:i.jsx("p",{className:"font-medium text-sm text-gray-800",children:fe.title})}),i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx(a,{variant:"outline",onClick:()=>be({show:!1,id:"",title:""}),children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),i.jsx(a,{variant:"destructive",onClick:()=>(async e=>{try{G(!0),await b(e),await We(ne),be({show:!1,id:"",title:""})}catch(n){console.error("å±¥æ­´å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",n),alert("å±¥æ­´ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{G(!1)}})(fe.id),className:"bg-red-600 hover:bg-red-700",children:"å‰Šé™¤ã™ã‚‹"})]})]})}),Te&&Ee&&i.jsx($,{data:Ee,fileName:ke,onClose:()=>{Ie(!1),Se(null),$e(""),re(!1)},onSave:e=>{console.log("ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜:",e);const n=JSON.parse(localStorage.getItem("savedReports")||"[]"),t={id:Date.now(),fileName:ke,reportData:e,savedAt:(new Date).toISOString()};n.push(t),localStorage.setItem("savedReports",JSON.stringify(n)),console.log("ãƒ¬ãƒãƒ¼ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ:",t)},onPrint:e=>{console.log("ãƒãƒ£ãƒƒãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’å°åˆ·:",e),window.print()}})]});var tn,an};
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{C as default};
