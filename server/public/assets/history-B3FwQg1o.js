const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-qgKIBYKJ.js","assets/ui-BaYWhfWe.js","assets/vendor-C0Yfakdp.js","assets/index-D8OdIOAq.css","assets/db-history-loader-c9Sv9kL9.js"])))=>i.map(i=>d[i]);
import{d as e,B as n,X as t,M as a,_ as s,F as i,S as o}from"./index-qgKIBYKJ.js";import{j as l}from"./ui-BaYWhfWe.js";import{r}from"./vendor-C0Yfakdp.js";import{C as c,a as d,b as m,c as h}from"./card-BIgeDqfh.js";import{I as p}from"./input-DxZruY1J.js";import{S as g,a as u,b as x,c as b,d as v}from"./select-Evmw4YmZ.js";import{e as y,a as f,d as j}from"./history-api-BLsa2wxX.js";import{T as N}from"./textarea-DkKcL0un.js";import{B as D}from"./badge-613OVALu.js";import{S as w}from"./square-pen-DQQXnEmA.js";import{D as T}from"./download-BzcNBquG.js";import{S as I}from"./save-DXFFroNK.js";import{I as S}from"./image-FIqVK_Dk.js";import{S as $}from"./search-BgTtirt0.js";import{T as E}from"./trash-2-BVIvPohC.js";import"./index-jVOyRz7F.js";import"./index-CttfQz0H.js";import"./check-B2Z9wgZi.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=e("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),k=e("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),B=e("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),M=e=>e?/^data:image\//.test(e)||/^https?:\/\//i.test(e)?e:e.startsWith("/api/")?"http://localhost:8080"+e:new URL(e,window.location.origin).toString():null,A=({data:e,fileName:s,onClose:i,onSave:o,onPrint:g})=>{var u,x,b,v,y,f,j,$,E,k,A,L,z,_;const[P,H]=r.useState(!1),[U,O]=r.useState(!1),[R,F]=r.useState({reportId:`R${e.chatId.slice(-5).toUpperCase()}`,machineId:e.machineNumber||(null==(x=null==(u=e.chatData)?void 0:u.machineInfo)?void 0:x.machineNumber)||"M98765",machineType:e.machineType||(null==(v=null==(b=e.chatData)?void 0:b.machineInfo)?void 0:v.machineTypeName)||"",machineNumber:e.machineNumber||(null==(f=null==(y=e.chatData)?void 0:y.machineInfo)?void 0:f.machineNumber)||"",date:new Date(e.exportTimestamp).toISOString().split("T")[0],location:"â—‹â—‹ç·š",failureCode:"FC01",description:e.problemDescription||"ãƒãƒ£ãƒƒãƒˆã«ã‚ˆã‚‹æ•…éšœç›¸è«‡ãƒ»å¿œæ€¥å‡¦ç½®",status:"å¿œæ€¥å‡¦ç½®å®Œäº†",engineer:e.userId||"æ‹…å½“è€…",notes:`ãƒãƒ£ãƒƒãƒˆID: ${e.chatId}\nãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°: ${(null==(j=e.metadata)?void 0:j.total_messages)||(null==(E=null==($=e.chatData)?void 0:$.messages)?void 0:E.length)||0}ä»¶\nã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆç¨®åˆ¥: ${e.exportType}`,repairSchedule:"2025å¹´9æœˆ",repairLocation:"å·¥å ´å†…ä¿®ç†ã‚¹ãƒšãƒ¼ã‚¹",incidentTitle:e.title||"ã‚¿ã‚¤ãƒˆãƒ«ãªã—",problemDescription:e.problemDescription||"èª¬æ˜ãªã—",extractedComponents:e.extractedComponents||[],extractedSymptoms:e.extractedSymptoms||[],possibleModels:e.possibleModels||[]}),[J,q]=r.useState(R);r.useEffect(()=>{q(R)},[R]);const W=(()=>{const e=[],n={reportId:"å ±å‘Šæ›¸ID",machineId:"æ©Ÿæ¢°ID",machineType:"æ©Ÿç¨®",machineNumber:"æ©Ÿæ¢°ç•ªå·",date:"æ—¥ä»˜",location:"å ´æ‰€",failureCode:"æ•…éšœã‚³ãƒ¼ãƒ‰",description:"èª¬æ˜",status:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹",engineer:"æ‹…å½“ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",notes:"å‚™è€ƒ",repairSchedule:"ä¿®ç¹•äºˆå®š",repairLocation:"ä¿®ç¹•å ´æ‰€",incidentTitle:"äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«",problemDescription:"äº‹è±¡èª¬æ˜",extractedComponents:"å½±éŸ¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ",extractedSymptoms:"ç—‡çŠ¶",possibleModels:"å¯èƒ½æ€§ã®ã‚ã‚‹æ©Ÿç¨®"};return Object.keys(R).forEach(t=>{const a=R[t],s=J[t];a!==s&&e.push({field:n[t]||t,oldValue:String(a||"æœªè¨­å®š"),newValue:String(s||"æœªè¨­å®š")})}),e})(),V=async n=>{try{const t={updatedData:{title:n.incidentTitle,problemDescription:n.problemDescription,machineType:n.machineType||e.machineType||"",machineNumber:n.machineNumber||e.machineNumber||"",extractedComponents:n.extractedComponents,extractedSymptoms:n.extractedSymptoms,possibleModels:n.possibleModels,reportData:n,lastUpdated:(new Date).toISOString()},updatedBy:"user"};console.log("ğŸ“¤ ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã™ã‚‹æ›´æ–°ãƒ‡ãƒ¼ã‚¿:",t),console.log("ğŸ” æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ã®æ›´æ–°ç¢ºèª:",{machineType:`${e.machineType||"æœªè¨­å®š"} â†’ ${n.machineType||"æœªè¨­å®š"}`,machineNumber:`${e.machineNumber||"æœªè¨­å®š"} â†’ ${n.machineNumber||"æœªè¨­å®š"}`});const a=await fetch(`/api/history/update-item/${e.chatId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const e=await a.json();throw new Error(e.error||"ãƒ¬ãƒãƒ¼ãƒˆã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}const s=await a.json();console.log("âœ… ãƒ¬ãƒãƒ¼ãƒˆæ›´æ–°å®Œäº†:",s),e.machineType===n.machineType&&e.machineNumber===n.machineNumber||console.log("ğŸ”„ æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ:",{machineType:`${e.machineType||"æœªè¨­å®š"} â†’ ${n.machineType||"æœªè¨­å®š"}`,machineNumber:`${e.machineNumber||"æœªè¨­å®š"} â†’ ${n.machineNumber||"æœªè¨­å®š"}`})}catch(t){console.error("âŒ ãƒ¬ãƒãƒ¼ãƒˆæ›´æ–°ã‚¨ãƒ©ãƒ¼:",t)}},K=(e,n)=>{q(t=>({...t,[e]:n}))},Y=(e,n)=>{const t=window.open("","_blank","noopener,noreferrer");if(!t)return;const a=((e,n)=>{const t=n?`<div class="image-section">\n           <h3>æ•…éšœç®‡æ‰€ç”»åƒ</h3>\n           <img class="report-img" src="${n}" alt="æ•…éšœç”»åƒ" />\n         </div>`:"";return`\n      <!doctype html>\n      <html>\n      <head>\n        <meta charset="utf-8">\n        <title>ãƒãƒ£ãƒƒãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå ±å‘Šæ›¸å°åˆ·</title>\n        <style>\n          @page { size: A4 portrait; margin: 10mm; }\n          @media print {\n            html, body { margin: 0; padding: 0; }\n            .no-print, .print:hidden { display: none !important; }\n            img, .image-cell, .image-section { page-break-inside: avoid; break-inside: avoid; }\n            table { width: 100%; border-collapse: collapse; table-layout: fixed; }\n            th, td { border: 1px solid #ccc; padding: 4px; vertical-align: top; }\n          }\n          img.thumb { width: 32px; height: 32px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px; }\n          .report-img { max-width: 100%; height: auto; }\n        </style>\n      </head>\n      <body>\n        <h1>ãƒãƒ£ãƒƒãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå ±å‘Šæ›¸</h1>\n\n        <div class="report-section">\n          <h3>åŸºæœ¬æƒ…å ±</h3>\n          <table>\n            <tr><th>å ±å‘Šæ›¸ID</th><td>${e.reportId||"-"}</td></tr>\n            <tr><th>æ©Ÿæ¢°ID</th><td>${e.machineId||"-"}</td></tr>\n            <tr><th>æ©Ÿç¨®</th><td>${e.machineType||"-"}</td></tr>\n            <tr><th>æ©Ÿæ¢°ç•ªå·</th><td>${e.machineNumber||"-"}</td></tr>\n            <tr><th>æ—¥ä»˜</th><td>${e.date||"-"}</td></tr>\n            <tr><th>å ´æ‰€</th><td>${e.location||"-"}</td></tr>\n          </table>\n        </div>\n\n        <div class="report-section">\n          <h3>äº‹è±¡è©³ç´°</h3>\n          <table>\n            <tr><th>äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«</th><td>${e.incidentTitle||"-"}</td></tr>\n            <tr><th>äº‹è±¡èª¬æ˜</th><td>${e.problemDescription||"-"}</td></tr>\n            <tr><th>æ•…éšœã‚³ãƒ¼ãƒ‰</th><td>${e.failureCode||"-"}</td></tr>\n            <tr><th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th><td>${e.status||"-"}</td></tr>\n            <tr><th>æ‹…å½“ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢</th><td>${e.engineer||"-"}</td></tr>\n          </table>\n        </div>\n\n        <div class="report-section">\n          <h3>æŠ½å‡ºæƒ…å ±</h3>\n          <table>\n            <tr><th>å½±éŸ¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</th><td>${Array.isArray(e.extractedComponents)?e.extractedComponents.join(", "):"-"}</td></tr>\n            <tr><th>ç—‡çŠ¶</th><td>${Array.isArray(e.extractedSymptoms)?e.extractedSymptoms.join(", "):"-"}</td></tr>\n            <tr><th>å¯èƒ½æ€§ã®ã‚ã‚‹æ©Ÿç¨®</th><td>${Array.isArray(e.possibleModels)?e.possibleModels.join(", "):"-"}</td></tr>\n          </table>\n        </div>\n\n        ${t}\n\n        <div class="report-section">\n          <h3>å‚™è€ƒ</h3>\n          <p>${e.notes||"-"}</p>\n        </div>\n\n        <div class="report-section">\n          <h3>ä¿®ç¹•äºˆå®š</h3>\n          <table>\n            <tr><th>äºˆå®šæœˆæ—¥</th><td>${e.repairSchedule||"-"}</td></tr>\n            <tr><th>å ´æ‰€</th><td>${e.repairLocation||"-"}</td></tr>\n          </table>\n        </div>\n      </body>\n      </html>\n    `})(e,n);t.document.write(a),t.document.close(),setTimeout(()=>{t.print()},100)},G=e=>new Date(e).toLocaleString("ja-JP"),X=J,Q=(e=>{var n;const t=[e];for(;t.length;){const e=t.pop();if(null!=e){if("string"==typeof e&&e.startsWith("data:image/"))return e;if(Array.isArray(e))for(const n of e)t.push(n);else if("object"==typeof e)for(const n of Object.values(e))t.push(n)}}const a=null==(n=null==e?void 0:e.savedImages)?void 0:n[0],s=M((null==a?void 0:a.url)||(null==a?void 0:a.path));if(s)return s;const i=null==e?void 0:e.imagePath;return(Array.isArray(i)?M(i[0]):M(i))||null})(e);return console.log("[chat-export] final imgSrc:",Q&&Q.slice(0,60)),l.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:l.jsxs("div",{className:"max-w-4xl mx-auto",children:[l.jsxs("div",{className:"flex justify-between items-center mb-6",children:[l.jsx("h1",{className:"text-3xl font-bold text-center flex-1",children:"å ±å‘Šæ›¸"}),l.jsx("div",{className:"flex gap-2",children:P?l.jsxs(l.Fragment,{children:[l.jsxs(n,{onClick:()=>{F(J),H(!1),O(!1),e.chatId&&V(J),o&&o(J);const n=[];e.machineType!==J.machineType&&n.push(`æ©Ÿç¨®: ${e.machineType||"æœªè¨­å®š"} â†’ ${J.machineType||"æœªè¨­å®š"}`),e.machineNumber!==J.machineNumber&&n.push(`æ©Ÿæ¢°ç•ªå·: ${e.machineNumber||"æœªè¨­å®š"} â†’ ${J.machineNumber||"æœªè¨­å®š"}`),n.length>0?alert(`ãƒ¬ãƒãƒ¼ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚\n\næ›´æ–°ã•ã‚ŒãŸå†…å®¹:\n${n.join("\n")}`):alert("ãƒ¬ãƒãƒ¼ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚")},className:"flex items-center gap-2",children:[l.jsx(I,{className:"h-4 w-4"}),"ä¿å­˜"]}),l.jsxs(n,{onClick:()=>{window.confirm("ç·¨é›†å†…å®¹ã‚’ç ´æ£„ã—ã¾ã™ã‹ï¼Ÿ")&&(q(R),H(!1),O(!1))},variant:"outline",className:"flex items-center gap-2",children:[l.jsx(t,{className:"h-4 w-4"}),"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"]}),l.jsx(n,{onClick:i,variant:"outline",children:"é–‰ã˜ã‚‹"})]}):l.jsxs(l.Fragment,{children:[l.jsxs(n,{onClick:()=>{H(!0)},variant:"outline",className:"flex items-center gap-2",children:[l.jsx(w,{className:"h-4 w-4"}),"ãƒ¬ãƒãƒ¼ãƒˆç·¨é›†"]}),W.length>0&&l.jsx(n,{onClick:()=>O(!U),variant:"outline",className:"flex items-center gap-2",children:l.jsxs("span",{className:"text-sm",children:["å·®åˆ†è¡¨ç¤º (",W.length,")"]})}),l.jsxs(n,{onClick:()=>{Y(X,Q)},variant:"outline",className:"flex items-center gap-2",children:[l.jsx(B,{className:"h-4 w-4"}),"å°åˆ·"]}),l.jsxs(n,{onClick:()=>{var n;const t=`\n å ±å‘Šæ›¸\n\näº‹è±¡æ¦‚è¦:\näº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«: ${R.incidentTitle}\nå ±å‘Šæ›¸ID: ${R.reportId}\næ©Ÿæ¢°ID: ${R.machineId}\næ—¥ä»˜: ${R.date}\nå ´æ‰€: ${R.location}\næ•…éšœã‚³ãƒ¼ãƒ‰: ${R.failureCode}\n\näº‹è±¡è©³ç´°:\nèª¬æ˜: ${R.problemDescription}\nã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${R.status}\næ‹…å½“ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢: ${R.engineer}\nå‚™è€ƒ: ${R.notes}\n\næŠ½å‡ºæƒ…å ±:\nå½±éŸ¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: ${R.extractedComponents.join(", ")}\nç—‡çŠ¶: ${R.extractedSymptoms.join(", ")}\nå¯èƒ½æ€§ã®ã‚ã‚‹æ©Ÿç¨®: ${R.possibleModels.join(", ")}\n\nä¿®ç¹•äºˆå®š:\näºˆå®šæœˆæ—¥: ${R.repairSchedule}\nå ´æ‰€: ${R.repairLocation}\n\nãƒãƒ£ãƒƒãƒˆå±¥æ­´:\n${(e.conversationHistory||(null==(n=e.chatData)?void 0:n.messages)||[]).map(e=>`${e.isAiResponse?"AI":"ãƒ¦ãƒ¼ã‚¶ãƒ¼"}: ${e.content}`).join("\n")}\n    `,a=new Blob([t],{type:"text/plain;charset=utf-8"}),s=window.URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download=`å ±å‘Šæ›¸_${R.incidentTitle}_${R.date}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(s)},variant:"outline",className:"flex items-center gap-2",children:[l.jsx(T,{className:"h-4 w-4"}),"ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"]}),l.jsx(n,{onClick:i,variant:"outline",children:"é–‰ã˜ã‚‹"})]})})]}),U&&W.length>0&&l.jsxs(c,{className:"mb-6 border-orange-200 bg-orange-50",children:[l.jsx(d,{children:l.jsx(m,{className:"text-lg font-semibold text-orange-800 flex items-center gap-2",children:l.jsxs("span",{children:["ğŸ“ ç·¨é›†å†…å®¹ã®å·®åˆ† (",W.length,"ä»¶)"]})})}),l.jsxs(h,{children:[l.jsx("div",{className:"space-y-3",children:W.map((e,n)=>l.jsxs("div",{className:"flex items-center gap-4 p-3 bg-white rounded-lg border",children:[l.jsx("div",{className:"flex-1",children:l.jsxs("span",{className:"font-medium text-gray-700",children:[e.field,":"]})}),l.jsxs("div",{className:"flex-1 text-right",children:[l.jsx("div",{className:"text-sm text-red-600 line-through",children:e.oldValue}),l.jsx("div",{className:"text-sm text-green-600 font-medium",children:e.newValue})]})]},n))}),l.jsx("div",{className:"mt-4 p-3 bg-blue-100 rounded-lg",children:l.jsx("p",{className:"text-sm text-blue-800",children:"ğŸ’¡ ä¸Šè¨˜ã®å¤‰æ›´å†…å®¹ã¯ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¾ã§ç¢ºå®šã•ã‚Œã¾ã›ã‚“ã€‚"})})]})]}),l.jsxs(c,{className:"mb-6",children:[l.jsx(d,{children:l.jsx(m,{className:"text-lg font-semibold",children:"äº‹è±¡æ¦‚è¦"})}),l.jsxs(h,{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«:"}),l.jsx(p,{value:X.incidentTitle,onChange:e=>K("incidentTitle",e.target.value),className:"mt-1",disabled:!P,placeholder:"ç™ºç”Ÿã—ãŸäº‹è±¡ã®ã‚¿ã‚¤ãƒˆãƒ«"})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"å ±å‘Šæ›¸ID:"}),l.jsx(p,{value:X.reportId,onChange:e=>K("reportId",e.target.value),className:"w-32",disabled:!P})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"æ©Ÿæ¢°ID:"}),l.jsx(p,{value:X.machineId,onChange:e=>K("machineId",e.target.value),className:"w-32",disabled:!P})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"æ©Ÿç¨®:"}),l.jsx(p,{value:X.machineType,onChange:e=>K("machineType",e.target.value),className:"w-32",disabled:!P,placeholder:"æ©Ÿç¨®å"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"æ©Ÿæ¢°ç•ªå·:"}),l.jsx(p,{value:X.machineNumber,onChange:e=>K("machineNumber",e.target.value),className:"w-32",disabled:!P,placeholder:"æ©Ÿæ¢°ç•ªå·"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"æ—¥ä»˜:"}),l.jsx(p,{type:"date",value:X.date,onChange:e=>K("date",e.target.value),className:"w-32",disabled:!P})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"å ´æ‰€:"}),l.jsx(p,{value:X.location,onChange:e=>K("location",e.target.value),className:"w-32",disabled:!P})]})]})]})]}),l.jsxs(c,{className:"mb-6",children:[l.jsx(d,{children:l.jsx(m,{className:"text-lg font-semibold",children:"äº‹è±¡è©³ç´°"})}),l.jsxs(h,{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"äº‹è±¡èª¬æ˜:"}),l.jsx(N,{value:X.problemDescription,onChange:e=>K("problemDescription",e.target.value),className:"mt-1",rows:3,disabled:!P,placeholder:"äº‹è±¡ã®è©³ç´°ãªèª¬æ˜"})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:"}),l.jsx(p,{value:X.status,onChange:e=>K("status",e.target.value),className:"w-48",disabled:!P})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"æ‹…å½“ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢:"}),l.jsx(p,{value:X.engineer,onChange:e=>K("engineer",e.target.value),className:"w-32",disabled:!P})]})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"å‚™è€ƒ:"}),l.jsx(N,{value:X.notes,onChange:e=>K("notes",e.target.value),className:"mt-1",rows:3,disabled:!P})]})]})]}),l.jsxs(c,{className:"mb-6",children:[l.jsx(d,{children:l.jsx(m,{className:"text-lg font-semibold",children:"æŠ½å‡ºæƒ…å ±"})}),l.jsxs(h,{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"å½±éŸ¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:"}),l.jsx(p,{value:X.extractedComponents.join(", "),onChange:e=>K("extractedComponents",e.target.value.split(", ").filter(e=>e.trim())),className:"mt-1",disabled:!P,placeholder:"ã‚¨ãƒ³ã‚¸ãƒ³, ãƒ–ãƒ¬ãƒ¼ã‚­, æ²¹åœ§ç³»çµ±"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"ç—‡çŠ¶:"}),l.jsx(p,{value:X.extractedSymptoms.join(", "),onChange:e=>K("extractedSymptoms",e.target.value.split(", ").filter(e=>e.trim())),className:"mt-1",disabled:!P,placeholder:"ã‚¨ãƒ³ã‚¸ãƒ³åœæ­¢, ç•°éŸ³, æ²¹åœ§æ¼ã‚Œ"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-medium",children:"å¯èƒ½æ€§ã®ã‚ã‚‹æ©Ÿç¨®:"}),l.jsx(p,{value:X.possibleModels.join(", "),onChange:e=>K("possibleModels",e.target.value.split(", ").filter(e=>e.trim())),className:"mt-1",disabled:!P,placeholder:"MT-100å‹, MR-400ã‚·ãƒªãƒ¼ã‚º"})]})]})]}),l.jsxs(c,{className:"mb-6",children:[l.jsx(d,{children:l.jsx(m,{className:"text-lg font-semibold",children:"ä¿®ç¹•äºˆå®š"})}),l.jsx(h,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"äºˆå®šæœˆæ—¥:"}),l.jsx(p,{value:X.repairSchedule,onChange:e=>K("repairSchedule",e.target.value),className:"w-32",disabled:!P})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"font-medium",children:"å ´æ‰€:"}),l.jsx(p,{value:X.repairLocation,onChange:e=>K("repairLocation",e.target.value),className:"w-48",disabled:!P})]})]})})]}),l.jsxs(c,{className:"mb-6",children:[l.jsx(d,{children:l.jsx(m,{className:"text-lg font-semibold",children:"æ•…éšœç®‡æ‰€ç”»åƒ"})}),l.jsxs(h,{children:[l.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"æ©Ÿæ¢°æ•…éšœç®‡æ‰€ã®ç”»åƒ"}),Q?l.jsx("img",{src:Q,alt:"æ•…éšœç®‡æ‰€ç”»åƒ",style:{maxWidth:"100%",height:"auto",display:"block"},onError:e=>{e.currentTarget.style.display="none"}},Q.slice(0,64)):l.jsx("div",{className:"text-center text-gray-500",children:"ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“"}),l.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"ä¸Šè¨˜ã¯æ•…éšœç®‡æ‰€ã®å†™çœŸã§ã™ã€‚"})]})]}),l.jsxs(c,{className:"mb-6",children:[l.jsx(d,{children:l.jsx(m,{className:"text-lg font-semibold",children:"ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚µãƒãƒªãƒ¼"})}),l.jsxs(h,{children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(C,{className:"h-4 w-4 text-gray-500"}),l.jsxs("span",{children:["ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ—¥æ™‚: ",G(e.exportTimestamp)]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(a,{className:"h-4 w-4 text-gray-500"}),l.jsxs("span",{children:["ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°:"," ",(null==(k=e.metadata)?void 0:k.total_messages)||(null==(L=null==(A=e.chatData)?void 0:A.messages)?void 0:L.length)||0,"ä»¶"]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(S,{className:"h-4 w-4 text-gray-500"}),l.jsxs("span",{children:["ç”»åƒæ•°: ",(null==(z=e.savedImages)?void 0:z.length)||0,"ä»¶"]})]})]}),(e.machineType||e.machineNumber)&&l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 p-3 bg-blue-50 rounded-lg",children:[e.machineType&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"font-medium",children:"æ©Ÿç¨®:"}),l.jsx("span",{children:e.machineType})]}),e.machineNumber&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"font-medium",children:"æ©Ÿæ¢°ç•ªå·:"}),l.jsx("span",{children:e.machineNumber})]})]}),l.jsx("div",{className:"max-h-96 overflow-y-auto border rounded-lg p-4 bg-gray-50",children:(e.conversationHistory||(null==(_=e.chatData)?void 0:_.messages)||[]).map((e,n)=>{return l.jsxs("div",{className:"mb-4 p-3 rounded-lg "+(e.isAiResponse?"bg-blue-50 ml-4":"bg-gray-100 mr-4"),children:[l.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[l.jsx(D,{variant:e.isAiResponse?"default":"secondary",className:"text-xs",children:e.isAiResponse?"AI":"ãƒ¦ãƒ¼ã‚¶ãƒ¼"}),l.jsx("span",{className:"text-xs text-gray-500",children:G(e.timestamp||e.createdAt)})]}),l.jsx("div",{className:"mt-1",children:(t=e.content,t&&t.startsWith("data:image/")?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(S,{className:"h-4 w-4 text-gray-500"}),l.jsx("span",{className:"text-sm text-gray-600",children:"ç”»åƒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"})]}):l.jsx("p",{className:"text-sm whitespace-pre-wrap leading-relaxed",children:e.content}))})]},e.id||n);var t})})]})]}),l.jsx("div",{className:"text-center text-sm text-gray-500 py-4",children:"Â© 2025 å ±å‘Šæ›¸. All rights reserved."})]})})},L=()=>{var e,t,a,N,D,w,I,M,L,z,_,P,H,U;const[O,R]=r.useState([]),[F,J]=r.useState([]),[q,W]=r.useState(""),[V,K]=r.useState({machineType:"",machineNumber:"",searchText:"",searchDate:""}),[Y,G]=r.useState(!0),[X,Q]=r.useState(null),[Z,ee]=r.useState(new Set),[ne,te]=r.useState(1),[ae,se]=r.useState(1),[ie,oe]=r.useState(!1),[le,re]=r.useState(!1),[ce,de]=r.useState(!1),[me,he]=r.useState(null),[pe,ge]=r.useState(null),[ue,xe]=r.useState(!1),[be,ve]=r.useState(!1),[ye,fe]=r.useState({show:!1,id:"",title:""}),[je,Ne]=r.useState(!1),[De,we]=r.useState("table"),[Te,Ie]=r.useState(!1),[Se,$e]=r.useState(null),[Ee,Ce]=r.useState(""),[ke,Be]=r.useState(!1),[Me,Ae]=r.useState(null),[Le,ze]=r.useState({machineTypes:[],machines:[]}),[_e,Pe]=r.useState({machineTypes:[],machineNumbers:[]}),[He,Ue]=r.useState(!1),Oe=r.useRef(0),Re=r.useRef(!1),Fe=e=>{var n,t;if(console.log("æ­£è¦åŒ–å‰ã®ã‚¢ã‚¤ãƒ†ãƒ :",e),!e.jsonData)return console.log("jsonDataãŒå­˜åœ¨ã—ã¾ã›ã‚“"),e;if(e.machineType&&e.machineNumber)return console.log("æ—¢ã«æ­£è¦åŒ–æ¸ˆã¿:",{machineType:e.machineType,machineNumber:e.machineNumber}),e;const a={...e,machineType:e.machineType||e.jsonData.machineType||"",machineNumber:e.machineNumber||e.jsonData.machineNumber||"",jsonData:{...e.jsonData,title:e.jsonData.title||e.title||"",problemDescription:e.jsonData.problemDescription||"",machineType:e.machineType||e.jsonData.machineType||"",machineNumber:e.machineNumber||e.jsonData.machineNumber||"",extractedComponents:e.jsonData.extractedComponents||e.extractedComponents||[],extractedSymptoms:e.jsonData.extractedSymptoms||e.extractedSymptoms||[],possibleModels:e.jsonData.possibleModels||e.possibleModels||[],conversationHistory:e.jsonData.conversationHistory||[],savedImages:e.jsonData.savedImages||[]}};if(e.jsonData.chatData){console.log("chatDataå½¢å¼ã‚’æ¤œå‡º");const s=e.jsonData.chatData,i=(null==(n=s.machineInfo)?void 0:n.machineTypeName)||"",o=(null==(t=s.machineInfo)?void 0:t.machineNumber)||"";console.log("chatDataã‹ã‚‰æŠ½å‡º:",{machineTypeName:i,machineNumber:o}),a.machineType=i||a.machineType,a.machineNumber=o||a.machineNumber,a.jsonData.machineType=i||a.jsonData.machineType,a.jsonData.machineNumber=o||a.jsonData.machineNumber}return console.log("æ­£è¦åŒ–å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ :",a),a};r.useEffect(()=>{const e=e=>{if(e.data&&"UPDATE_HISTORY_ITEM"===e.data.type){const n=e.data.data;console.log("å±¥æ­´ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡:",n),R(e=>e.map(e=>e.id===n.id||e.chatId===n.chatId?{...e,...n}:e)),J(e=>e.map(e=>e.id===n.id||e.chatId===n.chatId?{...e,...n}:e)),!X||X.id!==n.id&&X.chatId!==n.chatId||Q(e=>e?{...e,...n}:null)}};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[X]);const[Je,qe]=r.useState(!1);r.useEffect(()=>{console.log("ğŸ” machineDataçŠ¶æ…‹å¤‰åŒ–:",Le)},[Le]);const We=r.useCallback(async(e=1)=>{var n,t;try{G(!0);const a=Date.now();if(Oe.current&&a-Oe.current<1e3)return void console.log("ğŸ” APIãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™ä¸­...");Oe.current=a;const i={machineType:V.machineType,machineNumber:V.machineNumber,searchText:V.searchText,searchDate:V.searchDate},o=new URLSearchParams;i.machineType&&o.append("machineType",i.machineType),i.machineNumber&&o.append("machineNumber",i.machineNumber),i.searchText&&o.append("searchText",i.searchText),i.searchDate&&o.append("searchDate",i.searchDate),o.append("limit","20"),o.append("offset",(20*(e-1)).toString());const{buildApiUrl:l}=await s(async()=>{const{buildApiUrl:e}=await import("./index-qgKIBYKJ.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),r=l("/history");console.log("ğŸ” APIãƒªã‚¯ã‚¨ã‚¹ãƒˆURL:",r);const c=await fetch(r);console.log("ğŸ” ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:",c.status,c.statusText);const d=await c.json();if(console.log("ğŸ” å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:",d),console.log("ğŸ” ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ :",{success:d.success,hasItems:!!d.items,hasData:!!d.data,itemsLength:null==(n=d.items)?void 0:n.length,dataLength:null==(t=d.data)?void 0:t.length,total:d.total}),localStorage.setItem("debug_api_response",JSON.stringify(d,null,2)),Array.isArray(d)){console.log("ğŸ” å–å¾—ä»¶æ•°:",d.length),d.forEach((e,n)=>{console.log(`ğŸ” ã‚¢ã‚¤ãƒ†ãƒ  ${n+1}:`,{fileName:e.fileName,title:e.title,chatId:e.chatId})});const n=d.map(e=>{const n=e.title||"ã‚¿ã‚¤ãƒˆãƒ«ãªã—",t=e.content||{},a=t.machineType||e.machineType||"",s=t.machineNumber||e.machineNumber||"",i=t.problemDescription||t.answer||"",o={id:e.chatId||e.fileName,chatId:e.chatId||e.fileName,fileName:e.fileName,machineType:a,machineNumber:s,title:n,createdAt:e.createdAt,lastModified:e.lastModified,extractedComponents:t.extractedComponents||[],extractedSymptoms:t.extractedSymptoms||[],possibleModels:t.possibleModels||[],machineInfo:{machineTypeName:a,machineNumber:s},jsonData:{title:n,problemDescription:i,machineType:a,machineNumber:s,extractedComponents:t.extractedComponents||[],extractedSymptoms:t.extractedSymptoms||[],possibleModels:t.possibleModels||[],conversationHistory:t.conversationHistory||[],savedImages:t.savedImages||[],fileName:e.fileName}};return console.log("å¤‰æ›ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ :",{fileName:o.fileName,machineType:o.machineType,machineNumber:o.machineNumber,jsonData:o.jsonData}),o});console.log("ğŸ” è¨­å®šå‰ã®çŠ¶æ…‹:",{historyItemsLength:O.length,filteredItemsLength:F.length,updatedItemsLength:n.length});const{loadHistoryFromDB:t}=await s(async()=>{const{loadHistoryFromDB:e}=await import("./db-history-loader-c9Sv9kL9.js");return{loadHistoryFromDB:e}},__vite__mapDeps([4,0,1,2,3])),a=await t(),i=a;R(i),J(i),se(Math.ceil(i.length/20)),te(e),console.log("ğŸ” DBå°‚ç”¨å±¥æ­´è¨­å®šå®Œäº†:",{dbItemsLength:a.length,totalPages:Math.ceil(i.length/20)})}else{console.log("ğŸ” ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸã›ãš:",d);const{loadHistoryFromDB:e}=await s(async()=>{const{loadHistoryFromDB:e}=await import("./db-history-loader-c9Sv9kL9.js");return{loadHistoryFromDB:e}},__vite__mapDeps([4,0,1,2,3])),n=await e();n.length>0?(R(n),J(n),se(Math.ceil(n.length/20)),console.log(`ğŸ” DBå°‚ç”¨å±¥æ­´å–å¾—å®Œäº†: ${n.length}ä»¶`)):(R([]),J([]),se(1))}}catch(a){console.error("å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:",a),console.error("ã‚¨ãƒ©ãƒ¼è©³ç´°:",{message:a instanceof Error?a.message:"Unknown error",stack:a instanceof Error?a.stack:void 0});try{const{loadHistoryFromDB:e}=await s(async()=>{const{loadHistoryFromDB:e}=await import("./db-history-loader-c9Sv9kL9.js");return{loadHistoryFromDB:e}},__vite__mapDeps([4,0,1,2,3])),n=await e();n.length>0?(R(n),J(n),se(Math.ceil(n.length/20)),console.log(`ğŸ” ã‚¨ãƒ©ãƒ¼æ™‚DBå±¥æ­´å–å¾—å®Œäº†: ${n.length}ä»¶`)):(R([]),J([]),se(1))}catch(i){console.error("DBå±¥æ­´å–å¾—ã‚‚ã‚¨ãƒ©ãƒ¼:",i),R([]),J([]),se(1)}}finally{G(!1)}},[]);r.useEffect(()=>{Re.current||(Re.current=!0,We(1))},[]),r.useEffect(()=>{O.length>0&&(async()=>{try{Ue(!0),console.log("ğŸ” å±¥æ­´æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–‹å§‹");const e=[...O],n=[...new Set(e.map(e=>e.machineType).filter(Boolean))],t=[...new Set(e.map(e=>e.machineNumber).filter(Boolean))];Pe({machineTypes:n,machineNumbers:t}),console.log("ğŸ” å±¥æ­´æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†:",{machineTypes:n.length,machineNumbers:t.length})}catch(e){console.error("å±¥æ­´æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚¨ãƒ©ãƒ¼:",e)}finally{Ue(!1)}})()},[O]),r.useEffect(()=>{O.length>0&&We(1)},[V]);const Ve=(e,n)=>{K(t=>({...t,[e]:n}));try{me&&("machineType"!==e&&"machineNumber"!==e||(he(t=>t?{...t,[e]:n}:t),console.log(`filters -> editingItem sync: ${e} = ${n}`)))}catch(t){console.warn("ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‹ã‚‰ç·¨é›†ã‚¢ã‚¤ãƒ†ãƒ ã¸ã®åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ:",t)}},Ke=()=>{We(1)},Ye=e=>{We(e)},Ge=async(e="json")=>{if(0!==Z.size)try{oe(!0);const n=F.filter(e=>Z.has(e.id)),t=await y(n,e);Xe(t,`selected_history.${e}`)}catch(n){console.error("é¸æŠå±¥æ­´ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:",n)}finally{oe(!1)}else alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹å±¥æ­´ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚")},Xe=(e,n)=>{const t=window.URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=n,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(t),document.body.removeChild(a)},Qe=async(e="json")=>{try{oe(!0);const n=await f(V,e);Xe(n,`all_history.${e}`)}catch(n){console.error("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:",n)}finally{oe(!1)}},Ze=e=>new Date(e).toLocaleString("ja-JP"),en=async e=>{var n;try{console.log("ç·¨é›†ã•ã‚ŒãŸå±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä¿å­˜:",e),console.log("ç·¨é›†ã•ã‚ŒãŸå±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®ID:",e.id),console.log("ç·¨é›†ã•ã‚ŒãŸå±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®JSONãƒ‡ãƒ¼ã‚¿:",e.jsonData);let a=e.id||e.chatId;if(!a)return void alert("ã‚¢ã‚¤ãƒ†ãƒ IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ä¿å­˜ã§ãã¾ã›ã‚“ã€‚");if(a.startsWith("export_")){a=a.replace("export_",""),a.endsWith(".json")&&(a=a.replace(".json",""));const e=a.split("_");e.length>=2&&e[1].match(/^[a-f0-9-]+$/)&&(a=e[1])}console.log("ä½¿ç”¨ã™ã‚‹ID:",a,"å…ƒã®ID:",e.id||e.chatId);const s={updatedData:{...e.jsonData,machineType:e.machineType,machineNumber:e.machineNumber,title:(null==(n=e.jsonData)?void 0:n.title)||e.title,lastModified:(new Date).toISOString()},updatedBy:"user"};console.log("é€ä¿¡ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰:",s);const i=await fetch(`/api/history/update-item/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:",i.status,i.statusText),!i.ok){const e=await i.text();console.error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼è©³ç´°:",e);let n=`å±¥æ­´ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ (${i.status})`;try{n=JSON.parse(e).error||n}catch(t){n+=": "+e}return void alert(n)}const o=await i.json();if(console.log("å±¥æ­´æ›´æ–°å®Œäº†:",o),a){const n="savedMachineFailureReport_"+a;localStorage.setItem(n,JSON.stringify(e.jsonData)),console.log("ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ›´æ–°:",n)}R(n=>n.map(n=>{var t,s,i,o;return n.id===a||n.chatId===a?{...n,jsonData:e.jsonData,lastModified:(new Date).toISOString(),machineType:(null==(t=e.jsonData)?void 0:t.machineType)||n.machineType,machineNumber:(null==(s=e.jsonData)?void 0:s.machineNumber)||n.machineNumber,title:(null==(i=e.jsonData)?void 0:i.title)||n.title,incidentTitle:(null==(o=e.jsonData)?void 0:o.title)||n.incidentTitle}:n})),J(n=>n.map(n=>{var t,s,i,o;return n.id===a||n.chatId===a?{...n,jsonData:e.jsonData,lastModified:(new Date).toISOString(),machineType:(null==(t=e.jsonData)?void 0:t.machineType)||n.machineType,machineNumber:(null==(s=e.jsonData)?void 0:s.machineNumber)||n.machineNumber,title:(null==(i=e.jsonData)?void 0:i.title)||n.title,incidentTitle:(null==(o=e.jsonData)?void 0:o.title)||n.incidentTitle}:n})),alert("å±¥æ­´ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã€å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šæ›¸ãä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚"),xe(!1),he(null),console.log("å±¥æ­´æ›´æ–°å®Œäº† - ãƒªã‚¹ãƒˆå†èª­ã¿è¾¼ã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—")}catch(a){console.error("å±¥æ­´ä¿å­˜ã‚¨ãƒ©ãƒ¼:",a);const e=a instanceof Error?a.message:"Unknown error";alert("å±¥æ­´ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: "+e)}};function nn(e){var n,t;if(console.log("ğŸ–¼ï¸ pickFirstImage - ãƒ‡ãƒ¼ã‚¿åˆ†æ:",{hasImages:!!(null==e?void 0:e.images),imagesLength:(null==(n=null==e?void 0:e.images)?void 0:n.length)||0,hasSavedImages:!!(null==e?void 0:e.savedImages),savedImagesLength:(null==(t=null==e?void 0:e.savedImages)?void 0:t.length)||0,hasConversationHistory:!!(null==e?void 0:e.conversationHistory),hasImagePath:!!(null==e?void 0:e.imagePath),hasImageUrl:!!(null==e?void 0:e.imageUrl),dataKeys:Object.keys(e||{})}),"string"==typeof(null==e?void 0:e.imageUrl)&&e.imageUrl.trim())return console.log("ğŸ–¼ï¸ pickFirstImage - imageUrl:",e.imageUrl),e.imageUrl.startsWith("http")?e.imageUrl:`http://localhost:8080${e.imageUrl}`;if("string"==typeof(null==e?void 0:e.imagePath)&&e.imagePath.trim())return console.log("ğŸ–¼ï¸ pickFirstImage - imagePath:",e.imagePath),e.imagePath.startsWith("http")?e.imagePath:`http://localhost:8080${e.imagePath}`;if(Array.isArray(null==e?void 0:e.savedImages)&&e.savedImages.length>0){const n=e.savedImages[0];if(console.log("ğŸ–¼ï¸ pickFirstImage - savedImages[0]:",n),"string"==typeof n&&!n.startsWith("data:image/"))return n.startsWith("http")?n:`http://localhost:8080${n}`;if(n&&"object"==typeof n){const e=n.url||n.path||n.fileName;if(e&&!e.startsWith("data:image/"))return e.startsWith("http")?e:`http://localhost:8080${e}`}}if(Array.isArray(null==e?void 0:e.images)&&e.images.length>0){const n=e.images[0];if(console.log("ğŸ–¼ï¸ pickFirstImage - images[0]:",n),n&&"object"==typeof n&&n.fileName){const e=`/api/images/chat-exports/${n.fileName}`;return console.log("ğŸ–¼ï¸ pickFirstImage - DBç”»åƒãƒ¬ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å–å¾—:",e),`http://localhost:8080${e}`}}if(Array.isArray(null==e?void 0:e.conversationHistory))for(const a of e.conversationHistory)if(a.content&&"string"==typeof a.content&&a.content.startsWith("data:image/"))return console.log("ğŸ–¼ï¸ pickFirstImage - conversationHistoryã‹ã‚‰Base64ç”»åƒã‚’ç™ºè¦‹"),a.content;if("string"==typeof(null==e?void 0:e.id)||"string"==typeof(null==e?void 0:e.chatId)){const n=e.id||e.chatId;console.log("ğŸ–¼ï¸ pickFirstImage - å±¥æ­´IDã‹ã‚‰ç”»åƒã‚’æ¨æ¸¬:",n);const t=`/api/images/chat-exports/${[`${n}_3_0.jpeg`,`${n}_2_0.jpeg`,`${n}_1_0.jpeg`,`${n}_0_0.jpeg`,`${n}.jpg`,`${n}.jpeg`,`chat_image_${n}_*.jpg`][0]}`;return console.log("ğŸ–¼ï¸ pickFirstImage - æ¨æ¸¬ã•ã‚ŒãŸç”»åƒãƒ‘ã‚¹:",t),`http://localhost:8080${t}`}if("string"==typeof(null==e?void 0:e.fileName)){const n=`/api/images/chat-exports/${e.fileName.replace(/\.json$/,"")}_3_0.jpeg`;return console.log("ğŸ–¼ï¸ pickFirstImage - fileNameã‹ã‚‰æ¨æ¸¬:",n),`http://localhost:8080${n}`}return console.log("ğŸ–¼ï¸ pickFirstImage - ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"),null}return Y?l.jsx("div",{className:"p-6",children:l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­..."})]})})}):l.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[l.jsxs("div",{className:"mb-6",children:[l.jsx("h1",{className:"text-2xl font-bold mb-2",children:"å±¥æ­´ç®¡ç†"}),l.jsx("p",{className:"text-gray-600",children:"é€ä¿¡ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¨é–¢é€£ç”»åƒã®å±¥æ­´ã‚’ç®¡ç†ãƒ»æ¤œç´¢ã§ãã¾ã™"})]}),l.jsxs(c,{className:"mb-6",children:[l.jsx(d,{children:l.jsxs(m,{className:"flex items-center gap-2",children:[l.jsx($,{className:"h-5 w-5"}),"æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼"]})}),l.jsxs(h,{children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[l.jsx("div",{className:"lg:col-span-2",children:l.jsxs("div",{className:"space-y-2",children:[l.jsx(p,{placeholder:"ã‚¿ã‚¤ãƒˆãƒ«ã€æ©Ÿç¨®ã€äº‹æ¥­æ‰€ã€å¿œæ€¥å‡¦ç½®å†…å®¹ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãªã©ã§æ¤œç´¢...",value:V.searchText,onChange:e=>Ve("searchText",e.target.value),onKeyDown:e=>{"Enter"===e.key&&Ke()},className:"w-full"}),l.jsx("p",{className:"text-xs text-gray-500",children:"â€» è¤‡æ•°ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚¹ãƒšãƒ¼ã‚¹åŒºåˆ‡ã‚Šã§å…¥åŠ›ã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€å±¥æ­´ã‚’æ¤œç´¢ã—ã¾ã™"})]})}),l.jsx("div",{children:l.jsxs("div",{className:"space-y-2",children:[l.jsx(p,{type:"date",value:V.searchDate,onChange:e=>Ve("searchDate",e.target.value),className:"w-full"}),l.jsx("p",{className:"text-xs text-gray-500",children:"â€» æŒ‡å®šã—ãŸæ—¥ä»˜ã®å±¥æ­´ã‚’æ¤œç´¢ã—ã¾ã™"})]})}),l.jsx("div",{children:l.jsxs("div",{className:"space-y-2",children:[l.jsxs(g,{value:V.machineType||"all",onValueChange:e=>Ve("machineType","all"===e?"":e),children:[l.jsx(u,{children:l.jsx(x,{placeholder:"æ©Ÿç¨®ã‚’é¸æŠ"})}),l.jsxs(b,{children:[l.jsx(v,{value:"all",children:"ã™ã¹ã¦ã®æ©Ÿç¨®"}),He?l.jsx(v,{value:"loading",disabled:!0,children:"èª­ã¿è¾¼ã¿ä¸­..."}):_e.machineTypes&&_e.machineTypes.length>0?_e.machineTypes.map((e,n)=>l.jsx(v,{value:e,children:e},`type-${n}`)):l.jsx(v,{value:"no-data",disabled:!0,children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),l.jsxs("p",{className:"text-xs text-gray-500",children:["â€» JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ©Ÿç¨®ã‚’å–å¾—ã—ã¦ã„ã¾ã™",_e.machineTypes&&` (${_e.machineTypes.length}ä»¶)`]})]})}),l.jsx("div",{children:l.jsxs("div",{className:"space-y-2",children:[l.jsxs(g,{value:V.machineNumber||"all",onValueChange:e=>Ve("machineNumber","all"===e?"":e),children:[l.jsx(u,{children:l.jsx(x,{placeholder:"æ©Ÿæ¢°ç•ªå·ã‚’é¸æŠ"})}),l.jsxs(b,{children:[l.jsx(v,{value:"all",children:"ã™ã¹ã¦ã®æ©Ÿæ¢°ç•ªå·"}),He?l.jsx(v,{value:"loading",disabled:!0,children:"èª­ã¿è¾¼ã¿ä¸­..."}):_e.machineNumbers&&_e.machineNumbers.length>0?_e.machineNumbers.map((e,n)=>l.jsx(v,{value:e,children:e},`number-${n}`)):l.jsx(v,{value:"no-data",disabled:!0,children:"ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]})]}),l.jsxs("p",{className:"text-xs text-gray-500",children:["â€» JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ©Ÿæ¢°ç•ªå·ã‚’å–å¾—ã—ã¦ã„ã¾ã™",_e.machineNumbers&&` (${_e.machineNumbers.length}ä»¶)`]})]})})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(n,{onClick:Ke,className:"flex items-center gap-2",children:[l.jsx($,{className:"h-4 w-4"}),"æ¤œç´¢"]}),l.jsx(n,{variant:"outline",onClick:()=>{K({machineType:"",machineNumber:"",searchText:"",searchDate:""})},children:"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢"})]})]})]}),l.jsxs(c,{className:"mb-6",children:[l.jsx(d,{children:l.jsxs(m,{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(i,{className:"h-5 w-5"}),"æ•…éšœå±¥æ­´ä¸€è¦§ (",F.length,"ä»¶)"]}),l.jsx("div",{className:"flex items-center gap-2",children:ce&&l.jsx("span",{className:"text-sm text-gray-500",children:"ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•èª­ã¿è¾¼ã¿ä¸­..."})})]})}),l.jsx(h,{children:0===F.length?l.jsxs("div",{className:"text-center py-8",children:[l.jsx(i,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),l.jsx("p",{className:"text-gray-600",children:"å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“"})]}):l.jsx("div",{className:"space-y-4",children:l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[l.jsx("thead",{children:l.jsxs("tr",{className:"bg-gray-50",children:[l.jsxs("th",{className:"border border-gray-300 px-3 py-2 text-center text-sm font-medium",children:[l.jsx("input",{type:"checkbox",checked:Z.size===F.length&&F.length>0,onChange:()=>{Z.size===F.length?ee(new Set):ee(new Set(F.map(e=>e.id)))},className:"mr-2 w-6 h-6"}),"é¸æŠ"]}),l.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"æ©Ÿç¨®"}),l.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"æ©Ÿæ¢°ç•ªå·"}),l.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"äº‹è±¡å†…å®¹"}),l.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"ä½œæˆæ—¥æ™‚"}),l.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"ç”»åƒ"}),l.jsx("th",{className:"border border-gray-300 px-3 py-2 text-left text-sm font-medium",children:"ã‚¢ã‚¯ã‚·ãƒ§ãƒ³"})]})}),l.jsx("tbody",{children:F.map(e=>{var t,a,s,i,r,c,d;const m=e.jsonData;let h=(null==m?void 0:m.title)||"";if(!h&&e.fileName){const n=e.fileName.split("_");n.length>1&&(h=n[0])}if(!h&&(h=(null==m?void 0:m.question)||"äº‹è±¡ãªã—","äº‹è±¡ãªã—"===h&&(null==(t=null==m?void 0:m.chatData)?void 0:t.messages))){const e=m.chatData.messages.filter(e=>!e.isAiResponse);e.length>0&&(h=e[0].content||"äº‹è±¡ãªã—")}h||(h="äº‹è±¡ãªã—");const p=(null==m?void 0:m.machineType)||(null==(s=null==(a=null==m?void 0:m.chatData)?void 0:a.machineInfo)?void 0:s.machineTypeName)||(null==(i=e.machineInfo)?void 0:i.machineTypeName)||e.machineType||"",g=(null==m?void 0:m.machineNumber)||(null==(c=null==(r=null==m?void 0:m.chatData)?void 0:r.machineInfo)?void 0:c.machineNumber)||(null==(d=e.machineInfo)?void 0:d.machineNumber)||e.machineNumber||"";return l.jsxs("tr",{className:"hover:bg-gray-50 bg-blue-50",children:[l.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center text-sm",children:l.jsx("input",{type:"checkbox",checked:Z.has(e.id),onChange:()=>{return n=e.id,void ee(e=>{const t=new Set(e);return t.has(n)?t.delete(n):t.add(n),t});var n},className:"w-6 h-6"})}),l.jsx("td",{className:"border border-gray-300 px-3 py-2 text-sm",children:p||"-"}),l.jsx("td",{className:"border border-gray-300 px-3 py-2 text-sm",children:g||"-"}),l.jsx("td",{className:"border border-gray-300 px-3 py-2 text-sm max-w-xs truncate",title:h,children:h}),l.jsx("td",{className:"border border-gray-300 px-3 py-2 text-sm",children:Ze(e.createdAt)}),l.jsx("td",{className:"border border-gray-300 px-3 py-2",children:(()=>{console.log("ğŸ–¼ï¸ ç”»åƒè¡¨ç¤ºå‡¦ç†é–‹å§‹:",{itemId:e.id,itemTitle:e.title,hasImagePath:!!e.imagePath,hasImageUrl:!!e.imageUrl,hasJsonData:!!e.jsonData,jsonDataKeys:Object.keys(e.jsonData||{})});const n=nn(e);return console.log("ğŸ–¼ï¸ pickFirstImageçµæœ:",n),n?l.jsx("img",{src:n,alt:"ç”»åƒ",className:"w-8 h-8 object-cover rounded border",title:"æ•…éšœç”»åƒ",onError:e=>{console.error("ğŸ–¼ï¸ ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",n);e.target.style.display="none"},onLoad:()=>{console.log("ğŸ–¼ï¸ ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ:",n)}}):l.jsx("span",{className:"text-gray-500",children:"-"})})()}),l.jsx("td",{className:"border border-gray-300 px-3 py-2",children:l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{console.log("ğŸ” ç·¨é›†ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ - å…ƒã®ã‚¢ã‚¤ãƒ†ãƒ :",e),console.log("ğŸ” item.machineType:",e.machineType),console.log("ğŸ” item.machineNumber:",e.machineNumber),console.log("ğŸ” item.jsonData:",e.jsonData);const n=Fe(e);console.log("ğŸ” æ­£è¦åŒ–å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ :",n),console.log("ğŸ” æ­£è¦åŒ–å¾Œ machineType:",n.machineType),console.log("ğŸ” æ­£è¦åŒ–å¾Œ machineNumber:",n.machineNumber),he(n),xe(!0)},className:"flex items-center gap-1 text-xs",title:"ç·¨é›†ç”»é¢ã‚’é–‹ã",children:[l.jsx(o,{className:"h-3 w-3"}),"ç·¨é›†"]}),l.jsxs(n,{variant:"outline",size:"sm",onClick:()=>{fe({show:!0,id:e.id,title:h})},className:"flex items-center gap-1 text-xs text-red-600 hover:text-red-700 hover:bg-red-50",title:"å±¥æ­´ã‚’å‰Šé™¤",children:[l.jsx(E,{className:"h-3 w-3"}),"å‰Šé™¤"]})]})})]},e.id)})})]})})})})]}),l.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[l.jsx("div",{className:"flex items-center justify-between mb-4",children:l.jsx("h2",{className:"text-xl font-bold",children:"ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡¦ç†"})}),l.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(n,{onClick:()=>Ge("json"),disabled:ie||0===Z.size,variant:"default",className:"flex items-center gap-2",children:[l.jsx(T,{className:"h-4 w-4"}),"é¸æŠå±¥æ­´ã‚’JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (",Z.size,")"]}),l.jsxs(n,{onClick:()=>Ge("csv"),disabled:ie||0===Z.size,variant:"default",className:"flex items-center gap-2",children:[l.jsx(T,{className:"h-4 w-4"}),"é¸æŠå±¥æ­´ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (",Z.size,")"]}),l.jsxs(n,{onClick:()=>{const e=window.open("","_blank");if(!e)return;const n=Z.size>0?F.filter(e=>Z.has(e.id)):F,t=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>å±¥æ­´ä¸€è¦§ - å°åˆ·</title>\n        <style>\n          @page { size: A4 portrait; margin: 10mm; }\n          @media print {\n            html, body { margin: 0; padding: 0; }\n            .no-print { display: none !important; }\n            img, .image-cell { break-inside: avoid; page-break-inside: avoid; }\n            table { width: 100%; border-collapse: collapse; table-layout: fixed; }\n            th, td { border: 1px solid #ccc; padding: 4px; vertical-align: top; }\n          }\n          body { font-family: Arial, sans-serif; margin: 20px; }\n          .header { text-align: center; margin-bottom: 20px; }\n          .header h1 { margin: 0; color: #333; }\n          .header p { margin: 5px 0; color: #666; }\n          table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; vertical-align: top; }\n          th { background-color: #f5f5f5; font-weight: bold; }\n          .summary { margin-bottom: 20px; padding: 10px; background-color: #f9f9f9; border-radius: 5px; }\n          .image-cell img { max-width: 100px; max-height: 100px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px; display: block; margin: 0 auto; }\n          .image-cell { text-align: center; vertical-align: middle; }\n          img.thumb { width: 32px; height: 32px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px; }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n          <h1>æ•…éšœå±¥æ­´ä¸€è¦§</h1>\n          <p>å°åˆ·æ—¥æ™‚: ${(new Date).toLocaleString("ja-JP")}</p>\n          <p>å¯¾è±¡ä»¶æ•°: ${n.length}ä»¶${Z.size>0?" (é¸æŠã•ã‚ŒãŸå±¥æ­´)":""}</p>\n        </div>\n        \n        <div class="summary">\n          <strong>å°åˆ·å¯¾è±¡:</strong> ${Z.size>0?"é¸æŠã•ã‚ŒãŸå±¥æ­´":"æ•…éšœå±¥æ­´ä¸€è¦§"}<br>\n          <strong>å°åˆ·æ—¥æ™‚:</strong> ${(new Date).toLocaleString("ja-JP")}<br>\n          <strong>å¯¾è±¡ä»¶æ•°:</strong> ${n.length}ä»¶\n        </div>\n        \n        <table>\n          <thead>\n            <tr>\n              <th>æ©Ÿç¨®</th>\n              <th>æ©Ÿæ¢°ç•ªå·</th>\n              <th>äº‹è±¡</th>\n              <th>èª¬æ˜</th>\n              <th>ä½œæˆæ—¥æ™‚</th>\n              <th>ç”»åƒ</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${n.map(e=>{var n,t,a,s,i,o,l,r;const c=e.jsonData,d=(null==c?void 0:c.machineType)||(null==(t=null==(n=null==c?void 0:c.originalChatData)?void 0:n.machineInfo)?void 0:t.machineTypeName)||(null==(s=null==(a=null==c?void 0:c.chatData)?void 0:a.machineInfo)?void 0:s.machineTypeName)||e.machineType||"",m=(null==c?void 0:c.machineNumber)||(null==(o=null==(i=null==c?void 0:c.originalChatData)?void 0:i.machineInfo)?void 0:o.machineNumber)||(null==(r=null==(l=null==c?void 0:c.chatData)?void 0:l.machineInfo)?void 0:r.machineNumber)||e.machineNumber||"",h=(null==c?void 0:c.title)||(null==c?void 0:c.question)||"äº‹è±¡ãªã—",p=(null==c?void 0:c.problemDescription)||(null==c?void 0:c.answer)||"èª¬æ˜ãªã—",g=nn(e);return`\n                <tr>\n                  <td>${d}</td>\n                  <td>${m}</td>\n                  <td>${h}</td>\n                  <td>${p}</td>\n                  <td>${Ze(e.createdAt)}</td>\n                  <td class="image-cell">${g?`<img class="thumb" src="${g}" alt="æ•…éšœç”»åƒ" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span style="display:none; color: #999; font-size: 10px;">ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</span>`:"ãªã—"}</td>\n                </tr>\n              `}).join("")}\n          </tbody>\n        </table>\n        \n        <div class="no-print" style="margin-top: 20px; text-align: center;">\n          <button onclick="window.close()">é–‰ã˜ã‚‹</button>\n        </div>\n      </body>\n      </html>\n    `;e.document.write(t),e.document.close(),setTimeout(()=>{e.print()},100)},disabled:ie||0===Z.size,variant:"outline",className:"flex items-center gap-2",children:[l.jsx(i,{className:"h-4 w-4"}),"é¸æŠã®ä¸€è¦§ã‚’å°åˆ· (",Z.size,")"]})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(n,{onClick:()=>Qe("json"),disabled:ie,variant:"secondary",className:"flex items-center gap-2",children:[l.jsx(T,{className:"h-4 w-4"}),"å…¨å±¥æ­´ã‚’JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"]}),l.jsxs(n,{onClick:()=>Qe("csv"),disabled:ie,variant:"secondary",className:"flex items-center gap-2",children:[l.jsx(T,{className:"h-4 w-4"}),"å…¨å±¥æ­´ã‚’CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ"]})]})]}),ie&&l.jsxs("div",{className:"flex items-center gap-2 text-blue-600",children:[l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),"ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå‡¦ç†ä¸­..."]})]}),ae>1&&l.jsx("div",{className:"flex justify-center mt-6",children:l.jsxs("div",{className:"flex gap-2",children:[l.jsx(n,{variant:"outline",onClick:()=>Ye(ne-1),disabled:1===ne,children:"å‰ã¸"}),Array.from({length:Math.min(5,ae)},(e,t)=>{const a=Math.max(1,Math.min(ae-4,ne-2))+t;return l.jsx(n,{variant:ne===a?"default":"outline",onClick:()=>Ye(a),children:a},a)}),l.jsx(n,{variant:"outline",onClick:()=>Ye(ne+1),disabled:ne===ae,children:"æ¬¡ã¸"})]})}),be&&pe&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:l.jsx("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-auto",children:l.jsxs("div",{className:"p-6",children:[l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h2",{className:"text-xl font-bold",children:"å±¥æ­´ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(n,{onClick:()=>(e=>{var n,t,a,s,i,o,l,r,c,d,m,h,p,g;console.log("ğŸ–¨ï¸ å°åˆ·ãƒ¬ãƒãƒ¼ãƒˆé–‹å§‹:",e);const u=window.open("","_blank");if(!u)return console.error("âŒ å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸ"),void alert("å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç„¡åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚");console.log("âœ… å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ãã¾ã—ãŸ");const x=e.jsonData;let b="äº‹è±¡ãªã—";if(e.fileName){const n=e.fileName.split("_");n.length>1&&(b=n[0])}if("äº‹è±¡ãªã—"===b&&(b=(null==x?void 0:x.title)||(null==x?void 0:x.question)||"äº‹è±¡ãªã—","äº‹è±¡ãªã—"===b&&(null==(n=null==x?void 0:x.chatData)?void 0:n.messages))){const e=x.chatData.messages.filter(e=>!e.isAiResponse);e.length>0&&(b=e[0].content||"äº‹è±¡ãªã—")}const v=(null==x?void 0:x.problemDescription)||(null==x?void 0:x.answer)||"èª¬æ˜ãªã—",y=(null==(t=e.machineInfo)?void 0:t.machineTypeName)||(null==x?void 0:x.machineType)||(null==(s=null==(a=null==x?void 0:x.chatData)?void 0:a.machineInfo)?void 0:s.machineTypeName)||e.machineType||"",f=(null==(i=e.machineInfo)?void 0:i.machineNumber)||(null==x?void 0:x.machineNumber)||(null==(l=null==(o=null==x?void 0:x.chatData)?void 0:o.machineInfo)?void 0:l.machineNumber)||e.machineNumber||"";null==x||x.extractedComponents,null==x||x.extractedSymptoms,null==x||x.possibleModels;let j="",N="";if(console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨ç”»åƒèª­ã¿è¾¼ã¿å‡¦ç†:",{itemId:e.id,hasJsonData:!!x,jsonDataKeys:x?Object.keys(x):[],savedImages:null==x?void 0:x.savedImages,conversationHistory:null==x?void 0:x.conversationHistory,originalChatData:null==x?void 0:x.originalChatData,chatData:null==x?void 0:x.chatData,imagePath:e.imagePath}),(null==x?void 0:x.conversationHistory)&&x.conversationHistory.length>0){const n=x.conversationHistory.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(j=n.content,N=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: conversationHistoryã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆæœ€å„ªå…ˆï¼‰"))}if(!j&&(null==(r=null==x?void 0:x.originalChatData)?void 0:r.messages)){const n=x.originalChatData.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(j=n.content,N=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: originalChatDataã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½2ï¼‰"))}if(!j&&(null==(c=null==x?void 0:x.chatData)?void 0:c.messages)){const n=x.chatData.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(j=n.content,N=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: chatDataã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½3ï¼‰"))}if(!j&&(null==x?void 0:x.messages)&&Array.isArray(x.messages)){const n=x.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(j=n.content,N=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: messagesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½4ï¼‰"))}if(!j&&(null==x?void 0:x.savedImages)&&x.savedImages.length>0){const n=x.savedImages[0];j=n.url||"",N=n.fileName||`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: savedImagesã‹ã‚‰ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½5ï¼‰")}if(!j&&(null==(d=null==x?void 0:x.originalChatData)?void 0:d.messages)){const n=x.originalChatData.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(j=n.content,N=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: originalChatDataã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½3ï¼‰"))}if(!j&&(null==(m=null==x?void 0:x.chatData)?void 0:m.messages)){const n=x.chatData.messages.find(e=>e.content&&e.content.startsWith("data:image/"));n&&(j=n.content,N=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: chatDataã‹ã‚‰Base64ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½4ï¼‰"))}if(!j){const n=(e,t="")=>{const a=[];if(e&&"object"==typeof e)for(const[s,i]of Object.entries(e)){const e=t?`${t}.${s}`:s;"string"==typeof i&&i.startsWith("data:image/")?a.push({path:e,content:i}):Array.isArray(i)?i.forEach((t,s)=>{a.push(...n(t,`${e}[${s}]`))}):"object"==typeof i&&null!==i&&a.push(...n(i,e))}return a},t=n(x);t.length>0&&(j=t[0].content,N=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: å†å¸°çš„æ¤œç´¢ã§ç”»åƒã‚’å–å¾—ï¼ˆå„ªå…ˆé †ä½6ï¼‰"))}!j&&e.imagePath&&(j=e.imagePath.startsWith("http")?e.imagePath:e.imagePath.startsWith("/")?`${window.location.origin}${e.imagePath}`:`${window.location.origin}/api/images/chat-exports/${e.imagePath}`,N=`æ•…éšœç”»åƒ_${e.id}`,console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: imagePathã‹ã‚‰ç”»åƒã‚’å–å¾—ï¼ˆæœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰")),console.log("å€‹åˆ¥ãƒ¬ãƒãƒ¼ãƒˆå°åˆ·ç”¨: æœ€çµ‚çš„ãªç”»åƒæƒ…å ±:",{hasImage:!!j,imageUrl:j?j.substring(0,100)+"...":"ãªã—",imageFileName:N,isBase64:!!j&&j.startsWith("data:image/")});const D=`\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸ - å°åˆ·</title>\n        <style>\n          body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }\n          .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }\n          .header h1 { margin: 0; color: #333; font-size: 24px; }\n          .header p { margin: 5px 0; color: #666; }\n          .section { margin-bottom: 25px; }\n          .section h2 { color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; }\n          .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }\n          .info-item { padding: 10px; background-color: #f9f9f9; border-radius: 5px; }\n          .info-item strong { display: block; margin-bottom: 5px; color: #333; }\n          .content-box { background-color: #f9f9f9; padding: 15px; border-radius: 5px; margin-top: 10px; }\n          .image-section { text-align: center; margin: 20px 0; }\n          .image-section img { max-width: 100%; max-height: 300px; border: 1px solid #ddd; border-radius: 5px; }\n          @media print {\n            .no-print { display: none; }\n            body { \n              margin: 0; \n              font-size: 10px;\n              line-height: 1.2;\n            }\n            .header h1 { \n              font-size: 16px; \n              margin: 5px 0; \n            }\n            .header p { \n              font-size: 8px; \n              margin: 2px 0; \n            }\n            .section { \n              margin: 8px 0; \n              page-break-inside: avoid;\n            }\n            .section h2 { \n              font-size: 12px; \n              margin: 5px 0; \n            }\n            .info-grid { \n              gap: 4px; \n            }\n            .info-item { \n              font-size: 9px; \n              padding: 2px; \n            }\n            .content { \n              font-size: 9px; \n              line-height: 1.1;\n            }\n            .image-section { \n              margin: 8px 0; \n            }\n            .image-section img { \n              max-height: 150px; \n            }\n            @page {\n              size: A4;\n              margin: 10mm;\n            }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="header">\n                      <h1>æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸</h1>\n          <p>å°åˆ·æ—¥æ™‚: ${(new Date).toLocaleString("ja-JP")}</p>\n        </div>\n        \n        <div class="section">\n          <h2>å ±å‘Šæ¦‚è¦</h2>\n          <div class="info-grid">\n            <div class="info-item">\n              <strong>å ±å‘Šæ›¸ID</strong>\n              R${e.id.slice(-5).toUpperCase()}\n            </div>\n            <div class="info-item">\n              <strong>æ©Ÿæ¢°ID</strong>\n              ${e.machineNumber}\n            </div>\n            <div class="info-item">\n              <strong>æ—¥ä»˜</strong>\n              ${e.createdAt?new Date(e.createdAt).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]}\n            </div>\n            <div class="info-item">\n              <strong>å ´æ‰€</strong>\n              â—‹â—‹ç·š\n            </div>\n            <div class="info-item">\n              <strong>æ•…éšœã‚³ãƒ¼ãƒ‰</strong>\n              FC01\n            </div>\n          </div>\n        </div>\n        \n        <div class="section">\n          <h2>äº‹è±¡è©³ç´°</h2>\n          <div class="content-box">\n            <p><strong>äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«:</strong> ${b}</p>\n            <p><strong>äº‹è±¡èª¬æ˜:</strong> ${v}</p>\n            <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> å¿œæ€¥å‡¦ç½®å®Œäº†</p>\n            <p><strong>æ‹…å½“ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢:</strong> æ‹…å½“è€…</p>\n            <p><strong>æ©Ÿç¨®:</strong> ${y}</p>\n            <p><strong>æ©Ÿæ¢°ç•ªå·:</strong> ${f}</p>\n          </div>\n        </div>\n        \n        ${j?`\n        <div class="section">\n          <h2>æ•…éšœç®‡æ‰€ç”»åƒ</h2>\n          <div class="image-section">\n            <p>æ©Ÿæ¢°æ•…éšœç®‡æ‰€ã®ç”»åƒ</p>\n            <img src="${j}" alt="æ•…éšœç®‡æ‰€ç”»åƒ" />\n            <p style="font-size: 12px; color: #666;">ä¸Šè¨˜ã¯æ•…éšœç®‡æ‰€ã®å†™çœŸã§ã™ã€‚</p>\n          </div>\n        </div>\n        `:""}\n        \n        <div class="section">\n          <h2>ä¿®ç¹•è¨ˆç”»</h2>\n          <div class="info-grid">\n            <div class="info-item">\n              <strong>äºˆå®šæœˆæ—¥</strong>\n              ${(null==(h=e.jsonData)?void 0:h.repairSchedule)||"-"}\n            </div>\n            <div class="info-item">\n              <strong>å ´æ‰€</strong>\n              ${(null==(p=e.jsonData)?void 0:p.location)||"-"}\n            </div>\n          </div>\n        </div>\n        \n        <div class="section">\n          <h2>è¨˜äº‹æ¬„</h2>\n          <div class="content-box">\n            <p>${(null==(g=e.jsonData)?void 0:g.remarks)||"è¨˜è¼‰ãªã—"}</p>\n          </div>\n        </div>\n        \n        <div class="section">\n          <p style="text-align: center; color: #666; font-size: 12px;">\n            Â© 2025 æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸. All rights reserved.\n          </p>\n        </div>\n        \n        <div class="no-print" style="margin-top: 30px; text-align: center;">\n          <button onclick="window.print()">å°åˆ·</button>\n          <button onclick="window.close()">é–‰ã˜ã‚‹</button>\n        </div>\n      </body>\n      </html>\n    `;console.log("ğŸ–¨ï¸ HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é•·ã•:",D.length),console.log("ğŸ–¨ï¸ HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å…ˆé ­100æ–‡å­—:",D.substring(0,100));try{u.document.write(D),u.document.close(),console.log("âœ… document.write()ã§HTMLã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸ")}catch(w){console.error("âŒ document.write()ã§ã‚¨ãƒ©ãƒ¼:",w);try{u.document.documentElement.innerHTML=D,console.log("âœ… innerHTMLã§HTMLã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸ")}catch(T){console.error("âŒ innerHTMLã§ã‚‚ã‚¨ãƒ©ãƒ¼:",T),u.document.open(),u.document.write(D),u.document.close(),console.log("âœ… æ–°ã—ã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§HTMLã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸ")}}setTimeout(()=>{console.log("ğŸ–¨ï¸ æ›¸ãè¾¼ã¾ã‚ŒãŸHTMLã®é•·ã•:",u.document.documentElement.innerHTML.length),console.log("ğŸ–¨ï¸ æ›¸ãè¾¼ã¾ã‚ŒãŸHTMLã®å…ˆé ­100æ–‡å­—:",u.document.documentElement.innerHTML.substring(0,100))},100),console.log("âœ… å°åˆ·ãƒ¬ãƒãƒ¼ãƒˆHTMLã‚’æ›¸ãè¾¼ã¿ã¾ã—ãŸ"),u.onload=()=>{console.log("âœ… å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"),u.focus(),setTimeout(()=>{u.print(),console.log("âœ… å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ")},1e3)},setTimeout(()=>{u.closed||(u.focus(),u.print(),console.log("âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ"))},2e3)})(pe),className:"flex items-center gap-2",children:[l.jsx(i,{className:"h-4 w-4"}),"å°åˆ·"]}),l.jsxs(n,{onClick:()=>{const e=Fe(pe);he(e),ve(!1),xe(!0)},className:"flex items-center gap-2",children:[l.jsx(o,{className:"h-4 w-4"}),"ç·¨é›†ã«ç§»å‹•"]}),l.jsx(n,{variant:"ghost",onClick:()=>ve(!1),children:"Ã—"})]})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"text-center border-b pb-4",children:[l.jsx("h1",{className:"text-2xl font-bold mb-2",children:"å¿œæ€¥å‡¦ç½®ã‚µãƒãƒ¼ãƒˆå±¥æ­´"}),l.jsxs("p",{className:"text-sm text-gray-500",children:["ä½œæˆæ—¥æ™‚: ",Ze(pe.createdAt)]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold mb-3",children:"åŸºæœ¬æƒ…å ±"}),l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(o,{className:"h-4 w-4 text-gray-500"}),l.jsxs("span",{children:[l.jsx("strong",{children:"æ©Ÿç¨®:"})," ",pe.machineType]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(k,{className:"h-4 w-4 text-gray-500"}),l.jsxs("span",{children:[l.jsx("strong",{children:"æ©Ÿæ¢°ç•ªå·:"})," ",pe.machineNumber]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(C,{className:"h-4 w-4 text-gray-500"}),l.jsxs("span",{children:[l.jsx("strong",{children:"ä½œæˆæ—¥æ™‚:"})," ",Ze(pe.createdAt)]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(S,{className:"h-4 w-4 text-gray-500"}),l.jsxs("span",{children:[l.jsx("strong",{children:"ç”»åƒ:"})," ",pe.imagePath?"ã‚ã‚Š":"ãªã—"]})]})]})]}),pe.imagePath&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold mb-3",children:"é–¢é€£ç”»åƒ"}),l.jsx("img",{src:pe.imagePath,alt:"å±¥æ­´ç”»åƒ",className:"w-full h-48 object-cover rounded-md"})]})]}),l.jsxs("div",{children:[l.jsx("h3",{className:"text-lg font-semibold mb-3",children:"è©³ç´°æƒ…å ±"}),l.jsx("div",{className:"bg-gray-50 p-4 rounded-md",children:l.jsx("pre",{className:"text-sm overflow-auto max-h-64",children:JSON.stringify(pe.jsonData,null,2)})})]})]})]})})}),ue&&me&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:l.jsx("div",{className:"bg-white rounded-lg max-w-5xl w-full max-h-[95vh] overflow-auto",children:l.jsxs("div",{className:"p-6",children:[(0!==Le.machineTypes.length||Je||(async()=>{try{qe(!0),console.log("ğŸ” æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹");const{buildApiUrl:e}=await s(async()=>{const{buildApiUrl:e}=await import("./index-qgKIBYKJ.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),n=await fetch(e("/machines/machine-types"));console.log("ğŸ” APIãƒ¬ã‚¹ãƒãƒ³ã‚¹:",n.status,n.statusText);const t=await n.json();if(console.log("ğŸ” APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿:",t),t.success&&t.data){const e=new Set,n=[];console.log("ğŸ” æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿ã¯å°‚ç”¨APIã‹ã‚‰å–å¾—ã•ã‚Œã¾ã™"),t.data.forEach(t=>{t.machine_type_name&&!e.has(t.machine_type_name)&&(e.add(t.machine_type_name),n.push({id:t.id,machineTypeName:t.machine_type_name}))});const a={machineTypes:n,machines:[]};console.log("ğŸ” æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿å–å¾—çµæœ:",a),console.log("ğŸ” æ©Ÿç¨®æ•°:",a.machineTypes.length),console.log("ğŸ” æ©Ÿæ¢°ç•ªå·æ•°:",a.machines.length),console.log("ğŸ” æ©Ÿç¨®ä¸€è¦§:",a.machineTypes.map(e=>e.machineTypeName)),console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ä¸€è¦§:",a.machines.map(e=>`${e.machineNumber} (${e.machineTypeName})`)),console.log("ğŸ” setMachineDataå‘¼ã³å‡ºã—å‰:",a),ze(a),console.log("ğŸ” setMachineDataå‘¼ã³å‡ºã—å®Œäº†")}else console.log("âš ï¸ æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ:",t),console.log("âš ï¸ data.success:",t.success),console.log("âš ï¸ data.machineTypes:",t.machineTypes),console.log("âš ï¸ data.machines:",t.machines),ze({machineTypes:[],machines:[]})}catch(e){console.error("æ©Ÿç¨®ãƒ»æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:",e),ze({machineTypes:[],machines:[]})}finally{qe(!1)}})(),console.log("ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºæ™‚ã®editingItem:",{machineType:me.machineType,machineNumber:me.machineNumber,fileName:me.fileName,title:null==(tn=me.jsonData)?void 0:tn.title,question:null==(an=me.jsonData)?void 0:an.question,jsonData:me.jsonData}),null),l.jsxs("div",{className:"flex justify-between items-center mb-4",children:[l.jsx("h2",{className:"text-xl font-bold",children:"æ©Ÿæ¢°æ•…éšœæƒ…å ±ç·¨é›†"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(n,{onClick:()=>{console.log("ç·¨é›†ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã™:",me),en(me)},className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[l.jsx(T,{className:"h-4 w-4"}),"ä¿å­˜"]}),l.jsxs(n,{onClick:()=>{console.log("ğŸ–¨ï¸ ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‹ã‚‰å°åˆ·ã‚’å®Ÿè¡Œ:",me),console.log("ğŸ–¨ï¸ editingItem.jsonData:",me.jsonData),console.log("ğŸ–¨ï¸ editingItem.id:",me.id),console.log("ğŸ–¨ï¸ editingItem.fileName:",me.fileName);const e=(e=>{const n=(e=>{var n,t,a,s;console.log("ğŸ–¼ï¸ ç”»åƒåé›†é–‹å§‹ - reportData:",e),console.log("ğŸ–¼ï¸ reportData keys:",Object.keys(e||{}));const i=[],o=new Set;return console.log("ğŸ–¼ï¸ ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª:"),console.log("ğŸ–¼ï¸ - chatData:",(null==e?void 0:e.chatData)?"ã‚ã‚Š":"ãªã—"),console.log("ğŸ–¼ï¸ - chatData.messages:",(null==(n=null==e?void 0:e.chatData)?void 0:n.messages)?"ã‚ã‚Š("+e.chatData.messages.length+"ä»¶)":"ãªã—"),console.log("ğŸ–¼ï¸ - conversationHistory:",(null==e?void 0:e.conversationHistory)?"ã‚ã‚Š("+(Array.isArray(e.conversationHistory)?e.conversationHistory.length:"non-array")+")":"ãªã—"),console.log("ğŸ–¼ï¸ - originalChatData.messages:",(null==(t=null==e?void 0:e.originalChatData)?void 0:t.messages)?"ã‚ã‚Š("+e.originalChatData.messages.length+")":"ãªã—"),console.log("ğŸ–¼ï¸ - messages:",(null==e?void 0:e.messages)?"ã‚ã‚Š("+(Array.isArray(e.messages)?e.messages.length:"non-array")+")":"ãªã—"),(null==(a=null==e?void 0:e.chatData)?void 0:a.messages)&&Array.isArray(e.chatData.messages)&&(console.log("ğŸ–¼ï¸ chatData.messagesã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­..."),e.chatData.messages.forEach((e,n)=>{var t;if(console.log("ğŸ–¼ï¸ message["+n+"]:",{id:null==e?void 0:e.id,content:(null==e?void 0:e.content)?e.content.substring(0,50)+"...":"ãªã—",isBase64:null==(t=null==e?void 0:e.content)?void 0:t.startsWith("data:image/")}),(null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")){const t=e.content.replace(/\r?\n/g,"").replace(/[""]/g,'"').trim();o.has(t)||(o.add(t),i.push({id:`chatdata-${n}`,url:t,fileName:`æ•…éšœç”»åƒ${i.length+1}`,description:"æ•…éšœç®‡æ‰€ç”»åƒï¼ˆchatData.messagesï¼‰"}),console.log("ğŸ–¼ï¸ Base64ç”»åƒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆchatData.messagesï¼‰:",i.length))}})),(null==e?void 0:e.conversationHistory)&&Array.isArray(e.conversationHistory)&&(console.log("ğŸ–¼ï¸ conversationHistoryã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­..."),e.conversationHistory.forEach((e,n)=>{if((null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")){const t=e.content.replace(/\r?\n/g,"").replace(/[""]/g,'"').trim();o.has(t)||(o.add(t),i.push({id:`conversation-${n}`,url:t,fileName:`æ•…éšœç”»åƒ${i.length+1}`,description:"æ•…éšœç®‡æ‰€ç”»åƒï¼ˆconversationHistoryï¼‰"}),console.log("ğŸ–¼ï¸ Base64ç”»åƒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆconversationHistoryï¼‰:",i.length))}})),(null==(s=null==e?void 0:e.originalChatData)?void 0:s.messages)&&Array.isArray(e.originalChatData.messages)&&(console.log("ğŸ–¼ï¸ originalChatData.messagesã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­..."),e.originalChatData.messages.forEach((e,n)=>{if((null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")){const t=e.content.replace(/\r?\n/g,"").replace(/[""]/g,'"').trim();o.has(t)||(o.add(t),i.push({id:`original-${n}`,url:t,fileName:`æ•…éšœç”»åƒ${i.length+1}`,description:"æ•…éšœç®‡æ‰€ç”»åƒï¼ˆoriginalChatDataï¼‰"}),console.log("ğŸ–¼ï¸ Base64ç”»åƒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆoriginalChatDataï¼‰:",i.length))}})),(null==e?void 0:e.messages)&&Array.isArray(e.messages)&&(console.log("ğŸ–¼ï¸ messagesã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­..."),e.messages.forEach((e,n)=>{if((null==e?void 0:e.content)&&"string"==typeof e.content&&e.content.startsWith("data:image/")){const t=e.content.replace(/\r?\n/g,"").replace(/[""]/g,'"').trim();o.has(t)||(o.add(t),i.push({id:`messages-${n}`,url:t,fileName:`æ•…éšœç”»åƒ${i.length+1}`,description:"æ•…éšœç®‡æ‰€ç”»åƒï¼ˆmessagesï¼‰"}),console.log("ğŸ–¼ï¸ Base64ç”»åƒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼ˆmessagesï¼‰:",i.length))}})),console.log("ğŸ–¼ï¸ ç”»åƒåé›†çµæœï¼ˆBase64ã®ã¿ï¼‰:",i.length+"ä»¶ã®ç”»åƒ"),i.forEach((e,n)=>{console.log("ğŸ–¼ï¸ ç”»åƒ["+n+"]:",e.description,"-",e.url.substring(0,50)+"...")}),i})(e),t=n&&n.length>0?`             <div class="image-section">\n               <h3>æ•…éšœç®‡æ‰€ç”»åƒ</h3>\n               <div class="image-grid">\n                 ${n.map((e,n)=>`\n                   <div class="image-item">\n                     <img class="report-img" \n                          src="${e.url}" \n                          alt="æ•…éšœç”»åƒ${n+1}" />\n                   </div>\n                 `).join("")}\n               </div>\n             </div>`:"";return`\n      <!doctype html>\n      <html>\n      <head>\n        <meta charset="utf-8">\n        <title>æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸</title>\n        <style>\n          @page {\n            size: A4 portrait;\n            margin: 10mm;\n          }\n          \n          * {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n          }\n          \n          body {\n            font-family: 'Yu Mincho', 'YuMincho', 'Hiragino Mincho ProN', 'Hiragino Mincho Pro', 'HGSæ˜æœ', 'MS Mincho', serif;\n            font-size: 12pt;\n            line-height: 1.4;\n            color: #000;\n            background: white;\n            max-width: 100%;\n            overflow-x: hidden;\n          }\n          \n          /* å°åˆ·æ™‚ã®ã¿æ–‡å­—ã‚µã‚¤ã‚ºã‚’ã•ã‚‰ã«ç¸®å°ã—ã¦A4ä¸€æšã«åã‚ã‚‹ */\n          @media print {\n            body {\n              font-size: 10pt;\n              line-height: 1.2;\n            }\n            \n            .header h1 {\n              font-size: 16pt;\n              margin-bottom: 5px;\n            }\n            \n            .section h2 {\n              font-size: 12pt;\n              margin-bottom: 5px;\n            }\n            \n            .info-item strong,\n            .info-item span,\n            .info-item input,\n            .info-item textarea,\n            .content-box strong,\n            .content-box p {\n              font-size: 10pt;\n            }\n            \n            .header p {\n              font-size: 10pt;\n            }\n            \n            input, textarea, .editable {\n              font-size: 10pt;\n            }\n            \n            /* å°åˆ·æ™‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæœ€é©åŒ– */\n            .section {\n              margin-bottom: 8px;\n              page-break-inside: avoid;\n            }\n            \n            .info-grid {\n              gap: 4px;\n              margin-bottom: 8px;\n            }\n            \n            .info-item {\n              padding: 4px;\n            }\n            \n            .content-box {\n              padding: 4px;\n              margin-top: 4px;\n            }\n            \n            .image-grid {\n              gap: 4px;\n              margin: 4px 0;\n              grid-template-columns: repeat(2, 1fr);\n              max-width: 300px;\n            }\n            \n            .report-img {\n              max-width: 120px;\n              max-height: 80px;\n            }\n            \n            /* A4ä¸€æšã«åã‚ã‚‹ãŸã‚ã®èª¿æ•´ */\n            @page {\n              size: A4 portrait;\n              margin: 10mm;\n            }\n            \n            .container {\n              max-height: 260mm;\n              overflow: hidden;\n            }\n            \n            .action-buttons { \n              display: none !important; \n            }\n            \n            body { \n              margin: 0; \n              padding: 0;\n            }\n          }\n          \n          .container {\n            max-width: 100%;\n            padding: 0;\n          }\n          \n          .header {\n            text-align: center;\n            margin-bottom: 10px;\n            padding-bottom: 8px;\n            border-bottom: 2px solid #333;\n          }\n          \n          .header h1 {\n            font-size: 27pt;\n            font-weight: bold;\n            margin-bottom: 8px;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼çµ±ä¸€ */\n          .edit-mode .header h1 {\n            font-size: 27pt;\n            font-weight: bold;\n          }\n          \n          .section h2 {\n            font-size: 20pt;\n            font-weight: bold;\n            color: #000;\n            border-bottom: 1px solid #ccc;\n            padding-bottom: 4px;\n            margin-bottom: 8px;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã—çµ±ä¸€ */\n          .edit-mode .section h2 {\n            font-size: 20pt;\n            font-weight: bold;\n            color: #000;\n          }\n          \n          .info-item strong {\n            font-size: 18pt;\n            font-weight: bold;\n            color: #000;\n          }\n          \n          .info-item span,\n          .info-item input,\n          .info-item textarea {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          .header p {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ãƒ˜ãƒƒãƒ€ãƒ¼æ—¥ä»˜çµ±ä¸€ */\n          .edit-mode .header p {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          .section {\n            margin-bottom: 10px;\n            page-break-inside: avoid;\n          }\n          \n\n          \n          .info-grid {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 6px;\n            margin-bottom: 8px;\n          }\n          \n          .info-item {\n            padding: 8px;\n            background-color: #f8f8f8;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n          }\n          \n\n          \n          .content-box {\n            background-color: #f8f8f8;\n            padding: 6px;\n            border: 1px solid #ddd;\n            border-radius: 3px;\n            margin-top: 4px;\n          }\n          \n          .content-box p {\n            font-size: 8pt;\n            line-height: 1.3;\n            margin: 0;\n          }\n          \n          .image-section {\n            margin: 12px 0;\n            padding-left: 20px;\n            page-break-inside: avoid;\n          }\n          \n          .image-section h3 {\n            font-size: 10pt;\n            margin-bottom: 8px;\n            text-align: left;\n          }\n          \n          .image-grid {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 12px;\n            margin: 8px 0;\n            max-width: 600px;\n          }\n          \n          .image-item {\n            text-align: center;\n            page-break-inside: avoid;\n          }\n          \n          .report-img {\n            max-width: 120px;\n            max-height: 80px;\n            width: auto;\n            height: auto;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            object-fit: cover;\n            transition: all 0.2s ease;\n          }\n          \n          .resizable-image {\n            position: relative;\n            cursor: move;\n            user-select: none;\n          }\n          \n          .resizable-image:hover {\n            border: 2px solid #007bff;\n            transform: scale(1.02);\n          }\n          \n          .resizable-image.dragging {\n            opacity: 0.7;\n            transform: scale(1.1);\n            z-index: 1000;\n          }\n          \n          .image-caption {\n            text-align: center;\n            margin-top: 5px;\n            font-size: 8pt;\n            color: #666;\n          }\n          \n          .footer {\n            text-align: center;\n            margin-top: 8px;\n            padding-top: 6px;\n            border-top: 1px solid #ccc;\n            font-size: 7pt;\n            color: #666;\n          }\n          \n          .action-buttons {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            z-index: 1000;\n            display: flex;\n            gap: 10px;\n          }\n          \n          .btn {\n            padding: 10px 20px;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            font-size: 14px;\n            font-weight: bold;\n          }\n          \n          .btn-print {\n            background: #28a745;\n            color: white;\n            padding: 20px 40px; /* 2å€ã‚µã‚¤ã‚º */\n            font-size: 28px; /* 2å€ã‚µã‚¤ã‚º */\n          }\n          \n          .btn-save {\n            background: #ffc107;\n            color: #000;\n          }\n          \n          .btn-cancel {\n            background: #6c757d;\n            color: white;\n            padding: 20px 40px; /* 2å€ã‚µã‚¤ã‚º */\n            font-size: 28px; /* 2å€ã‚µã‚¤ã‚º */\n          }\n          \n          .btn-close {\n            background: #6c757d;\n            color: white;\n          }\n          \n          .readonly {\n            display: block;\n          }\n          \n          .editable {\n            display: none;\n            background-color: #f0f0f0;\n            color: #000;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            padding: 8px;\n            font-size: 18pt;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸UIã«åˆã‚ã›ã‚‹ */\n          .edit-mode .editable {\n            font-size: 18pt;\n          }\n          \n          .edit-mode .info-item strong {\n            font-size: 18pt;\n          }\n          \n          .edit-mode .info-item span {\n            font-size: 18pt;\n          }\n          \n          .edit-mode .content-box strong {\n            font-size: 18pt;\n          }\n          \n          .edit-mode .content-box p {\n            font-size: 18pt;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ - ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚ˆã†ã«å¼·åŒ– */\n          .edit-mode .readonly {\n            display: none !important;\n            visibility: hidden !important;\n          }\n          \n          .edit-mode .editable {\n            display: block !important;\n            visibility: visible !important;\n            width: 100% !important;\n            padding: 8px !important;\n            border: 2px solid #007bff !important;\n            border-radius: 3px !important;\n            font-size: 14pt !important;\n            color: #000 !important;\n            background-color: #fff !important;\n            font-family: inherit !important;\n          }\n          \n          /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç·¨é›†è¦ç´ ã‚’ç¢ºå®Ÿã«éè¡¨ç¤º */\n          .editable {\n            display: none !important;\n            visibility: hidden !important;\n          }\n          \n          /* èª­ã¿å–ã‚Šå°‚ç”¨è¦ç´ ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤º */\n          .readonly {\n            display: inline !important;\n            visibility: visible !important;\n          }\n          \n          input, textarea {\n            width: 100%;\n            padding: 8px;\n            border: 1px solid #ccc;\n            border-radius: 3px;\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«çµ±ä¸€ */\n          .edit-mode input,\n          .edit-mode textarea {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          .content-box strong {\n            font-size: 18pt;\n            font-weight: bold;\n            color: #000;\n          }\n          \n          .content-box p {\n            font-size: 18pt;\n            color: #000;\n          }\n          \n          @media print {\n            .action-buttons { display: none !important; }\n            body { margin: 0; }\n          }\n          \n          /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */\n          .readonly {\n            display: inline;\n          }\n          \n          .editable {\n            display: none !important;\n            padding: 4px 8px;\n            border: 1px solid #ddd;\n            border-radius: 4px;\n            width: 100%;\n            box-sizing: border-box;\n          }\n          \n          .edit-mode .readonly {\n            display: none !important;\n          }\n          \n          .edit-mode .editable {\n            display: block !important;\n            background-color: #ffffcc;\n            border: 2px solid #007bff;\n          }\n          \n          .btn {\n            padding: 8px 16px;\n            margin: 0 4px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 14px;\n          }\n          \n          .btn-save {\n            background-color: #28a745;\n            color: white;\n          }\n          \n          .btn-cancel {\n            background-color: #6c757d;\n            color: white;\n            padding: 20px 40px; /* 2å€ã‚µã‚¤ã‚º */\n            font-size: 28px; /* 2å€ã‚µã‚¤ã‚º */\n          }\n          \n          .btn-print {\n            background-color: #17a2b8;\n            color: white;\n            padding: 20px 40px; /* 2å€ã‚µã‚¤ã‚º */\n            font-size: 28px; /* 2å€ã‚µã‚¤ã‚º */\n          }\n          \n          .btn-close {\n            background-color: #dc3545;\n            color: white;\n          }\n        </style>\n      </head>\n      <body>\n        <script>\n          // ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿãªè¨­å®š\n          window.reportData = {};\n          console.log('Script starting...');\n        <\/script>\n        <div class="action-buttons">\n          <button class="btn btn-save" id="save-btn" style="display: none;">ä¿å­˜</button>\n          <button class="btn btn-print" onclick="window.print()">å°åˆ·</button>\n          <button class="btn btn-cancel" id="cancel-btn" style="display: none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>\n          <button class="btn btn-close" onclick="window.close()">é–‰ã˜ã‚‹</button>\n        </div>\n        \n        <div class="container">\n          <div class="header">\n            <h1>æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸</h1>\n            <p>å°åˆ·æ—¥æ™‚: ${(new Date).toLocaleString("ja-JP")}</p>\n          </div>\n          \n          <div class="section">\n            <h2>å ±å‘Šæ¦‚è¦</h2>\n            <div class="info-grid">\n              <div class="info-item">\n                <strong>å ±å‘Šæ›¸ID</strong>\n                <span class="readonly">${(e.reportId||e.id||"").substring(0,8)}...</span>\n                <input class="editable" value="${e.reportId||e.id||""}" />\n              </div>\n              <div class="info-item">\n                <strong>æ©Ÿç¨®</strong>\n                <span class="readonly">${e.machineType||e.machineTypeName||"-"}</span>\n                <input class="editable" value="${e.machineType||e.machineTypeName||""}" />\n              </div>\n              <div class="info-item">\n                <strong>æ©Ÿæ¢°ç•ªå·</strong>\n                <span class="readonly">${e.machineNumber||"-"}</span>\n                <input class="editable" value="${e.machineNumber||""}" />\n              </div>\n              <div class="info-item">\n                <strong>æ—¥ä»˜</strong>\n                <span class="readonly">${e.date?new Date(e.date).toLocaleDateString("ja-JP"):e.timestamp?new Date(e.timestamp).toLocaleDateString("ja-JP"):e.createdAt?new Date(e.createdAt).toLocaleDateString("ja-JP"):"-"}</span>\n                <input class="editable" type="date" value="${e.date||e.timestamp||e.createdAt||""}" />\n              </div>\n              <div class="info-item">\n                <strong>å ´æ‰€</strong>\n                <span class="readonly">${e.location||"-"}</span>\n                <input class="editable" value="${e.location||""}" />\n              </div>\n            </div>\n          </div>\n          \n          <div class="section">\n            <h2>æ•…éšœè©³ç´°</h2>\n            <div class="info-grid">\n              <div class="info-item">\n                <strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</strong>\n                <span class="readonly">${e.status||"-"}</span>\n                <input class="editable" value="${e.status||""}" />\n              </div>\n              <div class="info-item">\n                <strong>è²¬ä»»è€…</strong>\n                <span class="readonly">${e.engineer||"-"}</span>\n                <input class="editable" value="${e.engineer||""}" />\n              </div>\n            </div>\n            \n            <div class="content-box">\n              <strong>èª¬æ˜</strong>\n              <p class="readonly">${e.problemDescription||e.description||e.incidentTitle||e.title||"èª¬æ˜ãªã—"}</p>\n              <textarea class="editable" rows="4">${e.problemDescription||e.description||e.incidentTitle||e.title||""}</textarea>\n            </div>\n            \n            <div class="content-box">\n              <strong>å‚™è€ƒ</strong>\n              <p class="readonly">${e.notes||"-"}</p>\n              <textarea class="editable" rows="4">${e.notes||""}</textarea>\n            </div>\n          </div>\n          \n          ${t}\n          \n          <div class="section">\n            <h2>ä¿®ç¹•è¨ˆç”»</h2>\n            <div class="info-grid">\n              <div class="info-item">\n                <strong>ä¾é ¼æœˆæ—¥</strong>\n                <span class="readonly">${e.requestDate||"-"}</span>\n                <input class="editable" type="date" value="${e.requestDate||""}" />\n              </div>\n              <div class="info-item">\n                <strong>äºˆå®šæœˆæ—¥</strong>\n                <span class="readonly">${e.repairSchedule||"-"}</span>\n                <input class="editable" type="date" value="${e.repairSchedule||""}" />\n              </div>\n              <div class="info-item">\n                <strong>å ´æ‰€</strong>\n                <span class="readonly">${e.repairLocation||"-"}</span>\n                <input class="editable" value="${e.repairLocation||""}" />\n              </div>\n            </div>\n          </div>\n          \n          <div class="section">\n            <h2>è¨˜äº‹æ¬„</h2>\n            <div class="info-item">\n              <strong>å‚™è€ƒãƒ»è¨˜äº‹</strong>\n              <p class="readonly">${e.remarks||"-"}</p>\n              <textarea class="editable" rows="4" maxlength="200">${e.remarks||""}</textarea>\n            </div>\n          </div>\n          \n          <div class="footer">\n            <p>Â© 2025 æ©Ÿæ¢°æ•…éšœå ±å‘Šæ›¸. All rights reserved.</p>\n          </div>\n        </div>\n        \n        <script>\n          let isEditMode = false;\n          let originalData = {};\n          \n          // ãƒ‡ãƒ¼ã‚¿ã‚’å®‰å…¨ã«è¨­å®šã™ã‚‹é–¢æ•°\n          function setOriginalData(data) {\n            try {\n              originalData = data;\n              console.log('ğŸ”§ originalData set:', originalData);\n            } catch (e) {\n              console.error('originalDataã®è¨­å®šã«å¤±æ•—:', e);\n              originalData = {};\n            }\n          }\n          \n          // ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰èª­ã¿å–ã‚Šï¼‰\n          try {\n            if (window.reportData) {\n              setOriginalData(window.reportData);\n              console.log('ğŸ”§ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ');\n            } else {\n              console.error('ğŸ”§ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°window.reportDataãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n              setOriginalData({});\n            }\n          } catch (e) {\n            console.error('ğŸ”§ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å¤±æ•—:', e);\n            setOriginalData({});\n          }\n          \n          // ç”»åƒè¡¨ç¤ºã®åˆæœŸåŒ–ã¨ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š\n          document.addEventListener('DOMContentLoaded', function() {\n            console.log('ğŸ”§ DOMContentLoaded - Document ready');\n            console.log('ğŸ”§ Available edit elements:');\n            console.log('ğŸ”§ - Readonly elements:', document.querySelectorAll('.readonly').length);\n            console.log('ğŸ”§ - Editable elements:', document.querySelectorAll('.editable').length);\n            console.log('ğŸ”§ - Edit button:', !!document.querySelector('.btn-edit'));\n            console.log('ğŸ”§ Initial CSS classes:', document.body.classList.toString());\n            console.log('ğŸ”§ originalData:', originalData);\n            \n            // åˆæœŸçŠ¶æ…‹ã§ã¯ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚ªãƒ•ã«ã™ã‚‹\n            isEditMode = false;\n            document.body.classList.remove('edit-mode');\n            \n            // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š\n            setupButtonEvents();\n            \n            // è¤‡æ•°å›å®Ÿè¡Œã—ã¦ç¢ºå®Ÿã«è¨­å®š\n            setTimeout(() => {\n              setupButtonEvents();\n            }, 100);\n            \n            setTimeout(() => {\n              setupButtonEvents();\n            }, 500);\n          });\n          \n          // ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹é–¢æ•°\n          function setupButtonEvents() {\n            console.log('ğŸ”§ setupButtonEvents called');\n            \n            // DOMè¦ç´ ã®ç¢ºå®Ÿãªå–å¾—ã®ãŸã‚å°‘ã—å¾…æ©Ÿ\n            setTimeout(() => {\n              const editBtn = document.getElementById('edit-btn');\n              const saveBtn = document.getElementById('save-btn');\n              const cancelBtn = document.getElementById('cancel-btn');\n              \n              console.log('ğŸ”§ ãƒœã‚¿ãƒ³ã®å–å¾—çŠ¶æ³:', {\n                editBtn: !!editBtn,\n                saveBtn: !!saveBtn,\n                cancelBtn: !!cancelBtn\n              });\n              \n              if (editBtn) {\n                console.log('ğŸ”§ Edit button found, setting up event listener');\n                \n                // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚¯ãƒªã‚¢\n                const newEditBtn = editBtn.cloneNode(true);\n                editBtn.parentNode?.replaceChild(newEditBtn, editBtn);\n                \n                // æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ \n                newEditBtn.addEventListener('click', function(e) {\n                  console.log('ğŸ”§ Edit button click event triggered');\n                  e.preventDefault();\n                  e.stopPropagation();\n                  try {\n                    console.log('ğŸ”§ Calling toggleEditMode()...');\n                    toggleEditMode();\n                  } catch (error) {\n                    console.error('ğŸ”§ Error in toggleEditMode:', error);\n                    alert('ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);\n                  }\n                });\n                \n                // ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¨­å®š\n                newEditBtn.style.pointerEvents = 'auto';\n                newEditBtn.style.cursor = 'pointer';\n                newEditBtn.style.backgroundColor = '#007bff';\n                newEditBtn.style.color = 'white';\n                newEditBtn.style.border = '1px solid #007bff';\n                newEditBtn.style.borderRadius = '4px';\n                newEditBtn.style.padding = '8px 16px';\n                newEditBtn.style.fontSize = '14px';\n                \n                console.log('ğŸ”§ Edit button event listener added successfully');\n              } else {\n              console.error('ğŸ”§ Edit button not found!');\n              }\n              \n              if (saveBtn) {\n                const newSaveBtn = saveBtn.cloneNode(true);\n                saveBtn.parentNode?.replaceChild(newSaveBtn, saveBtn);\n                \n                newSaveBtn.addEventListener('click', function(e) {\n                  console.log('ğŸ”§ Save button click event triggered');\n                  e.preventDefault();\n                  e.stopPropagation();\n                  try {\n                    saveReport();\n                  } catch (error) {\n                    console.error('ğŸ”§ Error in saveReport:', error);\n                    alert('ä¿å­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);\n                  }\n                });\n              }\n              \n              if (cancelBtn) {\n                const newCancelBtn = cancelBtn.cloneNode(true);\n                cancelBtn.parentNode?.replaceChild(newCancelBtn, cancelBtn);\n                \n                newCancelBtn.addEventListener('click', function(e) {\n                  console.log('ğŸ”§ Cancel button click event triggered');\n                  e.preventDefault();\n                  e.stopPropagation();\n                  try {\n                    toggleEditMode();\n                  } catch (error) {\n                    console.error('ğŸ”§ Error in toggleEditMode (cancel):', error);\n                  }\n                });\n              }\n              \n              console.log('ğŸ”§ Button event setup complete');\n            }, 200); // DOMè¦ç´ ãŒç¢ºå®Ÿã«å­˜åœ¨ã™ã‚‹ã¾ã§å¾…æ©Ÿ\n          }          function toggleEditMode() {\n            console.log('ğŸ”§ toggleEditMode called, current isEditMode:', isEditMode);\n            console.log('ğŸ”§ Current document body classList before toggle:', document.body.classList.toString());\n            \n            isEditMode = !isEditMode;\n            console.log('ğŸ”§ toggled isEditMode to:', isEditMode);\n            \n            const editBtn = document.getElementById('edit-btn');\n            const cancelBtn = document.getElementById('cancel-btn');\n            const saveBtn = document.getElementById('save-btn');\n            \n            console.log('ğŸ”§ Found buttons:', { editBtn: !!editBtn, cancelBtn: !!cancelBtn, saveBtn: !!saveBtn });\n            \n            if (isEditMode) {\n              console.log('ğŸ”§ Entering edit mode...');\n              \n              // ãƒœã‚¿ãƒ³è¡¨ç¤ºã®å¤‰æ›´\n              if (editBtn) {\n                editBtn.style.display = 'none';\n                console.log('ğŸ”§ Edit button hidden');\n              }\n              if (cancelBtn) {\n                cancelBtn.style.display = 'inline-block';\n                cancelBtn.style.backgroundColor = '#6c757d';\n                cancelBtn.style.color = 'white';\n                cancelBtn.style.border = '1px solid #6c757d';\n                cancelBtn.style.borderRadius = '4px';\n                cancelBtn.style.padding = '8px 16px';\n                cancelBtn.style.fontSize = '14px';\n                cancelBtn.style.cursor = 'pointer';\n                console.log('ğŸ”§ Cancel button shown');\n              }\n              if (saveBtn) {\n                saveBtn.style.display = 'inline-block';\n                saveBtn.style.backgroundColor = '#28a745';\n                saveBtn.style.color = 'white';\n                saveBtn.style.border = '1px solid #28a745';\n                saveBtn.style.borderRadius = '4px';\n                saveBtn.style.padding = '8px 16px';\n                saveBtn.style.fontSize = '14px';\n                saveBtn.style.cursor = 'pointer';\n                console.log('ğŸ”§ Save button shown');\n              }\n              \n              // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ \n              document.body.classList.add('edit-mode');\n              console.log('ğŸ”§ Added edit-mode class, classList:', document.body.classList.toString());\n              \n              // è¦ç´ ã®è¡¨ç¤ºã‚’ç¢ºå®Ÿã«åˆ‡ã‚Šæ›¿ãˆ\n              const readonlyElements = document.querySelectorAll('.readonly');\n              const editableElements = document.querySelectorAll('.editable');\n              \n              console.log('ğŸ”§ Found elements for toggle:', { \n                readonly: readonlyElements.length, \n                editable: editableElements.length \n              });\n              \n              readonlyElements.forEach((el, index) => {\n                el.style.display = 'none !important';\n                el.style.visibility = 'hidden';\n                console.log('ğŸ”§ Hidden readonly element', index);\n              });\n              \n              editableElements.forEach((el, index) => {\n                el.style.display = 'block !important';\n                el.style.visibility = 'visible';\n                // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®èƒŒæ™¯è‰²ã‚’å¤‰æ›´ã—ã¦ç·¨é›†ä¸­ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«ã™ã‚‹\n                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {\n                  el.style.backgroundColor = '#ffffcc';\n                  el.style.border = '2px solid #007bff';\n                  el.removeAttribute('readonly');\n                  el.removeAttribute('disabled');\n                }\n                console.log('ğŸ”§ Shown editable element', index, 'tag:', el.tagName);\n              });\n              \n              // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æ™‚ã«å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¨­å®š\n              setupEditFields();\n              \n              console.log('ğŸ”§ Edit mode setup complete');\n            } else {\n              console.log('ğŸ”§ Exiting edit mode...');\n              \n              // ãƒœã‚¿ãƒ³è¡¨ç¤ºã®å¤‰æ›´\n              if (editBtn) {\n                editBtn.style.display = 'inline-block';\n                console.log('ğŸ”§ Edit button shown');\n              }\n              if (cancelBtn) {\n                cancelBtn.style.display = 'none';\n                console.log('ğŸ”§ Cancel button hidden');\n              }\n              if (saveBtn) {\n                saveBtn.style.display = 'none';\n                console.log('ğŸ”§ Save button hidden');\n              }\n              \n              // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤\n              document.body.classList.remove('edit-mode');\n              console.log('ğŸ”§ Removed edit-mode class, classList:', document.body.classList.toString());\n              \n              // è¦ç´ ã®è¡¨ç¤ºã‚’ç¢ºå®Ÿã«åˆ‡ã‚Šæ›¿ãˆ\n              const readonlyElements = document.querySelectorAll('.readonly');\n              const editableElements = document.querySelectorAll('.editable');\n              \n              readonlyElements.forEach((el, index) => {\n                el.style.display = 'inline';\n                el.style.visibility = 'visible';\n                console.log('ğŸ”§ Shown readonly element', index);\n              });\n              \n              editableElements.forEach((el, index) => {\n                el.style.display = 'none !important';\n                el.style.visibility = 'hidden';\n                console.log('ğŸ”§ Hidden editable element', index);\n              });\n              \n              // ç·¨é›†å†…å®¹ã‚’å…ƒã«æˆ»ã™\n              resetToOriginal();\n              \n              console.log('ğŸ”§ Read-only mode setup complete');\n            }\n          }\n                console.log('ğŸ”§ Save button hidden');\n              }\n              \n              // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤\n              document.body.classList.remove('edit-mode');\n              console.log('ğŸ”§ Removed edit-mode class, classList:', document.body.classList.toString());\n              \n              // è¦ç´ ã®è¡¨ç¤ºã‚’å¼·åˆ¶çš„ã«åˆ‡ã‚Šæ›¿ãˆ\n              readonlyElements.forEach((el, index) => {\n                el.style.display = 'inline';\n                el.style.visibility = 'visible';\n                console.log('ğŸ”§ Shown readonly element', index);\n              });\n              \n              editableElements.forEach((el, index) => {\n                el.style.display = 'none';\n                el.style.visibility = 'hidden';\n                console.log('ğŸ”§ Hidden editable element', index);\n              });\n              \n              // ç·¨é›†å†…å®¹ã‚’å…ƒã«æˆ»ã™\n              resetToOriginal();\n              \n              console.log('ğŸ”§ Read-only mode setup complete');\n            }\n          }\n          \n          // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§ã‚‚åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹\n          window.toggleEditMode = toggleEditMode;\n          \n          // ãƒšãƒ¼ã‚¸ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ã‚‚ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’å†è¨­å®š\n          window.addEventListener('load', function() {\n            console.log('ğŸ”§ Window load event - page fully loaded');\n            setTimeout(() => {\n              setupButtonEvents();\n            }, 500);\n          });\n          \n          function setupEditFields() {\n            console.log('ğŸ”§ setupEditFields called');\n            // å„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«é©åˆ‡ãªå€¤ã‚’è¨­å®š\n            const inputs = document.querySelectorAll('input.editable');\n            const textareas = document.querySelectorAll('textarea.editable');\n            \n            console.log('ğŸ”§ Found inputs:', inputs.length, 'textareas:', textareas.length);\n            \n            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¨­å®š\n            inputs.forEach((input, index) => {\n              console.log('ğŸ”§ Setting up input', index, input);\n              if (index === 0) input.value = originalData.reportId || originalData.id || '';\n              if (index === 1) input.value = originalData.machineType || originalData.machineTypeName || '';\n              if (index === 2) input.value = originalData.machineNumber || '';\n              if (index === 3) {\n                const dateValue = originalData.date || originalData.timestamp || originalData.createdAt;\n                if (dateValue) {\n                  const date = new Date(dateValue);\n                  input.value = date.toISOString().split('T')[0];\n                }\n              }\n              if (index === 4) input.value = originalData.location || '';\n              if (index === 5) input.value = originalData.status || '';\n              if (index === 6) input.value = originalData.engineer || '';\n              if (index === 7) input.value = originalData.requestDate || '';\n              if (index === 8) input.value = originalData.repairSchedule || '';\n              if (index === 9) input.value = originalData.repairLocation || '';\n            });\n            \n            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å€¤ã‚’è¨­å®š\n            textareas.forEach((textarea, index) => {\n              if (index === 0) {\n                textarea.value = originalData.problemDescription || originalData.description || originalData.incidentTitle || originalData.title || '';\n              }\n              if (index === 1) {\n                textarea.value = originalData.notes || '';\n              }\n            });\n          }\n          \n          function resetToOriginal() {\n            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…ƒã®å€¤ã«æˆ»ã™\n            setupEditFields();\n          }\n          \n          async function saveReport() {\n            console.log('ä¿å­˜å‡¦ç†é–‹å§‹');\n            console.log('originalData:', originalData);\n            console.log('originalData.id:', originalData.id);\n            console.log('originalData.chatId:', originalData.chatId);\n            console.log('originalData.reportId:', originalData.reportId);\n            console.log('originalData.fileName:', originalData.fileName);\n            \n            // ç·¨é›†ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’åé›†\n            const updatedData = { ...originalData };\n            \n            // å„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰å€¤ã‚’å–å¾—\n            const inputs = document.querySelectorAll('input.editable');\n            const textareas = document.querySelectorAll('textarea.editable');\n            \n            console.log('å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•°:', inputs.length);\n            console.log('ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢æ•°:', textareas.length);\n            \n            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’å–å¾—\n            inputs.forEach((input, index) => {\n              if (index === 0) updatedData.reportId = input.value;\n              if (index === 1) updatedData.machineType = input.value;\n              if (index === 2) updatedData.machineNumber = input.value;\n              if (index === 3) updatedData.date = input.value;\n              if (index === 4) updatedData.location = input.value;\n              if (index === 5) updatedData.status = input.value;\n              if (index === 6) updatedData.engineer = input.value;\n              if (index === 7) updatedData.requestDate = input.value;\n              if (index === 8) updatedData.repairSchedule = input.value;\n              if (index === 9) updatedData.repairLocation = input.value;\n            });\n            \n            // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å€¤ã‚’å–å¾—\n            textareas.forEach((textarea, index) => {\n              if (index === 0) {\n                updatedData.problemDescription = textarea.value;\n              }\n              if (index === 1) {\n                updatedData.notes = textarea.value;\n              }\n            });\n            \n            console.log('æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿:', updatedData);\n            console.log('ä½¿ç”¨ã™ã‚‹chatId:', updatedData.chatId || updatedData.id);\n            \n            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜\n            localStorage.setItem('savedMachineFailureReport_' + updatedData.id, JSON.stringify(updatedData));\n            \n            // å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ï¼ˆè¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å±¥æ­´ä¸€è¦§è¡¨ã‚’æ›´æ–°ï¼‰\n            try {\n              if (window.opener && !window.opener.closed) {\n                // è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n                window.opener.postMessage({\n                  type: 'UPDATE_HISTORY_ITEM',\n                  data: updatedData\n                }, '*');\n                \n                // è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚‚æ›´æ–°\n                try {\n                  const parentStorage = window.opener.localStorage;\n                  const historyKey = 'savedMachineFailureReport_' + updatedData.id;\n                  parentStorage.setItem(historyKey, JSON.stringify(updatedData));\n                } catch (storageError) {\n                  console.warn('è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ›´æ–°ã«å¤±æ•—:', storageError);\n                }\n              }\n            } catch (error) {\n              console.warn('è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¸ã®é€šçŸ¥ã«å¤±æ•—:', error);\n            }\n            \n            // å…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n            originalData = updatedData;\n            \n            // UIã‚’æ›´æ–°\n            updateUIAfterSave(updatedData);\n            \n            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†\n            toggleEditMode();\n            \n            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\n            alert('ãƒ¬ãƒãƒ¼ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚‚æ›´æ–°ã•ã‚Œã¾ã™ã€‚');\n            \n            // ã‚µãƒ¼ãƒãƒ¼ã¸ã®ä¿å­˜ã‚‚è©¦è¡Œ\n            try {\n              await saveToJsonFile(updatedData);\n            } catch (error) {\n              console.warn('ã‚µãƒ¼ãƒãƒ¼ã¸ã®ä¿å­˜ã¯å¤±æ•—ã—ã¾ã—ãŸãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ã«ã¯ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™:', error);\n            }\n          }\n          \n          async function saveToJsonFile(updatedData) {\n            try {\n              console.log('ã‚µãƒ¼ãƒãƒ¼ã¸ã®ä¿å­˜é–‹å§‹:', updatedData);\n              \n              // æ­£ã—ã„IDã‚’å–å¾—\n              let targetId = originalData.id || originalData.chatId || originalData.reportId;\n              \n              // IDãŒå–å¾—ã§ããªã„å ´åˆã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰UUIDã‚’æŠ½å‡º\n              if (!targetId && originalData.fileName) {\n                console.log('ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰UUIDæŠ½å‡ºã‚’è©¦è¡Œ:', originalData.fileName);\n                \n                // UUIDãƒ‘ã‚¿ãƒ¼ãƒ³1: æ¨™æº–çš„ãªUUIDå½¢å¼\n                let fileNameMatch = originalData.fileName.match(/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})/);\n                \n                if (fileNameMatch) {\n                  targetId = fileNameMatch[1];\n                  console.log('æ¨™æº–UUIDã‹ã‚‰æŠ½å‡ºã—ãŸID:', targetId);\n                } else {\n                  // UUIDãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢åŒºåˆ‡ã‚Šã®UUID\n                  fileNameMatch = originalData.fileName.match(/_([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})/);\n                  if (fileNameMatch) {\n                    targetId = fileNameMatch[1];\n                    console.log('ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢åŒºåˆ‡ã‚ŠUUIDã‹ã‚‰æŠ½å‡ºã—ãŸID:', targetId);\n                  }\n                }\n              }\n              \n              if (!targetId) {\n                console.error('å¯¾è±¡IDãŒç‰¹å®šã§ãã¾ã›ã‚“:', originalData);\n                throw new Error('å¯¾è±¡IDãŒç‰¹å®šã§ãã¾ã›ã‚“');\n              }\n              \n              console.log('ä¿å­˜å¯¾è±¡ID:', targetId);\n              \n              // æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™\n              const updatePayload = {\n                updatedData: updatedData,\n                updatedBy: 'user'\n              };\n              \n              console.log('é€ä¿¡ã™ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰:', updatePayload);\n              \n              // ã‚µãƒ¼ãƒãƒ¼APIã‚’å‘¼ã³å‡ºã—ã¦å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°\n              const response = await fetch('/api/history/update-item/' + targetId, {\n                method: 'PUT',\n                headers: {\n                  'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(updatePayload)\n              });\n              \n              console.log('ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response.status, response.statusText);\n              console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼:', Object.fromEntries(response.headers.entries()));\n              \n              if (response.ok) {\n                const result = await response.json();\n                console.log('å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ:', result);\n                \n                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\n                alert('ãƒ¬ãƒãƒ¼ãƒˆãŒå…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã«æ­£å¸¸ã«ä¸Šæ›¸ãä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚');\n                \n                return result;\n              } else {\n                const errorData = await response.json();\n                console.error('ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼:', errorData);\n                throw new Error(errorData.error || 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: ' + response.status);\n              }\n              \n            } catch (error) {\n              console.error('JSONãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);\n              throw error;\n            }\n          }\n                    engineer: updatedData.engineer,\n                    location: updatedData.location,\n                    requestDate: updatedData.requestDate,\n                    repairSchedule: updatedData.repairSchedule,\n                    repairLocation: updatedData.repairLocation,\n                    lastModified: new Date().toISOString()\n                  },\n                  updatedBy: 'user'\n                })\n              });\n              \n              console.log('ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response.status, response.statusText);\n              console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼:', Object.fromEntries(response.headers.entries()));\n              \n              if (response.ok) {\n                try {\n                  const result = await response.json();\n                  console.log('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸ:', result);\n                  \n                  // ä¿å­˜æˆåŠŸå¾Œã®å‡¦ç†\n                  updateUIAfterSave(updatedData);\n                  \n                  // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º\n                  alert('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚');\n                } catch (parseError) {\n                  console.warn('ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸãŒã€ä¿å­˜ã¯æˆåŠŸã—ã¦ã„ã¾ã™:', parseError);\n                  updateUIAfterSave(updatedData);\n                  alert('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸã€‚');\n                }\n              } else {\n                let errorMessage = 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼';\n                try {\n                  // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®Content-Typeã‚’ç¢ºèª\n                  const contentType = response.headers.get('content-type');\n                  if (contentType && contentType.includes('application/json')) {\n                    const errorData = await response.json();\n                    console.error('ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹è©³ç´°:', errorData);\n                    if (errorData.error) {\n                      errorMessage = errorData.error;\n                    } else if (errorData.message) {\n                      errorMessage = errorData.message;\n                    } else {\n                      errorMessage = 'HTTP ' + response.status + ': ' + response.statusText;\n                    }\n                  } else {\n                    // HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆ\n                    const textResponse = await response.text();\n                    console.error('HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹:', textResponse.substring(0, 200));\n                    errorMessage = 'HTTP ' + response.status + ': ' + response.statusText + ' (HTMLãƒ¬ã‚¹ãƒãƒ³ã‚¹)';\n                  }\n                } catch (parseError) {\n                  console.error('ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æã«å¤±æ•—:', parseError);\n                  errorMessage = 'HTTP ' + response.status + ': ' + response.statusText;\n                }\n                \n                console.error('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ:', errorMessage);\n                alert('å±¥æ­´ã‚¢ã‚¤ãƒ†ãƒ ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + errorMessage);\n              }\n            } catch (error) {\n              console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);\n              console.error('ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯:', error.stack);\n              alert('ä¿å­˜ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);\n            }\n          }\n          \n          function updateUIAfterSave(updatedData) {\n            // ä¿å­˜å¾Œã«UIã‚’æ›´æ–°\n            const readonlyElements = document.querySelectorAll('.readonly');\n            \n            // å ±å‘Šæ›¸ID\n            if (readonlyElements[0]) {\n              readonlyElements[0].textContent = (updatedData.reportId || updatedData.id || '').substring(0, 8) + '...';\n            }\n            \n            // æ©Ÿç¨®\n            if (readonlyElements[1]) {\n              readonlyElements[1].textContent = updatedData.machineType || updatedData.machineTypeName || '-';\n            }\n            \n            // æ©Ÿæ¢°ç•ªå·\n            if (readonlyElements[2]) {\n              readonlyElements[2].textContent = updatedData.machineNumber || '-';\n            }\n            \n            // æ—¥ä»˜\n            if (readonlyElements[3]) {\n              const dateValue = updatedData.date || updatedData.timestamp || updatedData.createdAt;\n              if (dateValue) {\n                const date = new Date(dateValue);\n                readonlyElements[3].textContent = date.toLocaleDateString('ja-JP');\n              } else {\n                readonlyElements[3].textContent = '-';\n              }\n            }\n            \n            // å ´æ‰€\n            if (readonlyElements[4]) {\n              readonlyElements[4].textContent = updatedData.location || '-';\n            }\n            \n            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹\n            if (readonlyElements[5]) {\n              readonlyElements[5].textContent = updatedData.status || '-';\n            }\n            \n            // è²¬ä»»è€…\n            if (readonlyElements[6]) {\n              readonlyElements[6].textContent = updatedData.engineer || '-';\n            }\n            \n            // èª¬æ˜\n            if (readonlyElements[7]) {\n              readonlyElements[7].textContent = updatedData.problemDescription || updatedData.description || updatedData.incidentTitle || updatedData.title || 'èª¬æ˜ãªã—';\n            }\n            \n            // å‚™è€ƒ\n            if (readonlyElements[8]) {\n              readonlyElements[8].textContent = updatedData.notes || '-';\n            }\n            \n            // ä¾é ¼æœˆæ—¥\n            if (readonlyElements[9]) {\n              readonlyElements[9].textContent = updatedData.requestDate || '-';\n            }\n            \n            // äºˆå®šæœˆæ—¥\n            if (readonlyElements[10]) {\n              readonlyElements[10].textContent = updatedData.repairSchedule || '-';\n            }\n            \n            // ä¿®ç¹•å ´æ‰€\n            if (readonlyElements[11]) {\n              readonlyElements[11].textContent = updatedData.repairLocation || '-';\n            }\n          }\n        <\/script>\n      </body>\n      </html>\n    `})(me.jsonData);console.log("ğŸ–¨ï¸ ç”Ÿæˆã•ã‚ŒãŸHTMLã®é•·ã•:",e.length);const n=window.open("","_blank","width=1200,height=800");n?(n.document.write(e),n.document.close(),n.onload=()=>{console.log("âœ… ç·¨é›†ç”»é¢ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ"),n.focus(),setTimeout(()=>{n.print(),console.log("âœ… å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ")},1e3)}):alert("å°åˆ·ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’ç„¡åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚")},className:"flex items-center gap-2",children:[l.jsx(B,{className:"h-4 w-4"}),"å°åˆ·"]}),l.jsx(n,{variant:"outline",onClick:()=>{console.log("ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™"),xe(!1),he(null)},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"})]})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[l.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(o,{className:"h-5 w-5"}),"åŸºæœ¬æƒ…å ±"]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"æ©Ÿç¨®"}),l.jsxs(g,{value:me.machineType||"",onValueChange:e=>{console.log("æ©Ÿç¨®ã‚’å¤‰æ›´:",e),he({...me,machineType:e,jsonData:{...me.jsonData,machineType:e}})},children:[l.jsx(u,{children:l.jsx(x,{placeholder:me.machineType?me.machineType:"æ©Ÿç¨®ã‚’é¸æŠ"})}),l.jsxs(b,{children:[me.machineType&&l.jsxs(v,{value:me.machineType,children:[me.machineType," (ç¾åœ¨ã®å€¤)"]}),Je?l.jsx(v,{value:"loading",disabled:!0,children:"ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­..."}):(null==(t=null==(e=Le.machineTypes)?void 0:e.filter(e=>(null==e?void 0:e.machineTypeName)&&e.machineTypeName!==me.machineType))?void 0:t.map(e=>l.jsx(v,{value:e.machineTypeName||"",children:e.machineTypeName||"ä¸æ˜"},e.id||`machine-type-${Date.now()}-${Math.random()}`)))||[]]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"æ©Ÿæ¢°ç•ªå·"}),l.jsxs(g,{value:me.machineNumber||"",onValueChange:e=>{console.log("æ©Ÿæ¢°ç•ªå·ã‚’å¤‰æ›´:",e),he({...me,machineNumber:e,jsonData:{...me.jsonData,machineNumber:e}})},children:[l.jsx(u,{children:l.jsx(x,{placeholder:me.machineNumber?me.machineNumber:"æ©Ÿæ¢°ç•ªå·ã‚’é¸æŠ"})}),l.jsxs(b,{children:[me.machineNumber&&l.jsxs(v,{value:me.machineNumber,children:[me.machineNumber," (ç¾åœ¨ã®å€¤)"]}),Je?l.jsx(v,{value:"loading",disabled:!0,children:"ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­..."}):(null==(N=null==(a=Le.machines)?void 0:a.filter(e=>(null==e?void 0:e.machineNumber)&&(null==e?void 0:e.machineTypeName)&&(!me.machineType||e.machineTypeName===me.machineType)&&e.machineNumber!==me.machineNumber))?void 0:N.map(e=>l.jsxs(v,{value:e.machineNumber||"",children:[e.machineNumber||"ä¸æ˜"," (",e.machineTypeName||"ä¸æ˜",")"]},e.id||`machine-${Date.now()}-${Math.random()}`)))||[]]})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"ãƒ•ã‚¡ã‚¤ãƒ«å"}),l.jsx(p,{value:me.fileName||"",onChange:e=>{console.log("ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å¤‰æ›´:",e.target.value),he({...me,fileName:e.target.value})},placeholder:"ãƒ•ã‚¡ã‚¤ãƒ«å",disabled:!0})]})]})]}),l.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[l.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(i,{className:"h-5 w-5"}),"äº‹è±¡ãƒ»èª¬æ˜"]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«"}),l.jsx(p,{value:(null==(D=me.jsonData)?void 0:D.title)||(null==(w=me.jsonData)?void 0:w.question)||"",onChange:e=>{console.log("äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´:",e.target.value),he({...me,jsonData:{...me.jsonData,title:e.target.value,question:e.target.value}})},placeholder:"äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›"}),(()=>{var e,n,t,a;const s=(null==(e=me.jsonData)?void 0:e.title)||(null==(n=me.jsonData)?void 0:n.question)||"";return console.log("ğŸ” äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ« - è¡¨ç¤ºå€¤:",s),console.log("ğŸ” äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ« - jsonData.title:",null==(t=me.jsonData)?void 0:t.title),console.log("ğŸ” äº‹è±¡ã‚¿ã‚¤ãƒˆãƒ« - jsonData.question:",null==(a=me.jsonData)?void 0:a.question),null})()]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"äº‹è±¡èª¬æ˜"}),l.jsx("textarea",{value:(null==(I=me.jsonData)?void 0:I.problemDescription)||(null==(M=me.jsonData)?void 0:M.answer)||"",onChange:e=>{console.log("äº‹è±¡èª¬æ˜ã‚’å¤‰æ›´:",e.target.value),he({...me,jsonData:{...me.jsonData,problemDescription:e.target.value,answer:e.target.value}})},className:"w-full h-24 p-3 border border-gray-300 rounded-md",placeholder:"äº‹è±¡ã®è©³ç´°èª¬æ˜ã‚’å…¥åŠ›"})]})]})]}),(()=>{const e=nn(me);return e?l.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[l.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(S,{className:"h-5 w-5"}),"æ•…éšœå€‹æ‰€ã®ç”»åƒ"]}),l.jsxs("div",{className:"text-center",children:[l.jsx("img",{src:e,alt:"æ•…éšœç”»åƒ",className:"max-w-full max-h-64 mx-auto border border-gray-300 rounded-md shadow-sm"}),l.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:["æ•…éšœç®‡æ‰€ã®ç”»åƒ"," ",e.startsWith("data:image/")?"(Base64)":"(URL)"]})]})]}):null})(),l.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[l.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(k,{className:"h-5 w-5"}),"ä¿®ç¹•è¨ˆç”»"]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"ä¿®ç¹•äºˆå®šæœˆæ—¥"}),l.jsx(p,{type:"date",value:(null==(L=me.jsonData)?void 0:L.repairSchedule)||"",onChange:e=>{he({...me,jsonData:{...me.jsonData,repairSchedule:e.target.value}})},placeholder:"ä¿®ç¹•äºˆå®šæœˆæ—¥"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"å ´æ‰€"}),l.jsx(p,{value:(null==(z=me.jsonData)?void 0:z.location)||"",onChange:e=>{he({...me,jsonData:{...me.jsonData,location:e.target.value}})},placeholder:"è¨­ç½®å ´æ‰€"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"}),l.jsxs(g,{value:(null==(_=me.jsonData)?void 0:_.status)||"",onValueChange:e=>{he({...me,jsonData:{...me.jsonData,status:e}})},children:[l.jsx(u,{children:l.jsx(x,{placeholder:"ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é¸æŠ"})}),l.jsxs(b,{children:[l.jsx(v,{value:"å ±å‘Šæ¸ˆã¿",children:"å ±å‘Šæ¸ˆã¿"}),l.jsx(v,{value:"å¯¾å¿œä¸­",children:"å¯¾å¿œä¸­"}),l.jsx(v,{value:"å®Œäº†",children:"å®Œäº†"}),l.jsx(v,{value:"ä¿ç•™",children:"ä¿ç•™"})]})]})]})]})]}),l.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[l.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[l.jsx(i,{className:"h-5 w-5"}),"è¨˜äº‹æ¬„"]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-sm font-medium mb-2",children:"å‚™è€ƒãƒ»è¨˜äº‹ (200æ–‡å­—ä»¥å†…)"}),l.jsx("textarea",{value:(null==(P=me.jsonData)?void 0:P.remarks)||"",onChange:e=>{e.target.value.length<=200&&he({...me,jsonData:{...me.jsonData,remarks:e.target.value}})},className:"w-full h-24 p-3 border border-gray-300 rounded-md",placeholder:"ä¿®ç¹•ã«é–¢ã™ã‚‹å‚™è€ƒã‚„è¿½åŠ æƒ…å ±ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ï¼ˆ200æ–‡å­—ä»¥å†…ï¼‰",maxLength:200}),l.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(null==(U=null==(H=me.jsonData)?void 0:H.remarks)?void 0:U.length)||0,"/200æ–‡å­—"]})]})]}),l.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[l.jsx(n,{variant:"outline",onClick:()=>{console.log("ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™"),xe(!1),he(null)},children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),l.jsx(n,{onClick:()=>{console.log("ç·¨é›†ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã™:",me),en(me)},className:"bg-green-600 hover:bg-green-700 text-white",children:"ä¿å­˜ã—ã¦é©ç”¨"})]})]})]})})}),ye.show&&l.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:l.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full mx-4",children:[l.jsx("h3",{className:"text-lg font-semibold mb-4 text-red-600",children:"å±¥æ­´å‰Šé™¤ã®ç¢ºèª"}),l.jsx("p",{className:"text-gray-700 mb-6",children:"ä»¥ä¸‹ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚"}),l.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-6",children:l.jsx("p",{className:"font-medium text-sm text-gray-800",children:ye.title})}),l.jsxs("div",{className:"flex justify-end gap-3",children:[l.jsx(n,{variant:"outline",onClick:()=>fe({show:!1,id:"",title:""}),children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),l.jsx(n,{variant:"destructive",onClick:()=>(async e=>{try{G(!0),await j(e),await We(ne),fe({show:!1,id:"",title:""})}catch(n){console.error("å±¥æ­´å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",n),alert("å±¥æ­´ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚")}finally{G(!1)}})(ye.id),className:"bg-red-600 hover:bg-red-700",children:"å‰Šé™¤ã™ã‚‹"})]})]})}),Te&&Se&&l.jsx(A,{data:Se,fileName:Ee,onClose:()=>{Ie(!1),$e(null),Ce(""),re(!1)},onSave:e=>{console.log("ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜:",e);const n=JSON.parse(localStorage.getItem("savedReports")||"[]"),t={id:Date.now(),fileName:Ee,reportData:e,savedAt:(new Date).toISOString()};n.push(t),localStorage.setItem("savedReports",JSON.stringify(n)),console.log("ãƒ¬ãƒãƒ¼ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ:",t)},onPrint:e=>{console.log("ãƒãƒ£ãƒƒãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’å°åˆ·:",e),window.print()}})]});var tn,an};
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{L as default};
