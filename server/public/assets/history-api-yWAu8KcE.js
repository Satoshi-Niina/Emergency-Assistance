import{h as e}from"./index-Dya0PsiY.js";const a=async(e={})=>{try{const[a,o]=await Promise.allSettled([t(e),i(e)]);let n=[];if("fulfilled"===a.status&&a.value.items&&(n=[...n,...a.value.items]),"fulfilled"===o.status&&o.value.data){const e=o.value.data.map(r);n=[...n,...e]}n.sort((e,a)=>new Date(a.createdAt).getTime()-new Date(e.createdAt).getTime());const s=e.limit||20,c=e.offset||0;return{items:n.slice(c,c+s),total:n.length,hasMore:c+s<n.length}}catch(a){return console.error("履歴一覧取得エラー:",a),{items:[],total:0,hasMore:!1}}},t=async(a={})=>{const t=new URLSearchParams;a.machineType&&t.append("machineType",a.machineType),a.machineNumber&&t.append("machineNumber",a.machineNumber),a.searchText&&t.append("searchText",a.searchText),a.searchDate&&t.append("searchDate",a.searchDate),a.limit&&t.append("limit",a.limit.toString()),a.offset&&t.append("offset",a.offset.toString());const i=await e(`/history?${t.toString()}`);return i.ok?i.json():{items:[],total:0,hasMore:!1}},i=async a=>await(async(a={})=>{const t=new URLSearchParams;a.limit&&t.append("limit",a.limit.toString()),a.offset&&t.append("offset",a.offset.toString()),a.machineType&&t.append("machineType",a.machineType),a.machineNumber&&t.append("machineNumber",a.machineNumber),a.category&&t.append("category",a.category),a.office&&t.append("office",a.office),a.keyword&&t.append("keyword",a.keyword);const i=await e(`/fault-history?${t.toString()}`);if(!i.success)throw new Error(i.error||"故障履歴の取得に失敗しました");return i})({machineType:a.machineType,machineNumber:a.machineNumber,keyword:a.searchText,limit:a.limit,offset:a.offset}),r=e=>{const a=e.images&&e.images.length>0?(t=e.images[0].fileName,`${window.location.origin}/api/fault-history/images/${t}`):void 0;var t;return{id:e.id,machineType:e.machineType||"",machineNumber:e.machineNumber||"",title:e.title,jsonData:{...e.jsonData,title:e.title,problemDescription:e.description,machineType:e.machineType,machineNumber:e.machineNumber,metadata:{office:e.office,category:e.category,keywords:e.keywords,source:"fault-history-db"}},imagePath:a,imageUrl:a,createdAt:e.createdAt,source:"fault-history-db"}},o=async a=>{const t=await e(`/history/${a}`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to delete history: ${t.statusText}`)},n=async()=>await e("/base-data"),s=async()=>await e("/files/processed"),c=async(a,t="json")=>await e("/history/export-selected",{method:"POST",body:JSON.stringify({ids:a,format:t})}),m=async(a={},t="json")=>{const i=new URLSearchParams;i.append("format",t),a.machineType&&i.append("machineType",a.machineType),a.machineNumber&&i.append("machineNumber",a.machineNumber);const r=await e(`/history/export-all?${i.toString()}`);if(!r.ok)throw new Error(`Failed to export all history: ${r.statusText}`);return r.blob()};export{m as a,a as b,s as c,o as d,c as e,n as f};
