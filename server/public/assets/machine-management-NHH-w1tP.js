import{j as e}from"./ui-BaYWhfWe.js";import{r as s}from"./vendor-C0Yfakdp.js";import{d as a,u as t,f as i,W as r,L as l,B as n,S as c}from"./index-D2n-Q-xG.js";import{C as h,c as o,a as d,b as m}from"./card-BqBfUk46.js";import{I as x}from"./input-00qY0QlV.js";import{L as j}from"./label-qry_Omxz.js";import{T as p,a as u,b as f,c as y,d as v,e as g}from"./table-EtJb2mgy.js";import{D as b,f as N,a as w,c as _,b as S,d as C,e as k}from"./dialog-Bw18cmE_.js";import{S as E,a as $,b as T,c as O,d as P}from"./select-Bs3DYrHv.js";import{A as L}from"./arrow-left-D75JwTss.js";import{P as A}from"./plus-C0XIaw8e.js";import{S as z}from"./square-pen-C1Ze8l06.js";import{T as I}from"./trash-2-CafAc5T9.js";import{S as J}from"./search-miAxG7GE.js";import"./index-jVOyRz7F.js";import"./index-CttfQz0H.js";import"./check-DcRucpBf.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=a("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function F(){const{user:a,isLoading:F}=t(),{toast:U}=i(),[V,q]=s.useState(!0),[B,H]=s.useState(null),[K,M]=s.useState([]),[W,G]=s.useState([]),[Q,R]=s.useState([]),[X,Y]=s.useState(""),[Z,ee]=s.useState("all"),[se,ae]=s.useState(!1),[te,ie]=s.useState(!1),[re,le]=s.useState(null),[ne,ce]=s.useState(null),[he,oe]=s.useState(""),[de,me]=s.useState(""),[xe,je]=s.useState("");s.useEffect(()=>{F||a||(window.location.href="/chat")},[a,F]),s.useEffect(()=>{pe()},[]),s.useEffect(()=>{let e=W;X.trim()&&(e=e.filter(e=>e.machine_number.toLowerCase().includes(X.toLowerCase())||e.machine_type_name&&e.machine_type_name.toLowerCase().includes(X.toLowerCase()))),"all"!==Z&&(e=e.filter(e=>e.machine_type_id===Z)),R(e)},[W,X,Z]);const pe=async()=>{try{const e="http://localhost:8000/api";q(!0),H(null);const s=await fetch(`${e}/machines/machine-types`),a=s.headers.get("content-type")||"";if(!s.ok||!a.includes("application/json")){const e=await s.text();throw console.error("APIレスポンス非JSON:",s.status,a,e.slice(0,200)),new Error("API非JSON: "+s.status+" "+a)}const t=await s.json();t.success&&M(t.data);const i=await fetch(`${e}/machines/all-machines`),r=i.headers.get("content-type")||"";if(!i.ok||!r.includes("application/json")){const e=await i.text();throw console.error("APIレスポンス非JSON:",i.status,r,e.slice(0,200)),new Error("API非JSON: "+i.status+" "+r)}const l=await i.json();if(l.success){const e=[];l.data.forEach(s=>{s.machines&&Array.isArray(s.machines)&&s.machines.forEach(a=>{e.push({id:a.id,machine_number:a.machine_number,machine_type_id:s.type_id,machine_type_name:s.machine_type_name})})}),G(e)}}catch(e){console.error("データ取得エラー:",e),H(e instanceof Error?e:new Error("Unknown error")),U({title:"エラー",description:"データの取得に失敗しました",variant:"destructive"})}finally{q(!1)}},ue=()=>{le(null),oe(""),ae(!1)},fe=()=>{ce(null),me(""),je(""),ie(!1)};return F||V?e.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 max-w-7xl mx-auto w-full bg-gradient-to-br from-blue-50 to-indigo-50",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-blue-600",children:"読み込み中..."})]})})}):e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 max-w-7xl mx-auto w-full bg-gradient-to-br from-blue-50 to-indigo-50",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[e.jsx(r,{className:"mr-2 h-6 w-6 text-indigo-500"}),"機種・機械番号管理"]}),e.jsx("p",{className:"text-blue-400",children:"機種と機械番号の一覧表示、追加、編集、削除ができます"})]}),e.jsx(l,{to:"/settings",children:e.jsxs(n,{variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-50",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"設定に戻る"]})})]})}),B&&e.jsx(h,{className:"mb-6 border-red-200 bg-red-50",children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"text-red-600",children:[e.jsx("p",{className:"font-medium",children:"エラーが発生しました"}),e.jsx("p",{className:"text-sm",children:B.message})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(h,{className:"lg:col-span-1",children:[e.jsx(d,{className:"pb-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white",children:e.jsxs(m,{className:"text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(c,{className:"mr-2 h-5 w-5"}),"機種管理"]}),e.jsxs(b,{open:se,onOpenChange:ae,children:[e.jsx(N,{asChild:!0,children:e.jsxs(n,{size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-white/30",onClick:ue,children:[e.jsx(A,{className:"mr-1 h-3 w-3"}),"追加"]})}),e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsx(S,{children:re?"機種を編集":"新規機種追加"}),e.jsx(C,{children:re?"機種名を編集してください":"新しい機種名を入力してください"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx(j,{htmlFor:"type-name",children:"機種名"}),e.jsx(x,{id:"type-name",value:he,onChange:e=>oe(e.target.value),placeholder:"機種名を入力"})]})}),e.jsxs(k,{children:[e.jsx(n,{variant:"outline",onClick:ue,children:"キャンセル"}),e.jsx(n,{onClick:async()=>{if(he.trim())try{const e=re?`http://localhost:8000/api/machines/machine-types/${re.id}`:"http://localhost:8000/api/machines/machine-types",s=re?"PUT":"POST";if(!(await fetch(e,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify({machine_type_name:he.trim()})})).ok)throw new Error("機種の保存に失敗しました");U({title:re?"機種を更新しました":"機種を追加しました",description:`${he} が正常に処理されました`}),oe(""),le(null),ae(!1),pe()}catch(e){console.error("機種保存エラー:",e),U({title:"エラー",description:"機種の保存に失敗しました",variant:"destructive"})}},children:re?"更新":"追加"})]})]})]})]})}),e.jsx(o,{className:"p-0",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===K.length?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"機種が登録されていません"}):e.jsx("div",{className:"divide-y",children:K.map(s=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.machine_type_name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[W.filter(e=>e.machine_type_id===s.id).length,"台の機械"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(e=>{le(e),oe(e.machine_type_name),ae(!0)})(s),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:e.jsx(z,{className:"h-3 w-3"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(async(e,s)=>{if(confirm(`機種「${s}」を削除してもよろしいですか？\n関連する機械番号も削除されます。`))try{if(!(await fetch(`http://localhost:8000/api/machines/machine-types/${e}`,{method:"DELETE"})).ok)throw new Error("機種の削除に失敗しました");U({title:"機種を削除しました",description:`${s} と関連する機械番号が削除されました`}),pe()}catch(a){console.error("機種削除エラー:",a),U({title:"エラー",description:"機種の削除に失敗しました",variant:"destructive"})}})(s.id,s.machine_type_name),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(I,{className:"h-3 w-3"})})]})]})},s.id))})})})]}),e.jsxs(h,{className:"lg:col-span-2",children:[e.jsx(d,{className:"pb-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white",children:e.jsxs(m,{className:"text-lg flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(D,{className:"mr-2 h-5 w-5"}),"機械番号管理"]}),e.jsxs(b,{open:te,onOpenChange:ie,children:[e.jsx(N,{asChild:!0,children:e.jsxs(n,{size:"sm",className:"bg-white/20 hover:bg-white/30 text-white border-white/30",onClick:fe,children:[e.jsx(A,{className:"mr-1 h-3 w-3"}),"追加"]})}),e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsx(S,{children:ne?"機械番号を編集":"新規機械番号追加"}),e.jsx(C,{children:ne?"機械番号を編集してください":"新しい機械番号を入力してください"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"machine-type",children:"機種"}),e.jsxs(E,{value:xe,onValueChange:je,children:[e.jsx($,{children:e.jsx(T,{placeholder:"機種を選択"})}),e.jsx(O,{children:K.map(s=>e.jsx(P,{value:s.id,children:s.machine_type_name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"machine-number",children:"機械番号"}),e.jsx(x,{id:"machine-number",value:de,onChange:e=>me(e.target.value),placeholder:"機械番号を入力"})]})]}),e.jsxs(k,{children:[e.jsx(n,{variant:"outline",onClick:fe,children:"キャンセル"}),e.jsx(n,{onClick:async()=>{if(de.trim()&&xe)try{const e=ne?`http://localhost:8000/api/machines/machines/${ne.id}`:"http://localhost:8000/api/machines/machines",s=ne?"PUT":"POST";if(!(await fetch(e,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify({machine_number:de.trim(),machine_type_id:xe})})).ok)throw new Error("機械番号の保存に失敗しました");U({title:ne?"機械番号を更新しました":"機械番号を追加しました",description:`${de} が正常に処理されました`}),me(""),je(""),ce(null),ie(!1),pe()}catch(e){console.error("機械番号保存エラー:",e),U({title:"エラー",description:"機械番号の保存に失敗しました",variant:"destructive"})}},children:ne?"更新":"追加"})]})]})]})]})}),e.jsxs(o,{children:[e.jsx("div",{className:"mb-4 space-y-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(x,{placeholder:"機械番号または機種名で検索...",value:X,onChange:e=>Y(e.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-48",children:e.jsxs(E,{value:Z,onValueChange:ee,children:[e.jsx($,{children:e.jsx(T,{placeholder:"機種でフィルター"})}),e.jsxs(O,{children:[e.jsx(P,{value:"all",children:"すべての機種"}),K.map(s=>e.jsx(P,{value:s.id,children:s.machine_type_name},s.id))]})]})})]})}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(p,{children:[e.jsx(u,{children:e.jsxs(f,{children:[e.jsx(y,{children:"機械番号"}),e.jsx(y,{children:"機種"}),e.jsx(y,{className:"text-right",children:"操作"})]})}),e.jsx(v,{children:0===Q.length?e.jsx(f,{children:e.jsx(g,{colSpan:3,className:"text-center py-8 text-gray-500",children:X||"all"!==Z?"検索条件に一致する機械番号が見つかりません":"機械番号が登録されていません"})}):Q.map(s=>e.jsxs(f,{children:[e.jsx(g,{className:"font-medium",children:s.machine_number}),e.jsx(g,{children:s.machine_type_name}),e.jsx(g,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(e=>{ce(e),me(e.machine_number),je(e.machine_type_id),ie(!0)})(s),className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:e.jsx(z,{className:"h-3 w-3"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>(async(e,s)=>{if(confirm(`機械番号「${s}」を削除してもよろしいですか？`))try{if(!(await fetch(`http://localhost:8000/api/machines/machines/${e}`,{method:"DELETE"})).ok)throw new Error("機械番号の削除に失敗しました");U({title:"機械番号を削除しました",description:`${s} が削除されました`}),pe()}catch(a){console.error("機械番号削除エラー:",a),U({title:"エラー",description:"機械番号の削除に失敗しました",variant:"destructive"})}})(s.id,s.machine_number),className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(I,{className:"h-3 w-3"})})]})})]},s.id))})]})})]})]})]})]})}export{F as default};
