import{j as t}from"./ui-BaYWhfWe.js";import{r as e}from"./vendor-C0Yfakdp.js";import"./card-CR4tj452.js";import"./index-CoKmVnLC.js";import"./input-BEgb4eHc.js";import"./select-BdO_cX6L.js";import"./textarea-lTy8xFrr.js";import"./index-jVOyRz7F.js";import"./index-CttfQz0H.js";import"./check-CzM8W_jI.js";const i=({item:e})=>{var i,d,l,n,s,r,o,a,h;if(!e)return null;const x=(null==(i=null==e?void 0:e.jsonData)?void 0:i.savedImages)||[];return t.jsxs("div",{className:"print-a4-report",style:{width:"190mm",minHeight:"270mm",margin:"0 auto",background:"#fff",border:"1px solid #bbb",padding:"18mm 12mm",boxSizing:"border-box",fontSize:"12px",color:"#222"},children:[t.jsx("h1",{style:{fontSize:"22px",fontWeight:"bold",textAlign:"center",marginBottom:"18px",letterSpacing:"2px"},children:"機械故障報告"}),t.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"14px"},children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("th",{style:{textAlign:"left",width:"22%",padding:"4px",fontWeight:"bold",background:"#f5f5f5"},children:"機種"}),t.jsx("td",{style:{padding:"4px"},children:e.machineType||"-"}),t.jsx("th",{style:{textAlign:"left",width:"22%",padding:"4px",fontWeight:"bold",background:"#f5f5f5"},children:"機械番号"}),t.jsx("td",{style:{padding:"4px"},children:e.machineNumber||"-"})]}),t.jsxs("tr",{children:[t.jsx("th",{style:{textAlign:"left",padding:"4px",fontWeight:"bold",background:"#f5f5f5"},children:"ファイル名"}),t.jsx("td",{colSpan:3,style:{padding:"4px"},children:e.fileName||"-"})]})]})}),t.jsxs("div",{style:{marginBottom:"12px"},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"2px"},children:"事象タイトル"}),t.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px",padding:"6px",minHeight:"18px",marginBottom:"6px",background:"#fafbfc"},children:(null==(d=e.jsonData)?void 0:d.title)||(e.fileName?e.fileName.split("_")[0]:"")||(null==(l=e.jsonData)?void 0:l.question)||"-"}),t.jsx("div",{style:{fontWeight:"bold",marginBottom:"2px"},children:"事象説明"}),t.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px",padding:"6px",minHeight:"32px",background:"#fafbfc"},children:(null==(n=e.jsonData)?void 0:n.problemDescription)||(null==(s=e.jsonData)?void 0:s.answer)||"-"})]}),t.jsxs("div",{style:{marginBottom:"12px"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:["故障個所の画像",x.length>0?`（${x.length}枚）`:""]}),t.jsx("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:x.length>0?x.map((e,i)=>t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("img",{src:e.url||e.path||"",alt:e.fileName||`故障画像${i+1}`,style:{maxWidth:"60mm",maxHeight:"38mm",border:"1px solid #bbb",borderRadius:"4px",marginBottom:"2px"}}),t.jsx("div",{style:{fontSize:"11px",color:"#888"},children:e.fileName||""})]},e.url||e.fileName||i)):t.jsx("span",{style:{color:"#888"},children:"画像なし"})})]}),t.jsxs("div",{style:{marginBottom:"12px"},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"2px"},children:"修繕計画"}),t.jsx("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"0"},children:t.jsx("tbody",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{textAlign:"left",width:"22%",padding:"4px",fontWeight:"bold",background:"#f5f5f5"},children:"修繕予定月日"}),t.jsx("td",{style:{padding:"4px"},children:(null==(r=e.jsonData)?void 0:r.repairSchedule)||"-"}),t.jsx("th",{style:{textAlign:"left",width:"22%",padding:"4px",fontWeight:"bold",background:"#f5f5f5"},children:"場所"}),t.jsx("td",{style:{padding:"4px"},children:(null==(o=e.jsonData)?void 0:o.location)||"-"}),t.jsx("th",{style:{textAlign:"left",width:"18%",padding:"4px",fontWeight:"bold",background:"#f5f5f5"},children:"ステータス"}),t.jsx("td",{style:{padding:"4px"},children:(null==(a=e.jsonData)?void 0:a.status)||"-"})]})})})]}),t.jsxs("div",{style:{marginBottom:"0"},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"2px"},children:"記事欄"}),t.jsx("div",{style:{border:"1px solid #ddd",borderRadius:"4px",padding:"6px",minHeight:"32px",background:"#fafbfc"},children:(null==(h=e.jsonData)?void 0:h.remarks)||"-"})]})]})},d=()=>{e.useEffect(()=>{(async()=>{try{const t=await fetch("/api/history");if(!t.ok)throw new Error("履歴データの取得に失敗しました");const e=await t.json();S(e.data||[]),k(e.data||[]),console.log("[履歴管理UI] API取得データ:",e),console.log("[履歴管理UI] setHistoryItems:",e.data||[])}catch(t){S([]),k([])}})()},[]);const[d,l]=e.useState(!1),[n,s]=e.useState(null),[r,o]=e.useState(!1),[a,h]=e.useState({show:!1,id:"",title:""}),[x,c]=e.useState(!1),[p,g]=e.useState(null),[m,j]=e.useState(""),[f,u]=e.useState({machineTypes:[],machines:[]}),[y,b]=e.useState({machineTypes:[],machineNumbers:[]}),[v,S]=e.useState([]),[w,k]=e.useState([]),[W,B]=e.useState({machineType:"",machineNumber:"",searchText:"",searchDate:""}),[D,N]=e.useState(new Set),[A,C]=e.useState(!1),[I,R]=e.useState(!1),[z,H]=e.useState(!1),[T,E]=e.useState(null),[J,P]=e.useState(null);return e.useRef(!1),t.jsxs("main",{style:{padding:"24px",maxWidth:1200,margin:"0 auto"},children:[t.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:600,marginBottom:16},children:"サポート履歴一覧"}),A?t.jsx("div",{children:"読み込み中..."}):0===w.length?t.jsx("div",{style:{color:"#888",margin:"32px 0"},children:"履歴データがありません"}):t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",background:"#fff",border:"1px solid #ddd"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{background:"#f5f5f5"},children:[t.jsx("th",{style:{padding:8},children:"選択"}),t.jsx("th",{style:{padding:8},children:"日付"}),t.jsx("th",{style:{padding:8},children:"機種"}),t.jsx("th",{style:{padding:8},children:"機械番号"}),t.jsx("th",{style:{padding:8},children:"タイトル"}),t.jsx("th",{style:{padding:8},children:"操作"})]})}),t.jsx("tbody",{children:w.map(e=>{var i,d;return t.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[t.jsx("td",{style:{textAlign:"center"},children:t.jsx("input",{type:"checkbox",checked:D.has(e.id),onChange:()=>handleSelectItem(e.id)})}),t.jsx("td",{style:{padding:8},children:(d=e.createdAt||"",new Date(d).toLocaleString("ja-JP"))}),t.jsx("td",{style:{padding:8},children:e.machineType||"-"}),t.jsx("td",{style:{padding:8},children:e.machineNumber||"-"}),t.jsx("td",{style:{padding:8},children:(null==(i=e.jsonData)?void 0:i.title)||e.fileName||"-"}),t.jsxs("td",{style:{padding:8},children:[t.jsx("button",{onClick:()=>(t=>{s(t),l(!0)})(e),style:{marginRight:8},children:"プレビュー"}),t.jsx("button",{onClick:()=>(t=>{P(t),o(!0)})(e),style:{marginRight:8},children:"編集"}),t.jsx("button",{onClick:()=>{var t;return h({show:!0,id:e.id,title:(null==(t=e.jsonData)?void 0:t.title)||e.fileName||""})},style:{color:"red"},children:"削除"})]})]},e.id)})})]}),d&&n&&t.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.3)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsxs("div",{style:{background:"#fff",borderRadius:8,padding:24,minWidth:600,maxWidth:"90vw",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 2px 16px rgba(0,0,0,0.2)"},children:[t.jsx("h3",{style:{fontSize:"1.2rem",fontWeight:600,marginBottom:12},children:"履歴プレビュー"}),t.jsx(i,{item:n}),t.jsx("div",{style:{textAlign:"right",marginTop:16},children:t.jsx("button",{onClick:()=>l(!1),children:"閉じる"})})]})})]})};export{d as default};
