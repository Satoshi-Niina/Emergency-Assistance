import{j as s,c as e}from"./ui-BaYWhfWe.js";import{r as a}from"./vendor-C0Yfakdp.js";import{d as t,c as r,f as i,B as c,M as l}from"./index-Bi0_jrGv.js";import{C as n,c as d,a as m,b as x}from"./card-BB112kUH.js";import{B as o}from"./badge-BUbi7OY4.js";import{L as h}from"./loader-circle-B2ThjJPI.js";import{R as j}from"./refresh-cw-zQTk-P4H.js";import{D as u}from"./database-CZVi44VP.js";import{C as p}from"./circle-check-big-CCUv2DgK.js";import{C as f}from"./circle-alert-DuKpVy7a.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=t("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var v="horizontal",g=["horizontal","vertical"],w=a.forwardRef((a,t)=>{const{decorative:r,orientation:i=v,...c}=a,l=function(s){return g.includes(s)}(i)?i:v,n=r?{role:"none"}:{"aria-orientation":"vertical"===l?l:void 0,role:"separator"};return s.jsx(e.div,{"data-orientation":l,...n,...c,ref:t})});w.displayName="Separator";var O=w;const R=a.forwardRef(({className:e,orientation:a="horizontal",decorative:t=!0,...i},c)=>s.jsx(O,{ref:c,decorative:t,orientation:a,className:r("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",e),...i}));function y(){const{toast:e}=i(),[t,r]=a.useState(null),[v,g]=a.useState(null),[w,O]=a.useState(!1),[y,b]=a.useState(!1),K="http://localhost:8081",P=async()=>{var s,a;O(!0),r(null);try{const t=await fetch(`${K}/api/_diag/postgresql`),i=await t.json(),c={success:i.success,status:i.success?"OK":"ERROR",message:i.message,error:i.error,current_time:null==(s=i.data)?void 0:s.current_time,version:null==(a=i.data)?void 0:a.version,timestamp:i.timestamp};r(c),"OK"===c.status?e({title:"DB接続確認",description:"データベース接続が正常です",variant:"default"}):e({title:"DB接続確認",description:c.error||c.message||"データベース接続エラー",variant:"destructive"})}catch(t){const s=t instanceof Error?t.message:"ネットワークエラー";r({status:"ERROR",error:s}),e({title:"DB接続確認",description:s,variant:"destructive"})}finally{O(!1)}},k=async()=>{b(!0),g(null);try{const s=await fetch(`${K}/api/_diag/gpt`),a=await s.json(),t={success:a.success,status:a.success?"OK":"ERROR",message:a.message,error:a.error,details:a.details,timestamp:a.timestamp};g(t),"OK"===t.status?e({title:"GPT接続確認",description:"GPT接続が正常です",variant:"default"}):e({title:"GPT接続確認",description:t.error||t.message||"GPT接続エラー",variant:"destructive"})}catch(s){const a=s instanceof Error?s.message:"ネットワークエラー";g({status:"ERROR",error:a}),e({title:"GPT接続確認",description:a,variant:"destructive"})}finally{b(!1)}};return s.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"システム診断"}),s.jsx("p",{className:"text-muted-foreground",children:"データベース接続とGPT接続の状態を確認できます"})]}),s.jsx(n,{className:"mb-6",children:s.jsx(d,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"一括診断"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"すべての接続確認を一度に実行します"})]}),s.jsxs(c,{onClick:async()=>{await P(),await k()},disabled:w||y,className:"flex items-center gap-2",children:[w||y?s.jsx(h,{className:"h-4 w-4 animate-spin"}):s.jsx(j,{className:"h-4 w-4"}),"全体診断実行"]})]})})}),s.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[s.jsxs(n,{children:[s.jsx(m,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(u,{className:"h-5 w-5"}),"PostgreSQL接続確認"]})}),s.jsxs(d,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"データベースへの接続状態を確認します"}),s.jsxs(c,{onClick:P,disabled:w,size:"sm",variant:"outline",children:[w?s.jsx(h,{className:"h-4 w-4 animate-spin"}):s.jsx(p,{className:"h-4 w-4"}),"確認実行"]})]}),t&&s.jsxs("div",{className:"space-y-3",children:[s.jsx(R,{}),s.jsxs("div",{className:"flex items-center gap-2",children:["OK"===t.status?s.jsx(p,{className:"h-4 w-4 text-green-500"}):s.jsx(N,{className:"h-4 w-4 text-red-500"}),s.jsx(o,{variant:"OK"===t.status?"default":"destructive",children:"OK"===t.status?"接続成功":"接続失敗"})]}),"OK"===t.status&&t.current_time&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:"DB時刻:"})," ",new Date(t.current_time).toLocaleString("ja-JP")]}),"ERROR"===t.status&&(t.error||t.message)&&s.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(f,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:t.error||t.message})]})})]})]})]}),s.jsxs(n,{children:[s.jsx(m,{children:s.jsxs(x,{className:"flex items-center gap-2",children:[s.jsx(l,{className:"h-5 w-5"}),"GPT接続確認"]})}),s.jsxs(d,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"OpenAI APIへの接続状態を確認します"}),s.jsxs(c,{onClick:k,disabled:y,size:"sm",variant:"outline",children:[y?s.jsx(h,{className:"h-4 w-4 animate-spin"}):s.jsx(p,{className:"h-4 w-4"}),"確認実行"]})]}),v&&s.jsxs("div",{className:"space-y-3",children:[s.jsx(R,{}),s.jsxs("div",{className:"flex items-center gap-2",children:["OK"===v.status?s.jsx(p,{className:"h-4 w-4 text-green-500"}):s.jsx(N,{className:"h-4 w-4 text-red-500"}),s.jsx(o,{variant:"OK"===v.status?"default":"destructive",children:"OK"===v.status?"接続成功":"接続失敗"})]}),"OK"===v.status&&v.message&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:"GPT応答:"}),s.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded text-xs max-h-20 overflow-y-auto",children:v.message})]}),"ERROR"===v.status&&(v.error||v.message)&&s.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(f,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:v.error}),s.jsx("div",{className:"text-red-500 mt-1",children:v.message}),v.details&&s.jsx("div",{className:"text-xs text-red-400 mt-1 font-mono",children:v.details})]})]})})]})]})]})]}),t&&v&&s.jsxs(n,{className:"mt-6",children:[s.jsx(m,{children:s.jsx(x,{children:"診断結果サマリー"})}),s.jsxs(d,{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(u,{className:"h-4 w-4"}),s.jsx("span",{children:"PostgreSQL:"}),s.jsx(o,{variant:"OK"===t.status?"default":"destructive",children:"OK"===t.status?"正常":"異常"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(l,{className:"h-4 w-4"}),s.jsx("span",{children:"GPT:"}),s.jsx(o,{variant:"OK"===v.status?"default":"destructive",children:"OK"===v.status?"正常":"異常"})]})]}),"OK"===t.status&&"OK"===v.status&&s.jsx("div",{className:"mt-4 p-3 bg-green-50 text-green-700 rounded-md",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:"すべての接続が正常です"})]})}),("ERROR"===t.status||"ERROR"===v.status)&&s.jsx("div",{className:"mt-4 p-3 bg-yellow-50 text-yellow-700 rounded-md",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:"一部の接続に問題があります"})]})})]})]})]})}R.displayName=O.displayName;export{y as default};
