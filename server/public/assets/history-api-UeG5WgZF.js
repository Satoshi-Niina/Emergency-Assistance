import{h as e}from"./index-CiljYYZq.js";const t=async(e={})=>{try{const[t,s]=await Promise.allSettled([a(e),i(e)]);let o=[];if("fulfilled"===t.status&&t.value.items&&(o=[...o,...t.value.items]),"fulfilled"===s.status&&s.value.data){const e=s.value.data.map(r);o=[...o,...e]}o.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());const n=e.limit||20,c=e.offset||0;return{items:o.slice(c,c+n),total:o.length,hasMore:c+n<o.length}}catch(t){return console.error("履歴一覧取得エラー:",t),{items:[],total:0,hasMore:!1}}},a=async(t={})=>{const a=new URLSearchParams;t.machineType&&a.append("machineType",t.machineType),t.machineNumber&&a.append("machineNumber",t.machineNumber),t.searchText&&a.append("searchText",t.searchText),t.searchDate&&a.append("searchDate",t.searchDate),t.limit&&a.append("limit",t.limit.toString()),t.offset&&a.append("offset",t.offset.toString());const i=await e(`/history?${a.toString()}`);return i.ok?i.json():{items:[],total:0,hasMore:!1}},i=async t=>await(async(t={})=>{const a=new URLSearchParams;t.limit&&a.append("limit",t.limit.toString()),t.offset&&a.append("offset",t.offset.toString()),t.machineType&&a.append("machineType",t.machineType),t.machineNumber&&a.append("machineNumber",t.machineNumber),t.category&&a.append("category",t.category),t.office&&a.append("office",t.office),t.keyword&&a.append("keyword",t.keyword);const i=await e(`/fault-history?${a.toString()}`);if(!i.success)throw new Error(i.error||"故障履歴の取得に失敗しました");return i})({machineType:t.machineType,machineNumber:t.machineNumber,keyword:t.searchText,limit:t.limit,offset:t.offset}),r=e=>{const t=e.images&&e.images.length>0?`http://localhost:8080/api/fault-history/images/${e.images[0].fileName}`:void 0;return{id:e.id,machineType:e.machineType||"",machineNumber:e.machineNumber||"",title:e.title,jsonData:{...e.jsonData,title:e.title,problemDescription:e.description,machineType:e.machineType,machineNumber:e.machineNumber,metadata:{office:e.office,category:e.category,keywords:e.keywords,source:"fault-history-db"}},imagePath:t,imageUrl:t,createdAt:e.createdAt,source:"fault-history-db"}},s=async t=>{const a=await e(`/history/${t}`,{method:"DELETE"});if(!a.ok)throw new Error(`Failed to delete history: ${a.statusText}`)},o=async()=>await e("/base-data"),n=async()=>await e("/files/processed"),c=async(t,a="json")=>await e("/history/export-selected",{method:"POST",body:JSON.stringify({ids:t,format:a})}),m=async(t={},a="json")=>{const i=new URLSearchParams;i.append("format",a),t.machineType&&i.append("machineType",t.machineType),t.machineNumber&&i.append("machineNumber",t.machineNumber);const r=await e(`/history/export-all?${i.toString()}`);if(!r.ok)throw new Error(`Failed to export all history: ${r.statusText}`);return r.blob()};export{m as a,t as b,n as c,s as d,c as e,o as f};
