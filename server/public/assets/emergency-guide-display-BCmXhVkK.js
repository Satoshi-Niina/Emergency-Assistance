const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CHBhc1kl.js","assets/ui-BaYWhfWe.js","assets/vendor-C0Yfakdp.js","assets/index-D8OdIOAq.css"])))=>i.map(i=>d[i]);
import{d as e,B as s,_ as t}from"./index-CHBhc1kl.js";import{j as l}from"./ui-BaYWhfWe.js";import{r as i}from"./vendor-C0Yfakdp.js";import{C as a,c as n,a as r,b as o}from"./card-GNoEM2Vj.js";import{A as c}from"./arrow-left-DtbQ7uMP.js";import{I as d}from"./image-BvQHKAe-.js";import{C as m}from"./circle-check-big-DoNQjED3.js";function g(){try{if("undefined"!=typeof window){if(window.runtimeConfig&&window.runtimeConfig.API_BASE_URL){const e=window.runtimeConfig.API_BASE_URL.replace(/\/$/,"");return console.log("ğŸ”§ runtime-configã‹ã‚‰API_BASE_URLå–å¾—:",e),e.replace(/\/api$/,"")}if(""!=="http://localhost:8080".trim())return"http://localhost:8080".replace(/\/$/,"").replace(/\/api$/,"");const e=window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1");return/\.azurestaticapps\.net$/i.test(window.location.hostname)?"":e?window.location.origin:"https://emergencyassistance-sv-fbanemhrbshuf9bd.japanwest-01.azurewebsites.net"}}catch(e){console.warn("APIãƒ™ãƒ¼ã‚¹URLå–å¾—ã‚¨ãƒ©ãƒ¼:",e)}return"undefined"!=typeof window?window.location.origin:""}function x(e){if(console.log("ğŸ–¼ï¸ convertImageUrl é–‹å§‹:",{url:e,type:typeof e}),!e)return console.log("âŒ URLãŒç©ºã§ã™"),"";if("string"!=typeof e){if("string"!=typeof e.url)return console.log("âŒ æœ‰åŠ¹ãªURLãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),"";e=e.url,console.log("ğŸ”„ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰URLã‚’æŠ½å‡º:",e)}if("string"==typeof e&&e.includes("localhost:8000")){const s="undefined"!=typeof window?window.location.origin:"",t=e.replace(/http:\/\/localhost:8000/g,s);return console.log("ğŸ”§ ãƒ¬ã‚¬ã‚·ãƒ¼ãƒãƒ¼ãƒˆä¿®æ­£:",{original:e,corrected:t,currentOrigin:s}),t}if(e.startsWith("http://")||e.startsWith("https://"))return console.log("âœ… å®Œå…¨ãªURL:",e),e;if(e.startsWith("data:image/"))return console.log("âœ… Base64ãƒ‡ãƒ¼ã‚¿:",e.substring(0,50)+"..."),e;if(e.startsWith("/api/")){const s=g(),t=s||"",l=t?`${t}${e}`:e;return console.log("âœ… APIãƒ‘ã‚¹å¤‰æ›ï¼ˆå®Œå…¨URLï¼‰:",{original:e,apiBaseUrl:s,fullUrl:l}),l}if(e.startsWith("/"))return console.log("âœ… ç›¸å¯¾ãƒ‘ã‚¹:",e),e;const s=g();console.log("ğŸ”§ APIãƒ™ãƒ¼ã‚¹URL:",s);let t=e;if(e.includes("/")?t=e.split("/").pop()||e:e.includes("\\")&&(t=e.split("\\").pop()||e),console.log("ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«åæŠ½å‡º:",{original:e,fileName:t}),t.includes("emergency-flow-step")||e.includes("/api/emergency-flow/image/")){const e=g()||"",s=e?`${e}/api/emergency-flow/image/${t}`:`/api/emergency-flow/image/${t}`;return console.log("âœ… emergency-flow URL:",s),s}const l=g()||"",i=l?`${l}/api/troubleshooting/image/${t}`:`/api/troubleshooting/image/${t}`;return console.log("âœ… troubleshooting URL:",i),i}function u(e){const s=x(e);return console.log("ğŸ”§ buildImageUrl -> convertImageUrl:",{input:e,output:s}),s}function p(e,s){var t;const l=e.currentTarget;console.error("ç”»åƒè¡¨ç¤ºã‚¨ãƒ©ãƒ¼:",s),console.log("å…ƒã®ç”»åƒURL:",s),console.log("å¤‰æ›å¾Œã®URL:",l.src);try{const e=g(),i=null==(t=s.split("/").pop())?void 0:t.split("\\").pop();if(i&&i!==s)return console.log("ãƒ•ã‚¡ã‚¤ãƒ«åã®ã¿ã§å†è©¦è¡Œ:",i),void(l.src=`${e}/api/emergency-flow/image/${i}`);console.log("å…ƒã®URLã‚’ãã®ã¾ã¾ä½¿ç”¨"),l.src=s}catch(i){console.error("ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¤±æ•—:",i),l.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgNzBDMTE2LjU2OSA3MCAxMzAgODMuNDMxIDEzMCAxMDBDMTMwIDExNi41NjkgMTE2LjU2OSAxMzAgMTAwIDEzMEM4My40MzEgMTMwIDcwIDExNi41NjkgNzAgMTAwQzcwIDgzLjQzMSA4My40MzEgNzAgMTAwIDcwWiIgZmlsbD0iIzlDQTBBNiIvPgo8cGF0aCBkPSJNMTAwIDE0MEMxMTYuNTY5IDE0MCAxMzAgMTUzLjQzMSAxMzAgMTcwQzEzMCAxODYuNTY5IDExNi41NjkgMjAwIDEwMCAyMDBDODMuNDMxIDIwMCA3MCAxODYuNTY5IDcwIDE3MEM3MCAxNTMuNDMxIDgzLjQzMSAxNDAgMTAwIDE0MFoiIGZpbGw9IiM5Q0EwQTYiLz4KPHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIwIDIwQzIwIDE3LjIzOSAyMi4yMzkgMTUgMjUgMTVIMzVDMzcuNzYxIDE1IDQwIDE3LjIzOSA0MCAyMFYzMEM0MCAzMi43NjEgMzcuNzYxIDM1IDM1IDM1SDI1QzIyLjIzOSAzNSAyMCAzMi43NjEgMjAgMzBWMjBaIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yNSAxN0MyNSAxNi40NDc3IDI1LjQ0NzcgMTYgMjYgMTZIMzRDMzQuNTUyMyAxNiAzNSAxNi40NDc3IDM1IDE3VjI5QzM1IDI5LjU1MjMgMzQuNTUyMyAzMCAzNCAzMEgyNkMyNS40NDc3IDMwIDI1IDI5LjU1MjMgMjUgMjlWMTdaIiBmaWxsPSIjOTlBM0Y2Ii8+Cjwvc3ZnPgo8L3N2Zz4K"}}
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h=e("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),j=e("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function N({guideId:e,onExit:g,isPreview:x=!1,onSendToChat:N,backButtonText:w="æˆ»ã‚‹"}){const[f,M]=i.useState(null),[I,y]=i.useState(0),[b,A]=i.useState(!0),[D,z]=i.useState(""),[U,v]=i.useState(null),[E,C]=i.useState([]),[T,L]=i.useState(!1),[S,R]=i.useState(!1);i.useEffect(()=>{e&&(async()=>{try{A(!0),console.log("ğŸ”„ å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹:",e);const s=`?ts=${Date.now()}&r=${Math.random().toString(36).substring(2)}`,{buildApiUrl:l}=await t(async()=>{const{buildApiUrl:e}=await import("./index-CHBhc1kl.js").then(e=>e.J);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),i=l(`/emergency-flow/${e}${s}`);console.log("ğŸŒ ã‚¬ã‚¤ãƒ‰è©³ç´°API URL:",i);const a=await fetch(i,{method:"GET",headers:{"Cache-Control":"no-cache, no-store, must-revalidate, max-age=0",Pragma:"no-cache",Expires:"Thu, 01 Jan 1970 00:00:00 GMT","X-Requested-With":"XMLHttpRequest"}});if(console.log("ğŸ“¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹çŠ¶æ…‹:",a.status,a.statusText),!a.ok){const e=await a.text();throw console.error("âŒ API ã‚¨ãƒ©ãƒ¼:",e),new Error(`Failed to fetch guide data: ${a.status} - ${e}`)}const n=await a.json();console.log("ğŸ“Š å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:",n);const r=n.success&&n.data?n.data:n;if(console.log("ğŸ“‹ å‡¦ç†å¯¾è±¡ãƒ‡ãƒ¼ã‚¿:",r),M(r),r.steps&&r.steps.length>0){const e=r.steps[0];C([{stepId:e.id,title:e.title,message:e.message,type:e.type,imageUrl:e.imageUrl,images:e.images,timestamp:new Date}])}}catch(s){console.error("Guide data fetch error:",s),z("ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{A(!1)}})()},[e]);const k=e=>{if(f)if(e){const s=f.steps.findIndex(s=>s.id===e);if(-1!==s){y(s),v(null);const e=f.steps[s],t={stepId:e.id,title:e.title,message:e.message,type:e.type,imageUrl:e.imageUrl,images:e.images,selectedCondition:U,timestamp:new Date};C(e=>[...e,t])}}else if(I<f.steps.length-1){const e=I+1;y(e),v(null);const s=f.steps[e],t={stepId:s.id,title:s.title,message:s.message,type:s.type,imageUrl:s.imageUrl,images:s.images,timestamp:new Date};C(e=>[...e,t])}},$=()=>{if(!f||0===E.length)return;const e={title:f.title,description:f.description,executedSteps:E.filter(e=>"start"!==e.type&&"end"!==e.type),totalSteps:E.length,completedAt:new Date,isPartial:!T};window.dispatchEvent(new CustomEvent("emergency-guide-completed",{detail:e})),N&&N(),T?g():(console.log("è¡¨ç¤ºã—ãŸãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡å®Œäº†:",e),R(!0),setTimeout(()=>{R(!1)},3e3))};if(b)return l.jsx(a,{className:"w-full max-w-4xl mx-auto",children:l.jsx(n,{className:"flex justify-center items-center py-12",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})});if(D||!f)return l.jsxs(a,{className:"w-full max-w-4xl mx-auto",children:[l.jsx(r,{children:l.jsx(o,{className:"text-red-600",children:"ã‚¨ãƒ©ãƒ¼"})}),l.jsxs(n,{children:[l.jsx("p",{className:"mb-4",children:D||"ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),l.jsx(s,{onClick:g,children:"æˆ»ã‚‹"})]})]});const B=f&&f.steps&&0!==f.steps.length&&f.steps[I]||null,P=I===f.steps.length-1,Z=0===I;return B?l.jsxs(a,{className:"w-full max-w-4xl mx-auto",children:[l.jsx(r,{children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-start gap-2 flex-1 min-w-0",children:[l.jsxs(s,{variant:"ghost",size:"sm",onClick:g,className:"flex-shrink-0",children:[l.jsx(c,{className:"h-4 w-4"}),w]}),l.jsxs(o,{className:"text-xl break-words leading-tight",children:[f.title,x&&" (ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)"]})]}),l.jsxs("div",{className:"text-sm text-gray-500 flex-shrink-0 ml-4",children:["ã‚¹ãƒ†ãƒƒãƒ— ",I+1," / ",f.steps.length]})]})}),l.jsx(n,{children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[l.jsx("h3",{className:"font-semibold text-blue-900 mb-2 text-lg",children:B.title}),B.description&&l.jsx("p",{className:"text-blue-800 text-sm mb-3",children:B.description}),l.jsx("div",{className:"text-blue-800 whitespace-pre-line",children:B.message})]}),"decision"===B.type&&B.conditions&&B.conditions.length>0&&l.jsxs("div",{className:"space-y-3",children:[l.jsx("h4",{className:"font-medium text-gray-900",children:x?"æ¡ä»¶åˆ†å²:":"é¸æŠã—ã¦ãã ã•ã„ï¼š"}),x?l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:B.conditions.map((e,s)=>l.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg bg-gray-50",children:[l.jsx("div",{className:"font-medium text-sm",children:e.label}),l.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["æ¬¡ã‚¹ãƒ†ãƒƒãƒ—:"," ",(()=>{const s=f.steps.find(s=>s.id===e.nextId),t=f.steps.findIndex(s=>s.id===e.nextId);return s?`${s.title||`ã‚¹ãƒ†ãƒƒãƒ— ${t+1}`}`:"æœªè¨­å®š"})()]})]},s))}):l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:B.conditions.map((e,t)=>l.jsx(s,{variant:"outline",className:"h-auto p-4 text-left justify-start",onClick:()=>(e=>{v(e.nextId),k(e.nextId)})(e),children:l.jsx("div",{className:"flex flex-col items-start",children:l.jsx("span",{className:"font-medium",children:e.label})})},t))})]}),B.images&&B.images.length>0?l.jsx("div",{className:"mt-4",children:l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:B.images.map((e,s)=>l.jsxs("div",{className:"relative",children:[l.jsx("img",{src:u(e.url),alt:`${B.title} - ${e.fileName||"ç”»åƒ"}`,className:"w-full h-auto rounded-lg shadow-md",crossOrigin:"anonymous",onError:t=>{console.error("âŒ ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (emergency-guide-display):",{imageUrl:e.url,builtUrl:u(e.url),fileName:e.fileName,stepTitle:B.title,index:s}),p(t,e.url)},onLoad:()=>{console.log("âœ… ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ (emergency-guide-display):",{imageUrl:e.url,builtUrl:u(e.url),fileName:e.fileName,stepTitle:B.title,index:s})}}),e.fileName&&l.jsx("div",{className:"text-sm text-gray-600 mt-1",children:e.fileName})]},s))})}):B.imageUrl?l.jsx("div",{className:"mt-4",children:l.jsx("img",{src:u(B.imageUrl),alt:B.title,className:"w-full h-auto rounded-lg shadow-md",crossOrigin:"anonymous",onError:e=>{console.error("âŒ ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (legacy imageUrl):",{imageUrl:B.imageUrl,builtUrl:u(B.imageUrl),stepTitle:B.title}),p(e,B.imageUrl)},onLoad:()=>{console.log("âœ… ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ (legacy imageUrl):",{imageUrl:B.imageUrl,builtUrl:u(B.imageUrl),stepTitle:B.title})}})}):l.jsxs("div",{className:"mt-4 text-center py-4 bg-gray-50 rounded-lg",children:[l.jsx(d,{className:"mx-auto h-8 w-8 text-gray-400"}),l.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ç”»åƒã¯ã‚ã‚Šã¾ã›ã‚“"})]}),l.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[l.jsxs(s,{variant:"outline",onClick:()=>{I>0&&(y(I-1),v(null),C(e=>e.slice(0,-1)))},disabled:Z,children:[l.jsx(c,{className:"h-4 w-4 mr-2"}),"å‰ã¸"]}),l.jsxs("div",{className:"flex gap-2",children:[I>=1&&!T&&!x&&l.jsxs(s,{onClick:$,variant:"outline",className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-300",children:[l.jsx(j,{className:"h-4 w-4 mr-2"}),"è¡¨ç¤ºã—ãŸãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡"]}),(x||"decision"!==B.type)&&l.jsx(s,{onClick:P?()=>{L(!0)}:()=>k(),className:"flex items-center gap-2",children:P?l.jsxs(l.Fragment,{children:[l.jsx(m,{className:"h-4 w-4"}),"å®Œäº†"]}):l.jsxs(l.Fragment,{children:["æ¬¡ã¸",l.jsx(h,{className:"h-4 w-4"})]})})]})]}),T&&!x&&l.jsxs("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(m,{className:"h-5 w-5 text-green-600"}),l.jsx("span",{className:"text-green-800 font-medium",children:"å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ"})]}),l.jsxs(s,{onClick:$,className:"bg-green-600 hover:bg-green-700 text-white",children:[l.jsx(j,{className:"h-4 w-4 mr-2"}),"ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡"]})]}),l.jsx("p",{className:"text-green-700 text-sm mt-2",children:"å®Ÿè¡Œã—ãŸã‚¹ãƒ†ãƒƒãƒ—ã¨ç”»åƒã‚’ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«è¨˜éŒ²ã—ã¾ã™"})]}),T&&x&&l.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(m,{className:"h-5 w-5 text-blue-600"}),l.jsx("span",{className:"text-blue-800 font-medium",children:"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†"})]}),l.jsx("p",{className:"text-blue-700 text-sm mt-2",children:"ãƒ•ãƒ­ãƒ¼ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚å®Ÿéš›ã®ä½¿ç”¨æ™‚ã«ã¯ãƒãƒ£ãƒƒãƒˆé€ä¿¡æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚"})]}),S&&!x&&l.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg animate-pulse",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(m,{className:"h-5 w-5 text-blue-600"}),l.jsx("span",{className:"text-blue-800 font-medium",children:"è¡¨ç¤ºã—ãŸãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡ã—ã¾ã—ãŸ"})]}),l.jsx("p",{className:"text-blue-700 text-sm mt-2",children:"ç¾åœ¨ã¾ã§ã®å®Ÿè¡Œå±¥æ­´ãŒãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«è¨˜éŒ²ã•ã‚Œã¾ã—ãŸã€‚ã‚¬ã‚¤ãƒ‰ã‚’ç¶šè¡Œã§ãã¾ã™ã€‚"})]})]})},B.id)]}):l.jsx(a,{className:"w-full max-w-4xl mx-auto",children:l.jsxs(n,{children:[l.jsx("p",{className:"text-center py-8",children:"ã‚¹ãƒ†ãƒƒãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),l.jsx(s,{onClick:g,className:"w-full",children:"æˆ»ã‚‹"})]})})}export{h as A,N as E,j as S,u as b,x as c};
