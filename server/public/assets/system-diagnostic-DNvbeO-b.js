import{j as s,c as e}from"./ui-BaYWhfWe.js";import{r as a}from"./vendor-C0Yfakdp.js";import{d as t,c as r,f as i,B as c,M as l,g as n}from"./index-B8tm-pMU.js";import{C as d,c as m,a as x,b as o}from"./card-CxU256ru.js";import{B as h}from"./badge-DHhuvfi3.js";import{L as j}from"./loader-circle-CXgt2-0C.js";import{R as u}from"./refresh-cw-C-cQTo6c.js";import{D as p}from"./database-DptPVGUW.js";import{C as f}from"./circle-check-big-Cwy9fPXh.js";import{C as N}from"./circle-alert-DHB01o9A.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=t("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var g="horizontal",w=["horizontal","vertical"],O=a.forwardRef((a,t)=>{const{decorative:r,orientation:i=g,...c}=a,l=function(s){return w.includes(s)}(i)?i:g,n=r?{role:"none"}:{"aria-orientation":"vertical"===l?l:void 0,role:"separator"};return s.jsx(e.div,{"data-orientation":l,...n,...c,ref:t})});O.displayName="Separator";var R=O;const y=a.forwardRef(({className:e,orientation:a="horizontal",decorative:t=!0,...i},c)=>s.jsx(R,{ref:c,decorative:t,orientation:a,className:r("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",e),...i}));function b(){const{toast:e}=i(),[t,r]=a.useState(null),[g,w]=a.useState(null),[O,R]=a.useState(!1),[b,K]=a.useState(!1),P=async()=>{var s,a;R(!0),r(null);try{const t=await fetch(n("/_diag/postgresql")),i=await t.json(),c={success:!!i.success,status:i.success?"OK":"ERROR",message:i.message,error:i.error,current_time:null==(s=i.data)?void 0:s.current_time,version:null==(a=i.data)?void 0:a.version,timestamp:i.timestamp};r(c),"OK"===c.status?e({title:"DB接続確認",description:"データベース接続が正常です",variant:"default"}):e({title:"DB接続確認",description:c.error||c.message||"データベース接続エラー",variant:"destructive"})}catch(t){const s=t instanceof Error?t.message:"ネットワークエラー";r({success:!1,status:"ERROR",error:s}),e({title:"DB接続確認",description:s,variant:"destructive"})}finally{R(!1)}},k=async()=>{K(!0),w(null);try{const s=await fetch(n("/_diag/gpt")),a=await s.json(),t={success:!!a.success,status:a.success?"OK":"ERROR",message:a.message,error:a.error,details:a.details,timestamp:a.timestamp};w(t),"OK"===t.status?e({title:"GPT接続確認",description:"GPT接続が正常です",variant:"default"}):e({title:"GPT接続確認",description:t.error||t.message||"GPT接続エラー",variant:"destructive"})}catch(s){const a=s instanceof Error?s.message:"ネットワークエラー";w({success:!1,status:"ERROR",error:a}),e({title:"GPT接続確認",description:a,variant:"destructive"})}finally{K(!1)}};return s.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-2",children:"システム診断"}),s.jsx("p",{className:"text-muted-foreground",children:"データベース接続とGPT接続の状態を確認できます"})]}),s.jsx(d,{className:"mb-6",children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold mb-2",children:"一括診断"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"すべての接続確認を一度に実行します"})]}),s.jsxs(c,{onClick:async()=>{await P(),await k()},disabled:O||b,className:"flex items-center gap-2",children:[O||b?s.jsx(j,{className:"h-4 w-4 animate-spin"}):s.jsx(u,{className:"h-4 w-4"}),"全体診断実行"]})]})})}),s.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[s.jsxs(d,{children:[s.jsx(x,{children:s.jsxs(o,{className:"flex items-center gap-2",children:[s.jsx(p,{className:"h-5 w-5"}),"PostgreSQL接続確認"]})}),s.jsxs(m,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"データベースへの接続状態を確認します"}),s.jsxs(c,{onClick:P,disabled:O,size:"sm",variant:"outline",children:[O?s.jsx(j,{className:"h-4 w-4 animate-spin"}):s.jsx(f,{className:"h-4 w-4"}),"確認実行"]})]}),t&&s.jsxs("div",{className:"space-y-3",children:[s.jsx(y,{}),s.jsxs("div",{className:"flex items-center gap-2",children:["OK"===t.status?s.jsx(f,{className:"h-4 w-4 text-green-500"}):s.jsx(v,{className:"h-4 w-4 text-red-500"}),s.jsx(h,{variant:"OK"===t.status?"default":"destructive",children:"OK"===t.status?"接続成功":"接続失敗"})]}),"OK"===t.status&&t.current_time&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:"DB時刻:"})," ",new Date(t.current_time).toLocaleString("ja-JP")]}),"ERROR"===t.status&&(t.error||t.message)&&s.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(N,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:t.error||t.message})]})})]})]})]}),s.jsxs(d,{children:[s.jsx(x,{children:s.jsxs(o,{className:"flex items-center gap-2",children:[s.jsx(l,{className:"h-5 w-5"}),"GPT接続確認"]})}),s.jsxs(m,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:"OpenAI APIへの接続状態を確認します"}),s.jsxs(c,{onClick:k,disabled:b,size:"sm",variant:"outline",children:[b?s.jsx(j,{className:"h-4 w-4 animate-spin"}):s.jsx(f,{className:"h-4 w-4"}),"確認実行"]})]}),g&&s.jsxs("div",{className:"space-y-3",children:[s.jsx(y,{}),s.jsxs("div",{className:"flex items-center gap-2",children:["OK"===g.status?s.jsx(f,{className:"h-4 w-4 text-green-500"}):s.jsx(v,{className:"h-4 w-4 text-red-500"}),s.jsx(h,{variant:"OK"===g.status?"default":"destructive",children:"OK"===g.status?"接続成功":"接続失敗"})]}),"OK"===g.status&&g.message&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:"GPT応答:"}),s.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded text-xs max-h-20 overflow-y-auto",children:g.message})]}),"ERROR"===g.status&&(g.error||g.message)&&s.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-md",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(N,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium",children:g.error}),s.jsx("div",{className:"text-red-500 mt-1",children:g.message}),g.details&&s.jsx("div",{className:"text-xs text-red-400 mt-1 font-mono",children:g.details})]})]})})]})]})]})]}),t&&g&&s.jsxs(d,{className:"mt-6",children:[s.jsx(x,{children:s.jsx(o,{children:"診断結果サマリー"})}),s.jsxs(m,{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{className:"h-4 w-4"}),s.jsx("span",{children:"PostgreSQL:"}),s.jsx(h,{variant:"OK"===t.status?"default":"destructive",children:"OK"===t.status?"正常":"異常"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(l,{className:"h-4 w-4"}),s.jsx("span",{children:"GPT:"}),s.jsx(h,{variant:"OK"===g.status?"default":"destructive",children:"OK"===g.status?"正常":"異常"})]})]}),"OK"===t.status&&"OK"===g.status&&s.jsx("div",{className:"mt-4 p-3 bg-green-50 text-green-700 rounded-md",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:"すべての接続が正常です"})]})}),("ERROR"===t.status||"ERROR"===g.status)&&s.jsx("div",{className:"mt-4 p-3 bg-yellow-50 text-yellow-700 rounded-md",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-4 w-4"}),s.jsx("span",{className:"font-medium",children:"一部の接続に問題があります"})]})})]})]})]})}y.displayName=R.displayName;export{b as default};
