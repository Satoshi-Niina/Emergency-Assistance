const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-D2n-Q-xG.js","assets/ui-BaYWhfWe.js","assets/vendor-C0Yfakdp.js","assets/index-BPCHOJE0.css"])))=>i.map(i=>d[i]);
import{d as e,B as s,_ as t}from"./index-D2n-Q-xG.js";import{j as l}from"./ui-BaYWhfWe.js";import{r as i}from"./vendor-C0Yfakdp.js";import{C as a,c as r,a as n,b as c}from"./card-BqBfUk46.js";import{A as o}from"./arrow-left-D75JwTss.js";import{I as d}from"./image-GU48u0ox.js";import{C as m}from"./circle-check-big-CTBfrkRl.js";function g(){try{if("undefined"!=typeof window){window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1");return/\.azurestaticapps\.net$/i.test(window.location.hostname)?"":"https://emergencyassistance-sv-fbanemhrbshuf9bd.japanwest-01.azurewebsites.net"}}catch(e){console.warn("APIãƒ™ãƒ¼ã‚¹URLå–å¾—ã‚¨ãƒ©ãƒ¼:",e)}return"http://localhost:8000"}function x(e){if(console.log("ğŸ–¼ï¸ convertImageUrl é–‹å§‹:",{url:e,type:typeof e}),!e)return console.log("âŒ URLãŒç©ºã§ã™"),"";if("string"!=typeof e){if("string"!=typeof e.url)return console.log("âŒ æœ‰åŠ¹ãªURLãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"),"";e=e.url,console.log("ğŸ”„ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰URLã‚’æŠ½å‡º:",e)}if(e.startsWith("http://")||e.startsWith("https://"))return console.log("âœ… å®Œå…¨ãªURL:",e),e;if(e.startsWith("data:image/"))return console.log("âœ… Base64ãƒ‡ãƒ¼ã‚¿:",e.substring(0,50)+"..."),e;if(e.startsWith("/api/")){const s=g(),t=`${s}${e}`;return console.log("âœ… APIãƒ‘ã‚¹å¤‰æ›:",{original:e,apiBaseUrl:s,fullUrl:t}),t}if(e.startsWith("/"))return console.log("âœ… ç›¸å¯¾ãƒ‘ã‚¹:",e),e;const s=g();console.log("ğŸ”§ APIãƒ™ãƒ¼ã‚¹URL:",s);let t=e;if(e.includes("/")?t=e.split("/").pop()||e:e.includes("\\")&&(t=e.split("\\").pop()||e),console.log("ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«åæŠ½å‡º:",{original:e,fileName:t}),t.includes("emergency-flow-step")||e.includes("/api/emergency-flow/image/")){const e=`${s}/api/emergency-flow/image/${t}`;return console.log("âœ… emergency-flow URL:",e),e}const l=`${s}/api/troubleshooting/image/${t}`;return console.log("âœ… troubleshooting URL:",l),l}function u(e){return x(e)}function h(e,s){var t;const l=e.currentTarget;console.error("ç”»åƒè¡¨ç¤ºã‚¨ãƒ©ãƒ¼:",s),console.log("å…ƒã®ç”»åƒURL:",s),console.log("å¤‰æ›å¾Œã®URL:",l.src);try{const e=g(),i=null==(t=s.split("/").pop())?void 0:t.split("\\").pop();if(i&&i!==s)return console.log("ãƒ•ã‚¡ã‚¤ãƒ«åã®ã¿ã§å†è©¦è¡Œ:",i),void(l.src=`${e}/api/emergency-flow/image/${i}`);console.log("å…ƒã®URLã‚’ãã®ã¾ã¾ä½¿ç”¨"),l.src=s}catch(i){console.error("ç”»åƒã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¤±æ•—:",i),l.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xMDAgNzBDMTE2LjU2OSA3MCAxMzAgODMuNDMxIDEzMCAxMDBDMTMwIDExNi41NjkgMTE2LjU2OSAxMzAgMTAwIDEzMEM4My40MzEgMTMwIDcwIDExNi41NjkgNzAgMTAwQzcwIDgzLjQzMSA4My40MzEgNzAgMTAwIDcwWiIgZmlsbD0iIzlDQTBBNiIvPgo8cGF0aCBkPSJNMTAwIDE0MEMxMTYuNTY5IDE0MCAxMzAgMTUzLjQzMSAxMzAgMTcwQzEzMCAxODYuNTY5IDExNi41NjkgMjAwIDEwMCAyMDBDODMuNDMxIDIwMCA3MCAxODYuNTY5IDcwIDE3MEM3MCAxNTMuNDMxIDgzLjQzMSAxNDAgMTAwIDE0MFoiIGZpbGw9IiM5Q0EwQTYiLz4KPHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIwIDIwQzIwIDE3LjIzOSAyMi4yMzkgMTUgMjUgMTVIMzVDMzcuNzYxIDE1IDQwIDE3LjIzOSA0MCAyMFYzMEM0MCAzMi43NjEgMzcuNzYxIDM1IDM1IDM1SDI1QzIyLjIzOSAzNSAyMCAzMi43NjEgMjAgMzBWMjBaIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yNSAxN0MyNSAxNi40NDc3IDI1LjQ0NzcgMTYgMjYgMTZIMzRDMzQuNTUyMyAxNiAzNSAxNi40NDc3IDM1IDE3VjI5QzM1IDI5LjU1MjMgMzQuNTUyMyAzMCAzNCAzMEgyNkMyNS40NDc3IDMwIDI1IDI5LjU1MjMgMjUgMjlWMTdaIiBmaWxsPSIjOTlBM0Y2Ii8+Cjwvc3ZnPgo8L3N2Zz4K"}}
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p=e("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),j=e("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function N({guideId:e,onExit:g,isPreview:x=!1,onSendToChat:N,backButtonText:M="æˆ»ã‚‹"}){const[I,f]=i.useState(null),[w,y]=i.useState(0),[b,D]=i.useState(!0),[A,z]=i.useState(""),[v,U]=i.useState(null),[E,T]=i.useState([]),[C,S]=i.useState(!1),[L,k]=i.useState(!1);i.useEffect(()=>{e&&(async()=>{try{D(!0),console.log("ğŸ”„ å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹:",e);const s=`?ts=${Date.now()}&r=${Math.random().toString(36).substring(2)}`,{buildApiUrl:l}=await t(async()=>{const{buildApiUrl:e}=await import("./index-D2n-Q-xG.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),i=l(`/emergency-flow/detail/${e}${s}`);console.log("ğŸŒ ã‚¬ã‚¤ãƒ‰è©³ç´°API URL:",i);const a=await fetch(i,{method:"GET",headers:{"Cache-Control":"no-cache, no-store, must-revalidate, max-age=0",Pragma:"no-cache",Expires:"Thu, 01 Jan 1970 00:00:00 GMT","X-Requested-With":"XMLHttpRequest"}});if(console.log("ğŸ“¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹çŠ¶æ…‹:",a.status,a.statusText),!a.ok){const e=await a.text();throw console.error("âŒ API ã‚¨ãƒ©ãƒ¼:",e),new Error(`Failed to fetch guide data: ${a.status} - ${e}`)}const r=await a.json();console.log("ğŸ“Š å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:",r);const n=r.success&&r.data?r.data:r;if(console.log("ğŸ“‹ å‡¦ç†å¯¾è±¡ãƒ‡ãƒ¼ã‚¿:",n),f(n),n.steps&&n.steps.length>0){const e=n.steps[0];T([{stepId:e.id,title:e.title,message:e.message,type:e.type,imageUrl:e.imageUrl,images:e.images,timestamp:new Date}])}}catch(s){console.error("Guide data fetch error:",s),z("ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")}finally{D(!1)}})()},[e]);const R=e=>{if(I)if(e){const s=I.steps.findIndex(s=>s.id===e);if(-1!==s){y(s),U(null);const e=I.steps[s],t={stepId:e.id,title:e.title,message:e.message,type:e.type,imageUrl:e.imageUrl,images:e.images,selectedCondition:v,timestamp:new Date};T(e=>[...e,t])}}else if(w<I.steps.length-1){const e=w+1;y(e),U(null);const s=I.steps[e],t={stepId:s.id,title:s.title,message:s.message,type:s.type,imageUrl:s.imageUrl,images:s.images,timestamp:new Date};T(e=>[...e,t])}},B=()=>{if(!I||0===E.length)return;const e={title:I.title,description:I.description,executedSteps:E.filter(e=>"start"!==e.type&&"end"!==e.type),totalSteps:E.length,completedAt:new Date,isPartial:!C};window.dispatchEvent(new CustomEvent("emergency-guide-completed",{detail:e})),N&&N(),C?g():(console.log("è¡¨ç¤ºã—ãŸãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡å®Œäº†:",e),k(!0),setTimeout(()=>{k(!1)},3e3))};if(b)return l.jsx(a,{className:"w-full max-w-4xl mx-auto",children:l.jsx(r,{className:"flex justify-center items-center py-12",children:l.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})});if(A||!I)return l.jsxs(a,{className:"w-full max-w-4xl mx-auto",children:[l.jsx(n,{children:l.jsx(c,{className:"text-red-600",children:"ã‚¨ãƒ©ãƒ¼"})}),l.jsxs(r,{children:[l.jsx("p",{className:"mb-4",children:A||"ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),l.jsx(s,{onClick:g,children:"æˆ»ã‚‹"})]})]});const P=I&&I.steps&&0!==I.steps.length&&I.steps[w]||null,Z=w===I.steps.length-1,$=0===w;return P?l.jsxs(a,{className:"w-full max-w-4xl mx-auto",children:[l.jsx(n,{children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex items-start gap-2 flex-1 min-w-0",children:[l.jsxs(s,{variant:"ghost",size:"sm",onClick:g,className:"flex-shrink-0",children:[l.jsx(o,{className:"h-4 w-4"}),M]}),l.jsxs(c,{className:"text-xl break-words leading-tight",children:[I.title,x&&" (ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)"]})]}),l.jsxs("div",{className:"text-sm text-gray-500 flex-shrink-0 ml-4",children:["ã‚¹ãƒ†ãƒƒãƒ— ",w+1," / ",I.steps.length]})]})}),l.jsx(r,{children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[l.jsx("h3",{className:"font-semibold text-blue-900 mb-2 text-lg",children:P.title}),P.description&&l.jsx("p",{className:"text-blue-800 text-sm mb-3",children:P.description}),l.jsx("div",{className:"text-blue-800 whitespace-pre-line",children:P.message})]}),"decision"===P.type&&P.conditions&&P.conditions.length>0&&l.jsxs("div",{className:"space-y-3",children:[l.jsx("h4",{className:"font-medium text-gray-900",children:x?"æ¡ä»¶åˆ†å²:":"é¸æŠã—ã¦ãã ã•ã„ï¼š"}),x?l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:P.conditions.map((e,s)=>l.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg bg-gray-50",children:[l.jsx("div",{className:"font-medium text-sm",children:e.label}),l.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["æ¬¡ã‚¹ãƒ†ãƒƒãƒ—:"," ",(()=>{const s=I.steps.find(s=>s.id===e.nextId),t=I.steps.findIndex(s=>s.id===e.nextId);return s?`${s.title||`ã‚¹ãƒ†ãƒƒãƒ— ${t+1}`}`:"æœªè¨­å®š"})()]})]},s))}):l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:P.conditions.map((e,t)=>l.jsx(s,{variant:"outline",className:"h-auto p-4 text-left justify-start",onClick:()=>(e=>{U(e.nextId),R(e.nextId)})(e),children:l.jsx("div",{className:"flex flex-col items-start",children:l.jsx("span",{className:"font-medium",children:e.label})})},t))})]}),P.images&&P.images.length>0?l.jsx("div",{className:"mt-4",children:l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.images.map((e,s)=>l.jsxs("div",{className:"relative",children:[l.jsx("img",{src:u(e.url),alt:`${P.title} - ${e.fileName||"ç”»åƒ"}`,className:"w-full h-auto rounded-lg shadow-md",crossOrigin:"anonymous",onError:t=>{console.error("âŒ ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (emergency-guide-display):",{imageUrl:e.url,builtUrl:u(e.url),fileName:e.fileName,stepTitle:P.title,index:s}),h(t,e.url)},onLoad:()=>{console.log("âœ… ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ (emergency-guide-display):",{imageUrl:e.url,builtUrl:u(e.url),fileName:e.fileName,stepTitle:P.title,index:s})}}),e.fileName&&l.jsx("div",{className:"text-sm text-gray-600 mt-1",children:e.fileName})]},s))})}):P.imageUrl?l.jsx("div",{className:"mt-4",children:l.jsx("img",{src:u(P.imageUrl),alt:P.title,className:"w-full h-auto rounded-lg shadow-md",crossOrigin:"anonymous",onError:e=>{console.error("âŒ ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (legacy imageUrl):",{imageUrl:P.imageUrl,builtUrl:u(P.imageUrl),stepTitle:P.title}),h(e,P.imageUrl)},onLoad:()=>{console.log("âœ… ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ (legacy imageUrl):",{imageUrl:P.imageUrl,builtUrl:u(P.imageUrl),stepTitle:P.title})}})}):l.jsxs("div",{className:"mt-4 text-center py-4 bg-gray-50 rounded-lg",children:[l.jsx(d,{className:"mx-auto h-8 w-8 text-gray-400"}),l.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã«ç”»åƒã¯ã‚ã‚Šã¾ã›ã‚“"})]}),l.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[l.jsxs(s,{variant:"outline",onClick:()=>{w>0&&(y(w-1),U(null),T(e=>e.slice(0,-1)))},disabled:$,children:[l.jsx(o,{className:"h-4 w-4 mr-2"}),"å‰ã¸"]}),l.jsxs("div",{className:"flex gap-2",children:[w>=1&&!C&&!x&&l.jsxs(s,{onClick:B,variant:"outline",className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-300",children:[l.jsx(j,{className:"h-4 w-4 mr-2"}),"è¡¨ç¤ºã—ãŸãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡"]}),(x||"decision"!==P.type)&&l.jsx(s,{onClick:Z?()=>{S(!0)}:()=>R(),className:"flex items-center gap-2",children:Z?l.jsxs(l.Fragment,{children:[l.jsx(m,{className:"h-4 w-4"}),"å®Œäº†"]}):l.jsxs(l.Fragment,{children:["æ¬¡ã¸",l.jsx(p,{className:"h-4 w-4"})]})})]})]}),C&&!x&&l.jsxs("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(m,{className:"h-5 w-5 text-green-600"}),l.jsx("span",{className:"text-green-800 font-medium",children:"å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ãŒå®Œäº†ã—ã¾ã—ãŸ"})]}),l.jsxs(s,{onClick:B,className:"bg-green-600 hover:bg-green-700 text-white",children:[l.jsx(j,{className:"h-4 w-4 mr-2"}),"ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡"]})]}),l.jsx("p",{className:"text-green-700 text-sm mt-2",children:"å®Ÿè¡Œã—ãŸã‚¹ãƒ†ãƒƒãƒ—ã¨ç”»åƒã‚’ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«è¨˜éŒ²ã—ã¾ã™"})]}),C&&x&&l.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(m,{className:"h-5 w-5 text-blue-600"}),l.jsx("span",{className:"text-blue-800 font-medium",children:"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†"})]}),l.jsx("p",{className:"text-blue-700 text-sm mt-2",children:"ãƒ•ãƒ­ãƒ¼ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚å®Ÿéš›ã®ä½¿ç”¨æ™‚ã«ã¯ãƒãƒ£ãƒƒãƒˆé€ä¿¡æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚"})]}),L&&!x&&l.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg animate-pulse",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(m,{className:"h-5 w-5 text-blue-600"}),l.jsx("span",{className:"text-blue-800 font-medium",children:"è¡¨ç¤ºã—ãŸãƒ•ãƒ­ãƒ¼ã‚’ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡ã—ã¾ã—ãŸ"})]}),l.jsx("p",{className:"text-blue-700 text-sm mt-2",children:"ç¾åœ¨ã¾ã§ã®å®Ÿè¡Œå±¥æ­´ãŒãƒãƒ£ãƒƒãƒˆå±¥æ­´ã«è¨˜éŒ²ã•ã‚Œã¾ã—ãŸã€‚ã‚¬ã‚¤ãƒ‰ã‚’ç¶šè¡Œã§ãã¾ã™ã€‚"})]})]})},P.id)]}):l.jsx(a,{className:"w-full max-w-4xl mx-auto",children:l.jsxs(r,{children:[l.jsx("p",{className:"text-center py-8",children:"ã‚¹ãƒ†ãƒƒãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}),l.jsx(s,{onClick:g,className:"w-full",children:"æˆ»ã‚‹"})]})})}export{p as A,N as E,j as S,x as c};
