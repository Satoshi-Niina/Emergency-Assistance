# Emergency Assistance - ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰

## ğŸ¯ ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å®Œå…¨åˆ†é›¢ãƒ‡ãƒ—ãƒ­ã‚¤æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             GitHub Repository (main)                 â”‚
â”‚  - Client (React/Vite)                              â”‚
â”‚  - Server (Node.js/Express)                         â”‚
â”‚  - Docker Configuration                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ git push
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â–¼                 â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Actions       â”‚  â”‚ GitHub       â”‚  â”‚ GitHub         â”‚
â”‚ (Client Deploy)      â”‚  â”‚ Actions      â”‚  â”‚ Actions        â”‚
â”‚ - Build React        â”‚  â”‚ (Docker)     â”‚  â”‚ (Server)       â”‚
â”‚ - Deploy to SWA      â”‚  â”‚ - Build img  â”‚  â”‚ - Deploy ACR   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                     â”‚                   â”‚
           â–¼                     â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure Static Web Appsâ”‚  â”‚ Azure        â”‚  â”‚ Azure App      â”‚
â”‚ - React Frontend     â”‚  â”‚ Container    â”‚  â”‚ Service        â”‚
â”‚ - CDNé…ä¿¡            â”‚  â”‚ Registry     â”‚  â”‚ (Docker)       â”‚
â”‚ witty-river-*.net    â”‚  â”‚ - Imageä¿å­˜  â”‚  â”‚ - Containerå®Ÿè¡Œâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                          â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ API calls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              https://.../api/*
```

## ğŸ“‹ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

### 1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆFrontendï¼‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤

**è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤**: `client/**` ã®å¤‰æ›´ã‚’pushã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add client/
git commit -m "feat: update client feature"
git push origin main

# GitHub Actions ãŒè‡ªå‹•å®Ÿè¡Œ
# â†’ Azure Static Web Apps ã«ãƒ‡ãƒ—ãƒ­ã‚¤
```

**æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤**:
```bash
# GitHub Actions ã® Manual trigger
# Repository â†’ Actions â†’ "Deploy Client" â†’ Run workflow
```

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: `.github/workflows/cliente-azure.yml`

**ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆ**:
- Production: `https://witty-river-012f39e00.1.azurestaticapps.net`
- Staging: `https://staging.witty-river-012f39e00.1.azurestaticapps.net`

### 2. ã‚µãƒ¼ãƒãƒ¼ï¼ˆBackendï¼‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ - Dockerç‰ˆ

**è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤**: `server/**` ã¾ãŸã¯ `Dockerfile` ã®å¤‰æ›´ã‚’pushã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ã‚µãƒ¼ãƒãƒ¼ã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add server/ Dockerfile
git commit -m "feat: update server API"
git push origin main

# GitHub Actions ãŒè‡ªå‹•å®Ÿè¡Œ
# â†’ Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
# â†’ Azure Container Registry ã«ãƒ—ãƒƒã‚·ãƒ¥
# â†’ Azure App Service ã«ãƒ‡ãƒ—ãƒ­ã‚¤
```

**æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤**:
```bash
# GitHub Actions ã® Manual trigger
# Repository â†’ Actions â†’ "Deploy Server (Docker)" â†’ Run workflow
```

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: `.github/workflows/azure-docker-deploy.yml`

**ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼**:
1. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
2. Azure Container Registry ã«ãƒ—ãƒƒã‚·ãƒ¥
3. Azure App Service ãŒæ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒ«
4. ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•

**ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆ**:
- Production: `https://emergency-assistance-bfckhjejb3fbf9du.japanwest-01.azurewebsites.net`

## ğŸ”§ å¿…è¦ãªGitHub Secrets

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨
```yaml
AZURE_STATIC_WEB_APPS_API_TOKEN: <your-static-web-apps-token>
AZURE_STATIC_WEB_APPS_API_TOKEN_STAGING: <your-staging-token> # Optional
```

### ã‚µãƒ¼ãƒãƒ¼ç”¨ï¼ˆDockerï¼‰
```yaml
# Azure Container Registry
ACR_LOGIN_SERVER: emergencyassistanceacr.azurecr.io
ACR_USERNAME: <your-acr-username>
ACR_PASSWORD: <your-acr-password>

# Azure App Service
AZURE_WEBAPP_PUBLISH_PROFILE: <your-publish-profile>
AZURE_CREDENTIALS: <your-service-principal-json>
AZURE_RESOURCE_GROUP: <your-resource-group>

# Application Secrets
DATABASE_URL: postgresql://...
SESSION_SECRET: <32-char-secret>
JWT_SECRET: <32-char-secret>
OPENAI_API_KEY: sk-...
AZURE_STORAGE_CONNECTION_STRING: DefaultEndpointsProtocol=https;...
AZURE_STORAGE_CONTAINER_NAME: knowledge
```

## ğŸš€ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```bash
# 1. Dockeré–‹ç™ºç’°å¢ƒã§é–‹ç™º
.\start-docker.ps1
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ2ã€ã‚’é¸æŠï¼ˆé–‹ç™ºç’°å¢ƒï¼‰
# http://localhost:8080 ã§ã‚¢ã‚¯ã‚»ã‚¹

# 2. ã‚³ãƒ¼ãƒ‰å¤‰æ›´ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ã§è‡ªå‹•åæ˜ ï¼‰
# ... é–‹ç™ºä½œæ¥­ ...

# 3. æœ¬ç•ªç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
.\start-docker.ps1
# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€Œ1ã€ã‚’é¸æŠï¼ˆæœ¬ç•ªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
# http://localhost:8080 ã§å‹•ä½œç¢ºèª

# 4. å•é¡Œãªã‘ã‚Œã°ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
git add .
git commit -m "feat: new feature"
git push origin main

# 5. è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
# â†’ GitHub Actions ãŒè‡ªå‹•å®Ÿè¡Œ
# â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ: Static Web Apps ã¸
# â†’ ã‚µãƒ¼ãƒãƒ¼: Docker ã‚³ãƒ³ãƒ†ãƒŠã§ App Service ã¸

# 6. æœ¬ç•ªç’°å¢ƒã§å‹•ä½œç¢ºèª
# https://witty-river-012f39e00.1.azurestaticapps.net
```

## ğŸ“Š ãƒ‡ãƒ—ãƒ­ã‚¤ã®æ¯”è¼ƒ

### å¾“æ¥ã®æ–¹æ³•ï¼ˆå»ƒæ­¢ï¼‰

| å•é¡Œç‚¹ | èª¬æ˜ |
|--------|------|
| âŒ ç’°å¢ƒã®ä¸ä¸€è‡´ | ãƒ­ãƒ¼ã‚«ãƒ«ã¨æœ¬ç•ªã§å‹•ä½œãŒç•°ãªã‚‹ |
| âŒ è¤‡é›‘ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ | test-production-locally.ps1 ç­‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå¿…è¦ |
| âŒ CORSã‚¨ãƒ©ãƒ¼ | ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ã—ã‹ç™ºè¦‹ã§ããªã„ |
| âŒ ãƒ‡ãƒãƒƒã‚°å›°é›£ | æœ¬ç•ªç’°å¢ƒã§ã®å•é¡Œã‚’å†ç¾ã—ã«ãã„ |

### Dockeræ–¹å¼ï¼ˆç¾åœ¨ï¼‰

| ãƒ¡ãƒªãƒƒãƒˆ | èª¬æ˜ |
|---------|------|
| âœ… ç’°å¢ƒã®å®Œå…¨ä¸€è‡´ | ãƒ­ãƒ¼ã‚«ãƒ« = æœ¬ç•ªã‚’ä¿è¨¼ |
| âœ… ã‚·ãƒ³ãƒ—ãƒ« | `.\start-docker.ps1` ã ã‘ã§æœ¬ç•ªç’°å¢ƒã‚’å†ç¾ |
| âœ… äº‹å‰æ¤œè¨¼ | ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ã™ã¹ã¦ã®å•é¡Œã‚’ç™ºè¦‹ |
| âœ… ç¢ºå®Ÿæ€§ | ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œ = æœ¬ç•ªã§ã‚‚å‹•ä½œ |

## ğŸ” ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl https://witty-river-012f39e00.1.azurestaticapps.net

# ä¸»è¦æ©Ÿèƒ½ç¢ºèª
# 1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
# 2. ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
# 3. APIé€šä¿¡
```

### ã‚µãƒ¼ãƒãƒ¼

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl https://emergency-assistance-bfckhjejb3fbf9du.japanwest-01.azurewebsites.net/health

# APIç¢ºèª
curl https://emergency-assistance-bfckhjejb3fbf9du.japanwest-01.azurewebsites.net/api/ping

# è©³ç´°æƒ…å ±
curl https://emergency-assistance-bfckhjejb3fbf9du.japanwest-01.azurewebsites.net/api/health/detailed
```

## ğŸ†˜ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã™ã‚‹

```bash
# ãƒ­ã‚°ç¢ºèª
# GitHub Actions â†’ Cliente-azure workflow â†’ å¤±æ•—ã—ãŸã‚¸ãƒ§ãƒ–

# è§£æ±ºæ–¹æ³•
1. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
2. ä¾å­˜é–¢ä¿‚ã‚’ç¢ºèª: npm ci
3. Secrets ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
```

### ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¤±æ•—ã™ã‚‹

```bash
# Docker ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
1. Dockerfile ã®æ§‹æ–‡ã‚’ç¢ºèª
2. ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ: docker build .

# Azure ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼
1. ACRèªè¨¼æƒ…å ±ã‚’ç¢ºèª
2. App Serviceè¨­å®šã‚’ç¢ºèª
3. ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª

# ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•ã‚¨ãƒ©ãƒ¼
1. Azure Portal â†’ App Service â†’ ãƒ­ã‚°ã‚’ç¢ºèª
2. Container Settings ã‚’ç¢ºèª
3. ç’°å¢ƒå¤‰æ•° WEBSITES_PORT=8080 ã‚’ç¢ºèª
```

### ãƒ­ãƒ¼ã‚«ãƒ«ã¨æœ¬ç•ªã§å‹•ä½œãŒç•°ãªã‚‹

```bash
# Dockeræœ¬ç•ªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§å†ç¾
.\start-docker.ps1  # â†’ ã€Œ1ã€ã‚’é¸æŠ

# æœ¬ç•ªç’°å¢ƒã¨åŒã˜æ§‹æˆã§å‹•ä½œç¢ºèª
# å•é¡ŒãŒå†ç¾ã—ãŸã‚‰ä¿®æ­£ â†’ å†ãƒ†ã‚¹ãƒˆ
```

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Dockerç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](DOCKER_SETUP.md)
- [Docker ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](DOCKER_QUICKREF.md)
- [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](DEVELOPMENT_SETUP.md)
- [Azure Docker ãƒ‡ãƒ—ãƒ­ã‚¤è©³ç´°](docs/AZURE_DOCKER_DEPLOYMENT.md)

## âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰

- [ ] ãƒ­ãƒ¼ã‚«ãƒ«Dockerã§å‹•ä½œç¢ºèª
- [ ] æœ¬ç•ªç’°å¢ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ãƒ†ã‚¹ãƒˆ
- [ ] CORSã‚¨ãƒ©ãƒ¼ãªã—
- [ ] APIãŒæ­£å¸¸ã«å‹•ä½œ
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒæ­£å¸¸
- [ ] GitHub Secrets ãŒè¨­å®šæ¸ˆã¿

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œ

- [ ] ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚µãƒ¼ãƒãƒ¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸ
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãŒå‹•ä½œ
- [ ] APIå‘¼ã³å‡ºã—ãŒæˆåŠŸ
- [ ] CORSã‚¨ãƒ©ãƒ¼ãªã—
- [ ] ä¸»è¦æ©Ÿèƒ½ãŒå‹•ä½œ

---

**é‡è¦**: Dockerç’°å¢ƒã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€**ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œç¢ºèª = æœ¬ç•ªã§ã‚‚ç¢ºå®Ÿã«å‹•ä½œ**ãŒä¿è¨¼ã•ã‚Œã¾ã™ï¼
