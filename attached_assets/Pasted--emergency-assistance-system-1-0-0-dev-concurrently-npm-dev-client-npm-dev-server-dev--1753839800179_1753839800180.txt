
> emergency-assistance-system@1.0.0 dev
> concurrently "npm:dev-client" "npm:dev-server"

[dev-client] 
[dev-client] > emergency-assistance-system@1.0.0 dev-client
[dev-client] > cd client && vite --host 0.0.0.0 --port 5001
[dev-client] 
[dev-server] 
[dev-server] > emergency-assistance-system@1.0.0 dev-server
[dev-server] > tsx server/index.ts
[dev-server] 
[dev-client] [dotenv@17.0.1] injecting env (0) from .env – [tip] encrypt with dotenvx: https://dotenvx.com
[dev-client] 
[dev-client]   VITE v5.4.19  ready in 341 ms
[dev-client] 
[dev-client]   ➜  Local:   http://localhost:5001/
[dev-client]   ➜  Network: http://172.31.107.66:5001/
[dev-server] 🔍 DEBUG server/db/schema.ts: DATABASE_URL = postgresql://neondb_owner:npg_D9YMuCVw6TUo@ep-mute-dew-afai7m8x.c-2.us-west-2.aws.neon.tech/neondb?sslmode=require
[dev-server] 🔍 DEBUG server/db/schema.ts: connectionString = postgresql://neondb_owner:npg_D9YMuCVw6TUo@ep-mute-dew-afai7m8x.c-2.us-west-2.aws.neon.tech/neondb?sslmode=require
[dev-server] 🔍 DEBUG server/db/index.ts: DATABASE_URL = postgresql://neondb_owner:npg_D9YMuCVw6TUo@ep-mute-dew-afai7m8x.c-2.us-west-2.aws.neon.tech/neondb?sslmode=require
[dev-server] 🔍 DEBUG server/db/index.ts: connectionString = postgresql://neondb_owner:npg_D9YMuCVw6TUo@ep-mute-dew-afai7m8x.c-2.us-west-2.aws.neon.tech/neondb?sslmode=require
[dev-server] 🔧 [AUTH ROUTER] 認証ルーター初期化開始
[dev-server] ✅ [AUTH ROUTER] 認証ルーター初期化完了
[dev-server] 📍 登録されたルート: POST /login, POST /register, POST /logout, GET /me
[dev-server] 🔍 DEBUG: DATABASE_URL = postgresql://neondb_owner:npg_D9YMuCVw6TUo@ep-mute-dew-afai7m8x.c-2.us-west-2.aws.neon.tech/neondb?sslmode=require
[dev-server] 🔍 認証ルーターインポート状況: { authRouterExists: true, authRouterType: 'function' }
[dev-server] 🔎 [起動時パス確認] knowledge-base/images/emergency-flows: /home/runner/workspace/knowledge-base/images/emergency-flows (exists: true)
[dev-server] 🔎 [起動時パス確認] knowledge-base/data: /home/runner/workspace/knowledge-base/data (exists: true)
[dev-server] 🔎 [起動時パス確認] knowledge-base/troubleshooting: /home/runner/workspace/knowledge-base/troubleshooting (exists: true)
[dev-server] 🔎 [起動時パス確認] .env: /home/runner/workspace/server/.env (exists: false)
[dev-server] 🔎 [環境変数確認] OpenAI API KEY: [SET]
[dev-server] 🚀 サーバー起動開始
[dev-server] ✅ 環境変数読み込み完了
[dev-server] 🔧 Expressインスタンス作成
[dev-server] 🚀 サーバーをポート 5000 で起動中...
[dev-server] 📡 使用ポート: 5000
[dev-server] 🛣️ ルーティング設定開始
[dev-server] 🔧 認証ルート登録中...
[dev-server] 📍 authRouter type: function
[dev-server] 📍 authRouter is function: true
[dev-server] ✅ authRouter is valid Express router
[dev-server] ✅ 認証ルート登録完了: /api/auth
[dev-server] 📍 登録された認証ルート:
[dev-server]   [0] post /login
[dev-server]   [1] post /register
[dev-server]   [2] post /logout
[dev-server]   [3] get /me
[dev-server] ✅ 画像配信ルート設定完了
[dev-server] ✅ 全ルート設定完了
[dev-server] 🔄 サーバーlisten開始
[dev-server] ✅ サーバーindex.tsファイルの終端
[dev-server] 🚀 Server successfully started on http://0.0.0.0:5000
[dev-server] 🌐 Local access: http://localhost:5000
[dev-server] 📂 Working directory: /home/runner/workspace
[dev-server] 🔧 Node environment: development
[dev-server] 🔄 データベース接続テスト開始...
[dev-server] 
[dev-server] 🔍 [2025-07-30T01:42:52.485Z] GET /
[dev-server] 📍 詳細: {
[dev-server]   url: '/',
[dev-server]   path: '/',
[dev-server]   originalUrl: '/',
[dev-server]   baseUrl: '',
[dev-server]   method: 'GET',
[dev-server]   headers: {
[dev-server]     host: 'ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     origin: undefined,
[dev-server]     'content-type': undefined,
[dev-server]     'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWeb...'
[dev-server]   },
[dev-server]   body: 'N/A'
[dev-server] }
[dev-server] 🔍 CORS チェック: {
[dev-server]   origin: undefined,
[dev-server]   allowedOrigins: [
[dev-server]     'http://localhost:3000',
[dev-server]     'http://localhost:4173',
[dev-server]     'http://localhost:5001',
[dev-server]     'http://127.0.0.1:3000',
[dev-server]     'http://127.0.0.1:4173',
[dev-server]     'http://127.0.0.1:5001',
[dev-server]     '=https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     'https://workspace.takabeniniina.repl.co',
[dev-server]     'https://workspace.takabeniniina.repl.co:3001',
[dev-server]     'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001'
[dev-server]   ]
[dev-server] }
[dev-server] ✅ CORS許可: オリジンなし（同一オリジン）
[dev-server] 📨 [2025-07-30T01:42:52.490Z] GET /
[dev-server] 🔍 Headers: Origin=undefined, Host=ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev, Referer=https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev/__replco/workspace_iframe.html?initialPath=%2F&id=%3Ar2oi%3A
[dev-server] 🔍 Full URL: http://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev/
[dev-server] 
[dev-server] ❌ [404 NOT FOUND] GET /
[dev-server] 📍 詳細情報: {
[dev-server]   path: '/',
[dev-server]   originalUrl: '/',
[dev-server]   baseUrl: '',
[dev-server]   method: 'GET',
[dev-server]   headers: {
[dev-server]     host: 'ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     origin: undefined,
[dev-server]     'content-type': undefined
[dev-server]   }
[dev-server] }
[dev-server] 
[dev-server] 🔍 [EXPRESS ROUTER STACK 詳細調査]
[dev-server] 🛣️ Express app._router.stack:
[dev-server]   [0] regexp: /^\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: query
[dev-server]   [1] regexp: /^\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: expressInit
[dev-server]   [2] regexp: /^(.*)\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: <anonymous>
[dev-server]   [3] regexp: /^\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: corsMiddleware
[dev-server]   [4] regexp: /^\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: jsonParser
[dev-server]   [5] regexp: /^\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: urlencodedParser
[dev-server]   [6] regexp: /^\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: session
[dev-server]   [7] regexp: /^\/public\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: serveStatic
[dev-server]   [8] regexp: /^\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: <anonymous>
[dev-server]   [9] regexp: /^\/api\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: <anonymous>
[dev-server]   [10] regexp: /^\/api\/auth\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: router
[dev-server]        🔧 Sub-router found with 4 routes:
[dev-server]          [0] /login - {"post":true}
[dev-server]          [1] /register - {"post":true}
[dev-server]          [2] /logout - {"post":true}
[dev-server]          [3] /me - {"get":true}
[dev-server]   [11] regexp: /^\/api\/emergency-flow\/image\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: serveStatic
[dev-server]   [12] regexp: /^\/api\/health\/?$/i, methods: {"get":true}
[dev-server]        path: /api/health, name: bound dispatch
[dev-server]   [13] regexp: /^\/api\/chats(?:\/([^/]+?))\/last-export\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: <anonymous>
[dev-server]   [14] regexp: /^\/api\/(.*)\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: <anonymous>
[dev-server]   [15] regexp: /^\/api\/troubleshooting\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: router
[dev-server]        🔧 Sub-router found with 6 routes:
[dev-server]          [0] /list - {"get":true}
[dev-server]          [1] /detail/:id - {"get":true}
[dev-server]          [2] / - {"post":true}
[dev-server]          [3] /:id - {"put":true}
[dev-server]          [4] /:id - {"delete":true}
[dev-server]          [5] /search - {"post":true}
[dev-server]   [16] regexp: /^\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: <anonymous>
[dev-server]   [17] regexp: /^(.*)\/?(?=\/|$)/i, methods: "N/A"
[dev-server]        path: middleware, name: <anonymous>
[dev-server] 🛣️ 想定されているAPIルート:
[dev-server]   ✅ POST /api/auth/login
[dev-server]   ✅ GET /api/auth/me
[dev-server]   ✅ POST /api/auth/logout
[dev-server]   ✅ POST /api/auth/register
[dev-server] ✅ Connected to PostgreSQL database
[dev-server] ✅ データベース接続成功
[dev-server] 🔄 デフォルトユーザー作成開始...
[dev-server] 🔄 デフォルトユーザー作成開始...
[dev-server] 
[dev-server] 🔍 [2025-07-30T01:42:54.200Z] GET /api/auth/me
[dev-server] 📍 詳細: {
[dev-server]   url: '/',
[dev-server]   path: '/',
[dev-server]   originalUrl: '/api/auth/me',
[dev-server]   baseUrl: '/api/auth/me',
[dev-server]   method: 'GET',
[dev-server]   headers: {
[dev-server]     host: 'ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     origin: 'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001',
[dev-server]     'content-type': undefined,
[dev-server]     'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWeb...'
[dev-server]   },
[dev-server]   body: 'N/A'
[dev-server] }
[dev-server] 🔍 CORS チェック: {
[dev-server]   origin: 'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001',
[dev-server]   allowedOrigins: [
[dev-server]     'http://localhost:3000',
[dev-server]     'http://localhost:4173',
[dev-server]     'http://localhost:5001',
[dev-server]     'http://127.0.0.1:3000',
[dev-server]     'http://127.0.0.1:4173',
[dev-server]     'http://127.0.0.1:5001',
[dev-server]     '=https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     'https://workspace.takabeniniina.repl.co',
[dev-server]     'https://workspace.takabeniniina.repl.co:3001',
[dev-server]     'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001'
[dev-server]   ]
[dev-server] }
[dev-server] ✅ CORS許可: Replit環境
[dev-server] 📨 [2025-07-30T01:42:54.201Z] GET /api/auth/me
[dev-server] 🔍 Headers: Origin=https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001, Host=ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev, Referer=https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001/
[dev-server] 🔍 Full URL: http://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev/api/auth/me
[dev-server] 🔍 [API Route Handler] 受信: {
[dev-server]   method: 'GET',
[dev-server]   path: '/auth/me',
[dev-server]   originalUrl: '/api/auth/me',
[dev-server]   baseUrl: '/api',
[dev-server]   headers: {
[dev-server]     'content-type': undefined,
[dev-server]     'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWeb'
[dev-server]   }
[dev-server] }
[dev-server] 🔐 [認証API] 詳細: { method: 'GET', path: '/auth/me', body: 'N/A', hasSession: true }
[dev-server] 👤 ユーザー情報取得リクエスト: { hasSession: true, userId: undefined }
[dev-server] ❌ 認証されていません
[dev-server] 
[dev-server] 🔍 [2025-07-30T01:42:54.363Z] GET /api/auth/me
[dev-server] 📍 詳細: {
[dev-server]   url: '/',
[dev-server]   path: '/',
[dev-server]   originalUrl: '/api/auth/me',
[dev-server]   baseUrl: '/api/auth/me',
[dev-server]   method: 'GET',
[dev-server]   headers: {
[dev-server]     host: 'ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     origin: 'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001',
[dev-server]     'content-type': undefined,
[dev-server]     'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWeb...'
[dev-server]   },
[dev-server]   body: 'N/A'
[dev-server] }
[dev-server] 🔍 CORS チェック: {
[dev-server]   origin: 'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001',
[dev-server]   allowedOrigins: [
[dev-server]     'http://localhost:3000',
[dev-server]     'http://localhost:4173',
[dev-server]     'http://localhost:5001',
[dev-server]     'http://127.0.0.1:3000',
[dev-server]     'http://127.0.0.1:4173',
[dev-server]     'http://127.0.0.1:5001',
[dev-server]     '=https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     'https://workspace.takabeniniina.repl.co',
[dev-server]     'https://workspace.takabeniniina.repl.co:3001',
[dev-server]     'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev',
[dev-server]     'https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001'
[dev-server]   ]
[dev-server] }
[dev-server] ✅ CORS許可: Replit環境
[dev-server] 📨 [2025-07-30T01:42:54.364Z] GET /api/auth/me
[dev-server] 🔍 Headers: Origin=https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001, Host=ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev, Referer=https://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev:3001/
[dev-server] 🔍 Full URL: http://ceb3a872-0092-4e86-a990-adc5b271598b-00-tlthbuz5ebfd.sisko.replit.dev/api/auth/me
[dev-server] 🔍 [API Route Handler] 受信: {
[dev-server]   method: 'GET',
[dev-server]   path: '/auth/me',
[dev-server]   originalUrl: '/api/auth/me',
[dev-server]   baseUrl: '/api',
[dev-server]   headers: {
[dev-server]     'content-type': undefined,
[dev-server]     'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWeb'
[dev-server]   }
[dev-server] }
[dev-server] 🔐 [認証API] 詳細: { method: 'GET', path: '/auth/me', body: 'N/A', hasSession: true }
[dev-server] 👤 ユーザー情報取得リクエスト: { hasSession: true, userId: undefined }
[dev-server] ❌ 認証されていません
[dev-server] 🗑️ 既存のniinaユーザーを削除しました
[dev-server] 🔐 新しいパスワードハッシュを生成: $2b$10$vAW0CifkrS.gWAoexc2S7unkkY.h7CrXaO5VKHUDnz57Zul7E70wW
[dev-server] ✅ 管理者ユーザー (niina) を再作成しました
[dev-server] takabeni1ユーザーは既に存在します
[dev-server] デフォルトユーザーの作成が完了しました
[dev-server] ✅ デフォルトユーザー作成完了
^C[dev-server] npm run dev-server exited with code SIGINT
[dev-client] npm run dev-client exited with code SIGINT