â‘  emergency-guide.tsxï¼ˆå‰Šé™¤ãƒ•ã‚¡ã‚¤ãƒ«ãŒå†è¡¨ç¤ºã•ã‚Œãªã„ï¼‰
ğŸ”§ è¿½åŠ ãƒ»ä¿®æ­£ç®‡æ‰€ï¼šuseEffect ã« flowDataUpdated ã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œã‚’è¿½åŠ 

tsx
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
useEffect(() => {
  const refreshFlowList = async () => {
    try {
      const response = await fetch(`/api/emergency-flow/list?ts=${Date.now()}`);
      if (!response.ok) throw new Error("èª­ã¿è¾¼ã¿å¤±æ•—");
      const data = await response.json();
      setFlowList(Array.isArray(data) ? data : []);
    } catch (err) {
      console.error("ãƒ•ãƒ­ãƒ¼ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼", err);
    }
  };

  window.addEventListener("flowDataUpdated", refreshFlowList);
  return () => window.removeEventListener("flowDataUpdated", refreshFlowList);
}, []);
âœ… â‘¡ emergency-flow-creator.tsxï¼ˆä¿å­˜ã•ã‚Œãªã„ä¸å…·åˆä¿®æ­£ï¼‰
ğŸ”§ ä¿å­˜å¾Œã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¦ã„ãŸéƒ¨åˆ†ã‚’å‰Šé™¤ã—ã€ä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å†è¨­å®š

tsx
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
if (result.success) {
  toast({
    title: "ä¿å­˜æˆåŠŸ",
    description: `å¿œæ€¥å‡¦ç½®ãƒ•ãƒ­ãƒ¼ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ: ${result.fileName}`,
  });

  await fetchFlowList();

  // ğŸ”½ ä¿®æ­£ç‚¹ï¼šflowData ã‚’åˆæœŸåŒ–ã—ãªã„
  setFlowData(saveData);
  setCharacterDesignTab('file'); // ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã«æˆ»ã‚‹ã ã‘ã«ã™ã‚‹
}
âœ… â‘¢ emergency-flow-editor.tsxï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç·¨é›† + åˆ¤æ–­ãƒãƒ¼ãƒ‰æ¡ä»¶ä¿å­˜ï¼‰
ğŸ›  è¿½åŠ  UIï¼šãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†æ¬„
tsx
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
{selectedNode && (
  <div className="mb-2">
    <Label htmlFor="node-label">ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¿ã‚¤ãƒˆãƒ«</Label>
    <Input
      id="node-label"
      value={selectedNode.data.label || ''}
      onChange={(e) => updateNodeData('label', e.target.value)}
    />
  </div>
)}
ğŸ›  åˆ¤æ–­ãƒãƒ¼ãƒ‰ç”¨ï¼šæ¡ä»¶é …ç›®ï¼ˆyes/no/otherï¼‰ç·¨é›†æ¬„
tsx
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
{selectedNode?.type === 'decision' && (
  <>
    <Label>ã¯ã„ï¼ˆyesï¼‰ã®æ¡ä»¶</Label>
    <Input
      value={selectedNode.data.yesCondition || ''}
      onChange={(e) => updateNodeData('yesCondition', e.target.value)}
    />
    <Label>ã„ã„ãˆï¼ˆnoï¼‰ã®æ¡ä»¶</Label>
    <Input
      value={selectedNode.data.noCondition || ''}
      onChange={(e) => updateNodeData('noCondition', e.target.value)}
    />
    <Label>ãã®ä»–ï¼ˆotherï¼‰ã®æ¡ä»¶</Label>
    <Input
      value={selectedNode.data.otherCondition || ''}
      onChange={(e) => updateNodeData('otherCondition', e.target.value)}
    />
  </>
)}
ğŸ›  useEffectï¼šåˆæœŸèª­ã¿è¾¼ã¿æ™‚ã«æ¡ä»¶ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã™ã‚‹å‡¦ç†
tsx
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
useEffect(() => {
  if (Array.isArray(initialData?.nodes)) {
    const enhanced = initialData.nodes.map(node => {
      if (node.type === 'decision') {
        const match = initialData.steps?.find(step => step.id === node.id);
        if (match) {
          return {
            ...node,
            data: {
              ...node.data,
              yesCondition: match.yesCondition || '',
              noCondition: match.noCondition || '',
              otherCondition: match.otherCondition || ''
            }
          };
        }
      }
      return node;
    });
    setNodes(enhanced);
  }
}, [initialData]);
ğŸ›  ä¿å­˜æ™‚ï¼šstep ã«æ¡ä»¶é …ç›®ã‚’å«ã‚ã‚‹ï¼ˆæ—¢ã«å¯¾å¿œæ¸ˆã ãŒå†ç¢ºèªï¼‰
tsx
ã‚³ãƒ”ãƒ¼ã™ã‚‹
ç·¨é›†ã™ã‚‹
if (node.type === 'decision') {
  step.yesCondition = node.data.yesCondition || '';
  step.noCondition = node.data.noCondition || '';
  step.otherCondition = node.data.otherCondition || '';
}