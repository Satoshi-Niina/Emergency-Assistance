<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>編集機能テスト</title>
  <style>
    .readonly {
      display: block;
    }
    
    .editable {
      display: none;
      background-color: #f0f0f0;
      color: #000;
      border: 1px solid #ccc;
      border-radius: 3px;
      padding: 8px;
    }
    
    .edit-mode .readonly {
      display: none !important;
    }
    
    .edit-mode .editable {
      display: block !important;
      width: 100% !important;
      padding: 8px !important;
      border: 1px solid #007bff !important;
      border-radius: 3px !important;
      color: #000 !important;
      background-color: #fff !important;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      margin: 5px;
    }
    
    .btn-edit {
      background: #007bff;
      color: white;
    }
    
    .btn-save {
      background: #ffc107;
      color: #000;
    }
    
    .btn-cancel {
      background: #6c757d;
      color: white;
    }
  </style>
</head>
<body>
  <div>
    <button class="btn btn-edit" onclick="console.log('編集ボタンクリック'); toggleEditMode()">編集</button>
    <button class="btn btn-save" onclick="console.log('保存ボタンクリック'); saveData()" style="display: none;">保存</button>
    <button class="btn btn-cancel" onclick="console.log('キャンセルボタンクリック'); toggleEditMode()" style="display: none;">キャンセル</button>
  </div>
  
  <div style="margin: 20px; padding: 20px; border: 1px solid #ccc;">
    <h2>テストフィールド</h2>
    <div style="margin: 10px 0;">
      <strong>名前：</strong>
      <span class="readonly">テスト太郎</span>
      <input class="editable" value="テスト太郎" />
    </div>
    <div style="margin: 10px 0;">
      <strong>場所：</strong>
      <span class="readonly">東京</span>
      <input class="editable" value="東京" />
    </div>
    <div style="margin: 10px 0;">
      <strong>説明：</strong>
      <span class="readonly">これはテストです</span>
      <textarea class="editable">これはテストです</textarea>
    </div>
  </div>
  
  <script>
    let isEditMode = false;
    
    function toggleEditMode() {
      console.log('toggleEditMode呼び出し, 現在のisEditMode:', isEditMode);
      
      isEditMode = !isEditMode;
      console.log('新しいisEditMode:', isEditMode);
      
      const editBtn = document.querySelector('.btn-edit');
      const saveBtn = document.querySelector('.btn-save');
      const cancelBtn = document.querySelector('.btn-cancel');
      
      console.log('ボタン要素:', { 
        editBtn: !!editBtn, 
        saveBtn: !!saveBtn, 
        cancelBtn: !!cancelBtn 
      });
      
      if (isEditMode) {
        console.log('編集モードに入る');
        if (editBtn) editBtn.style.display = 'none';
        if (saveBtn) saveBtn.style.display = 'inline-block';
        if (cancelBtn) cancelBtn.style.display = 'inline-block';
        document.body.classList.add('edit-mode');
        console.log('body class:', document.body.classList.toString());
      } else {
        console.log('編集モードを終了');
        if (editBtn) editBtn.style.display = 'inline-block';
        if (saveBtn) saveBtn.style.display = 'none';
        if (cancelBtn) cancelBtn.style.display = 'none';
        document.body.classList.remove('edit-mode');
        console.log('body class:', document.body.classList.toString());
      }
      
      // 表示状態を確認
      setTimeout(() => {
        const readonlyElements = document.querySelectorAll('.readonly');
        const editableElements = document.querySelectorAll('.editable');
        
        console.log('readonly要素数:', readonlyElements.length);
        console.log('editable要素数:', editableElements.length);
        
        readonlyElements.forEach((el, index) => {
          const computedStyle = window.getComputedStyle(el);
          console.log(`readonly[${index}] display:`, computedStyle.display);
        });
        
        editableElements.forEach((el, index) => {
          const computedStyle = window.getComputedStyle(el);
          console.log(`editable[${index}] display:`, computedStyle.display);
        });
      }, 100);
    }
    
    function saveData() {
      console.log('保存処理実行');
      // 編集を終了
      toggleEditMode();
      alert('保存されました');
    }
    
    // ページ読み込み時
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ページ読み込み完了');
      console.log('readonly要素数:', document.querySelectorAll('.readonly').length);
      console.log('editable要素数:', document.querySelectorAll('.editable').length);
    });
  </script>
</body>
</html>
