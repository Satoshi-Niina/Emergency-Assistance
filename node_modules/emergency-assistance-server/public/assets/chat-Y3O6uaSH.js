const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BWHx4aNU.js","assets/ui-BaYWhfWe.js","assets/vendor-C0Yfakdp.js","assets/index-D8OdIOAq.css"])))=>i.map(i=>d[i]);
import{d as e,u as t,e as n,f as a,X as s,B as r,W as i,a as o,_ as l}from"./index-BWHx4aNU.js";import{j as c}from"./ui-BaYWhfWe.js";import{r as d}from"./vendor-C0Yfakdp.js";import{V as u,S as m}from"./switch-BMAW5kNP.js";import{I as h}from"./input-DPpCwyP1.js";import{T as g}from"./textarea-BelS5tPE.js";import{S as p,E as f}from"./emergency-guide-display-BIXLoTK-.js";import{D as x,a as b,b as w,c as y}from"./dialog-BMg_uIt1.js";import{C as v,a as j}from"./circle-aSrAhnk-.js";import"./tabs-SMrEzrxB.js";import{C as N,a as k,b as S,c as C}from"./card-DPbG-Nme.js";import{B as M}from"./badge-BmXFADSs.js";import{C as E}from"./circle-check-big-quDMk7dN.js";import{M as T,A as D}from"./message-circle-BhN4tAzF.js";import{T as P}from"./triangle-alert-Dw5gCUdQ.js";import{L as W}from"./label-CwZArt2K.js";import{B as A}from"./brain-B9-0Kj1B.js";import{U as I}from"./upload-Cqtwg_0Z.js";import{T as L}from"./trash-2-DuaaSSbK.js";import"./index-CttfQz0H.js";import"./arrow-left-CJxWYUvX.js";import"./image-B9rWll4Q.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=e("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),z=e("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),$=e("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),R=e("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),O=e("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]),q=e("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),F=e("TabletSmartphone",[["rect",{width:"10",height:"14",x:"3",y:"8",rx:"2",key:"1vrsiq"}],["path",{d:"M5 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2h-2.4",key:"1j4zmg"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),H=e("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]),U=6048e5,B=Symbol.for("constructDateFrom");
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function Y(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&B in e?e[B](t):e instanceof Date?new e.constructor(t):new Date(t)}function Q(e,t){return Y(t||e,e)}let V={};function X(){return V}function G(e,t){var n,a,s,r;const i=X(),o=(null==t?void 0:t.weekStartsOn)??(null==(a=null==(n=null==t?void 0:t.locale)?void 0:n.options)?void 0:a.weekStartsOn)??i.weekStartsOn??(null==(r=null==(s=i.locale)?void 0:s.options)?void 0:r.weekStartsOn)??0,l=Q(e,null==t?void 0:t.in),c=l.getDay(),d=(c<o?7:0)+c-o;return l.setDate(l.getDate()-d),l.setHours(0,0,0,0),l}function J(e,t){return G(e,{...t,weekStartsOn:1})}function K(e,t){const n=Q(e,null==t?void 0:t.in),a=n.getFullYear(),s=Y(n,0);s.setFullYear(a+1,0,4),s.setHours(0,0,0,0);const r=J(s),i=Y(n,0);i.setFullYear(a,0,4),i.setHours(0,0,0,0);const o=J(i);return n.getTime()>=r.getTime()?a+1:n.getTime()>=o.getTime()?a:a-1}function Z(e){const t=Q(e),n=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return n.setUTCFullYear(t.getFullYear()),+e-+n}function ee(e,t){const n=Q(e,null==t?void 0:t.in);return n.setHours(0,0,0,0),n}function te(e,t,n){const[a,s]=function(e,...t){const n=Y.bind(null,t.find(e=>"object"==typeof e));return t.map(n)}(null==n||n.in,e,t),r=ee(a),i=ee(s),o=+r-Z(r),l=+i-Z(i);return Math.round((o-l)/864e5)}function ne(e){return!(!((t=e)instanceof Date||"object"==typeof t&&"[object Date]"===Object.prototype.toString.call(t))&&"number"!=typeof e||isNaN(+Q(e)));var t}const ae={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function se(e){return(t={})=>{const n=t.width?String(t.width):e.defaultWidth;return e.formats[n]||e.formats[e.defaultWidth]}}const re={date:se({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:se({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:se({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ie={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function oe(e){return(t,n)=>{let a;if("formatting"===((null==n?void 0:n.context)?String(n.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,s=(null==n?void 0:n.width)?String(n.width):t;a=e.formattingValues[s]||e.formattingValues[t]}else{const t=e.defaultWidth,s=(null==n?void 0:n.width)?String(n.width):e.defaultWidth;a=e.values[s]||e.values[t]}return a[e.argumentCallback?e.argumentCallback(t):t]}}function le(e){return(t,n={})=>{const a=n.width,s=a&&e.matchPatterns[a]||e.matchPatterns[e.defaultMatchWidth],r=t.match(s);if(!r)return null;const i=r[0],o=a&&e.parsePatterns[a]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(o)?function(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n;return}(o,e=>e.test(i)):function(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t(e[n]))return n;return}(o,e=>e.test(i));let c;c=e.valueCallback?e.valueCallback(l):l,c=n.valueCallback?n.valueCallback(c):c;return{value:c,rest:t.slice(i.length)}}}function ce(e){return(t,n={})=>{const a=t.match(e.matchPattern);if(!a)return null;const s=a[0],r=t.match(e.parsePattern);if(!r)return null;let i=e.valueCallback?e.valueCallback(r[0]):r[0];i=n.valueCallback?n.valueCallback(i):i;return{value:i,rest:t.slice(s.length)}}}const de={code:"en-US",formatDistance:(e,t,n)=>{let a;const s=ae[e];return a="string"==typeof s?s:1===t?s.one:s.other.replace("{{count}}",t.toString()),(null==n?void 0:n.addSuffix)?n.comparison&&n.comparison>0?"in "+a:a+" ago":a},formatLong:re,formatRelative:(e,t,n,a)=>ie[e],localize:{ordinalNumber:(e,t)=>{const n=Number(e),a=n%100;if(a>20||a<10)switch(a%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:oe({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:oe({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:oe({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:oe({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:oe({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:ce({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:le({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:le({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:le({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:le({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:le({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function ue(e,t){const n=Q(e,null==t?void 0:t.in),a=te(n,function(e,t){const n=Q(e,null==t?void 0:t.in);return n.setFullYear(n.getFullYear(),0,1),n.setHours(0,0,0,0),n}(n));return a+1}function me(e,t){const n=Q(e,null==t?void 0:t.in),a=+J(n)-+function(e,t){const n=K(e,t),a=Y(e,0);return a.setFullYear(n,0,4),a.setHours(0,0,0,0),J(a)}(n);return Math.round(a/U)+1}function he(e,t){var n,a,s,r;const i=Q(e,null==t?void 0:t.in),o=i.getFullYear(),l=X(),c=(null==t?void 0:t.firstWeekContainsDate)??(null==(a=null==(n=null==t?void 0:t.locale)?void 0:n.options)?void 0:a.firstWeekContainsDate)??l.firstWeekContainsDate??(null==(r=null==(s=l.locale)?void 0:s.options)?void 0:r.firstWeekContainsDate)??1,d=Y((null==t?void 0:t.in)||e,0);d.setFullYear(o+1,0,c),d.setHours(0,0,0,0);const u=G(d,t),m=Y((null==t?void 0:t.in)||e,0);m.setFullYear(o,0,c),m.setHours(0,0,0,0);const h=G(m,t);return+i>=+u?o+1:+i>=+h?o:o-1}function ge(e,t){const n=Q(e,null==t?void 0:t.in),a=+G(n,t)-+function(e,t){var n,a,s,r;const i=X(),o=(null==t?void 0:t.firstWeekContainsDate)??(null==(a=null==(n=null==t?void 0:t.locale)?void 0:n.options)?void 0:a.firstWeekContainsDate)??i.firstWeekContainsDate??(null==(r=null==(s=i.locale)?void 0:s.options)?void 0:r.firstWeekContainsDate)??1,l=he(e,t),c=Y((null==t?void 0:t.in)||e,0);return c.setFullYear(l,0,o),c.setHours(0,0,0,0),G(c,t)}(n,t);return Math.round(a/U)+1}function pe(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const fe={y(e,t){const n=e.getFullYear(),a=n>0?n:1-n;return pe("yy"===t?a%100:a,t.length)},M(e,t){const n=e.getMonth();return"M"===t?String(n+1):pe(n+1,2)},d:(e,t)=>pe(e.getDate(),t.length),a(e,t){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];default:return"am"===n?"a.m.":"p.m."}},h:(e,t)=>pe(e.getHours()%12||12,t.length),H:(e,t)=>pe(e.getHours(),t.length),m:(e,t)=>pe(e.getMinutes(),t.length),s:(e,t)=>pe(e.getSeconds(),t.length),S(e,t){const n=t.length,a=e.getMilliseconds();return pe(Math.trunc(a*Math.pow(10,n-3)),t.length)}},xe="midnight",be="noon",we="morning",ye="afternoon",ve="evening",je="night",Ne={G:function(e,t,n){const a=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(a,{width:"abbreviated"});case"GGGGG":return n.era(a,{width:"narrow"});default:return n.era(a,{width:"wide"})}},y:function(e,t,n){if("yo"===t){const t=e.getFullYear(),a=t>0?t:1-t;return n.ordinalNumber(a,{unit:"year"})}return fe.y(e,t)},Y:function(e,t,n,a){const s=he(e,a),r=s>0?s:1-s;if("YY"===t){return pe(r%100,2)}return"Yo"===t?n.ordinalNumber(r,{unit:"year"}):pe(r,t.length)},R:function(e,t){return pe(K(e),t.length)},u:function(e,t){return pe(e.getFullYear(),t.length)},Q:function(e,t,n){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(a);case"QQ":return pe(a,2);case"Qo":return n.ordinalNumber(a,{unit:"quarter"});case"QQQ":return n.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(a,{width:"narrow",context:"formatting"});default:return n.quarter(a,{width:"wide",context:"formatting"})}},q:function(e,t,n){const a=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(a);case"qq":return pe(a,2);case"qo":return n.ordinalNumber(a,{unit:"quarter"});case"qqq":return n.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(a,{width:"narrow",context:"standalone"});default:return n.quarter(a,{width:"wide",context:"standalone"})}},M:function(e,t,n){const a=e.getMonth();switch(t){case"M":case"MM":return fe.M(e,t);case"Mo":return n.ordinalNumber(a+1,{unit:"month"});case"MMM":return n.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(a,{width:"narrow",context:"formatting"});default:return n.month(a,{width:"wide",context:"formatting"})}},L:function(e,t,n){const a=e.getMonth();switch(t){case"L":return String(a+1);case"LL":return pe(a+1,2);case"Lo":return n.ordinalNumber(a+1,{unit:"month"});case"LLL":return n.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(a,{width:"narrow",context:"standalone"});default:return n.month(a,{width:"wide",context:"standalone"})}},w:function(e,t,n,a){const s=ge(e,a);return"wo"===t?n.ordinalNumber(s,{unit:"week"}):pe(s,t.length)},I:function(e,t,n){const a=me(e);return"Io"===t?n.ordinalNumber(a,{unit:"week"}):pe(a,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getDate(),{unit:"date"}):fe.d(e,t)},D:function(e,t,n){const a=ue(e);return"Do"===t?n.ordinalNumber(a,{unit:"dayOfYear"}):pe(a,t.length)},E:function(e,t,n){const a=e.getDay();switch(t){case"E":case"EE":case"EEE":return n.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(a,{width:"short",context:"formatting"});default:return n.day(a,{width:"wide",context:"formatting"})}},e:function(e,t,n,a){const s=e.getDay(),r=(s-a.weekStartsOn+8)%7||7;switch(t){case"e":return String(r);case"ee":return pe(r,2);case"eo":return n.ordinalNumber(r,{unit:"day"});case"eee":return n.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(s,{width:"short",context:"formatting"});default:return n.day(s,{width:"wide",context:"formatting"})}},c:function(e,t,n,a){const s=e.getDay(),r=(s-a.weekStartsOn+8)%7||7;switch(t){case"c":return String(r);case"cc":return pe(r,t.length);case"co":return n.ordinalNumber(r,{unit:"day"});case"ccc":return n.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(s,{width:"narrow",context:"standalone"});case"cccccc":return n.day(s,{width:"short",context:"standalone"});default:return n.day(s,{width:"wide",context:"standalone"})}},i:function(e,t,n){const a=e.getDay(),s=0===a?7:a;switch(t){case"i":return String(s);case"ii":return pe(s,t.length);case"io":return n.ordinalNumber(s,{unit:"day"});case"iii":return n.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(a,{width:"short",context:"formatting"});default:return n.day(a,{width:"wide",context:"formatting"})}},a:function(e,t,n){const a=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){const a=e.getHours();let s;switch(s=12===a?be:0===a?xe:a/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(s,{width:"narrow",context:"formatting"});default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(e,t,n){const a=e.getHours();let s;switch(s=a>=17?ve:a>=12?ye:a>=4?we:je,t){case"B":case"BB":case"BBB":return n.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(s,{width:"narrow",context:"formatting"});default:return n.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),n.ordinalNumber(t,{unit:"hour"})}return fe.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getHours(),{unit:"hour"}):fe.H(e,t)},K:function(e,t,n){const a=e.getHours()%12;return"Ko"===t?n.ordinalNumber(a,{unit:"hour"}):pe(a,t.length)},k:function(e,t,n){let a=e.getHours();return 0===a&&(a=24),"ko"===t?n.ordinalNumber(a,{unit:"hour"}):pe(a,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getMinutes(),{unit:"minute"}):fe.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getSeconds(),{unit:"second"}):fe.s(e,t)},S:function(e,t){return fe.S(e,t)},X:function(e,t,n){const a=e.getTimezoneOffset();if(0===a)return"Z";switch(t){case"X":return Se(a);case"XXXX":case"XX":return Ce(a);default:return Ce(a,":")}},x:function(e,t,n){const a=e.getTimezoneOffset();switch(t){case"x":return Se(a);case"xxxx":case"xx":return Ce(a);default:return Ce(a,":")}},O:function(e,t,n){const a=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+ke(a,":");default:return"GMT"+Ce(a,":")}},z:function(e,t,n){const a=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+ke(a,":");default:return"GMT"+Ce(a,":")}},t:function(e,t,n){return pe(Math.trunc(+e/1e3),t.length)},T:function(e,t,n){return pe(+e,t.length)}};function ke(e,t=""){const n=e>0?"-":"+",a=Math.abs(e),s=Math.trunc(a/60),r=a%60;return 0===r?n+String(s):n+String(s)+t+pe(r,2)}function Se(e,t){if(e%60==0){return(e>0?"-":"+")+pe(Math.abs(e)/60,2)}return Ce(e,t)}function Ce(e,t=""){const n=e>0?"-":"+",a=Math.abs(e);return n+pe(Math.trunc(a/60),2)+t+pe(a%60,2)}const Me=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Ee=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Te={p:Ee,P:(e,t)=>{const n=e.match(/(P+)(p+)?/)||[],a=n[1],s=n[2];if(!s)return Me(e,t);let r;switch(a){case"P":r=t.dateTime({width:"short"});break;case"PP":r=t.dateTime({width:"medium"});break;case"PPP":r=t.dateTime({width:"long"});break;default:r=t.dateTime({width:"full"})}return r.replace("{{date}}",Me(a,t)).replace("{{time}}",Ee(s,t))}},De=/^D+$/,Pe=/^Y+$/,We=["D","DD","YY","YYYY"];const Ae=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ie=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Le=/^'([^]*?)'?$/,_e=/''/g,ze=/[a-zA-Z]/;function $e(e,t,n){var a,s,r,i,o,l,c,d;const u=X(),m=(null==n?void 0:n.locale)??u.locale??de,h=(null==n?void 0:n.firstWeekContainsDate)??(null==(s=null==(a=null==n?void 0:n.locale)?void 0:a.options)?void 0:s.firstWeekContainsDate)??u.firstWeekContainsDate??(null==(i=null==(r=u.locale)?void 0:r.options)?void 0:i.firstWeekContainsDate)??1,g=(null==n?void 0:n.weekStartsOn)??(null==(l=null==(o=null==n?void 0:n.locale)?void 0:o.options)?void 0:l.weekStartsOn)??u.weekStartsOn??(null==(d=null==(c=u.locale)?void 0:c.options)?void 0:d.weekStartsOn)??0,p=Q(e,null==n?void 0:n.in);if(!ne(p))throw new RangeError("Invalid time value");let f=t.match(Ie).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,Te[t])(e,m.formatLong)}return e}).join("").match(Ae).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:Re(e)};if(Ne[t])return{isToken:!0,value:e};if(t.match(ze))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});m.localize.preprocessor&&(f=m.localize.preprocessor(p,f));const x={firstWeekContainsDate:h,weekStartsOn:g,locale:m};return f.map(a=>{if(!a.isToken)return a.value;const s=a.value;(!(null==n?void 0:n.useAdditionalWeekYearTokens)&&function(e){return Pe.test(e)}(s)||!(null==n?void 0:n.useAdditionalDayOfYearTokens)&&function(e){return De.test(e)}(s))&&function(e,t,n){const a=function(e,t,n){const a="Y"===e[0]?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${a} to the input \`${n}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(e,t,n);if(console.warn(a),We.includes(e))throw new RangeError(a)}(s,t,String(e));return(0,Ne[s[0]])(p,s,m.localize,x)}).join("")}function Re(e){const t=e.match(Le);return t?t[1].replace(_e,"'"):e}const Oe={lessThanXSeconds:{one:"1ç§’æœªæº€",other:"{{count}}ç§’æœªæº€",oneWithSuffix:"ç´„1ç§’",otherWithSuffix:"ç´„{{count}}ç§’"},xSeconds:{one:"1ç§’",other:"{{count}}ç§’"},halfAMinute:"30ç§’",lessThanXMinutes:{one:"1åˆ†æœªæº€",other:"{{count}}åˆ†æœªæº€",oneWithSuffix:"ç´„1åˆ†",otherWithSuffix:"ç´„{{count}}åˆ†"},xMinutes:{one:"1åˆ†",other:"{{count}}åˆ†"},aboutXHours:{one:"ç´„1æ™‚é–“",other:"ç´„{{count}}æ™‚é–“"},xHours:{one:"1æ™‚é–“",other:"{{count}}æ™‚é–“"},xDays:{one:"1æ—¥",other:"{{count}}æ—¥"},aboutXWeeks:{one:"ç´„1é€±é–“",other:"ç´„{{count}}é€±é–“"},xWeeks:{one:"1é€±é–“",other:"{{count}}é€±é–“"},aboutXMonths:{one:"ç´„1ã‹æœˆ",other:"ç´„{{count}}ã‹æœˆ"},xMonths:{one:"1ã‹æœˆ",other:"{{count}}ã‹æœˆ"},aboutXYears:{one:"ç´„1å¹´",other:"ç´„{{count}}å¹´"},xYears:{one:"1å¹´",other:"{{count}}å¹´"},overXYears:{one:"1å¹´ä»¥ä¸Š",other:"{{count}}å¹´ä»¥ä¸Š"},almostXYears:{one:"1å¹´è¿‘ã",other:"{{count}}å¹´è¿‘ã"}},qe={date:se({formats:{full:"yå¹´Mæœˆdæ—¥EEEE",long:"yå¹´Mæœˆdæ—¥",medium:"y/MM/dd",short:"y/MM/dd"},defaultWidth:"full"}),time:se({formats:{full:"Hæ™‚mmåˆ†ssç§’ zzzz",long:"H:mm:ss z",medium:"H:mm:ss",short:"H:mm"},defaultWidth:"full"}),dateTime:se({formats:{full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},defaultWidth:"full"})},Fe={lastWeek:"å…ˆé€±ã®eeeeã®p",yesterday:"æ˜¨æ—¥ã®p",today:"ä»Šæ—¥ã®p",tomorrow:"æ˜æ—¥ã®p",nextWeek:"ç¿Œé€±ã®eeeeã®p",other:"P"},He={code:"ja",formatDistance:(e,t,n)=>{let a;n=n||{};const s=Oe[e];return a="string"==typeof s?s:1===t?n.addSuffix&&s.oneWithSuffix?s.oneWithSuffix:s.one:n.addSuffix&&s.otherWithSuffix?s.otherWithSuffix.replace("{{count}}",String(t)):s.other.replace("{{count}}",String(t)),n.addSuffix?n.comparison&&n.comparison>0?a+"å¾Œ":a+"å‰":a},formatLong:qe,formatRelative:(e,t,n,a)=>Fe[e],localize:{ordinalNumber:(e,t)=>{const n=Number(e);switch(String(null==t?void 0:t.unit)){case"year":return`${n}å¹´`;case"quarter":return`ç¬¬${n}å››åŠæœŸ`;case"month":return`${n}æœˆ`;case"week":return`ç¬¬${n}é€±`;case"date":return`${n}æ—¥`;case"hour":return`${n}æ™‚`;case"minute":return`${n}åˆ†`;case"second":return`${n}ç§’`;default:return`${n}`}},era:oe({values:{narrow:["BC","AC"],abbreviated:["ç´€å…ƒå‰","è¥¿æš¦"],wide:["ç´€å…ƒå‰","è¥¿æš¦"]},defaultWidth:"wide"}),quarter:oe({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["ç¬¬1å››åŠæœŸ","ç¬¬2å››åŠæœŸ","ç¬¬3å››åŠæœŸ","ç¬¬4å››åŠæœŸ"]},defaultWidth:"wide",argumentCallback:e=>Number(e)-1}),month:oe({values:{narrow:["1","2","3","4","5","6","7","8","9","10","11","12"],abbreviated:["1æœˆ","2æœˆ","3æœˆ","4æœˆ","5æœˆ","6æœˆ","7æœˆ","8æœˆ","9æœˆ","10æœˆ","11æœˆ","12æœˆ"],wide:["1æœˆ","2æœˆ","3æœˆ","4æœˆ","5æœˆ","6æœˆ","7æœˆ","8æœˆ","9æœˆ","10æœˆ","11æœˆ","12æœˆ"]},defaultWidth:"wide"}),day:oe({values:{narrow:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"],short:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"],abbreviated:["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"],wide:["æ—¥æ›œæ—¥","æœˆæ›œæ—¥","ç«æ›œæ—¥","æ°´æ›œæ—¥","æœ¨æ›œæ—¥","é‡‘æ›œæ—¥","åœŸæ›œæ—¥"]},defaultWidth:"wide"}),dayPeriod:oe({values:{narrow:{am:"åˆå‰",pm:"åˆå¾Œ",midnight:"æ·±å¤œ",noon:"æ­£åˆ",morning:"æœ",afternoon:"åˆå¾Œ",evening:"å¤œ",night:"æ·±å¤œ"},abbreviated:{am:"åˆå‰",pm:"åˆå¾Œ",midnight:"æ·±å¤œ",noon:"æ­£åˆ",morning:"æœ",afternoon:"åˆå¾Œ",evening:"å¤œ",night:"æ·±å¤œ"},wide:{am:"åˆå‰",pm:"åˆå¾Œ",midnight:"æ·±å¤œ",noon:"æ­£åˆ",morning:"æœ",afternoon:"åˆå¾Œ",evening:"å¤œ",night:"æ·±å¤œ"}},defaultWidth:"wide",formattingValues:{narrow:{am:"åˆå‰",pm:"åˆå¾Œ",midnight:"æ·±å¤œ",noon:"æ­£åˆ",morning:"æœ",afternoon:"åˆå¾Œ",evening:"å¤œ",night:"æ·±å¤œ"},abbreviated:{am:"åˆå‰",pm:"åˆå¾Œ",midnight:"æ·±å¤œ",noon:"æ­£åˆ",morning:"æœ",afternoon:"åˆå¾Œ",evening:"å¤œ",night:"æ·±å¤œ"},wide:{am:"åˆå‰",pm:"åˆå¾Œ",midnight:"æ·±å¤œ",noon:"æ­£åˆ",morning:"æœ",afternoon:"åˆå¾Œ",evening:"å¤œ",night:"æ·±å¤œ"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:ce({matchPattern:/^ç¬¬?\d+(å¹´|å››åŠæœŸ|æœˆ|é€±|æ—¥|æ™‚|åˆ†|ç§’)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}}),era:le({matchPatterns:{narrow:/^(B\.?C\.?|A\.?D\.?)/i,abbreviated:/^(ç´€å…ƒ[å‰å¾Œ]|è¥¿æš¦)/i,wide:/^(ç´€å…ƒ[å‰å¾Œ]|è¥¿æš¦)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^B/i,/^A/i],any:[/^(ç´€å…ƒå‰)/i,/^(è¥¿æš¦|ç´€å…ƒå¾Œ)/i]},defaultParseWidth:"any"}),quarter:le({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^Q[1234]/i,wide:/^ç¬¬[1234ä¸€äºŒä¸‰å››ï¼‘ï¼’ï¼“ï¼”]å››åŠæœŸ/i},defaultMatchWidth:"wide",parsePatterns:{any:[/(1|ä¸€|ï¼‘)/i,/(2|äºŒ|ï¼’)/i,/(3|ä¸‰|ï¼“)/i,/(4|å››|ï¼”)/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:le({matchPatterns:{narrow:/^([123456789]|1[012])/,abbreviated:/^([123456789]|1[012])æœˆ/i,wide:/^([123456789]|1[012])æœˆ/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^1\D/,/^2/,/^3/,/^4/,/^5/,/^6/,/^7/,/^8/,/^9/,/^10/,/^11/,/^12/]},defaultParseWidth:"any"}),day:le({matchPatterns:{narrow:/^[æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ]/,short:/^[æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ]/,abbreviated:/^[æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ]/,wide:/^[æ—¥æœˆç«æ°´æœ¨é‡‘åœŸ]æ›œæ—¥/},defaultMatchWidth:"wide",parsePatterns:{any:[/^æ—¥/,/^æœˆ/,/^ç«/,/^æ°´/,/^æœ¨/,/^é‡‘/,/^åœŸ/]},defaultParseWidth:"any"}),dayPeriod:le({matchPatterns:{any:/^(AM|PM|åˆå‰|åˆå¾Œ|æ­£åˆ|æ·±å¤œ|çœŸå¤œä¸­|å¤œ|æœ)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^(A|åˆå‰)/i,pm:/^(P|åˆå¾Œ)/i,midnight:/^æ·±å¤œ|çœŸå¤œä¸­/i,noon:/^æ­£åˆ/i,morning:/^æœ/i,afternoon:/^åˆå¾Œ/i,evening:/^å¤œ/i,night:/^æ·±å¤œ/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function Ue({message:e,isDraft:s=!1}){const{user:r}=t(),{setSelectedText:i}=n(),[o,l]=d.useState(""),[m,h]=d.useState(!1),[g,p]=d.useState(!1),{toast:f}=a(),x=!e.isAiResponse,b=e.content&&e.content.includes("å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰å®Ÿæ–½è¨˜éŒ²");b&&console.log("ğŸ”µ å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¾ã™:",{id:e.id,isAiResponse:e.isAiResponse,contentStart:e.content.substring(0,50)+"...",timestamp:e.timestamp});let w="--:--";try{const t=e.timestamp||e.createdAt;if(t){const e=new Date(t);w=isNaN(e.getTime())?$e(new Date,"HH:mm",{locale:He}):$e(e,"HH:mm",{locale:He})}else w=$e(new Date,"HH:mm",{locale:He})}catch(v){console.error("æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼:",v,"timestamp:",e.timestamp),w=$e(new Date,"HH:mm",{locale:He})}const y=t=>{var n;const a=(null==(n=e.media)?void 0:n.map(e=>e.url))||[];window.dispatchEvent(new CustomEvent("preview-image",{detail:{url:t,all_slides:a.length>1?a:void 0,title:"å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰",content:e.content}}))};return c.jsxs("div",{className:`flex items-end mb-4 ${x?"justify-start":"justify-end"} min-w-[250px] ${s?"draft-message animate-pulse":""}`,onMouseUp:()=>{const e=window.getSelection(),t=null==e?void 0:e.toString();if(e&&t&&t.trim().length>0){const e=t.trim();l(e),h(!0)}else l(""),h(!1)},children:[c.jsxs("div",{className:`mx-2 flex flex-col ${x?"items-start":"items-end"} max-w-[70%] min-w-[230px]`,children:[c.jsx("div",{className:"flex items-center gap-2 mb-1",children:!x&&c.jsx("button",{onClick:async()=>{if(g)"speechSynthesis"in window&&window.speechSynthesis.cancel(),p(!1),f({title:"éŸ³å£°èª­ã¿ä¸Šã’ã‚’åœæ­¢ã—ã¾ã—ãŸ",duration:2e3});else{const t=e.content||e.text||"";if(!x&&t&&"string"==typeof t&&t.trim()){p(!0),f({title:"éŸ³å£°èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã—ã¾ã™",duration:2e3});try{await((e,t={})=>new Promise((n,a)=>{if(!("speechSynthesis"in window))return void a(new Error("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°åˆæˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“"));const s=new SpeechSynthesisUtterance(e);s.rate=t.rate||1,s.pitch=t.pitch||1,s.volume=t.volume||1,s.lang=t.lang||"ja-JP",s.onend=()=>{n()},s.onerror=e=>{a(new Error(`éŸ³å£°åˆæˆã‚¨ãƒ©ãƒ¼: ${e.error}`))},window.speechSynthesis.cancel(),window.speechSynthesis.speak(s)}))(t,{rate:1,pitch:1,lang:"ja-JP"})}catch(v){f({title:"éŸ³å£°èª­ã¿ä¸Šã’ã‚¨ãƒ©ãƒ¼",description:v instanceof Error?v.message:"éŸ³å£°ã®èª­ã¿ä¸Šã’ã«å¤±æ•—ã—ã¾ã—ãŸ",variant:"destructive"})}finally{p(!1)}}}},className:"w-8 h-8 flex items-center justify-center rounded-full shadow-sm \n                "+(g?"bg-indigo-600 text-white animate-pulse":"bg-blue-50 text-blue-600 hover:bg-blue-100"),title:g?"éŸ³å£°èª­ã¿ä¸Šã’ã‚’åœæ­¢":"éŸ³å£°èª­ã¿ä¸Šã’",children:c.jsx(u,{size:16})})}),c.jsxs("div",{className:"px-4 py-3 mb-1 shadow-sm w-full "+(x?"chat-bubble-user bg-blue-500 text-white rounded-[18px_18px_18px_4px] border border-blue-500":"chat-bubble-ai bg-white rounded-[18px_18px_4px_18px] border border-gray-200"),children:[c.jsxs("div",{className:"relative",children:[(()=>{const t=e.content||"";return t.startsWith("data:image/")||t.includes(".jpg")||t.includes(".png")||t.includes("/knowledge-base/images/")?c.jsx("img",{src:t,alt:"ç”»åƒ",className:"rounded-lg max-w-xs cursor-pointer",style:{maxHeight:"300px",objectFit:"contain"},onClick:()=>y(t)}):c.jsx("p",{className:x?"text-white":"text-gray-900",children:t})})(),m&&c.jsx("button",{onClick:()=>{o&&(i(o),f({title:"ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ",description:"é¸æŠã—ãŸãƒ†ã‚­ã‚¹ãƒˆãŒå…¥åŠ›æ¬„ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸã€‚"}),h(!1))},className:"absolute -top-2 -right-2 bg-blue-600 text-white p-1.5 rounded-full shadow-md hover:bg-blue-700 transition-colors",title:"å…¥åŠ›æ¬„ã«ã‚³ãƒ”ãƒ¼",children:c.jsx(R,{size:14})})]}),(e.media&&e.media.length>0&&console.log("ãƒ¡ãƒ‡ã‚£ã‚¢è¡¨ç¤º:",{messageId:e.id,mediaCount:e.media.length,mediaDetails:e.media.map((e,t)=>({index:t,type:e.type,urlPrefix:e.url.substring(0,50)+"...",urlLength:e.url.length,isBase64:e.url.startsWith("data:"),title:e.title,fileName:e.fileName}))}),c.jsx(c.Fragment,{children:e.media&&e.media.length>0&&c.jsxs("div",{className:"mt-3",children:[b&&e.media.length>0&&c.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[c.jsxs("div",{className:"text-sm text-blue-700 font-medium mb-2",children:["ğŸ“‹ å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ç”»åƒ (",e.media.length,"ä»¶)"]}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:e.media.map((t,n)=>c.jsx("div",{className:"relative",children:"image"===t.type&&c.jsxs("div",{className:"group cursor-pointer",children:[c.jsx("img",{src:t.url,alt:t.title||`ã‚¬ã‚¤ãƒ‰ç”»åƒ${n+1}`,className:"w-full h-20 object-cover rounded border border-blue-300 shadow-sm group-hover:shadow-md transition-shadow",onClick:()=>y(t.url),onLoad:a=>{console.log("å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ:",{messageId:e.id,mediaIndex:n,title:t.title,fileName:t.fileName})},onError:a=>{var s;console.error("å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",{messageId:e.id,mediaIndex:n,url:t.url.substring(0,100)+"...",title:t.title});const r=a.target;r.onerror=null,r.style.display="none";const i=document.createElement("div");i.className="w-full h-20 bg-gray-100 border border-gray-300 rounded flex items-center justify-center",i.innerHTML=`\n                                <div class="text-center text-gray-500 text-xs">\n                                  <div class="mb-1">âš ï¸</div>\n                                  <div>${t.fileName||"ç”»åƒ"}</div>\n                                </div>\n                              `,null==(s=r.parentNode)||s.insertBefore(i,r)}}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black bg-opacity-20 rounded",children:c.jsx("div",{className:"bg-white bg-opacity-80 p-1 rounded",children:c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),t.fileName&&c.jsx("div",{className:"text-xs text-gray-600 mt-1 truncate",children:t.fileName})]})},`${e.id}-guide-media-${n}`))})]}),(!b||0===e.media.length)&&e.media&&e.media.length>0&&c.jsx(c.Fragment,{children:e.media.map((t,n)=>c.jsxs("div",{className:"mt-2",children:["image"===t.type&&c.jsxs("div",{className:"relative",children:[c.jsx("img",{src:t.url,alt:"æ·»ä»˜ç”»åƒ",className:"rounded-lg w-full max-w-xs cursor-pointer border border-blue-200 shadow-md",style:{maxHeight:"300px",objectFit:"contain"},onClick:()=>y(t.url),onLoad:a=>{console.log("ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ:",{messageId:e.id,mediaIndex:n,width:a.target.naturalWidth,height:a.target.naturalHeight,urlType:t.url.startsWith("data:")?"base64":"url"})},onError:a=>{var s,r;console.warn("ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",{messageId:e.id,mediaIndex:n,url:t.url.substring(0,100)+"...",isBase64:t.url.startsWith("data:"),error:a});const i=a.target;if(i.onerror=null,t.url.startsWith("data:image/")){i.style.display="none";const e=document.createElement("div");e.className="flex items-center justify-center bg-gray-100 border border-gray-300 rounded-lg p-4 max-w-xs",e.innerHTML='<span class="text-gray-500 text-sm">ç”»åƒã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ</span>',null==(s=i.parentNode)||s.insertBefore(e,i)}else if(t.url.includes("/api/")){i.style.display="none";const e=document.createElement("div");e.className="flex items-center justify-center bg-gray-100 border border-gray-300 rounded-lg p-4 max-w-xs",e.innerHTML='<span class="text-gray-500 text-sm">ç”»åƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</span>',null==(r=i.parentNode)||r.insertBefore(e,i)}else i.src.includes("/placeholder-image.png")||(i.src="/placeholder-image.png")}}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",onClick:()=>y(t.url),children:c.jsx("div",{className:"bg-blue-600 bg-opacity-70 p-2 rounded-full",children:c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})})]}),"video"===t.type&&c.jsxs("div",{className:"relative",children:[c.jsx("video",{src:t.url,controls:!0,className:"rounded-lg w-full max-w-xs border border-blue-200 shadow-md",style:{maxHeight:"300px"},onClick:e=>{e.stopPropagation()},onLoadedMetadata:a=>{console.log("å‹•ç”»ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æˆåŠŸ:",{messageId:e.id,mediaIndex:n,duration:a.target.duration,urlType:t.url.startsWith("blob:")?"blob":"url"})},onError:a=>{console.error("å‹•ç”»èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",{messageId:e.id,mediaIndex:n,url:t.url.substring(0,100)+"...",isBlob:t.url.startsWith("blob:")})}}),c.jsx("div",{className:"absolute top-2 right-2 flex items-center justify-center opacity-50 hover:opacity-100 transition-opacity",onClick:()=>y(t.url),children:c.jsx("div",{className:"bg-blue-600 bg-opacity-70 p-2 rounded-full",children:c.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})})]})]},`${e.id}-media-${n}`))})]})}))]}),c.jsx("span",{className:"text-xs "+(x?"text-blue-400":"text-gray-400"),children:w})]}),c.jsx("div",{children:c.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+(x?"bg-blue-500":"bg-gray-500"),children:c.jsx("span",{className:"text-white text-sm",children:x?"ğŸ‘¤":"ğŸ¤–"})})})]})}function Be({onSendMessage:e,isLoading:t=!1,disabled:a=!1}){const[i,o]=d.useState(""),[l,u]=d.useState([]),{recordedText:m,selectedText:f,draftMessage:x,setDraftMessage:b}=n(),w=function(){const[e,t]=d.useState(void 0);return d.useEffect(()=>{const e=window.matchMedia("(max-width: 767px)"),n=()=>{t(window.innerWidth<768)};return e.addEventListener("change",n),t(window.innerWidth<768),()=>e.removeEventListener("change",n)},[]),{isMobile:!!e}}(),y=d.useRef(null),v=d.useRef(null);d.useEffect(()=>{f&&(o(f),w&&v.current?v.current.focus():y.current&&y.current.focus())},[f,w]);const j=e=>{o(e.target.value)},N=async n=>{if(n.preventDefault(),!i.trim()&&0===l.length)return;if(t||a)return;const s=i,r=[...l];o(""),u([]),await e(s,r)},k=()=>{window.dispatchEvent(new CustomEvent("open-camera"))},S=()=>{o(""),w&&v.current?v.current.focus():y.current&&y.current.focus()};return c.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 border-t border-blue-200 p-2 message-input-container",children:c.jsxs("form",{onSubmit:N,className:"flex items-center",children:[c.jsxs("div",{className:"flex-1 flex items-center bg-white border border-blue-200 rounded-full px-3 py-1 shadow-inner",children:[w?c.jsxs("div",{className:"flex-1 relative h-[48px]",children:[" ",c.jsx(g,{ref:v,className:"absolute inset-0 bg-transparent border-none focus-visible:ring-0 focus-visible:ring-offset-0 resize-none py-1 overflow-y-auto text-lg",placeholder:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...",value:i,onChange:j,disabled:t,rows:1,style:{lineHeight:"1.2"},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N(e))}}),i.trim()&&c.jsx("button",{type:"button",onClick:S,className:"absolute right-1 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:c.jsx(s,{size:16})})]}):c.jsxs("div",{className:"flex-1 h-[48px] flex items-center relative",children:[" ",c.jsx(h,{ref:y,type:"text",className:"w-full h-full bg-transparent border-none focus-visible:ring-0 focus-visible:ring-offset-0 text-lg",placeholder:"ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...",value:i,onChange:j,disabled:t}),i.trim()&&c.jsx("button",{type:"button",onClick:S,className:"absolute right-1 text-gray-400 hover:text-gray-600",children:c.jsx(s,{size:16})})]}),c.jsx(r,{type:"submit",disabled:t||!i.trim(),size:"icon",variant:"ghost",className:"ml-1 p-1 min-w-[28px] min-h-[28px] h-7 w-7 bg-gradient-to-r from-sky-100 to-blue-100 hover:from-sky-200 hover:to-blue-200 rounded-full border border-blue-300",children:c.jsx(p,{className:"h-4 w-4 text-blue-600"})})]}),c.jsxs("div",{className:"md:hidden flex flex-col items-center ml-2",children:[c.jsx("span",{className:"text-xs font-medium text-indigo-700 mb-0.5",children:"ã‚«ãƒ¡ãƒ©"}),c.jsx(r,{type:"button",onClick:k,size:"icon",variant:"ghost",className:"p-2 h-10 w-10 rounded-full bg-gradient-to-r from-indigo-100 to-cyan-100 hover:from-indigo-200 hover:to-cyan-200 border border-indigo-300",children:c.jsx(_,{className:"h-5 w-5 text-indigo-600"})})]}),c.jsxs("div",{className:"hidden md:flex md:flex-col md:items-center md:ml-2",children:[c.jsx("span",{className:"text-xs font-medium text-indigo-700 mb-0.5",children:"ã‚«ãƒ¡ãƒ©"}),c.jsx(r,{type:"button",onClick:k,size:"icon",variant:"ghost",className:"p-2 h-10 w-10 rounded-full bg-gradient-to-r from-indigo-100 to-cyan-100 hover:from-indigo-200 hover:to-cyan-200 border border-indigo-300",children:c.jsx(_,{className:"h-5 w-5 text-indigo-600"})})]})]})})}function Ye(){const[e,t]=d.useState(!1),[i,o]=d.useState(!1),[l,u]=d.useState(!1),[h,g]=d.useState(null),[p,f]=d.useState(null),[j]=d.useState(!0),N=d.useRef(null),k=d.useRef(null),S=d.useRef([]),{captureImage:C,sendMessage:M}=n(),{toast:E}=a(),T=function(){const[e,t]=d.useState(window.innerWidth>window.innerHeight?"landscape":"portrait");return d.useEffect(()=>{const e=()=>{t(window.innerWidth>window.innerHeight?"landscape":"portrait")};return window.addEventListener("resize",e),window.addEventListener("orientationchange",e),e(),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]),e}();d.useEffect(()=>{const e=e=>{console.log("ğŸ“¸ CameraModal: open-camera ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã—ã¾ã—ãŸ",e),t(!0)};return console.log("ğŸ“¸ CameraModal: open-camera ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²ã—ã¾ã—ãŸ"),window.addEventListener("open-camera",e),()=>{console.log("ğŸ“¸ CameraModal: open-camera ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ"),window.removeEventListener("open-camera",e)}},[]),d.useEffect(()=>{if(e){(async()=>{try{const e=await navigator.permissions.query({name:"camera"});if(console.log("ğŸ“¸ ã‚«ãƒ¡ãƒ©æ¨©é™çŠ¶æ…‹:",e.state),"denied"===e.state)return void E({title:"ã‚«ãƒ¡ãƒ©æ¨©é™ãŒæ‹’å¦ã•ã‚Œã¦ã„ã¾ã™",description:"ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚",variant:"destructive"})}catch(e){console.log("ğŸ“¸ æ¨©é™APIãŒåˆ©ç”¨ã§ãã¾ã›ã‚“:",e)}setTimeout(()=>{D()},300)})()}else P()},[e]);const D=async()=>{try{if(console.log("ğŸ“¸ ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹é–‹å§‹"),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚«ãƒ¡ãƒ©æ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“");const e="https:"===location.protocol||"localhost"===location.hostname;if(console.log("ğŸ”’ ã‚»ã‚­ãƒ¥ã‚¢ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ:",e,"ãƒ—ãƒ­ãƒˆã‚³ãƒ«:",location.protocol,"ãƒ›ã‚¹ãƒˆ:",location.hostname),!e)throw new Error("ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯HTTPSæ¥ç¶šãŒå¿…è¦ã§ã™");p&&(console.log("ğŸ›‘ æ—¢å­˜ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åœæ­¢"),p.getTracks().forEach(e=>e.stop())),console.log("ğŸ“¸ ã‚«ãƒ¡ãƒ©åˆ¶ç´„è¨­å®š:",{facingMode:j?"environment":"user",videoMode:i,constraints:{video:{facingMode:j?"environment":"user",width:{ideal:1280},height:{ideal:720}},audio:i}});const t={video:{facingMode:j?"environment":"user",width:{ideal:1280},height:{ideal:720}},audio:i};console.log("ğŸ“¸ getUserMediaå‘¼ã³å‡ºã—é–‹å§‹");const n=await navigator.mediaDevices.getUserMedia(t);console.log("âœ… getUserMediaæˆåŠŸ:",{streamActive:n.active,videoTracks:n.getVideoTracks().length,audioTracks:n.getAudioTracks().length}),f(n),N.current&&(console.log("ğŸ“º ãƒ“ãƒ‡ã‚ªè¦ç´ ã«ã‚¹ãƒˆãƒªãƒ¼ãƒ è¨­å®š"),N.current.srcObject=n,N.current.onloadedmetadata=()=>{var e;console.log("âœ… ãƒ“ãƒ‡ã‚ªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†"),null==(e=N.current)||e.play().catch(e=>{console.error("âŒ ãƒ“ãƒ‡ã‚ªå†ç”Ÿã‚¨ãƒ©ãƒ¼:",e)})})}catch(e){console.error("âŒ ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼:",e);let t="ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸ";e instanceof Error&&(t="NotAllowedError"===e.name?"ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„ã€‚":"NotFoundError"===e.name?"ã‚«ãƒ¡ãƒ©ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒã‚¤ã‚¹ã«ã‚«ãƒ¡ãƒ©ãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚":"NotReadableError"===e.name?"ã‚«ãƒ¡ãƒ©ãŒä»–ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚":"OverconstrainedError"===e.name?"ã‚«ãƒ¡ãƒ©ã®è¨­å®šã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚åˆ¥ã®ã‚«ãƒ¡ãƒ©ã‚’è©¦ã—ã¦ãã ã•ã„ã€‚":"SecurityError"===e.name?"ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã§ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚HTTPSã§æ¥ç¶šã—ã¦ãã ã•ã„ã€‚":`ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼: ${e.message}`),E({title:"ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼",description:t,variant:"destructive"})}},P=()=>{p&&(p.getTracks().forEach(e=>e.stop()),f(null)),l&&A(),g(null)},W=()=>{if(S.current=[],p){const e=new MediaRecorder(p);k.current=e,e.ondataavailable=e=>{e.data.size>0&&S.current.push(e.data)},e.onstop=()=>{const e=new Blob(S.current,{type:"video/mp4"}),t=URL.createObjectURL(e);g(t),u(!1)},e.start(),u(!0)}},A=()=>{k.current&&l&&k.current.stop()};return c.jsx(x,{open:e,onOpenChange:t,children:c.jsxs(b,{className:("landscape"===T?"max-w-3xl":"max-w-md")+" p-0 overflow-hidden bg-blue-50 border border-blue-200 camera-modal","aria-describedby":"camera-modal-desc",children:[c.jsx(w,{className:"sr-only",children:"ã‚«ãƒ¡ãƒ©"}),c.jsx("div",{id:"camera-modal-desc",className:"sr-only",children:"å†™çœŸã‚„å‹•ç”»ã‚’æ’®å½±ã™ã‚‹ãŸã‚ã®ã‚«ãƒ¡ãƒ©ãƒ¢ãƒ¼ãƒ€ãƒ«"}),c.jsxs(y,{className:"p-4 border-b border-blue-200 flex flex-row justify-between items-center bg-blue-100",children:[c.jsx(w,{className:"text-indigo-600 text-lg font-bold",children:"ã‚«ãƒ¡ãƒ©èµ·å‹•"}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("div",{className:"flex items-center bg-white px-2 py-1 rounded-full",children:[c.jsx(F,{className:"h-6 w-6 mr-2 text-indigo-600"}),c.jsx(m,{id:"camera-mode",checked:i,onCheckedChange:()=>{l&&A(),o(!i),g(null),P(),setTimeout(()=>D(),300)}}),c.jsx(H,{className:"h-6 w-6 ml-2 text-indigo-600"})]}),c.jsx(r,{variant:"ghost",size:"icon",className:"p-2 rounded-full hover:bg-blue-200 text-blue-700",onClick:()=>t(!1),children:c.jsx(s,{})})]})]}),c.jsxs("div",{className:"relative bg-black",children:[h?i?c.jsx("video",{src:h,controls:!0,className:`w-full ${"landscape"===T?"h-64":"h-80"} bg-neutral-800 object-contain`,onClick:()=>window.dispatchEvent(new CustomEvent("preview-image",{detail:{url:h}}))}):c.jsx("img",{src:h,alt:"Captured",className:`w-full ${"landscape"===T?"h-64":"h-80"} bg-neutral-800 object-contain`,onClick:()=>window.dispatchEvent(new CustomEvent("preview-image",{detail:{url:h}}))}):c.jsx("video",{ref:N,autoPlay:!0,playsInline:!0,muted:!0,className:`w-full ${"landscape"===T?"h-64":"h-80"} bg-neutral-800 object-cover`}),!h&&c.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center space-x-4",children:i?c.jsx(c.Fragment,{children:l?c.jsxs(c.Fragment,{children:[c.jsx(r,{className:"bg-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg",variant:"outline",size:"icon",onClick:A,children:c.jsx(O,{className:"h-6 w-6 text-blue-600"})}),c.jsx(r,{className:"bg-red-500 rounded-full w-14 h-14 flex items-center justify-center shadow-lg",variant:"outline",size:"icon",onClick:A,children:c.jsx(q,{className:"h-6 w-6 text-white"})})]}):c.jsx(r,{className:"bg-blue-600 rounded-full w-16 h-16 flex items-center justify-center shadow-lg border-2 border-white",variant:"outline",size:"icon",onClick:W,children:c.jsx(v,{className:"h-8 w-8 text-white"})})}):c.jsx(r,{className:"bg-blue-600 rounded-full w-16 h-16 flex items-center justify-center shadow-lg border-2 border-white",variant:"outline",size:"icon",onClick:()=>{if(N.current)if(i)l?A():W();else{const t=document.createElement("canvas"),n=N.current,a=874,s=1240;let{videoWidth:r,videoHeight:i}=n;if(r>a||i>s){const e=r/i;r>i?(r=a,i=a/e):(i=s,r=s*e)}t.width=r,t.height=i;const o=t.getContext("2d");if(o&&n){o.drawImage(n,0,0,r,i);try{const e=t.toDataURL("image/jpeg",.4);if(!e.startsWith("data:image/"))return console.error("Base64ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£ã§ã™:",e.substring(0,50)),void console.error("canvas.toDataURL()ã®çµæœ:",typeof e,e.length);console.log("âœ… æ’®å½±ç”»åƒã‚’Base64å½¢å¼ã§ç”ŸæˆæˆåŠŸ:",{format:"image/jpeg",quality:.4,resolution:"150dpiç›¸å½“",originalSize:`${n.videoWidth}x${n.videoHeight}`,compressedSize:`${r}x${i}`,maxResolution:`${a}x${s}`,dataLength:e.length,dataSizeMB:(e.length/1024/1024).toFixed(2),isValidBase64:e.startsWith("data:image/jpeg;base64,"),mimeType:e.split(";")[0],preview:e.substring(0,50)+"..."}),g(e)}catch(e){console.error("canvas.toDataURL()ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:",e)}}}},children:c.jsx(v,{className:"h-12 w-12 text-white"})})})]}),c.jsx("div",{className:"p-4 bg-blue-50",children:h?c.jsx(r,{className:"w-full bg-blue-600 text-white py-3 rounded-lg font-medium text-lg",onClick:async()=>{if(h)try{console.log("æ’®å½±ã—ãŸç”»åƒã‚’ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡ã—ã¾ã™");let e=h;if(!h.startsWith("data:image/")){if(console.log("ç”»åƒãƒ‡ãƒ¼ã‚¿ãŒBase64å½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å¤‰æ›ã—ã¾ã™:",typeof h),"object"==typeof h)return void console.error("ç”»åƒãƒ‡ãƒ¼ã‚¿ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§ã™ã€‚Base64å¤‰æ›ãŒå¿…è¦ã§ã™ã€‚");e=`data:image/jpeg;base64,${h}`}console.log("é€ä¿¡ã™ã‚‹ç”»åƒãƒ‡ãƒ¼ã‚¿:",{isBase64:e.startsWith("data:image/"),urlLength:e.length,mimeType:e.split(";")[0],preview:e.substring(0,50)+"..."}),await M(e),t(!1),g(null)}catch(e){console.error("ç”»åƒé€ä¿¡ã‚¨ãƒ©ãƒ¼:",e)}},children:"é€ä¿¡ã™ã‚‹"}):c.jsx("div",{className:"flex items-center justify-between",children:c.jsx("p",{className:"text-sm text-blue-700 font-medium",children:i?l?"éŒ²ç”»ä¸­... åœæ­¢ã™ã‚‹ã«ã¯â–¡ã‚’ã‚¿ãƒƒãƒ—":"â— ã‚’ã‚¿ãƒƒãƒ—ã—ã¦éŒ²ç”»é–‹å§‹":"â—‹ ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å†™çœŸæ’®å½±"})})})]})})}function Qe(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;if(e.includes("/knowledge-base/images/"))return e;if(e.includes("/uploads/"))return e.replace("/uploads/","/knowledge-base/");if(e.endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".jpeg")||e.endsWith(".svg")){const t=e.split("/").pop();if(t){if(t.endsWith(".svg")){return`/knowledge-base/images/${t.replace(".svg",".png")}`}return`/knowledge-base/images/${t}`}}return e}function Ve(){var e,t;const[n,a]=d.useState(!1),[i,o]=d.useState(""),[l,u]=d.useState(""),[m,h]=d.useState(""),[g,p]=d.useState([]),[f,w]=d.useState(0),[y,v]=d.useState(null),[N,k]=d.useState(!1),[S,C]=d.useState("ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"),[M,E]=d.useState(""),T=e=>{if(!g.length)return;let t;t="next"===e?(f+1)%g.length:(f-1+g.length)%g.length,w(t);const n=g[t];o(n),u("")};d.useEffect(()=>{const e=e=>{const t=e;if(t.detail){if(t.detail.url&&o(t.detail.url),t.detail.pngFallbackUrl?u(t.detail.pngFallbackUrl):u(""),t.detail.title?C(t.detail.title):C("ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"),t.detail.content?E(t.detail.content):E(""),t.detail.metadata_json?(h(t.detail.metadata_json),(async e=>{try{k(!0);const t=await fetch(e);if(!t.ok)throw new Error("Metadata fetch failed");const n=await t.json();v(n)}catch(t){console.error("Failed to load metadata:",t),v(null)}finally{k(!1)}})(t.detail.metadata_json)):(h(""),v(null)),t.detail.all_slides&&Array.isArray(t.detail.all_slides)){p(t.detail.all_slides);const e=t.detail.all_slides.findIndex(e=>e===t.detail.url);w(e>=0?e:0)}else p([]),w(0);a(!0)}};return window.addEventListener("preview-image",e),()=>{window.removeEventListener("preview-image",e)}},[]);const D=(()=>{if(!y||!y.slides)return null;const e=f+1;return y.slides.find(t=>t.ã‚¹ãƒ©ã‚¤ãƒ‰ç•ªå·===e)})();return c.jsx(x,{open:n,onOpenChange:a,children:c.jsxs(b,{className:"max-w-5xl bg-black bg-opacity-90 border border-blue-400 flex flex-col items-center justify-center p-0 rounded-xl","aria-labelledby":"dialog-title","aria-describedby":"dialog-description image-preview-description",children:[c.jsxs("div",{className:"sr-only",children:[c.jsx("h2",{id:"dialog-title",children:(null==(e=null==y?void 0:y.metadata)?void 0:e.ã‚¿ã‚¤ãƒˆãƒ«)||S}),c.jsx("p",{id:"dialog-description",children:"æ‹¡å¤§ç”»åƒãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼"}),c.jsx("p",{id:"image-preview-description",children:"ç”»åƒã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã¨é–¢é€£æƒ…å ±ã®ç¢ºèªãŒã§ãã¾ã™"})]}),c.jsxs("div",{className:"w-full flex justify-between items-center p-2 bg-blue-700 text-white",children:[c.jsxs("h3",{className:"text-sm font-medium ml-2",children:[(null==(t=null==y?void 0:y.metadata)?void 0:t.ã‚¿ã‚¤ãƒˆãƒ«)||S,g.length>1&&` - ã‚¹ãƒ©ã‚¤ãƒ‰ ${f+1}/${g.length}`]}),c.jsx("div",{className:"flex items-center",children:c.jsx(r,{className:"text-white hover:bg-blue-600 rounded-full",variant:"ghost",size:"icon",onClick:()=>a(!1),children:c.jsx(s,{className:"h-5 w-5"})})})]}),c.jsxs("div",{className:"relative w-full max-h-[70vh] flex items-center justify-center p-2",children:[g.length>1&&c.jsx(r,{className:"absolute left-2 z-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full opacity-75 hover:opacity-100",size:"icon",onClick:()=>T("prev"),children:c.jsx(z,{className:"h-5 w-5"})}),c.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-0 bg-gray-50",children:c.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-blue-600 border-t-transparent animate-spin"})}),c.jsx("img",{src:Qe(i||""),alt:(null==D?void 0:D.ã‚¿ã‚¤ãƒˆãƒ«)||S||"æ‹¡å¤§ç”»åƒ",className:"max-w-full max-h-[70vh] object-contain rounded-lg border border-blue-500 z-10 relative",loading:"eager",decoding:"async",onLoad:e=>{const t=e.currentTarget;t.classList.add("loaded");const n=t.parentElement;if(n){n.querySelectorAll(".animate-spin").forEach(e=>{e.parentElement&&(e.parentElement.style.display="none")})}},onError:e=>{const t=e.currentTarget,n=t.src||"";console.log("ç”»åƒè¡¨ç¤ºã‚¨ãƒ©ãƒ¼:",n);try{if(l&&""!==l.trim())return console.log("æŒ‡å®šã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯URLã‚’ä½¿ç”¨:",l),void(t.src=Qe(l));if(n.endsWith(".svg")){console.log("SVG->PNGã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯");const e=n.replace(".svg",".png");return void(t.src=e)}if(n.endsWith(".jpeg")||n.endsWith(".jpg")){console.log("JPEG->PNGã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯");const e=n.replace(/\.(jpeg|jpg)$/,".png");return void(t.src=e)}if(!n.includes("/knowledge-base/")){const e=n.split("/").pop();if(e)return console.log("ãƒ‘ã‚¹å½¢å¼ã‚¨ãƒ©ãƒ¼ã€knowledge-baseãƒ‘ã‚¹ã«ä¿®æ­£"),void(t.src=`/knowledge-base/images/${e}`)}if(g.length>1){const e=(f+1)%g.length;return console.log(`ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰ãŒè¡¨ç¤ºã§ããªã„ãŸã‚ã€æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰(${e})ã«åˆ‡ã‚Šæ›¿ãˆ`),void T("next")}console.log("ã™ã¹ã¦ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è©¦è¡ŒãŒå¤±æ•—ã€ã‚¨ãƒ©ãƒ¼è¡¨ç¤º");const e=t.parentElement;if(e&&(t.style.opacity="0.2",!e.querySelector(".error-message"))){const t=document.createElement("div");t.className="error-message absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 text-white p-4 rounded-lg z-20";const a=document.createElement("p");a.className="text-xl mb-2",a.textContent="ç”»åƒã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ";const s=document.createElement("p");s.className="text-sm",s.textContent=n.split("/").pop()||"",t.appendChild(a),t.appendChild(s),e.appendChild(t)}}catch(a){console.error("ã‚¨ãƒ©ãƒ¼å‡¦ç†ä¸­ã«ä¾‹å¤–ãŒç™ºç”Ÿ:",a)}}}),g.length>1&&c.jsx(r,{className:"absolute right-2 z-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full opacity-75 hover:opacity-100",size:"icon",onClick:()=>T("next"),children:c.jsx(j,{className:"h-5 w-5"})})]}),!1,g.length>1&&c.jsx("div",{className:"w-full px-2 py-3 border-t border-blue-500 overflow-x-auto flex bg-gray-800",children:g.map((e,t)=>c.jsx("div",{className:"flex-shrink-0 mx-1 cursor-pointer transition-all "+(t===f?"border-2 border-blue-500 scale-105":"border border-gray-600 hover:border-blue-400"),onClick:()=>{w(t),o(e),u("")},children:c.jsxs("div",{className:"relative h-16 w-24",children:[c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-700 z-0",children:c.jsx("div",{className:"w-6 h-6 rounded-full border-2 border-blue-500 border-t-transparent animate-spin"})}),c.jsx("img",{src:Qe(e),alt:`ã‚¹ãƒ©ã‚¤ãƒ‰ ${t+1}`,className:"h-16 w-24 object-cover relative z-10",loading:"eager",decoding:"async",onLoad:e=>{const t=e.currentTarget.parentElement;if(t){t.querySelectorAll(".animate-spin").forEach(e=>{e.parentElement&&(e.parentElement.style.display="none")})}},onError:e=>{console.log(`ã‚µãƒ ãƒã‚¤ãƒ«(${t})èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼`);const n=e.currentTarget;n.style.opacity="0.3";const a=n.parentElement;if(a){const e=document.createElement("div");e.className="absolute inset-0 flex items-center justify-center z-20 bg-black bg-opacity-50 text-white text-xs",e.textContent="èª­è¾¼ã‚¨ãƒ©ãƒ¼",a.appendChild(e)}}})]})},t))})]})})}const Xe=({onKeywordClick:e})=>c.jsxs("div",{className:"flex flex-wrap gap-2 my-3",children:[c.jsx("span",{className:"text-sm text-gray-600 self-center mr-1",children:"ä»£è¡¨çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:"}),["ã‚¨ãƒ³ã‚¸ãƒ³","ãƒˆãƒ«ã‚³ãƒ³","ãƒ–ãƒ¬ãƒ¼ã‚­","ã‚¨ã‚¢ãƒ¼å›è·¯"].map(t=>c.jsx(r,{variant:"outline",size:"sm",className:"bg-blue-50 hover:bg-blue-100 text-blue-700 border-blue-200",onClick:()=>e(t),children:t},t))]});function Ge(){const[e,t]=d.useState([]),[n,a]=d.useState(""),[s,o]=d.useState(!1),[l,u]=d.useState(null),[m,g]=d.useState(null),[p,f]=d.useState(null),x=d.useRef(null),b=d.useRef(!1);d.useEffect(()=>{var e;null==(e=x.current)||e.scrollIntoView({behavior:"smooth"})},[e]);d.useEffect(()=>{b.current||(b.current=!0,(async()=>{o(!0);try{const e=await fetch("/api/interactive-diagnosis/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)throw new Error("è¨ºæ–­ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹ã«å¤±æ•—");const n=await e.json();u(n.diagnosisState),g(n.interactiveResponse),f(n.sessionId),n.interactiveResponse.nextQuestion?t([{id:Date.now(),content:n.interactiveResponse.nextQuestion,isAiResponse:!0,timestamp:new Date,type:"question"}]):t([{id:Date.now(),content:n.interactiveResponse.message,isAiResponse:!0,timestamp:new Date,type:"message"}])}catch(e){console.error("è¨ºæ–­é–‹å§‹ã‚¨ãƒ©ãƒ¼:",e)}finally{o(!1)}})())},[]);const w=async e=>{if(!e.trim()||!l)return;o(!0);const n={id:Date.now(),content:e,isAiResponse:!1,timestamp:new Date,type:"message"};t(e=>[...e,n]),a("");try{const n=await fetch("/api/interactive-diagnosis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userResponse:e,currentState:l})});if(!n.ok)throw new Error("è¨ºæ–­å‡¦ç†ã«å¤±æ•—");const a=await n.json();u(a.updatedState),g(a.interactiveResponse),a.interactiveResponse.nextQuestion?t(e=>[...e,{id:Date.now()+1,content:a.interactiveResponse.nextQuestion,isAiResponse:!0,timestamp:new Date,type:"question"}]):t(e=>[...e,{id:Date.now()+1,content:a.interactiveResponse.message,isAiResponse:!0,timestamp:new Date,type:v(a.interactiveResponse.priority)}])}catch(s){console.error("è¨ºæ–­å‡¦ç†ã‚¨ãƒ©ãƒ¼:",s);const e={id:Date.now()+1,content:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",isAiResponse:!0,timestamp:new Date,type:"message"};t(t=>[...t,e])}finally{o(!1)}},y=e=>{w(e)},v=e=>{switch(e){case"safety":return"safety";case"action":return"action";case"diagnosis":return"question";default:return"message"}},j=e=>{switch(e){case"safety":return c.jsx(P,{className:"w-4 h-4 text-red-500"});case"action":return c.jsx(i,{className:"w-4 h-4 text-blue-500"});case"question":return c.jsx(T,{className:"w-4 h-4 text-purple-500"});default:return null}};return c.jsx("div",{className:"max-w-4xl mx-auto p-4",children:c.jsxs(N,{className:"h-[700px] flex flex-col",children:[c.jsx(k,{className:"py-2 border-b",children:c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsxs(S,{className:"flex items-center gap-2 text-base font-semibold",children:[c.jsx(i,{className:"w-4 h-4"})," AIã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ”¯æ´"]}),l&&c.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[c.jsx(M,{variant:"outline",className:(e=>{switch(e){case"critical":return"bg-red-100 text-red-800 border-red-200";case"high":return"bg-orange-100 text-orange-800 border-orange-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-green-100 text-green-800 border-green-200"}})(l.collectedInfo.urgency),children:l.collectedInfo.urgency}),c.jsxs(M,{variant:"outline",children:[c.jsx($,{className:"w-3 h-3 mr-1"}),"ä¿¡é ¼ ",Math.round(100*l.confidence),"%"]}),c.jsx(M,{variant:"outline",children:l.phase})]})]})}),c.jsx(C,{className:"flex-1 flex flex-col",children:c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 mb-4 p-4 bg-gray-50 rounded-lg",children:[!l&&c.jsx("div",{className:"flex justify-center py-8",children:c.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[c.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"}),"åˆæœŸåŒ–ä¸­..."]})}),e.map(e=>c.jsx("div",{className:"flex "+(e.isAiResponse?"justify-end":"justify-start"),children:c.jsxs("div",{className:"max-w-[80%] p-3 rounded-lg shadow-sm "+(e.isAiResponse?"bg-white border border-gray-200 text-gray-800 rounded-[18px_18px_4px_18px]":"bg-blue-600 text-white rounded-[18px_18px_18px_4px]"),children:[e.isAiResponse&&c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[j(e.type),c.jsx("span",{className:"text-[11px] font-medium text-gray-500 tracking-wide",children:"GPTã‚µãƒãƒ¼ãƒˆ"})]}),c.jsx("div",{className:"whitespace-pre-wrap text-sm leading-relaxed",children:e.content}),c.jsx("div",{className:"text-[10px] opacity-60 mt-1 text-right",children:e.timestamp.toLocaleTimeString()})]})},e.id)),s&&c.jsx("div",{className:"flex justify-start",children:c.jsx("div",{className:"bg-white border border-gray-200 p-3 rounded-lg",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full"}),c.jsx("span",{className:"text-sm text-gray-600",children:"åˆ†æä¸­..."})]})})}),c.jsx("div",{ref:x})]}),l&&(null==m?void 0:m.options)&&m.options.length>0&&c.jsxs("div",{className:"mb-4",children:[c.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ã‚¯ã‚¤ãƒƒã‚¯é¸æŠ:"}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.options.map((e,t)=>c.jsx(r,{variant:"outline",size:"sm",onClick:()=>y(e),disabled:s,className:"text-sm",children:e},t)),m.details&&!e.some(e=>e.content.includes(m.details))&&c.jsx(r,{variant:"secondary",size:"sm",onClick:()=>y("è©³ç´°"),disabled:s,className:"text-sm",children:"è©³ç´°"})]})]}),l&&(null==m?void 0:m.requiresInput)&&"completed"!==l.phase&&c.jsxs("div",{className:"flex gap-2",children:[c.jsx(h,{value:n,onChange:e=>a(e.target.value),placeholder:"å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...",onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),w(n))},disabled:s,className:"flex-1"}),c.jsx(r,{onClick:()=>w(n),disabled:s||!n.trim(),className:"bg-blue-600 hover:bg-blue-700",children:"é€ä¿¡"})]}),"completed"===(null==l?void 0:l.phase)&&c.jsxs("div",{className:"text-center p-4 bg-green-50 border border-green-200 rounded-lg",children:[c.jsx(E,{className:"w-8 h-8 text-green-600 mx-auto mb-2"}),c.jsx("p",{className:"text-green-800 font-medium",children:"è¨ºæ–­ãƒ»å¯¾å¿œãŒå®Œäº†ã—ã¾ã—ãŸ"}),c.jsx(r,{onClick:()=>window.location.reload(),className:"mt-2",variant:"outline",children:"æ–°ã—ã„è¨ºæ–­ã‚’é–‹å§‹"})]})]})})]})})}function Je(){const{user:e}=t(),{messages:i,setMessages:u,sendMessage:m,isLoading:g,clearChatHistory:p,isClearing:x,chatId:b,initializeChat:w,exportChatHistory:y}=n();null==e||e.role;const{toast:v}=a();o();const j=d.useRef(null);d.useRef(null);const[N,k]=d.useState(!1),[S,C]=d.useState([]),[M,E]=d.useState([]),[T,P]=d.useState(null),[z,$]=d.useState(""),[R,O]=d.useState(!1),[q,F]=d.useState(!1),[H,U]=d.useState(!1),[B,Y]=d.useState(null),[Q,V]=d.useState(0),[X,G]=d.useState(0),[J,K]=d.useState(""),[Z,ee]=d.useState([]),[te,ne]=d.useState([]),[ae,se]=d.useState(""),[re,ie]=d.useState(""),[oe,le]=d.useState(!1),[ce,de]=d.useState(!1),[ue,me]=d.useState(""),[he,ge]=d.useState(""),[pe,fe]=d.useState(!1),[xe,be]=d.useState(!1),[we,ye]=d.useState([]),[ve,je]=d.useState([]),[Ne,ke]=d.useState(!1),[Se,Ce]=d.useState(null),[Me,Ee]=d.useState([]),[Te,De]=d.useState(!1);d.useEffect(()=>{ze(),Pe(),_e()},[]),d.useEffect(()=>{console.log("ğŸ” æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ¤œçŸ¥:",{machineTypesCount:Z.length,machineTypes:Z,filteredMachineTypesCount:we.length}),ye(Z)},[Z]),d.useEffect(()=>{console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ¤œçŸ¥:",{machinesCount:te.length,machines:te,filteredMachinesCount:ve.length}),je(te)},[te]);const Pe=async()=>{try{De(!0);const{buildApiUrl:e}=await l(async()=>{const{buildApiUrl:e}=await import("./index-BWHx4aNU.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),t=e("/knowledge-base"),n=await fetch(t);if(!n.ok)throw new Error(`Failed to fetch knowledge data: ${n.statusText}`);{const e=await n.json();e.success?(Ee(e.data),console.log("âœ… ãƒŠãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ:",e.data.length+"ä»¶")):(console.error("âŒ ãƒŠãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—:",e.message),Ee([]))}}catch(e){console.error("âŒ ãƒŠãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:",e),v({title:"ã‚¨ãƒ©ãƒ¼",description:e instanceof Error?e.message:"ãƒŠãƒ¬ãƒƒã‚¸ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ",variant:"destructive"}),Ee([])}finally{De(!1)}};d.useEffect(()=>{const e=e=>{const t=e.target;t.closest("#machine-type")||t.closest("#machine-number")||t.closest("#machine-type-menu")||t.closest("#machine-number-menu")||(fe(!1),be(!1))};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[]);const[We,Ae]=d.useState(null),[Ie,Le]=d.useState({initialPrompt:"ä½•ã‹å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã‹ï¼ŸãŠå›°ã‚Šã®äº‹è±¡ã‚’æ•™ãˆã¦ãã ã•ã„ï¼",conversationStyle:"frank",questionFlow:{step1:"å…·ä½“çš„ãªç—‡çŠ¶ã‚’æ•™ãˆã¦ãã ã•ã„",step2:"ã„ã¤é ƒã‹ã‚‰ç™ºç”Ÿã—ã¦ã„ã¾ã™ã‹ï¼Ÿ",step3:"ä½œæ¥­ç’°å¢ƒã‚„çŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„",step4:"ä»–ã«æ°—ã«ãªã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",step5:"ç·Šæ€¥åº¦ã‚’æ•™ãˆã¦ãã ã•ã„"},branchingConditions:{timeCheck:!0,detailsCheck:!0,toolsCheck:!0,safetyCheck:!0},responsePattern:"step_by_step",escalationTime:20,customInstructions:"",enableEmergencyContact:!0}),_e=()=>{try{const e=localStorage.getItem("aiAssistSettings");e&&Le(JSON.parse(e))}catch(e){}},ze=d.useCallback(async()=>{try{le(!0),console.log("ğŸ” æ©Ÿç¨®ä¸€è¦§å–å¾—é–‹å§‹");const{buildApiUrl:e}=await l(async()=>{const{buildApiUrl:e}=await import("./index-BWHx4aNU.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),t=e("/machines/machine-types");console.log("ğŸ” æ©Ÿç¨®ä¸€è¦§å–å¾—URL:",t),console.log("ğŸ” ç¾åœ¨ã®URL:",window.location.href),console.log("ğŸ” ç’°å¢ƒå¤‰æ•°:",{VITE_API_BASE_URL:"http://localhost:8080",NODE_ENV:void 0,MODE:"production"});const n=await fetch(t,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},credentials:"include"});if(console.log("ğŸ” æ©Ÿç¨®ä¸€è¦§å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:",n.status),console.log("ğŸ” æ©Ÿç¨®ä¸€è¦§å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼:",Object.fromEntries(n.headers.entries())),n.ok){const e=await n.json();if(console.log("âœ… æ©Ÿç¨®ä¸€è¦§å–å¾—çµæœ:",e),e.success){const t=e.machineTypes||e.data||[];console.log("âœ… æ©Ÿç¨®ä¸€è¦§è¨­å®šå®Œäº†:",t.length,"ä»¶"),console.log("âœ… æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿:",t);const n=t.map(e=>({id:e.id,machine_type_name:e.name||e.machine_type_name||e.category}));ee(n),ye(n),0===n.length&&console.log("âš ï¸ æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã§ã™")}else console.error("âŒ æ©Ÿç¨®ä¸€è¦§å–å¾—æˆåŠŸã ãŒãƒ‡ãƒ¼ã‚¿ãŒç„¡åŠ¹:",e),ee([]),ye([])}else{const e=await n.text();console.error("âŒ æ©Ÿç¨®ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",n.status,e),401===n.status&&console.log("ğŸ” èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚"),ee([]),ye([])}}catch(e){console.error("âŒ æ©Ÿç¨®ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",e),ee([]),ye([])}finally{le(!1),console.log("ğŸ” æ©Ÿç¨®ä¸€è¦§å–å¾—å®Œäº†ã€æœ€çµ‚çŠ¶æ…‹:",{machineTypesCount:Z.length,filteredMachineTypesCount:we.length})}},[]),$e=e=>{if(console.log("ğŸ” æ©Ÿç¨®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–‹å§‹:",e,"æ©Ÿç¨®æ•°:",Z.length),!e.trim())return console.log("âœ… å…¥åŠ›ãŒç©ºã®ãŸã‚å…¨æ©Ÿç¨®ã‚’è¡¨ç¤º:",Z.length,"ä»¶"),void ye(Z);const t=Z.filter(t=>t.machine_type_name.toLowerCase().includes(e.toLowerCase()));console.log("âœ… ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµæœ:",t.length,"ä»¶"),ye(t)},Re=e=>{if(console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–‹å§‹:",e,"æ©Ÿæ¢°æ•°:",te.length),!e.trim())return console.log("âœ… å…¥åŠ›ãŒç©ºã®ãŸã‚å…¨æ©Ÿæ¢°ã‚’è¡¨ç¤º:",te.length,"ä»¶"),void je(te);const t=te.filter(t=>t.machine_number.toLowerCase().includes(e.toLowerCase()));console.log("âœ… ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµæœ:",t.length,"ä»¶"),je(t)},Oe=d.useCallback(async e=>{try{de(!0),console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ä¸€è¦§å–å¾—é–‹å§‹, æ©Ÿç¨®ID:",e);const{buildApiUrl:t}=await l(async()=>{const{buildApiUrl:e}=await import("./index-BWHx4aNU.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),n=t(`/machines?type_id=${e}`);console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ä¸€è¦§å–å¾—URL:",n);const a=await fetch(n,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},credentials:"include"});if(console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ä¸€è¦§å–å¾—ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:",a.status),a.ok){const e=await a.json();if(console.log("âœ… æ©Ÿæ¢°ç•ªå·ä¸€è¦§å–å¾—çµæœ:",e),e.success){const t=e.machines||e.data||[];console.log("âœ… æ©Ÿæ¢°ç•ªå·ä¸€è¦§è¨­å®šå®Œäº†:",t.length,"ä»¶"),console.log("âœ… æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿:",t);const n=t.map(e=>({id:e.id,machine_number:e.machine_number}));ne(n),je(n),console.log("ğŸ”§ æ©Ÿæ¢°ç•ªå·å–å¾—å¾Œã®çŠ¶æ…‹:",{machinesCount:n.length,machines:n,machineNumberInput:he,selectedMachineNumber:re,showMachineNumberSuggestions:xe})}else console.error("âŒ æ©Ÿæ¢°ç•ªå·ä¸€è¦§å–å¾—æˆåŠŸã ãŒsuccess=false:",e),ne([]),je([])}else{const e=await a.text();console.error("âŒ æ©Ÿæ¢°ç•ªå·ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",a.status,e),ne([]),je([])}}catch(t){console.error("âŒ æ©Ÿæ¢°ç•ªå·ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t),ne([]),je([])}finally{de(!1),console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ä¸€è¦§å–å¾—å®Œäº†ã€æœ€çµ‚çŠ¶æ…‹:",{machinesCount:te.length,filteredMachinesCount:ve.length})}},[te.length,ve.length,he,re,xe]);d.useEffect(()=>{var e;null==(e=j.current)||e.scrollIntoView({behavior:"smooth"})},[i]),d.useEffect(()=>{if(console.log("ğŸš€ ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸ãƒã‚¦ãƒ³ãƒˆ - åˆæœŸåŒ–é–‹å§‹"),!b){console.log("ğŸ”„ ãƒãƒ£ãƒƒãƒˆIDãŒæœªè¨­å®šã®ãŸã‚åˆæœŸåŒ–ã‚’å®Ÿè¡Œ");try{w()}catch(e){console.error("âŒ ãƒãƒ£ãƒƒãƒˆIDåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",e)}}ze().catch(e=>{console.error("âŒ æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€ãƒãƒ£ãƒƒãƒˆç”»é¢ã¯è¡¨ç¤ºã•ã‚Œã¾ã™:",e)})},[b,w,ze]),d.useEffect(()=>{console.log("ğŸ“Š æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹æ›´æ–°:",{machineTypesCount:Z.length,selectedMachineType:ae,machineTypeInput:ue,isLoadingMachineTypes:oe}),Z.length>0&&$e(ue)},[Z,ue]),d.useEffect(()=>{console.log("ğŸ“Š æ©Ÿç¨®å…¥åŠ›çŠ¶æ…‹æ›´æ–°:",{machineTypeInput:ue,selectedMachineType:ae})},[ue,ae]),d.useEffect(()=>{console.log("ğŸ” machineTypeInputå€¤å¤‰æ›´æ¤œå‡º:",{currentValue:ue,length:ue.length,timestamp:(new Date).toISOString()})},[ue]),d.useEffect(()=>{console.log("ğŸ“Š æ©Ÿæ¢°ç•ªå·ãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹æ›´æ–°:",{machinesCount:te.length,selectedMachineNumber:re,machineNumberInput:he,isLoadingMachines:ce}),te.length>0&&Re(he)},[te,he]),d.useEffect(()=>{console.log("ğŸ“Š æ©Ÿæ¢°ç•ªå·å…¥åŠ›çŠ¶æ…‹æ›´æ–°:",{machineNumberInput:he,selectedMachineNumber:re})},[he,re]),d.useEffect(()=>{let e;return H&&B&&(e=setInterval(()=>{const e=new Date,t=Math.floor((e.getTime()-B.getTime())/1e3);V(t);const n=Math.floor(t/60);if(Ie.enableEmergencyContact&&n>=Ie.escalationTime&&n%5==0){const e={id:Date.now().toString(),content:`ğŸš¨ **æ•‘æ´è¦è«‹ã®æ¤œè¨**\n\nAIæ”¯æ´é–‹å§‹ã‹ã‚‰${n}åˆ†ãŒçµŒéã—ã¾ã—ãŸã€‚\n\n**æŠ€è¡“æ”¯æ´ã‚»ãƒ³ã‚¿ãƒ¼:**\nğŸ“ 0123-456-789\n\n**ã¾ãŸã¯**\nç¾å ´ã®å°‚é–€å®¶ã«é€£çµ¡ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚\n\nå®‰å…¨ã‚’æœ€å„ªå…ˆã«è¡Œå‹•ã—ã¦ãã ã•ã„ã€‚`,isAiResponse:!0,timestamp:new Date,type:"escalation_notice"};u(t=>[...t,e])}},1e3)),()=>{e&&clearInterval(e)}},[H,B,Ie]);const qe=async()=>{try{console.log("ğŸš€ é€ä¿¡å‰ã®çŠ¶æ…‹ç¢ºèª:",{chatId:b,messagesLength:i.length,hasChatId:!!b,hasMessages:i.length>0,messagesWithContent:i.filter(e=>e.content&&e.content.trim()).length,machineInfo:{selectedMachineType:ae,selectedMachineNumber:re,machineTypeInput:ue,machineNumberInput:he}});const n=!!b,a=i.length>0,s=i.some(e=>e.content&&e.content.trim());if(console.log("ğŸ” é€ä¿¡æ¡ä»¶ãƒã‚§ãƒƒã‚¯:",{hasValidChatId:n,hasMessages:a,hasValidMessages:s,messagesCount:i.length,messagesWithContent:i.filter(e=>e.content&&e.content.trim()).length}),!n){console.log("âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼: ãƒãƒ£ãƒƒãƒˆIDãŒç„¡åŠ¹ - åˆæœŸåŒ–ã‚’è©¦è¡Œ");try{return await w(),console.log("âœ… ãƒãƒ£ãƒƒãƒˆIDåˆæœŸåŒ–æˆåŠŸ"),void setTimeout(()=>{qe()},100)}catch(e){return console.error("âŒ ãƒãƒ£ãƒƒãƒˆIDåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:",e),void v({title:"é€ä¿¡ã‚¨ãƒ©ãƒ¼",description:"ãƒãƒ£ãƒƒãƒˆIDã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚",variant:"destructive"})}}if(!s)return console.log("âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼: æœ‰åŠ¹ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã›ã‚“"),void v({title:"é€ä¿¡ã‚¨ãƒ©ãƒ¼",description:"é€ä¿¡ã™ã‚‹ãƒãƒ£ãƒƒãƒˆå†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",variant:"destructive"});const r={chatId:b,timestamp:(new Date).toISOString(),machineInfo:{selectedMachineType:ae,selectedMachineNumber:re,machineTypeName:ue,machineNumber:he},messages:i.map(e=>{var t;return{id:e.id,content:e.content,isAiResponse:e.isAiResponse,timestamp:e.timestamp,media:(null==(t=e.media)?void 0:t.map(e=>({id:e.id,type:e.type,url:e.url,title:e.title,fileName:e.fileName||""})))||[]}})};console.log("ğŸ“¤ é€ä¿¡ãƒ‡ãƒ¼ã‚¿:",{chatId:r.chatId,messageCount:r.messages.length,machineInfo:r.machineInfo,totalDataSize:JSON.stringify(r).length});const{buildApiUrl:o}=await l(async()=>{const{buildApiUrl:e}=await import("./index-BWHx4aNU.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),c="localhost"===window.location.hostname,d=o(c?`/chats/${b}/send-test`:`/chats/${b}/send`);console.log("ğŸŒ é€ä¿¡URL:",d),console.log("ğŸ—ï¸ é–‹ç™ºç’°å¢ƒ:",c),console.log("ğŸ  ãƒ›ã‚¹ãƒˆå:",window.location.hostname),console.log("ğŸ”§ ç’°å¢ƒå¤‰æ•°:",{NODE_ENV:"production",DEV:!1,PROD:!0,VITE_API_BASE_URL:"http://localhost:8080"});const u=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({chatData:r,exportType:"manual_send"})});if(console.log("ğŸ“¡ é€ä¿¡ãƒ¬ã‚¹ãƒãƒ³ã‚¹:",{status:u.status,statusText:u.statusText,ok:u.ok,headers:Object.fromEntries(u.headers.entries())}),!u.ok){let e=`é€ä¿¡å¤±æ•—: ${u.status} ${u.statusText}`,n="";try{const t=await u.json();e=t.error||t.message||e,n=t.details||t.error||"",console.error("âŒ ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹:",t)}catch(t){console.warn("âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®è§£æã«å¤±æ•—:",t)}const a=n?`${e}\nè©³ç´°: ${n}`:e;throw new Error(a)}{const e=await u.json(),t=ae&&re?` (æ©Ÿç¨®: ${ue}, æ©Ÿæ¢°ç•ªå·: ${he})`:"";console.log("âœ… ã‚µãƒ¼ãƒãƒ¼é€ä¿¡æˆåŠŸ:",e);const n=e.knowledgeUpdateScheduled?" ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ã«è‡ªå‹•è¿½åŠ ã•ã‚Œã¾ã™ã€‚":"";v({title:"é€ä¿¡æˆåŠŸ",description:`ãƒãƒ£ãƒƒãƒˆå†…å®¹ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¾ã—ãŸã€‚(${i.filter(e=>e.content&&e.content.trim()).length}ä»¶ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)${t}${n}`}),e.knowledgeUpdateScheduled&&setTimeout(()=>{v({title:"ğŸ§  AIãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹",description:"ã“ã®æ•…éšœå±¥æ­´ãŒè‡ªå‹•çš„ã«AIã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚æ¬¡å›ã‹ã‚‰åŒæ§˜ã®å•é¡Œã«å¯¾ã—ã¦ã‚ˆã‚Šæ­£ç¢ºãªã‚µãƒãƒ¼ãƒˆãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚",duration:6e3})},2e3),await p(),se(""),ie(""),me(""),ge(""),ye([]),je([]),v({title:"ãƒãƒ£ãƒƒãƒˆã‚¯ãƒªã‚¢å®Œäº†",description:"é€ä¿¡å¾Œã«ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚"}),console.log("ğŸ§¹ ãƒãƒ£ãƒƒãƒˆçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ")}}catch(n){console.error("âŒ ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ã‚¨ãƒ©ãƒ¼:",n),v({title:"é€ä¿¡ã‚¨ãƒ©ãƒ¼",description:n instanceof Error?n.message:"ã‚µãƒ¼ãƒãƒ¼ã¸ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚",variant:"destructive"})}},Fe=async e=>{if($(e),e.trim())try{const t=S.filter(t=>`${t.title} ${t.description} ${t.keyword||""}`.toLowerCase().includes(e.toLowerCase()));E(t),console.log(`ğŸ” æ¤œç´¢çµæœ: "${e}" -> ${t.length}ä»¶`)}catch(t){console.error("æ¤œç´¢å‡¦ç†ã‚¨ãƒ©ãƒ¼:",t),E(S)}else E(S)},He=async e=>{if(Se)try{const t={...Se,answers:[...Se.answers,{stepId:`step_${Date.now()}`,answer:e,timestamp:new Date}]};Ce(t),m(e,[],!1);const{buildApiUrl:n}=await l(async()=>{const{buildApiUrl:e}=await import("./index-BWHx4aNU.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),a=n("/troubleshooting-qa/answer"),s=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({problemDescription:Se.problemDescription,previousAnswers:t.answers.slice(0,-1),currentAnswer:e})});if(!s.ok)throw new Error("å›ç­”ã®å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ");{const e=(await s.json()).data;"complete"===e.status?(Ce(e=>({...e,currentQuestion:void 0,currentOptions:void 0})),m(e.solution,[],!0),ke(!1)):"emergency"===e.status?(Ce(e=>({...e,currentQuestion:void 0,currentOptions:void 0})),m(e.emergencyAction,[],!0),ke(!1)):(Ce(t=>({...t,currentQuestion:e.question,currentOptions:e.options||[],reasoning:e.reasoning})),m(e.question,[],!0))}}catch(t){console.error("âŒ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°QAå›ç­”å‡¦ç†ã‚¨ãƒ©ãƒ¼:",t),v({title:"ã‚¨ãƒ©ãƒ¼",description:"å›ç­”ã®å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ",variant:"destructive"})}},Qe=async e=>{try{const t=Je(e,X);if(t)return Ze(e,t),Ke(t);const n=[Ie.questionFlow.step1,Ie.questionFlow.step2,Ie.questionFlow.step3,Ie.questionFlow.step4,Ie.questionFlow.step5],a=n[X%n.length];return Ze(e,a),Ke(a)}catch(t){return"ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ç¾åœ¨AIæ”¯æ´ã®å¿œç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"}},Je=(e,t)=>{const n=e.toLowerCase();switch(t){case 0:return Ie.questionFlow.step1;case 1:return Ie.questionFlow.step2;case 2:return Ie.branchingConditions.timeCheck&&(n.includes("æ€¥")||n.includes("ã™ã"))?"æ™‚é–“ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ":Ie.questionFlow.step3;case 3:return Ie.branchingConditions.detailsCheck?"è©³ç´°ã‚’æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ":Ie.questionFlow.step4;case 4:return Ie.branchingConditions.toolsCheck?"å¿…è¦ãªå·¥å…·ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ":Ie.questionFlow.step5;default:return Ie.branchingConditions.safetyCheck?"å®‰å…¨ã«ä½œæ¥­ã§ãã‚‹çŠ¶æ³ã§ã™ã‹ï¼Ÿ":null}},Ke=e=>{switch(Ie.conversationStyle){case"frank":return e.replace(/ãã ã•ã„/g,"ãã ã•ã„ã­").replace(/ã¾ã™ã‹/g,"ã¾ã™ã‹ï¼Ÿ");case"business":return`æã‚Œå…¥ã‚Šã¾ã™ãŒã€${e}ã‚’ãŠèã‹ã›ã„ãŸã ã‘ã¾ã™ã§ã—ã‚‡ã†ã‹ã€‚`;case"technical":return`æŠ€è¡“çš„ç¢ºèªã¨ã—ã¦ã€${e}`;default:return e}},Ze=(e,t)=>{const n=e.toLowerCase();if(t.toLowerCase(),console.log("ğŸ” updateEmergencyStep:",{userInput:e,lowerInput:n,currentStep:X,currentProblemType:J}),0!==X||J||(n.includes("ã‚¨ãƒ³ã‚¸ãƒ³")&&n.includes("å›è»¢")?K("engine_rpm"):n.includes("ã‚¨ãƒ³ã‚¸ãƒ³")&&n.includes("ã‹ã‹ã‚‰ãªã„")?K("engine_start"):n.includes("ãƒ–ãƒ¬ãƒ¼ã‚­")?K("brake"):K("general")),console.log("ğŸ”„ Processing user input for step progression:",n),n.includes("å®Œäº†")||n.includes("å›°é›£")||n.includes("é€€é¿")||n.includes("å¤‰ã‚ã‚‰ãªã„")||n.includes("å¤‰åŒ–ãªã—"))return console.log("ğŸ”„ Resetting due to completion/difficulty"),G(0),void K("");console.log("ğŸ”„ Advancing step from",X,"to",X+1),G(e=>e+1)},et=e=>{const t=Math.floor(e/60);return t>=20?"critical":t>=15?"warning":"normal"},[tt,nt]=d.useState(!1),[at,st]=d.useState(null),[rt,it]=d.useState(!1);return c.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[c.jsxs("div",{className:"sticky top-0 z-50 bg-white border-b px-4 py-3 flex items-center justify-between shadow-sm",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(W,{htmlFor:"machine-type",className:"text-sm font-medium text-gray-700",children:"æ©Ÿç¨®:"}),c.jsxs("div",{className:"relative",children:[c.jsx(h,{id:"machine-type",type:"text",placeholder:oe?"èª­ã¿è¾¼ã¿ä¸­...":"æ©Ÿç¨®ã‚’é¸æŠ...",value:ue,onChange:e=>{const t=e.target.value;console.log("ğŸ” æ©Ÿç¨®å…¥åŠ›å¤‰æ›´:",t),me(t),$e(t),fe(!0)},onFocus:()=>{console.log("ğŸ” æ©Ÿç¨®å…¥åŠ›ãƒ•ã‚©ãƒ¼ã‚«ã‚¹:",{machineTypesCount:Z.length,machineTypes:Z,filteredMachineTypesCount:we.length,showMachineTypeSuggestions:pe}),fe(!0),Z.length>0&&ye(Z)},onBlur:e=>{const t=e.relatedTarget;t&&t.closest(".machine-type-dropdown")||setTimeout(()=>{fe(!1)},150)},disabled:oe,className:"w-48"}),(console.log("ğŸ” æ©Ÿç¨®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³è¡¨ç¤ºæ¡ä»¶:",{showMachineTypeSuggestions:pe,filteredMachineTypesCount:we.length,filteredMachineTypes:we,machineTypesCount:Z.length,machineTypes:Z,isLoadingMachineTypes:oe}),null),pe&&c.jsx("div",{id:"machine-type-menu",className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto machine-type-dropdown",children:oe?c.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"èª­ã¿è¾¼ã¿ä¸­..."}):we.length>0?we.map(e=>c.jsx("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",onClick:t=>{t.preventDefault(),t.stopPropagation(),(e=>{console.log("ğŸ” æ©Ÿç¨®é¸æŠå‡¦ç†é–‹å§‹ ==========================="),console.log("ğŸ” é¸æŠã•ã‚ŒãŸæ©Ÿç¨®:",e);try{me(e.machine_type_name),se(e.id),fe(!1),ie(""),ge(""),ne([]),je([]),console.log("âœ… æ©Ÿç¨®é¸æŠå®Œäº†:",e.machine_type_name),Oe(e.id)}catch(t){console.error("âŒ æ©Ÿç¨®é¸æŠå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼:",t)}})(e)},onMouseDown:e=>{e.preventDefault()},tabIndex:0,children:e.machine_type_name},e.id)):c.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:ue.trim()?"è©²å½“ã™ã‚‹æ©Ÿç¨®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“":0===Z.length?"æ©Ÿç¨®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...":"æ©Ÿç¨®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"})})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(W,{htmlFor:"machine-number",className:"text-sm font-medium text-gray-700",children:"æ©Ÿæ¢°ç•ªå·:"}),c.jsxs("div",{className:"relative",children:[c.jsx(h,{id:"machine-number",type:"text",placeholder:ce?"èª­ã¿è¾¼ã¿ä¸­...":"æ©Ÿæ¢°ç•ªå·ã‚’é¸æŠ...",value:he,onChange:e=>{const t=e.target.value;console.log("ğŸ” æ©Ÿæ¢°ç•ªå·å…¥åŠ›å¤‰æ›´:",t),ge(t),Re(t),be(!0)},onFocus:()=>{console.log("ğŸ” æ©Ÿæ¢°ç•ªå·å…¥åŠ›ãƒ•ã‚©ãƒ¼ã‚«ã‚¹"),console.log("ğŸ”§ ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®çŠ¶æ…‹:",{selectedMachineType:ae,machinesCount:te.length,machines:te,filteredMachinesCount:ve.length,filteredMachines:ve,isLoadingMachines:ce,machineNumberInput:he,showMachineNumberSuggestions:xe}),be(!0),te.length>0?(je(te),console.log("âœ… ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«æ©Ÿæ¢°ç•ªå·ãƒªã‚¹ãƒˆã‚’è¨­å®š:",te.length,"ä»¶")):console.log("âš ï¸ ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã«æ©Ÿæ¢°ç•ªå·ãŒã‚ã‚Šã¾ã›ã‚“")},onBlur:e=>{const t=e.relatedTarget;t&&t.closest(".machine-number-dropdown")||setTimeout(()=>{be(!1)},150)},disabled:!ae||ce,className:"w-48"}),(console.log("ğŸ” æ©Ÿæ¢°ç•ªå·ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³è¡¨ç¤ºæ¡ä»¶:",{showMachineNumberSuggestions:xe,filteredMachinesCount:ve.length,filteredMachines:ve,selectedMachineType:ae,machineNumberInput:he,isLoadingMachines:ce}),null),xe&&c.jsx("div",{id:"machine-number-menu",className:"absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto machine-number-dropdown",children:ve.length>0?ve.map(e=>c.jsx("div",{className:"px-3 py-2 hover:bg-gray-100 cursor-pointer text-sm",onClick:t=>{t.preventDefault(),t.stopPropagation(),(e=>{console.log("ğŸ” æ©Ÿæ¢°ç•ªå·é¸æŠé–‹å§‹:",e);try{ie(e.id),ge(e.machine_number),be(!1),console.log("âœ… æ©Ÿæ¢°ç•ªå·é¸æŠå®Œäº†:",e.machine_number)}catch(t){console.error("âŒ æ©Ÿæ¢°ç•ªå·é¸æŠå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼:",t)}})(e)},onMouseDown:e=>{e.preventDefault()},tabIndex:0,children:e.machine_number},e.id)):c.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:he.trim()?"è©²å½“ã™ã‚‹æ©Ÿæ¢°ç•ªå·ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“":ae?"ã“ã®æ©Ÿç¨®ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹æ©Ÿæ¢°ç•ªå·ãŒã‚ã‚Šã¾ã›ã‚“":"å…ˆã«æ©Ÿç¨®ã‚’é¸æŠã—ã¦ãã ã•ã„"})})]})]})]}),c.jsxs("div",{className:"flex items-center gap-6",children:[H?c.jsxs("div",{className:"flex items-center gap-4 mr-6",children:[c.jsxs(r,{variant:"outline",size:"lg",onClick:()=>{U(!1),Y(null),V(0),G(0),K("");const e={id:Date.now().toString(),content:"AIæ”¯æ´ã‚’çµ‚äº†ã—ã¾ã™ã€‚ã¾ãŸä½•ã‹ãŠå›°ã‚Šã®ã“ã¨ãŒã‚ã‚Œã°ã€ã„ã¤ã§ã‚‚ãŠå£°ãŒã‘ãã ã•ã„ï¼",isAiResponse:!0,timestamp:new Date,type:"ai_support_end"};u(t=>[...t,e]),v({title:"AIæ”¯æ´çµ‚äº†",description:"AIæ”¯æ´ã‚’çµ‚äº†ã—ã¾ã—ãŸã€‚"})},className:"px-8 py-3 text-base font-semibold "+("critical"===et(Q)?"bg-red-50 border-red-200 text-red-700 hover:bg-red-100":"warning"===et(Q)?"bg-yellow-50 border-yellow-200 text-yellow-700 hover:bg-yellow-100":"bg-orange-50 border-orange-200 text-orange-700 hover:bg-orange-100"),children:[c.jsx(s,{className:"w-6 h-6 mr-3"}),"AIæ”¯æ´çµ‚äº†"]}),c.jsx("div",{className:"px-4 py-2 rounded-lg border text-sm font-medium "+("critical"===et(Q)?"bg-red-100 text-red-800 border-red-200":"warning"===et(Q)?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-green-100 text-green-800 border-green-200"),children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{children:"â°"}),c.jsx("span",{children:(ot=Q,`${Math.floor(ot/60)}:${(ot%60).toString().padStart(2,"0")}`)}),"warning"===et(Q)&&c.jsx("span",{className:"text-xs",children:"(ã‚ã¨5åˆ†)"}),"critical"===et(Q)&&c.jsx("span",{className:"text-xs",children:"(æ•‘æ´è¦è«‹æ¨å¥¨)"})]})})]}):c.jsxs(r,{variant:"outline",size:"lg",onClick:async()=>{try{_e(),U(!0),Y(new Date),V(0);const e={id:Date.now().toString(),content:Ie.initialPrompt,isAiResponse:!0,timestamp:new Date,type:"ai_support"};u(t=>[...t,e]),v({title:"AIæ”¯æ´é–‹å§‹",description:"AIæ”¯æ´ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸã€‚ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ã§ã‚„ã‚Šå–ã‚Šã—ã¦ãã ã•ã„ã€‚"})}catch(e){console.error("AIæ”¯æ´é–‹å§‹ã‚¨ãƒ©ãƒ¼:",e),v({title:"ã‚¨ãƒ©ãƒ¼",description:"AIæ”¯æ´ã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ",variant:"destructive"})}},disabled:g,className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100 mr-6 px-8 py-3 text-base font-semibold",children:[c.jsx(A,{className:"w-6 h-6 mr-3"}),"AIæ”¯æ´"]}),c.jsxs(r,{variant:"outline",size:"sm",onClick:()=>{console.log("ğŸ“¸ ã‚«ãƒ¡ãƒ©ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"),window.dispatchEvent(new CustomEvent("open-camera")),console.log("ğŸ“¸ open-camera ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã—ã¾ã—ãŸ")},className:"bg-blue-50 border-blue-200 text-blue-700 hover:bg-blue-100 mr-6",children:[c.jsx(_,{className:"w-4 h-4 mr-2"}),"ã‚«ãƒ¡ãƒ©"]}),c.jsxs(r,{variant:"outline",size:"lg",onClick:async()=>{await(async()=>{try{O(!0),console.log("ğŸ”„ å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ä¸€è¦§å–å¾—é–‹å§‹");const e=`?ts=${Date.now()}&r=${Math.random().toString(36).substring(2)}`,{buildApiUrl:t}=await l(async()=>{const{buildApiUrl:e}=await import("./index-BWHx4aNU.js").then(e=>e.I);return{buildApiUrl:e}},__vite__mapDeps([0,1,2,3])),n=t(`/emergency-flow/list${e}`);console.log("ğŸŒ API URL:",n);const a=await fetch(n,{method:"GET",headers:{"Cache-Control":"no-cache, no-store, must-revalidate, max-age=0",Pragma:"no-cache",Expires:"Thu, 01 Jan 1970 00:00:00 GMT","X-Requested-With":"XMLHttpRequest"}});if(console.log("ğŸ“¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹çŠ¶æ…‹:",a.status,a.statusText),!a.ok){const e=await a.text();throw console.error("âŒ API ã‚¨ãƒ©ãƒ¼:",e),new Error(`Failed to fetch emergency guides: ${a.status} - ${e}`)}{const e=await a.json();if(console.log("ğŸ“Š å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿:",e),e.success){const t=e.data||[];C(t),E(t),console.log("âœ… å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰å–å¾—æˆåŠŸ:",t.length+"ä»¶"),t.forEach((e,t)=>{var n;console.log(`ğŸ“‹ ã‚¬ã‚¤ãƒ‰ ${t+1}:`,{id:e.id,title:e.title,fileName:e.fileName,description:(null==(n=e.description)?void 0:n.substring(0,50))+"..."})})}else console.error("âŒ å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰å–å¾—å¤±æ•—:",e.message),C([]),E([])}}catch(e){console.error("ã‚¬ã‚¤ãƒ‰ä¸€è¦§ã®å–å¾—ã«å¤±æ•—:",e),v({title:"ã‚¨ãƒ©ãƒ¼",description:"å¿œæ€¥å‡¦ç½®ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ",variant:"destructive"}),C([]),E([])}finally{O(!1)}})(),k(!0)},disabled:R,className:"bg-red-50 border-red-200 text-red-700 hover:bg-red-100 mr-6 px-8 py-3 text-base font-semibold",children:[c.jsx(D,{className:"w-6 h-6 mr-3"}),"å¿œæ€¥å¾©æ—§ãƒãƒ‹ãƒ¥ã‚¢ãƒ«"]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs(r,{variant:"outline",size:"sm",onClick:qe,disabled:g||0===i.length,children:[c.jsx(I,{className:"w-4 h-4 mr-2"}),"ã‚µãƒ¼ãƒãƒ¼é€ä¿¡"]}),c.jsxs(r,{variant:"outline",size:"sm",onClick:async()=>{try{await p(),ke(!1),Ce(null),U(!1),v({title:"æˆåŠŸ",description:"ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ"})}catch(e){v({title:"ã‚¨ãƒ©ãƒ¼",description:"ã‚¯ãƒªã‚¢ã«å¤±æ•—ã—ã¾ã—ãŸ",variant:"destructive"})}},disabled:g||x||0===i.length,children:[c.jsx(L,{className:"w-4 h-4 mr-2"}),"ã‚¯ãƒªã‚¢"]})]})]}),q?c.jsx("div",{className:"flex-1",children:c.jsx(Ge,{})}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth",children:[i.map(e=>c.jsx("div",{className:"flex "+(e.isAiResponse?"justify-end":"justify-start"),children:c.jsx("div",{className:"max-w-2xl "+(e.isAiResponse?"w-auto":"w-full"),children:e.isAiResponse&&Ne&&(null==Se?void 0:Se.currentQuestion)===e.content?c.jsx(TroubleshootingQABubble,{question:e.content,options:(null==Se?void 0:Se.currentOptions)||[],reasoning:null==Se?void 0:Se.reasoning,onAnswer:He,isLoading:g}):e.isAiResponse&&(e.content.includes("è§£æ±ºç­–")||e.content.includes("ç·Šæ€¥å¯¾å¿œ"))?c.jsx(SolutionBubble,{solution:e.content,problemDescription:null==Se?void 0:Se.problemDescription,isEmergency:e.content.includes("ç·Šæ€¥å¯¾å¿œ")}):c.jsx(Ue,{message:e})})},e.id)),g&&c.jsx("div",{className:"flex justify-end",children:c.jsx("div",{className:"bg-white rounded-lg shadow-sm border p-4",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),c.jsx("span",{className:"text-gray-600",children:"AIãŒå¿œç­”ã‚’ç”Ÿæˆä¸­..."})]})})}),c.jsx("div",{ref:j,className:"h-4"})]}),c.jsx("div",{className:"border-t bg-white p-4",children:c.jsx(Be,{onSendMessage:async(e,t=[])=>{(e.trim()||0!==t.length)&&(Ne&&Se?await He(e):H?await(async(e,t=[])=>{try{const n={id:Date.now().toString(),content:e,isAiResponse:!1,timestamp:new Date,type:"user_message",media:t};u(e=>[...e,n]);const a=await Qe(e),s={id:(Date.now()+1).toString(),content:a,isAiResponse:!0,timestamp:new Date,type:"ai_support_response"};u(e=>[...e,s])}catch(n){console.error("AIæ”¯æ´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ã‚¨ãƒ©ãƒ¼:",n);const e={id:(Date.now()+1).toString(),content:"ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ç¾åœ¨AIæ”¯æ´ã®å¿œç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",isAiResponse:!0,timestamp:new Date,type:"ai_support_response"};u(t=>[...t,e]),v({title:"ã‚¨ãƒ©ãƒ¼",description:"AIæ”¯æ´ã®å¿œç­”ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ",variant:"destructive"})}})(e,t):m(e,t,!1))},isLoading:g,disabled:Ne&&!(null==Se?void 0:Se.currentQuestion)})})]}),c.jsx(Ye,{}),rt&&at&&c.jsx(Ve,{}),N&&c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto",children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h2",{className:"text-xl font-semibold",children:"å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰"}),c.jsxs(r,{variant:"ghost",size:"sm",onClick:()=>{k(!1),P(null),$("")},className:"text-gray-500 hover:text-gray-700",children:[c.jsx(s,{className:"w-4 h-4 mr-2"}),"é–‰ã˜ã‚‹"]})]}),c.jsx("div",{className:"mb-4",children:c.jsx(h,{type:"text",placeholder:"ã‚¬ã‚¤ãƒ‰ã‚’æ¤œç´¢...",value:z,onChange:e=>Fe(e.target.value),className:"w-full"})}),c.jsx("div",{className:"mb-4",children:c.jsx(Xe,{onKeywordClick:e=>{Fe(e)}})}),!T&&c.jsx("div",{className:"overflow-auto",children:c.jsxs("table",{className:"w-full border-collapse border border-gray-300 text-sm",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-gray-100",children:[c.jsx("th",{className:"border border-gray-300 p-3 text-left text-sm font-medium",children:"ã‚¿ã‚¤ãƒˆãƒ«"}),c.jsx("th",{className:"border border-gray-300 p-3 text-left text-sm font-medium",children:"èª¬æ˜"})]})}),c.jsx("tbody",{children:0===M.length?c.jsx("tr",{children:c.jsx("td",{colSpan:2,className:"border border-gray-300 p-4 text-center text-gray-500",children:"ã‚¬ã‚¤ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"})}):M.map(e=>c.jsxs("tr",{className:"hover:bg-gray-50 cursor-pointer "+(T===e.id?"bg-blue-50 ring-2 ring-blue-500":""),onClick:()=>{return t=e.id,void P(t);var t},children:[c.jsx("td",{className:"border border-gray-300 p-3",children:c.jsx("div",{className:"break-words leading-tight text-sm font-semibold hover:text-blue-600",children:e.title})}),c.jsx("td",{className:"border border-gray-300 p-3",children:c.jsx("div",{className:"break-words leading-tight text-sm text-gray-600",children:e.description})})]},e.id))})]})}),T&&c.jsx("div",{className:"mt-6",children:c.jsx(f,{guideId:T,onExit:()=>P(null),backButtonText:"ä¸€è¦§ã«æˆ»ã‚‹",onSendToChat:()=>{console.log("å¿œæ€¥å‡¦ç½®ã‚¬ã‚¤ãƒ‰ã‚’ãƒãƒ£ãƒƒãƒˆã«é€ä¿¡"),k(!1)}})})]})})]});var ot}export{Je as default};
