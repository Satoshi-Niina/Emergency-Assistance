const fs = require('fs');
const path = require('path');

// Base64ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function createImageFromBase64(base64Data, outputPath) {
  try {
    // Base64ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ãƒãƒƒãƒ•ã‚¡ã‚’ä½œæˆ
    const base64String = base64Data.replace(/^data:image\/[a-z]+;base64,/, '');
    const imageBuffer = Buffer.from(base64String, 'base64');
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿
    fs.writeFileSync(outputPath, imageBuffer);
    
    console.log(`âœ… ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæˆåŠŸ: ${outputPath} (${imageBuffer.length} bytes)`);
    return true;
  } catch (error) {
    console.error(`âŒ ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå¤±æ•—: ${outputPath}`, error);
    return false;
  }
}

// ãƒ†ã‚¹ãƒˆç”¨ã®Base64ãƒ‡ãƒ¼ã‚¿ï¼ˆå°ã•ãªãƒ†ã‚¹ãƒˆç”»åƒï¼‰
const testBase64Data = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDABQODxIPDRQSEBIXFRQYHjIhHhwcHj0sLiQySUBMS0dARkVQWnNiUFVtVkVGZIhlbXd7gYKBTmCNl4x9lnN+gXz/2wBDARUXFx4aHjshITt8U0ZTfHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHx8fHz/wAARCAHrA2oDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEG/8QAFhABAQEAAAAAAAAAAAAAAAAAABEB/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8AyQDYAAAIACgAgAAAAAAAAIoAigCKAIKCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACoCiAAAAACoAogCoqAAAoAAAAAAAACgAgAAAQABQAAAAAAAAAQAAAAAARQAAAAAQUEUAQVAUEBUAAAFQAAAAAAAAAAAAAFQAAAAAAAAAAAAAAAAAVAAAAAAAAAAAAAAAAAAAAVAUQAABQAAAAAAAAFABAAAAAAUAAAAAAAAAAAEAAAAAAAAAEAUQFEUEVFBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUQAAAAABQQAFAAAAEUAAAAAAAAAAAAABQAAAAAAAAAAAQAAAAEUAAAABAAAAUQAABUAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUEFQAVAUAEUAAAAAAAAFAAABAAUAAAAAAAAAAAAAEAABFAAAAQAFBAABUBUAAAAAAAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUEABUVAFQAVABRAUQAUQFAAAAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAEABQQAAAFQUEAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFBAAAAAAFRQQFBAAUQBRFAAAAAAAAAAUFQAAAAAAAAAAQAAAFABAAAAABAUABFQBUUEAAAAFAQAAFBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUEAAVFAQAVFABFBAUAAAAAAAAAAABQVAAAAAAAAAABAAUAEAAAAAAEUABAFQUEFQFRUBRFBAAAAVAAAAAAAAAAFQAAAAAAAAAAAAAAAAAAAAAAAAFQAAAAAAAAAAAFQAAABQRUAVFARUAUAAAAAAAABQAAAQAFAAAAABAAUAAAAAEABQEVAAAQUAAAABFQAAAAAAAFBAAAAAAAAAAAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFQAFBFQBUFBAAUQAUQFAAAAAUAEAAAAAAABQAAAAAAAQAFABAAAAUAEAAAEBUVAVABUFBAAAAFRQQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFEAAAFRQQUBFEBRFAQAUAAAAAAAAAAAABQAAAAAAAAAQAFABAAAAAAAAAEAVBQRRAFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFQBUAVFQFQAFQBQAAAAAAAAAAANAAKCgAAAAAAAAAAAgAAAAAAAACKAAACAAAAoIqAAAAKCCoAAAAAAAAACggAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKgAAAqCggqACoCgAgoCKACKAAAAAAAAAAAAAARQAAAAAAAAAQAFABAAUAAAEAAAAAEBQQAVABUAAAAAAAAAAAAAAAAAFQFEAAABUAAAAAAAAAAAAAAAFQFQAAAAAFQAFQFEAVABRFBAUBFQFAARQEFAAAAFABAAAAAAUAAAAAAAAAAAAAAAEAAAAAAAAAAEAAVAFQAVABUVABUAAAAAAAAAAAVAAAAAAAAAAAAAAAAAAAAAAAAAAAAABUAVBQQFAQUEFQFEAFAEVAFAAEUAAAAABQAAAQAAAFAAAAAAAAABAAAAUAEAAARQAAAFAEQVAAVFBFABFQFRUBQAQAAAAAAAAFBAAAAAUEAABQQAAAAAAAAAAAAAAVAAAAAAUEBQRQBFQAUAAAAAAAAAAAAAAAAFAAABABVEAAAAAAAAAAAAAQAAAAAFABAABFQBUVAVAAVFBAUEFAQVAVAAABUFBAAAAFQAAAAAAAAAAAAAAAAAFQAAAAAVAAAAUEAAFQBUUEABQAAAAARQAAAAAAAAAAUAEAgKAAAAAAACAAoAAAIAAAAAAAAAAAAAgCggCiAAAAAKIAACoqAAAAAAAAAqAACggACoAAAAAAAAAAAAAAAKgAAAqKAgAoAAigAgCiAoICggAoAAAAAAAAAAoAIACgBUABQAAAAAAAQAFABAAAAAAAAAAARQAAAAAQAFQAVAFEBUAAAAAAAAAAAAABUAAAAAAAAAAAAAAAAAAABUAAAFQBUUEUQAVABUBQAEUBFABFQFAAAAAAAUAAAEAAAgAAqiAAAAAAAIACgAAAAAgAAIoAAAigIoAIqAqKAgAKioCoAAAKioCoAAAKioAAAAAAAAAKgAAKgAAACoAAAAACggqAAAKigioAoACKACCioogAAAKIoiCgAAKACAAAAoAIACgACoKCAAAAAAAAAAAIACgAAAgAKACAAoAIAAIoAiooIqAKCKKIIKioAKgAKCAAoiggACooAgAAAACoAAKAgACoACgIoAgAqKAIAKAACAqKgCgACAoAAAAICgAAAAKACAAoAIACgAAoAgAAAAqAAAAAAAAAAAAIACgAgAAAAAAAgKIoCACooCCoCgAgqAoIAoAioAKgAogAAAKCKICoKAgAqACgAIAAoAAAIoIoAigAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAACoAKgAKCAAAAAAAAAAAIAAAAAAAAAAAAAAAAIKAigCCoAoAgqAKiggoAgoCKAIAKgAAAqAAqAKioCoKAioCooAigAACCgigAAAIoAAIoAAAAAAAAAAKACAAAAAAoAAAAKgCgAgAAAAAAAAAAAAAAAAAAAAAACAAoAIAAAAAAIqKAioCoKCKgAqKCCoAoAAAioAKiggAAAAKAgoICgigAAAAAAAigAAAAAAAAAAAAACgAgAAAKAAACAAAAoAAAAAqAiigAAigIAAAAAAAAAAAAAgAKAAACAAAAoAIAAAAAAAAIoAIKAAAigAigAAIqAKgAoACKAAAIoCKAIoAAAAAAAAAAAAoAIAAAAAAACgAgAKAAAAAAAAAAAAAACooAAAAIoACAAqIACgAAAAAAAgAKAAAAACAAoAAAIACgAgAAAAiooCKAAAIKCKAAAAigIKAiigIIKgoAAAAAAAAACgAAAgAAAAAAAAAAAKACAAAAoAAAAAAAAAAAAAAoAAICgAIoCKgAAAAAAAAAAgAKAAAAAAAAAAACAAAAAAAAAAAAAAAAAACCgIoAAACKAIoAAAAAAAAACgAgAAAAAKAAACAAoAAAAAAAAAAAAAAAAAAAoIogCgAAAAAAAAAIoCAAAAAAAAAAAAAAAAAAAAAAAgAKACAAAAAAAAAAAAAAAAAAAAAAAAAAoAIAAAAAAAAAAACgAAAAAgAKAAAAAAAAAAAAAAAAAKAACKAIKAAAAAAAAAAAgoCAACoAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAKACAAAAAAAAAAAAAAAAAAoAIAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAACooAAAIoCKAAAAAAAAAAAAAIKCAAAAAAAAAAAAAAAAAAAAAAAAAIACgAAAgAAAKACAAAAoAIAAAAAAAAAAACgAgAAAAAKAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAACgAAAAAAAAAgAKAAAAAAAAAAAAKgAAAAAKiggKAAAAAAAAAAAAAAAAAAAAAAAACKigAAgAAAAAAAAAAAAAACAAoAAAAAAAIAAACgAAAAAAAAAAAgAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAqAqKAigAAAAABgAAAagP//Z';

// å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
const outputDir = path.join(__dirname, 'knowledge-base', 'images', 'chat-exports');

// å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å
const outputFiles = [
  'chat_image_0a9f4736-82fa-4a6a-a5aa-e029cf088afd_1754638047580.jpg',
  'chat_image_a0626cc5-716c-4ab7-ba38-1f04bdcb2fab_1754638818186.jpg'
];

console.log('ğŸ–¼ï¸ ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä¿®å¾©é–‹å§‹...');

// å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
outputFiles.forEach((fileName, index) => {
  const outputPath = path.join(outputDir, fileName);
  console.log(`ğŸ“· ç”»åƒ${index + 1}ã‚’ä½œæˆä¸­: ${fileName}`);
  
  const success = createImageFromBase64(testBase64Data, outputPath);
  if (success) {
    console.log(`âœ… ç”»åƒ${index + 1}ä½œæˆå®Œäº†`);
  } else {
    console.log(`âŒ ç”»åƒ${index + 1}ä½œæˆå¤±æ•—`);
  }
});

console.log('ğŸ‰ ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä¿®å¾©å®Œäº†');

