# Emergency Assistance - Docker開発環境

## 🎯 最も確実な開発方法

### 問題の根本原因
- ローカル開発環境と本番環境の構成が異なる
- 環境変数の管理が複雑
- デプロイ後にのみ問題が発覚

### 解決策：Docker環境
**ローカル環境 = 本番環境**を完全保証する開発環境を構築します。

## 🚀 最速スタート（3ステップ）

### 1. Docker Desktopをインストール
```powershell
# Windows: https://www.docker.com/products/docker-desktop/
# インストール後、再起動
```

### 2. スクリプトで起動
```powershell
# PowerShellで実行
.\start-docker.ps1
```

### 3. ブラウザで確認
```
http://localhost:8080
```

**これだけで本番環境と同じ構成が起動します！**

## 📋 起動モード

### 本番環境シミュレーション（推奨）
```powershell
.\start-docker.ps1
# メニューで「1」を選択
```

- ✅ 本番環境と完全に同じ構成
- ✅ CORSの動作確認
- ✅ デプロイ前の最終チェック
- ✅ PostgreSQLデータベース含む

### 開発環境（ホットリロード）
```powershell
.\start-docker.ps1
# メニューで「2」を選択
```

- ✅ コード変更が即座に反映
- ✅ 本番と同じ環境構成
- ✅ 効率的な開発作業

## 🎓 推奨ワークフロー

```
┌─────────────────────────────────────┐
│ 1. Docker開発環境で開発             │
│    .\start-docker.ps1 → 「2」       │
│    http://localhost:8080           │
└──────────────┬──────────────────────┘
               │ コード変更
               ▼
┌─────────────────────────────────────┐
│ 2. 本番環境シミュレーション           │
│    .\start-docker.ps1 → 「1」       │
│    CORS・API動作確認                │
└──────────────┬──────────────────────┘
               │ 問題なし
               ▼
┌─────────────────────────────────────┐
│ 3. Git コミット＆プッシュ            │
│    git add .                       │
│    git commit -m "..."             │
│    git push                        │
└──────────────┬──────────────────────┘
               │ 自動デプロイ
               ▼
┌─────────────────────────────────────┐
│ 4. 本番環境で動作確認                │
│    ✅ ローカルと完全一致             │
└─────────────────────────────────────┘
```

## 💡 従来の問題と比較

### ❌ 従来の開発フロー
```
ローカル開発 → デプロイ → エラー発見 → 修正 → 再デプロイ → ...
    ↑                                              ↓
    └──────────────── 繰り返し ───────────────────┘
```

**問題点:**
- CORSエラーはデプロイ後にしか分からない
- APIパスの違いが本番で発覚
- 環境変数の不一致で動作しない
- 無駄なデプロイ回数

### ✅ Docker開発フロー
```
Docker開発 → 本番シミュレーション → デプロイ → ✅完了
    ↑              │
    └── 問題発見 ──┘ (デプロイ前に解決)
```

**メリット:**
- ✅ デプロイ前にすべての問題を発見
- ✅ 本番環境との完全一致を保証
- ✅ 無駄なデプロイが不要
- ✅ 確実に動作する

## 🔧 コマンド一覧

### 基本操作
```powershell
# 起動メニュー
.\start-docker.ps1

# 直接起動（本番シミュレーション）
docker-compose up -d

# 直接起動（開発環境）
docker-compose -f docker-compose.dev.yml up -d

# 停止
docker-compose down

# ログ確認
docker-compose logs -f

# 再ビルド
docker-compose up --build
```

### デバッグ
```powershell
# コンテナ内に入る
docker-compose exec app sh

# データベースに接続
docker-compose exec postgres psql -U postgres -d emergency_assistance

# 環境変数確認
docker-compose exec app env
```

## 📚 詳細ドキュメント

より詳しい情報は以下を参照:
- `DOCKER_SETUP.md` - 完全なセットアップガイド
- `docker-compose.yml` - 本番環境設定
- `docker-compose.dev.yml` - 開発環境設定
- `Dockerfile` - イメージビルド定義

## ❓ よくある質問

### Q: Dockerを使う必要がありますか？
**A:** はい。ローカル=本番を保証する唯一確実な方法です。

### Q: 起動が遅いですか？
**A:** 初回ビルドは数分かかりますが、2回目以降は数秒で起動します。

### Q: ファイル変更はすぐ反映されますか？
**A:** 開発環境（モード2）ではホットリロードが有効です。

### Q: 従来の開発方法も使えますか？
**A:** 可能ですが、Docker環境を推奨します。本番との差異がなくなります。

### Q: データベースはどうなりますか？
**A:** PostgreSQLコンテナが自動で起動・初期化されます。

## 🎯 まとめ

### 最も確実な開発方法
```powershell
# 1. Docker環境で開発
.\start-docker.ps1  # 「2」を選択

# 2. 本番環境シミュレーション
.\start-docker.ps1  # 「1」を選択

# 3. 問題なければデプロイ
git push
```

**この方法なら、デプロイ後の予期しないエラーは起きません！**

---

詳細: `DOCKER_SETUP.md`
トラブルシューティング: `DOCKER_SETUP.md` のトラブルシューティングセクション
