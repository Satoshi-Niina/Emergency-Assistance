# ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒèµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
Write-Host "ğŸš€ ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚’èµ·å‹•ä¸­..." -ForegroundColor Green

# å…¨ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
Write-Host "ğŸ›‘ æ—¢å­˜ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ä¸­..." -ForegroundColor Yellow
Get-Process | Where-Object {$_.ProcessName -like "*node*"} | Stop-Process -Force -ErrorAction SilentlyContinue

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ
Write-Host "ğŸ” ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆä¸­..." -ForegroundColor Yellow
try {
    $dbTest = psql -U postgres -h localhost -d emergency_assistance -c "SELECT COUNT(*) FROM users;" 2>$null
    if ($LASTEXITCODE -eq 0) {
        Write-Host "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæˆåŠŸ" -ForegroundColor Green
    } else {
        Write-Host "âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—" -ForegroundColor Red
        Write-Host "PostgreSQLãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„" -ForegroundColor Yellow
        exit 1
    }
} catch {
    Write-Host "âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼: $_" -ForegroundColor Red
    exit 1
}

# ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¢ºèª
Write-Host "ğŸ‘¤ ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç¢ºèªä¸­..." -ForegroundColor Yellow
$userTest = psql -U postgres -h localhost -d emergency_assistance -c "SELECT username FROM users WHERE username='testuser';" 2>$null
if ($LASTEXITCODE -eq 0) {
    Write-Host "âœ… ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªå®Œäº†" -ForegroundColor Green
} else {
    Write-Host "âš ï¸ ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“" -ForegroundColor Yellow
}

Write-Host ""
Write-Host "ğŸ¯ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚’èµ·å‹•ä¸­..." -ForegroundColor Cyan
Write-Host "  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: http://localhost:5173" -ForegroundColor White
Write-Host "  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: http://localhost:9000" -ForegroundColor White
Write-Host "  - ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼: testuser / test123" -ForegroundColor White
Write-Host ""

# ã‚·ãƒ³ãƒ—ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
Write-Host "ğŸš€ ã‚·ãƒ³ãƒ—ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ä¸­..." -ForegroundColor Yellow
Start-Process -FilePath "node" -ArgumentList "simple-local-server.js" -WindowStyle Hidden

# å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’èµ·å‹•
Start-Sleep -Seconds 3

Write-Host "ğŸŒ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’èµ·å‹•ä¸­..." -ForegroundColor Yellow
cd client
Start-Process -FilePath "npm" -ArgumentList "run", "dev" -WindowStyle Normal

Write-Host ""
Write-Host "âœ… èµ·å‹•å®Œäº†ï¼" -ForegroundColor Green
Write-Host "ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5173 ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„" -ForegroundColor White
Write-Host "ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±: testuser / test123" -ForegroundColor White
