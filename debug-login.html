<!DOCTYPE html>
<html>
<head>
    <title>ç·Šæ€¥æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ  - ãƒ­ã‚°ã‚¤ãƒ³ãƒ‡ãƒãƒƒã‚°</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        .debug-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { color: red; }
        .success { color: green; }
        input, button { padding: 10px; margin: 5px; width: 200px; }
        .status-panel { background: #e3f2fd; padding: 10px; border-left: 4px solid #2196f3; }
    </style>
</head>
<body>
    <h1>ğŸš¨ ç·Šæ€¥æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ  - ãƒ­ã‚°ã‚¤ãƒ³ãƒ‡ãƒãƒƒã‚°</h1>
    
    <div class="status-panel">
        <h3>ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</h3>
        <p><strong>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ URL:</strong> Azure Static Web Apps</p>
        <p><strong>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API:</strong> https://emergencyassistance-sv-fbanemhrbshuf9bd.japanwest-01.azurewebsites.net</p>
        <p><strong>ç¾åœ¨ã®æ¥ç¶šçŠ¶æ…‹:</strong> <span id="connection-status">ç¢ºèªä¸­...</span></p>
    </div>

    <div class="debug-section">
        <h3>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±</h3>
        <p><strong>ç®¡ç†è€…:</strong></p>
        <ul>
            <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼å: <code>admin</code></li>
            <li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: <code>password</code></li>
        </ul>
        <p><strong>å¾“æ¥­å“¡:</strong></p>
        <ul>
            <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼å: <code>employee1</code></li>
            <li>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: <code>password</code></li>
        </ul>
    </div>

    <div class="debug-section">
        <h3>ğŸ§ª ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ</h3>
        <form id="loginForm">
            <div>
                <input type="text" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" value="admin">
            </div>
            <div>
                <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" value="password">
            </div>
            <div>
                <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ</button>
            </div>
        </form>
        <div id="login-result"></div>
    </div>

    <div class="debug-section">
        <h3>ğŸ”§ è¨ºæ–­çµæœ</h3>
        <div id="diagnostics">
            <p>1. <span id="api-health">APIæ¥ç¶šç¢ºèªä¸­...</span></p>
            <p>2. <span id="db-connection">ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèªä¸­...</span></p>
            <p>3. <span id="gpt-connection">GPTæ¥ç¶šç¢ºèªä¸­...</span></p>
        </div>
    </div>

    <script>
        const API_BASE = 'https://emergencyassistance-sv-fbanemhrbshuf9bd.japanwest-01.azurewebsites.net';

        // 1. API Health Check
        async function checkAPIHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();
                document.getElementById('api-health').innerHTML = 
                    `<span class="success">âœ… APIæ¥ç¶šOK (${data.status})</span>`;
                document.getElementById('connection-status').innerHTML = 
                    '<span class="success">æ¥ç¶šOK</span>';
                return true;
            } catch (error) {
                document.getElementById('api-health').innerHTML = 
                    `<span class="error">âŒ APIæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                document.getElementById('connection-status').innerHTML = 
                    '<span class="error">æ¥ç¶šã‚¨ãƒ©ãƒ¼</span>';
                return false;
            }
        }

        // 2. Database Connection Check
        async function checkDBConnection() {
            try {
                const response = await fetch(`${API_BASE}/api/health/db`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('db-connection').innerHTML = 
                        `<span class="success">âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šOK</span>`;
                } else {
                    document.getElementById('db-connection').innerHTML = 
                        `<span class="error">âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼ (${response.status})</span>`;
                }
            } catch (error) {
                document.getElementById('db-connection').innerHTML = 
                    `<span class="error">âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
            }
        }

        // 3. GPT Connection Check
        async function checkGPTConnection() {
            try {
                const response = await fetch(`${API_BASE}/api/health/gpt`);
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('gpt-connection').innerHTML = 
                        `<span class="success">âœ… GPTæ¥ç¶šOK</span>`;
                } else {
                    document.getElementById('gpt-connection').innerHTML = 
                        `<span class="error">âŒ GPTæ¥ç¶šã‚¨ãƒ©ãƒ¼ (${response.status})</span>`;
                }
            } catch (error) {
                document.getElementById('gpt-connection').innerHTML = 
                    `<span class="error">âŒ GPTæ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
            }
        }

        // Login Test
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('login-result');
            
            resultDiv.innerHTML = '<p>ãƒ­ã‚°ã‚¤ãƒ³ä¸­...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ!</h4>
                            <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼: ${data.user.display_name}</p>
                            <p>æ¨©é™: ${data.user.role}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>âŒ ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—</h4>
                            <p>${data.error || 'Unknown error'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        });

        // Run diagnostics on page load
        window.addEventListener('load', () => {
            checkAPIHealth();
            setTimeout(checkDBConnection, 1000);
            setTimeout(checkGPTConnection, 2000);
        });
    </script>
</body>
</html>
