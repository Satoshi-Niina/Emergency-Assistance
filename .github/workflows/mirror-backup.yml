name: Mirror main to backup
on:
  push:
    branches: [ main ]      # main に push/merge されたら起動
  workflow_dispatch:        # 手動実行も可

permissions:
  contents: write           # Actions の GITHUB_TOKEN に push 権限を付与

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout full history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create/Update backup from main
        run: |
          git config user.name  "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git checkout -B backup origin/main
          git push --force-with-lease origin backup
