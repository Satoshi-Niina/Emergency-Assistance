name: Deploy Backend

on:
  push:
    branches: [ main, develop, backup-clean ]
    paths:
      - "server/**"
      - "shared/**"
      - ".github/workflows/**"
      - "package.json"
      - "package-lock.json"

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install root dependencies
        run: npm ci
      - name: Install shared dependencies
        run: cd shared && npm ci
      - name: Install server dependencies
        run: cd server && npm ci
      - name: Build all (TypeScript/Client/Server)
        run: npm run build