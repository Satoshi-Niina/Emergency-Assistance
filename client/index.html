<!doctype html>
<!-- Trigger Client Build 2025-12-14 -->
<html lang="ja">
<!-- Build Timestamp: __BUILD_TIMESTAMP__ -->
<!-- Commit: __COMMIT_SHA__ -->

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Tech Support Assistant</title>
  <link rel="icon" type="image/x-icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”§</text></svg>" />
  <meta http-equiv="Content-Security-Policy" content="
      default-src 'self' data: blob:;
      script-src 'self' 'unsafe-inline' 'unsafe-eval' blob:;
      script-src-elem 'self' 'unsafe-inline' blob:;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      img-src 'self' data: blob: https: http://localhost:* http://127.0.0.1:*;
      media-src 'self' data: blob:;
      connect-src 'self' https: wss: ws: http://localhost:* http://127.0.0.1:*;
      font-src 'self' data: https://fonts.gstatic.com;
      worker-src 'self' blob:;
      frame-src 'self';
    " />
  <script>
    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLã®è¨­å®šï¼ˆæœ¬ç•ªç’°å¢ƒç”¨ï¼‰
    // GitHub Actionsãƒ“ãƒ«ãƒ‰ã§ã¯VITE_BACKEND_SERVICE_URLã‹ã‚‰ç½®æ›ã•ã‚Œã¾ã™
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦æœ¬ç•ªURLã‚’è¨­å®šï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
    const backendUrl = '%%%VITE_BACKEND_SERVICE_URL%%%';
    // ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãŒç½®æ›ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æœ¬ç•ªURLã‚’ä½¿ç”¨
    window.BACKEND_SERVICE_URL = (backendUrl && backendUrl.startsWith('http') && !backendUrl.includes('%%%')) 
      ? backendUrl 
      : 'https://emergency-assistantapp.azurewebsites.net';

    // å‹•çš„ç’°å¢ƒè¨­å®šï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ï¼‰
    (function () {
      const isLocalhost = window.location.hostname === 'localhost' ||
        window.location.hostname === '127.0.0.1' ||
        window.location.hostname.includes('localhost');

      const isAzureStaticWebApp = window.location.hostname.includes('azurestaticapps.net');

      // ç’°å¢ƒåˆ¥è¨­å®š
      let config;

      if (isLocalhost) {
        // ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ: ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰çµ±åˆã‚µãƒ¼ãƒãƒ¼ä½¿ç”¨
        config = {
          "API_BASE_URL": "",
          "CORS_ALLOW_ORIGINS": "http://localhost:5173,http://localhost:8080",
          "ENVIRONMENT": "development"
        };
      } else if (isAzureStaticWebApp) {
        // Azure Static Web Apps: å¤–éƒ¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ç›´æ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        // ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLã‚’å–å¾—ï¼ˆãƒ“ãƒ«ãƒ‰æ™‚ã«åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹ï¼‰
        // API_BASE_URLã«ã¯/apiã‚’å«ã‚ã‚‹ï¼ˆå®Œå…¨ãªAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆURLï¼‰
        const backendUrl = window.BACKEND_SERVICE_URL || '';
        config = {
          "API_BASE_URL": (backendUrl && backendUrl !== '')
            ? backendUrl + "/api"
            : "/api", // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: Static Web Appçµ±åˆFunctions
          "CORS_ALLOW_ORIGINS": window.location.origin,
          "ENVIRONMENT": "production"
        };
      } else {
        // ãã®ä»–ã®ç’°å¢ƒ: Static Web Appçµ±åˆFunctionsä½¿ç”¨
        config = {
          "API_BASE_URL": "/api",
          "CORS_ALLOW_ORIGINS": "*",
          "ENVIRONMENT": "production"
        };
      }

      console.log('ğŸ”§ Runtime Config Applied:', {
        hostname: window.location.hostname,
        environment: config.ENVIRONMENT,
        "API_BASE_URL": config.API_BASE_URL,
        backendUrl: window.BACKEND_SERVICE_URL,
      });

      window.runtimeConfig = config;
    })();
  </script>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>