# Emergency Assistance System - æŠ€è¡“è³‡æ–™

## ğŸ“‹ ç›®æ¬¡

1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
4. [APIä»•æ§˜](#apiä»•æ§˜)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
6. [èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#èªè¨¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
7. [ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†](#ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†)
8. [é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)
9. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)
10. [ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](#ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹)

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±¤                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  React 18 + TypeScript + Vite                        â”‚  â”‚
â”‚  â”‚  - TailwindCSS 4.x (ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°)                     â”‚  â”‚
â”‚  â”‚  - Shadcn UI (UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)                       â”‚  â”‚
â”‚  â”‚  - TanStack Query (çŠ¶æ…‹ç®¡ç†ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°)            â”‚  â”‚
â”‚  â”‚  - React Router (ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)                        â”‚  â”‚
â”‚  â”‚  - Axios (HTTPé€šä¿¡)                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ REST API (JSON)
                      â”‚ WebSocket (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ã‚µãƒ¼ãƒãƒ¼å±¤                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Node.js 20+ + Express 4.x (ESM)                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚  â”‚  Routes    â”‚ â”‚  Services  â”‚ â”‚Middleware  â”‚       â”‚  â”‚
â”‚  â”‚  â”‚  Layer     â”‚ â”‚  Layer     â”‚ â”‚  Layer     â”‚       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  - Express Session (ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†)                   â”‚  â”‚
â”‚  â”‚  - Helmet (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼)                      â”‚  â”‚
â”‚  â”‚  - CORS (ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³åˆ¶å¾¡)                          â”‚  â”‚
â”‚  â”‚  - Compression (ãƒ¬ã‚¹ãƒãƒ³ã‚¹åœ§ç¸®)                       â”‚  â”‚
â”‚  â”‚  - Morgan (ãƒ­ã‚°è¨˜éŒ²)                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                       â”‚
          â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ‡ãƒ¼ã‚¿å±¤         â”‚    â”‚  å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹å±¤         â”‚
â”‚                  â”‚    â”‚                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Turso SQLite â”‚ â”‚    â”‚ â”‚ Azure Blob Storage â”‚ â”‚
â”‚ â”‚ (PostgreSQL  â”‚ â”‚    â”‚ â”‚  - ç”»åƒã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸   â”‚ â”‚
â”‚ â”‚  äº’æ›)       â”‚ â”‚    â”‚ â”‚  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚    â”‚                        â”‚
â”‚ - Drizzle ORM    â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ - å‹å®‰å…¨ã‚¯ã‚¨ãƒª    â”‚    â”‚ â”‚ OpenAI API         â”‚ â”‚
â”‚                  â”‚    â”‚ â”‚  - GPT-4           â”‚ â”‚
â”‚                  â”‚    â”‚ â”‚  - AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ  â”‚ â”‚
â”‚                  â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
[ãƒ–ãƒ©ã‚¦ã‚¶] 
    â†“ (1) HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆ
[ExpressãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒã‚§ãƒ¼ãƒ³]
    â”œâ†’ CORSæ¤œè¨¼
    â”œâ†’ ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œè¨¼
    â”œâ†’ èªè¨¼ãƒã‚§ãƒƒã‚¯
    â””â†’ ãƒœãƒ‡ã‚£ãƒ‘ãƒ¼ã‚¹
    â†“ (2) ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
[ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼]
    â†“ (3) ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
[ã‚µãƒ¼ãƒ“ã‚¹å±¤]
    â”œâ†’ (4a) DBæ“ä½œ (Drizzle ORM)
    â”œâ†’ (4b) Blob Storageæ“ä½œ
    â””â†’ (4c) OpenAI APIå‘¼ã³å‡ºã—
    â†“ (5) ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ
[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ]
    â””â†’ (6) UIæ›´æ–° (React)
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----|----------|------|
| React | 18.3.1 | UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| TypeScript | 5.7.3 | å‹å®‰å…¨æ€§ |
| Vite | 5.4.21 | ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ãƒ»é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ |
| TailwindCSS | 4.1.17 | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |
| Shadcn UI | latest | UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| TanStack Query | 5.81.2 | ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ç®¡ç† |
| React Router | 7.6.3 | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| Axios | 1.10.0 | HTTPé€šä¿¡ |
| Zustand | 5.0.2 | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ç®¡ç† |
| React Hook Form | 7.54.2 | ãƒ•ã‚©ãƒ¼ãƒ ç®¡ç† |
| Zod | 3.24.1 | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----|----------|------|
| Node.js | 20+ | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  |
| Express | 4.21.2 | Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| Drizzle ORM | 0.44.4 | ORM |
| Turso SQLite | - | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆPostgreSQLäº’æ›ï¼‰ |
| @azure/storage-blob | 12.20.0 | Blob Storage SDK |
| @azure/identity | 4.0.1 | Azureèªè¨¼ |
| OpenAI | 4.104.0 | AI API |
| bcryptjs | 2.4.3 | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ³ã‚° |
| jsonwebtoken | 9.0.2 | JWTç”Ÿæˆãƒ»æ¤œè¨¼ |
| express-session | 1.18.2 | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† |
| helmet | 8.1.0 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ |
| cors | 2.8.5 | CORSåˆ¶å¾¡ |
| compression | 1.7.4 | ãƒ¬ã‚¹ãƒãƒ³ã‚¹åœ§ç¸® |
| morgan | 1.10.1 | ãƒ­ã‚°è¨˜éŒ² |
| multer | 1.4.5-lts.1 | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |

### ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»DevOps

| æŠ€è¡“ | ç”¨é€” |
|-----|------|
| Docker | ã‚³ãƒ³ãƒ†ãƒŠåŒ– |
| Docker Compose | ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ |
| Azure App Service | ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰ |
| Azure Static Web Apps | ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰ |
| Azure Container Registry | Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ¬ã‚¸ã‚¹ãƒˆãƒª |
| Azure Blob Storage | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ |
| GitHub Actions | CI/CD |

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆè©³ç´°

```
Emergency-Assistance/
â”‚
â”œâ”€â”€ client/                          # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/             # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                # Shadcn UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ forms/             # ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/            # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â””â”€â”€ shared/            # å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ hooks/                 # ã‚«ã‚¹ã‚¿ãƒ React Hooks
â”‚   â”‚   â”œâ”€â”€ lib/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”‚   â”œâ”€â”€ pages/                 # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ services/              # APIé€šä¿¡ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ store/                 # ZustandçŠ¶æ…‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ types/                 # TypeScriptå‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ App.tsx                # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â””â”€â”€ main.tsx               # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ public/                    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ index.html                 # HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ vite.config.js             # Viteè¨­å®š
â”‚   â”œâ”€â”€ tailwind.config.ts         # TailwindCSSè¨­å®š
â”‚   â”œâ”€â”€ tsconfig.json              # TypeScriptè¨­å®š
â”‚   â””â”€â”€ package.json               # ä¾å­˜é–¢ä¿‚
â”‚
â”œâ”€â”€ server/                          # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/                   # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆè‡ªå‹•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/            # ç®¡ç†æ©Ÿèƒ½ (/api/admin)
â”‚   â”‚   â”‚   â”œâ”€â”€ ai-assist/        # AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ (/api/ai-assist)
â”‚   â”‚   â”‚   â”œâ”€â”€ chatgpt/          # ChatGPTçµ±åˆ (/api/chatgpt)
â”‚   â”‚   â”‚   â”œâ”€â”€ chats/            # ãƒãƒ£ãƒƒãƒˆå±¥æ­´ (/api/chats)
â”‚   â”‚   â”‚   â”œâ”€â”€ data/             # ãƒ‡ãƒ¼ã‚¿ç®¡ç† (/api/data)
â”‚   â”‚   â”‚   â”œâ”€â”€ data-processor/   # ãƒ‡ãƒ¼ã‚¿å‡¦ç† (/api/data-processor)
â”‚   â”‚   â”‚   â”œâ”€â”€ db/               # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ (/api/db)
â”‚   â”‚   â”‚   â”œâ”€â”€ documents/        # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ (/api/documents)
â”‚   â”‚   â”‚   â”œâ”€â”€ emergency-flow/   # ç·Šæ€¥ãƒ•ãƒ­ãƒ¼ (/api/emergency-flow)
â”‚   â”‚   â”‚   â”œâ”€â”€ files/            # ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† (/api/files)
â”‚   â”‚   â”‚   â”œâ”€â”€ flows/            # ãƒ•ãƒ­ãƒ¼ç®¡ç† (/api/flows)
â”‚   â”‚   â”‚   â”œâ”€â”€ health/           # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (/api/health)
â”‚   â”‚   â”‚   â”œâ”€â”€ images/           # ç”»åƒç®¡ç† (/api/images)
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge/        # ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢ (/api/knowledge)
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge-base/   # KBç®¡ç† (/api/knowledge-base)
â”‚   â”‚   â”‚   â”œâ”€â”€ machines/         # ãƒã‚·ãƒ³æƒ…å ± (/api/machines)
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/         # è¨­å®šç®¡ç† (/api/settings)
â”‚   â”‚   â”‚   â”œâ”€â”€ tech-support/     # æŠ€è¡“ã‚µãƒãƒ¼ãƒˆ (/api/tech-support)
â”‚   â”‚   â”‚   â”œâ”€â”€ troubleshooting/  # ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒˆ (/api/troubleshooting)
â”‚   â”‚   â”‚   â””â”€â”€ users/            # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† (/api/users)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ config/               # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â”‚   â”œâ”€â”€ env.mjs          # ç’°å¢ƒå¤‰æ•°ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ cors.mjs         # CORSè¨­å®š
â”‚   â”‚   â”‚   â”œâ”€â”€ session.mjs      # ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š
â”‚   â”‚   â”‚   â””â”€â”€ security.mjs     # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ infra/                # ã‚¤ãƒ³ãƒ•ãƒ©å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ db.mjs           # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
â”‚   â”‚   â”‚   â”œâ”€â”€ blob.mjs         # Blob Storageæ¥ç¶š
â”‚   â”‚   â”‚   â””â”€â”€ openai.mjs       # OpenAIæ¥ç¶š
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routes/               # æ‰‹å‹•ãƒ«ãƒ¼ãƒˆå®šç¾©
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.mjs         # èªè¨¼ãƒ«ãƒ¼ãƒˆ (/api/auth)
â”‚   â”‚   â”‚   â”œâ”€â”€ health.mjs       # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (/health, /ready)
â”‚   â”‚   â”‚   â”œâ”€â”€ history.mjs      # å±¥æ­´ç®¡ç† (/api/history)
â”‚   â”‚   â”‚   â””â”€â”€ diag.mjs         # è¨ºæ–­ãƒ„ãƒ¼ãƒ« (/api/_diag)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ app.mjs               # Expressã‚¢ãƒ—ãƒªåˆæœŸåŒ–
â”‚   â”‚
â”‚   â”œâ”€â”€ azure-server.mjs           # æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ dev-server.mjs             # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
â”‚   â”œâ”€â”€ unified-hot-reload-server.js # ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
â”‚   â”œâ”€â”€ package.json               # ä¾å­˜é–¢ä¿‚
â”‚   â””â”€â”€ tsconfig.build.json        # TypeScriptè¨­å®š
â”‚
â”œâ”€â”€ shared/                         # å…±æœ‰ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ schema.ts                  # å…±æœ‰å‹å®šç¾©ï¼ˆZodï¼‰
â”‚   â”œâ”€â”€ schema.d.ts                # å‹å®šç¾©ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ scripts/                        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ check-azure-auth-status.ps1      # Azureèªè¨¼ç¢ºèª
â”‚   â”œâ”€â”€ check-azure-database.ps1         # DBæ¥ç¶šç¢ºèª
â”‚   â”œâ”€â”€ check-build-before-push.js       # ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯
â”‚   â”œâ”€â”€ check-rsc-vulnerabilities.mjs    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
â”‚   â”œâ”€â”€ check-user-passwords.mjs         # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª
â”‚   â”œâ”€â”€ clean.mjs                        # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ cleanup-env-vars.ps1             # ç’°å¢ƒå¤‰æ•°ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ clear-chat-db.mjs                # ãƒãƒ£ãƒƒãƒˆDBåˆæœŸåŒ–
â”‚   â”œâ”€â”€ generate-password-hash.js        # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ç”Ÿæˆ
â”‚   â”œâ”€â”€ kill-port-8080.ps1               # ãƒãƒ¼ãƒˆè§£æ”¾
â”‚   â”œâ”€â”€ pre-commit.ps1                   # ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯
â”‚   â”œâ”€â”€ pre-deploy-check.mjs             # ãƒ‡ãƒ—ãƒ­ã‚¤å‰æ¤œè¨¼
â”‚   â”œâ”€â”€ seed-admin-user.sql              # ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
â”‚   â””â”€â”€ upload-images-to-blob.mjs        # ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
â”‚
â”œâ”€â”€ knowledge-base/                 # ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ documents/                 # ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ images/                    # ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ data/                      # æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ troubleshooting/           # ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æƒ…å ±
â”‚   â””â”€â”€ exports/                   # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â”œâ”€â”€ docker-compose.yml              # æœ¬ç•ªDocker Composeè¨­å®š
â”œâ”€â”€ docker-compose.dev.yml          # é–‹ç™ºDocker Composeè¨­å®š
â”œâ”€â”€ Dockerfile                      # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸å®šç¾©
â”œâ”€â”€ .env.example                    # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ package.json                    # ãƒ«ãƒ¼ãƒˆä¾å­˜é–¢ä¿‚
â””â”€â”€ tsconfig.json                   # TypeScriptè¨­å®šï¼ˆãƒ«ãƒ¼ãƒˆï¼‰
```

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ 

#### ESM (ES Modules) ã®æ¡ç”¨

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å®Œå…¨ã«ESMã§æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™:

```javascript
// âœ… æ­£ã—ã„ (ESM)
import express from 'express';
export const app = express();

// âŒ ä½¿ç”¨ã—ãªã„ (CommonJS)
const express = require('express');
module.exports = app;
```

**ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­**:
- `.mjs`: ES Module JavaScriptï¼ˆæ˜ç¤ºçš„ï¼‰
- `.ts`: TypeScriptï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¾ŒESMï¼‰
- `.js`: CommonJSï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ã€æ®µéšçš„ã«å‰Šé™¤ä¸­ï¼‰

---

## APIä»•æ§˜

### ãƒ™ãƒ¼ã‚¹URL

- **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º**: `http://localhost:8080/api`
- **æœ¬ç•ªç’°å¢ƒ**: `https://your-app.azurewebsites.net/api`

### èªè¨¼æ–¹å¼

ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼ + Cookie

```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin123"
}

Response:
{
  "user": {
    "id": 1,
    "username": "admin",
    "role": "admin"
  },
  "message": "ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ"
}
```

ä»¥é™ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯è‡ªå‹•çš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³CookieãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

### ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```http
GET /health
GET /ready
GET /api/health

Response:
{
  "status": "ok",
  "timestamp": "2025-12-11T00:00:00.000Z",
  "uptime": 12345,
  "environment": "production"
}
```

#### èªè¨¼ (`/api/auth`)

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ | èªè¨¼ |
|---------|--------------|------|-----|
| POST | `/api/auth/login` | ãƒ­ã‚°ã‚¤ãƒ³ | ä¸è¦ |
| POST | `/api/auth/logout` | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ | å¿…è¦ |
| GET | `/api/auth/me` | ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± | å¿…è¦ |
| POST | `/api/auth/refresh` | ã‚»ãƒƒã‚·ãƒ§ãƒ³æ›´æ–° | å¿…è¦ |

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† (`/api/users`)

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ | èªè¨¼ |
|---------|--------------|------|-----|
| GET | `/api/users` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ | å¿…è¦(ç®¡ç†è€…) |
| GET | `/api/users/:id` | ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´° | å¿…è¦ |
| POST | `/api/users` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ | å¿…è¦(ç®¡ç†è€…) |
| PUT | `/api/users/:id` | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–° | å¿…è¦ |
| DELETE | `/api/users/:id` | ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ | å¿…è¦(ç®¡ç†è€…) |

#### ãƒãƒ£ãƒƒãƒˆ (`/api/chatgpt`)

```http
POST /api/chatgpt
Content-Type: application/json
Authorization: Session Cookie

{
  "message": "ç·Šæ€¥æ™‚ã®å¯¾å¿œæ‰‹é †ã‚’æ•™ãˆã¦ãã ã•ã„",
  "context": {
    "conversationId": "uuid-here",
    "previousMessages": []
  }
}

Response:
{
  "response": "ç·Šæ€¥æ™‚ã®å¯¾å¿œæ‰‹é †ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™...",
  "conversationId": "uuid-here",
  "timestamp": "2025-12-11T00:00:00.000Z"
}
```

#### ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹ (`/api/knowledge-base`)

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---------|--------------|------|
| GET | `/api/knowledge-base` | KBè¨˜äº‹ä¸€è¦§ |
| GET | `/api/knowledge-base/:id` | KBè¨˜äº‹è©³ç´° |
| POST | `/api/knowledge-base/search` | KBæ¤œç´¢ï¼ˆFuse.jsï¼‰ |
| POST | `/api/knowledge-base` | KBè¨˜äº‹ä½œæˆ |
| PUT | `/api/knowledge-base/:id` | KBè¨˜äº‹æ›´æ–° |
| DELETE | `/api/knowledge-base/:id` | KBè¨˜äº‹å‰Šé™¤ |

#### ç”»åƒç®¡ç† (`/api/images`)

```http
POST /api/images/upload
Content-Type: multipart/form-data

FormData:
- file: [ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«]
- category: "troubleshooting"

Response:
{
  "url": "https://storage.blob.core.windows.net/knowledge-base/images/uuid.png",
  "filename": "uuid.png",
  "size": 12345,
  "contentType": "image/png"
}
```

#### ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† (`/api/files`)

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---------|--------------|------|
| GET | `/api/files` | ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ |
| GET | `/api/files/:id` | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ |
| POST | `/api/files/upload` | ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| DELETE | `/api/files/:id` | ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ |

### ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼å½¢å¼:

```json
{
  "error": "error_code",
  "message": "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆäººé–“å¯èª­ï¼‰",
  "details": {
    "field": "validation error details"
  },
  "timestamp": "2025-12-11T00:00:00.000Z"
}
```

**HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰**:
- `200`: æˆåŠŸ
- `201`: ä½œæˆæˆåŠŸ
- `400`: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- `401`: èªè¨¼ã‚¨ãƒ©ãƒ¼
- `403`: æ¨©é™ã‚¨ãƒ©ãƒ¼
- `404`: ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„
- `500`: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### ã‚¹ã‚­ãƒ¼ãƒæ¦‚è¦

Drizzle ORMã‚’ä½¿ç”¨ã—ãŸå‹å®‰å…¨ãªã‚¹ã‚­ãƒ¼ãƒå®šç¾©:

```typescript
// server/db/schema/users.ts
import { pgTable, serial, text, timestamp } from 'drizzle-orm/pg-core';

export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  username: text('username').notNull().unique(),
  password: text('password').notNull(),
  email: text('email'),
  role: text('role').notNull().default('user'),
  createdAt: timestamp('created_at').defaultNow(),
  updatedAt: timestamp('updated_at').defaultNow()
});
```

### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

#### `users` ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ  | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|-------|---|-----|------|
| id | SERIAL | PRIMARY KEY | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| username | TEXT | NOT NULL, UNIQUE | ãƒ¦ãƒ¼ã‚¶ãƒ¼å |
| password | TEXT | NOT NULL | bcryptãƒãƒƒã‚·ãƒ¥åŒ–ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ |
| email | TEXT | | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| role | TEXT | NOT NULL, DEFAULT 'user' | å½¹å‰² (admin/user) |
| created_at | TIMESTAMP | DEFAULT NOW() | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | DEFAULT NOW() | æ›´æ–°æ—¥æ™‚ |

#### `chat_history` ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ  | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|-------|---|-----|------|
| id | SERIAL | PRIMARY KEY | å±¥æ­´ID |
| user_id | INTEGER | FOREIGN KEY â†’ users(id) | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| conversation_id | UUID | NOT NULL | ä¼šè©±ID |
| message | TEXT | NOT NULL | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
| response | TEXT | NOT NULL | AIãƒ¬ã‚¹ãƒãƒ³ã‚¹ |
| created_at | TIMESTAMP | DEFAULT NOW() | ä½œæˆæ—¥æ™‚ |

#### `knowledge_base` ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ  | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|-------|---|-----|------|
| id | SERIAL | PRIMARY KEY | KBè¨˜äº‹ID |
| title | TEXT | NOT NULL | ã‚¿ã‚¤ãƒˆãƒ« |
| content | TEXT | NOT NULL | å†…å®¹ï¼ˆMarkdownï¼‰ |
| category | TEXT | | ã‚«ãƒ†ã‚´ãƒª |
| tags | TEXT[] | | ã‚¿ã‚°é…åˆ— |
| author_id | INTEGER | FOREIGN KEY â†’ users(id) | ä½œæˆè€…ID |
| created_at | TIMESTAMP | DEFAULT NOW() | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMP | DEFAULT NOW() | æ›´æ–°æ—¥æ™‚ |

#### `files` ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ  | å‹ | åˆ¶ç´„ | èª¬æ˜ |
|-------|---|-----|------|
| id | SERIAL | PRIMARY KEY | ãƒ•ã‚¡ã‚¤ãƒ«ID |
| filename | TEXT | NOT NULL | ãƒ•ã‚¡ã‚¤ãƒ«å |
| original_name | TEXT | NOT NULL | å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«å |
| blob_url | TEXT | NOT NULL | Blob Storage URL |
| content_type | TEXT | | MIMEã‚¿ã‚¤ãƒ— |
| size | INTEGER | | ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰ |
| uploader_id | INTEGER | FOREIGN KEY â†’ users(id) | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è€…ID |
| created_at | TIMESTAMP | DEFAULT NOW() | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ—¥æ™‚ |

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œä¾‹

```javascript
// server/src/infra/db.mjs
import { drizzle } from 'drizzle-orm/libsql';
import { createClient } from '@libsql/client';

const client = createClient({
  url: process.env.DATABASE_URL,
  authToken: process.env.DATABASE_AUTH_TOKEN
});

export const db = drizzle(client);

// ã‚¯ã‚¨ãƒªä¾‹
import { users } from './db/schema/users';
import { eq } from 'drizzle-orm';

// SELECT
const user = await db.select().from(users).where(eq(users.id, 1));

// INSERT
await db.insert(users).values({
  username: 'newuser',
  password: hashedPassword,
  role: 'user'
});

// UPDATE
await db.update(users)
  .set({ email: 'new@example.com' })
  .where(eq(users.id, 1));

// DELETE
await db.delete(users).where(eq(users.id, 1));
```

---

## èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

```javascript
// server/src/config/session.mjs
import session from 'express-session';
import MemoryStore from 'memorystore';

const MemoryStoreSession = MemoryStore(session);

export const createSessionMiddleware = () => {
  return session({
    secret: process.env.SESSION_SECRET,
    resave: false,
    saveUninitialized: false,
    store: new MemoryStoreSession({
      checkPeriod: 86400000 // 24æ™‚é–“
    }),
    cookie: {
      secure: process.env.NODE_ENV === 'production', // HTTPSç’°å¢ƒã§ã®ã¿true
      httpOnly: true,
      maxAge: 24 * 60 * 60 * 1000, // 24æ™‚é–“
      sameSite: 'lax'
    }
  });
};
```

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ³ã‚°

```javascript
import bcrypt from 'bcryptjs';

// ãƒãƒƒã‚·ãƒ¥åŒ–
const salt = await bcrypt.genSalt(10);
const hashedPassword = await bcrypt.hash(plainPassword, salt);

// æ¤œè¨¼
const isValid = await bcrypt.compare(plainPassword, hashedPassword);
```

### èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

```javascript
// server/src/middleware/auth.mjs
export const requireAuth = (req, res, next) => {
  if (!req.session || !req.session.userId) {
    return res.status(401).json({
      error: 'unauthorized',
      message: 'èªè¨¼ãŒå¿…è¦ã§ã™'
    });
  }
  next();
};

export const requireAdmin = (req, res, next) => {
  if (!req.session?.user || req.session.user.role !== 'admin') {
    return res.status(403).json({
      error: 'forbidden',
      message: 'ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™'
    });
  }
  next();
};
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ (Helmet)

```javascript
// server/src/config/security.mjs
import helmet from 'helmet';

export const createSecurityMiddleware = () => {
  return helmet({
    contentSecurityPolicy: {
      directives: {
        defaultSrc: ["'self'"],
        scriptSrc: ["'self'", "'unsafe-inline'"],
        styleSrc: ["'self'", "'unsafe-inline'"],
        imgSrc: ["'self'", "data:", "https:"],
        connectSrc: ["'self'", "https://api.openai.com"]
      }
    },
    hsts: {
      maxAge: 31536000,
      includeSubDomains: true,
      preload: true
    }
  });
};
```

### CORSè¨­å®š

```javascript
// server/src/config/cors.mjs
export const corsOptions = {
  origin: (origin, callback) => {
    const allowedOrigins = process.env.CORS_ALLOW_ORIGINS?.split(',') || ['*'];
    
    if (allowedOrigins.includes('*') || !origin || allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('CORS policy violation'));
    }
  },
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
};
```

---

## ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç®¡ç†

### Azure Blob Storage

```javascript
// server/src/infra/blob.mjs
import { BlobServiceClient } from '@azure/storage-blob';
import { DefaultAzureCredential } from '@azure/identity';

export const getBlobServiceClient = () => {
  const connectionString = process.env.AZURE_STORAGE_CONNECTION_STRING;
  
  if (connectionString) {
    return BlobServiceClient.fromConnectionString(connectionString);
  }
  
  // ãƒãƒãƒ¼ã‚¸ãƒ‰IDã‚’ä½¿ç”¨
  const accountName = process.env.AZURE_STORAGE_ACCOUNT_NAME;
  const credential = new DefaultAzureCredential();
  return new BlobServiceClient(
    `https://${accountName}.blob.core.windows.net`,
    credential
  );
};

export const containerName = process.env.BLOB_CONTAINER_NAME || 'knowledge-base';
```

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

```javascript
// server/src/api/images/index.mjs
import multer from 'multer';
import { getBlobServiceClient, containerName } from '../../infra/blob.mjs';

const upload = multer({
  storage: multer.memoryStorage(),
  limits: { fileSize: 10 * 1024 * 1024 }, // 10MB
  fileFilter: (req, file, cb) => {
    if (file.mimetype.startsWith('image/')) {
      cb(null, true);
    } else {
      cb(new Error('ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™'));
    }
  }
});

export default function (app) {
  app.post('/api/images/upload', upload.single('file'), async (req, res) => {
    try {
      const blobClient = getBlobServiceClient();
      const containerClient = blobClient.getContainerClient(containerName);
      
      const blobName = `images/${Date.now()}-${req.file.originalname}`;
      const blockBlobClient = containerClient.getBlockBlobClient(blobName);
      
      await blockBlobClient.upload(req.file.buffer, req.file.size, {
        blobHTTPHeaders: {
          blobContentType: req.file.mimetype
        }
      });
      
      res.json({
        url: blockBlobClient.url,
        filename: blobName,
        size: req.file.size,
        contentType: req.file.mimetype
      });
    } catch (error) {
      console.error('Upload error:', error);
      res.status(500).json({ error: 'upload_failed', message: error.message });
    }
  });
}
```

### ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰

é–‹ç™ºç’°å¢ƒã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨:

```javascript
// server/uploads/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜
const storage = multer.diskStorage({
  destination: './server/uploads',
  filename: (req, file, cb) => {
    cb(null, `${Date.now()}-${file.originalname}`);
  }
});
```

---

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

#### TypeScript/JavaScript

```typescript
// âœ… è‰¯ã„ä¾‹
import { useState, useEffect } from 'react';

interface User {
  id: number;
  username: string;
  role: 'admin' | 'user';
}

export const UserProfile: React.FC<{ userId: number }> = ({ userId }) => {
  const [user, setUser] = useState<User | null>(null);
  
  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, [userId]);
  
  return <div>{user?.username}</div>;
};

// âŒ æ‚ªã„ä¾‹
export default function UserProfile(props) {
  const [user, setUser] = useState(null);
  useEffect(() => {
    fetch('/api/users/' + props.userId)
      .then(res => res.json())
      .then(data => setUser(data));
  });
  return <div>{user && user.username}</div>;
}
```

#### å‘½åè¦å‰‡

- **ãƒ•ã‚¡ã‚¤ãƒ«å**: kebab-case (ä¾‹: `user-profile.tsx`)
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: PascalCase (ä¾‹: `UserProfile`)
- **é–¢æ•°ãƒ»å¤‰æ•°**: camelCase (ä¾‹: `fetchUser`, `isLoading`)
- **å®šæ•°**: UPPER_SNAKE_CASE (ä¾‹: `API_BASE_URL`)
- **å‹ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: PascalCase (ä¾‹: `User`, `ApiResponse`)

#### ESLintè¨­å®š

```javascript
// eslint.config.js
export default {
  extends: [
    'eslint:recommended',
    'plugin:@typescript-eslint/recommended',
    'plugin:react/recommended',
    'plugin:react-hooks/recommended'
  ],
  rules: {
    'no-console': ['warn', { allow: ['warn', 'error'] }],
    '@typescript-eslint/no-explicit-any': 'warn',
    'react/prop-types': 'off'
  }
};
```

### Git ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```bash
# 1. æ–°æ©Ÿèƒ½ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
git checkout -b feature/new-feature

# 2. ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªå‹•å®Ÿè¡Œï¼‰
npm run pre-commit

# 3. ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "feat: add new feature"

# 4. ãƒ—ãƒƒã‚·ãƒ¥å‰ãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªå‹•å®Ÿè¡Œï¼‰
git push origin feature/new-feature

# 5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ
```

#### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´„

Conventional Commitså½¢å¼:

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type**:
- `feat`: æ–°æ©Ÿèƒ½
- `fix`: ãƒã‚°ä¿®æ­£
- `docs`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¤‰æ›´
- `style`: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- `refactor`: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `test`: ãƒ†ã‚¹ãƒˆè¿½åŠ 
- `chore`: ãƒ“ãƒ«ãƒ‰ãƒ»è¨­å®šå¤‰æ›´

**ä¾‹**:
```
feat(auth): add password reset functionality

- Add forgot password endpoint
- Send reset email via SendGrid
- Add password reset form to client

Closes #123
```

### ãƒ†ã‚¹ãƒˆ

```javascript
// tests/api/auth.test.js
import { describe, it, expect } from 'vitest';
import request from 'supertest';
import { createApp } from '../server/src/app.mjs';

describe('Auth API', () => {
  it('should login with valid credentials', async () => {
    const app = await createApp();
    const response = await request(app)
      .post('/api/auth/login')
      .send({ username: 'admin', password: 'admin123' });
    
    expect(response.status).toBe(200);
    expect(response.body.user).toBeDefined();
  });
});
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### Docker ãƒ‡ãƒ—ãƒ­ã‚¤

#### Dockerfile

```dockerfile
FROM node:20-alpine

WORKDIR /app

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY package*.json ./
COPY server/package*.json ./server/
COPY client/package*.json ./client/
RUN npm ci --only=production

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
COPY . .

# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ãƒ“ãƒ«ãƒ‰
RUN npm run build:client

EXPOSE 8080

CMD ["npm", "run", "start:prod"]
```

#### Docker Compose (æœ¬ç•ª)

```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=${DATABASE_URL}
      - AZURE_STORAGE_CONNECTION_STRING=${AZURE_STORAGE_CONNECTION_STRING}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    restart: unless-stopped
```

### Azure App Service ãƒ‡ãƒ—ãƒ­ã‚¤

#### GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```yaml
# .github/workflows/azure-deploy.yml
name: Deploy to Azure

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install dependencies
      run: |
        npm ci
        cd server && npm ci
        cd ../client && npm ci
    
    - name: Build client
      run: npm run build:client
    
    - name: Deploy to Azure
      uses: azure/webapps-deploy@v2
      with:
        app-name: ${{ secrets.AZURE_APP_NAME }}
        publish-profile: ${{ secrets.AZURE_PUBLISH_PROFILE }}
        package: .
```

### ç’°å¢ƒå¤‰æ•°ç®¡ç†

#### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º

`.env`ãƒ•ã‚¡ã‚¤ãƒ«:

```bash
NODE_ENV=development
PORT=8080
DATABASE_URL=file:./local.db
SESSION_SECRET=local-dev-secret-change-in-production
CORS_ALLOW_ORIGINS=http://localhost:5173,http://localhost:8080
```

#### Azure App Service

Azure Portalã§è¨­å®š:

1. App Service â†’ ã€Œæ§‹æˆã€
2. ã€Œæ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ :
   - `NODE_ENV=production`
   - `DATABASE_URL=<Turso connection string>`
   - `DATABASE_AUTH_TOKEN=<Turso token>`
   - `AZURE_STORAGE_CONNECTION_STRING=<connection string>`
   - `OPENAI_API_KEY=<API key>`
   - `SESSION_SECRET=<strong random string>`

---

## ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ãƒ‘ã‚¹ | èª¬æ˜ |
|----------|------|------|
| `npm run dev` | root | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆçµ±åˆï¼‰ |
| `npm run start:prod` | root | æœ¬ç•ªã‚µãƒ¼ãƒãƒ¼èµ·å‹• |
| `npm run build:client` | root | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ“ãƒ«ãƒ‰ |
| `npm run docker:dev` | root | Dockeré–‹ç™ºç’°å¢ƒèµ·å‹• |
| `npm run docker:prod` | root | Dockeræœ¬ç•ªç’°å¢ƒèµ·å‹• |
| `npm run pre-deploy` | root | ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯ |

### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### `scripts/kill-port-8080.ps1`

```powershell
# ãƒãƒ¼ãƒˆ8080ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†
.\scripts\kill-port-8080.ps1
```

#### `scripts/check-azure-auth-status.ps1`

```powershell
# Azureèªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª
.\scripts\check-azure-auth-status.ps1
```

å‡ºåŠ›ä¾‹:
```
âœ“ Azure CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
âœ“ ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿
âœ“ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³: "My Subscription"
```

#### `scripts/upload-images-to-blob.mjs`

```powershell
# knowledge-base/images/ å†…ã®ç”»åƒã‚’Blob Storageã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
node scripts/upload-images-to-blob.mjs
```

#### `scripts/generate-password-hash.js`

```powershell
# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®bcryptãƒãƒƒã‚·ãƒ¥ã‚’ç”Ÿæˆ
node scripts/generate-password-hash.js
# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
# å‡ºåŠ›: $2a$10$...
```

#### `scripts/check-rsc-vulnerabilities.mjs`

```powershell
# RSCï¼ˆReact Server Componentsï¼‰ã®è„†å¼±æ€§ã‚’ãƒã‚§ãƒƒã‚¯
npm run security:check-rsc
```

#### `scripts/pre-deploy-check.mjs`

```powershell
# ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ç·åˆãƒã‚§ãƒƒã‚¯
npm run pre-deploy
```

ãƒã‚§ãƒƒã‚¯é …ç›®:
- âœ“ ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼
- âœ“ ãƒ“ãƒ«ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
- âœ“ ä¾å­˜é–¢ä¿‚ã®æ•´åˆæ€§
- âœ“ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³

### ã‚µãƒ¼ãƒãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### `server/test-blob-connection.mjs`

```powershell
# Blob Storageæ¥ç¶šãƒ†ã‚¹ãƒˆ
node server/test-blob-connection.mjs
```

#### `server/check-table-structure.mjs`

```powershell
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã‚’ç¢ºèª
node server/check-table-structure.mjs
```

#### `server/reset-passwords.mjs`

```powershell
# å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
node server/reset-passwords.mjs
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´

```javascript
// ã‚³ãƒ¼ãƒ‰åˆ†å‰²ï¼ˆReact.lazyï¼‰
const AdminPanel = React.lazy(() => import('./pages/AdminPanel'));

// ä½¿ç”¨ä¾‹
<Suspense fallback={<Loading />}>
  <AdminPanel />
</Suspense>
```

### ã‚µãƒ¼ãƒãƒ¼å´

```javascript
// ãƒ¬ã‚¹ãƒãƒ³ã‚¹åœ§ç¸®
import compression from 'compression';
app.use(compression());

// é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
app.use(express.static('client/dist', {
  maxAge: '7d',
  etag: true,
  immutable: true
}));
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

```javascript
// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ
await db.execute(sql`CREATE INDEX idx_users_username ON users(username)`);

// ã‚¯ã‚¨ãƒªæœ€é©åŒ–ï¼ˆå¿…è¦ãªã‚«ãƒ©ãƒ ã®ã¿å–å¾—ï¼‰
const users = await db.select({
  id: users.id,
  username: users.username
}).from(users);
```

---

## ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ»ãƒ­ã‚®ãƒ³ã‚°

### ãƒ­ã‚°å‡ºåŠ›

```javascript
// server/src/config/logger.mjs
import morgan from 'morgan';

export const loggerMiddleware = morgan(
  process.env.NODE_ENV === 'production' ? 'combined' : 'dev'
);
```

### Azure Application Insightsï¼ˆæ¨å¥¨ï¼‰

```javascript
import appInsights from 'applicationinsights';

if (process.env.APPLICATIONINSIGHTS_CONNECTION_STRING) {
  appInsights.setup().start();
}
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼‰

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

```powershell
# Node.js ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãƒ¼ã§ãƒ‡ãƒãƒƒã‚°
node --inspect server/azure-server.mjs

# Chrome DevToolsã§ã‚¢ã‚¯ã‚»ã‚¹: chrome://inspect
```

### ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«

```bash
# ç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡
LOG_LEVEL=debug npm run dev
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°

```javascript
// server/src/middleware/performance.mjs
export const performanceMonitor = (req, res, next) => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = Date.now() - start;
    if (duration > 1000) {
      console.warn(`Slow request: ${req.method} ${req.path} - ${duration}ms`);
    }
  });
  
  next();
};
```

---

## ä»˜éŒ²

### ç’°å¢ƒå¤‰æ•°ä¸€è¦§

| å¤‰æ•°å | å¿…é ˆ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|-------|-----|----------|------|
| `NODE_ENV` | â—‹ | development | å®Ÿè¡Œç’°å¢ƒ |
| `PORT` | | 8080 | ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒˆ |
| `DATABASE_URL` | â—‹ | | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ–‡å­—åˆ— |
| `DATABASE_AUTH_TOKEN` | | | Tursoèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ |
| `AZURE_STORAGE_CONNECTION_STRING` | | | Azure Storageæ¥ç¶šæ–‡å­—åˆ— |
| `BLOB_CONTAINER_NAME` | | knowledge-base | Blobã‚³ãƒ³ãƒ†ãƒŠå |
| `OPENAI_API_KEY` | | | OpenAI APIã‚­ãƒ¼ |
| `SESSION_SECRET` | â—‹ | | ã‚»ãƒƒã‚·ãƒ§ãƒ³æš—å·åŒ–ã‚­ãƒ¼ |
| `CORS_ALLOW_ORIGINS` | | * | CORSè¨±å¯ã‚ªãƒªã‚¸ãƒ³ |

### ä¾å­˜é–¢ä¿‚ã®æ›´æ–°

```powershell
# å¤ã„ä¾å­˜é–¢ä¿‚ã‚’ãƒã‚§ãƒƒã‚¯
npm outdated

# ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
npm update

# ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆæ…é‡ã«ï¼‰
npx npm-check-updates -u
npm install
```

### ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ MIT ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´12æœˆ11æ—¥  
**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0  
**å¯¾è±¡ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.2
